var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,d,b){c!=Array.prototype&&c!=Object.prototype&&(c[d]=b.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var d=0;return $jscomp.iteratorPrototype(function(){return d<c.length?{done:!1,value:c[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,d){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var b=0,a={next:function(){if(b<c.length){var g=b++;return{value:d(g,c[g]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};
$jscomp.polyfill=function(c,d,b,a){if(d){b=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var g=c[a];g in b||(b[g]={});b=b[g]}c=c[c.length-1];a=b[c];d=d(a);d!=a&&null!=d&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6","es3");
$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var d=c[Symbol.iterator];return d?d.call(c):$jscomp.arrayIterator(c)};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function d(){this.batch_=null}function b(a){return a instanceof g?a:new g(function(b,c){b(a)})}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;d.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};d.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var a=$jscomp.global.setTimeout;d.prototype.asyncExecuteFunction=function(b){a(b,
0)};d.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(p){this.asyncThrow_(p)}}}this.batch_=null};d.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var g=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(n){b.reject(n)}};g.prototype.createResolveAndReject_=
function(){function a(a){return function(m){c||(c=!0,a.call(b,m))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};g.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof g)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};g.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(n){this.reject_(n);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};g.prototype.reject_=function(a){this.settle_(2,a)};g.prototype.fulfill_=function(a){this.settle_(1,a)};g.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};g.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new d;g.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};g.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(p){c.reject(p)}};g.prototype.then=function(a,b){function c(a,k){return"function"==typeof a?function(k){try{d(a(k))}catch(y){m(y)}}:k}var d,m,r=new g(function(a,
k){d=a;m=k});this.callWhenSettled_(c(a,d),c(b,m));return r};g.prototype.catch=function(a){return this.then(void 0,a)};g.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};g.resolve=b;g.reject=function(a){return new g(function(b,c){c(a)})};g.race=function(a){return new g(function(c,
d){for(var g=$jscomp.makeIterator(a),m=g.next();!m.done;m=g.next())b(m.value).callWhenSettled_(c,d)})};g.all=function(a){var c=$jscomp.makeIterator(a),d=c.next();return d.done?b([]):new g(function(a,m){function r(b){return function(c){h[b]=c;k--;0==k&&a(h)}}var h=[],k=0;do h.push(void 0),k++,b(d.value).callWhenSettled_(r(h.length-1),m),d=c.next();while(!d.done)})};return g},"es6","es3");
(function(){function c(a){return new Promise(function(b,c){d(a,b,c)})}var d=null,b=null,a={log:function(){"undefined"!==typeof module||"function"===typeof require&&"function"===typeof define||(window.webrtcLogDebug=void 0!=window.webrtcLogDebug&&"boolean"===typeof window.webrtcLogDebug?window.webrtcLogDebug:!0,window.webrtcLogDebug&&console.log.apply(console,arguments))},extractVersion:function(a,b,c){return(a=a.match(b))&&a.length>=c&&parseInt(a[c],10)}};"object"===typeof window&&(!window.HTMLMediaElement||
"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(a){"mozSrcObject"in this?this.mozSrcObject=a:(this._srcObject=a,this.src=URL.createObjectURL(a))}}),d=window.navigator&&window.navigator.getUserMedia);if("undefined"!==typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(a.log("This appears to be Firefox"),b=a.extractVersion(navigator.userAgent,
/Firefox\/([0-9]+)\./,1),window.RTCPeerConnection||(window.RTCPeerConnection=function(a,c){if(38>b&&a&&a.iceServers){for(var h=[],k=0;k<a.iceServers.length;k++){var v=a.iceServers[k];if(v.hasOwnProperty("urls"))for(var m=0;m<v.urls.length;m++){var r={url:v.urls[m]};0===v.urls[m].indexOf("turn")&&(r.username=v.username,r.credential=v.credential);h.push(r)}else h.push(a.iceServers[k])}a.iceServers=h}return new mozRTCPeerConnection(a,c)},mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,
"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),d=function(c,r,h){var k=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(k){if("require"!==k&&"advanced"!==k&&"mediaSource"!==k){var c=a[k]="object"===typeof a[k]?a[k]:{ideal:a[k]};void 0===
c.min&&void 0===c.max&&void 0===c.exact||b.push(k);void 0!==c.exact&&("number"===typeof c.exact?c.min=c.max=c.exact:a[k]=c.exact,delete c.exact);if(void 0!==c.ideal){a.advanced=a.advanced||[];var h={};h[k]="number"===typeof c.ideal?{min:c.ideal,max:c.ideal}:c.ideal;a.advanced.push(h);delete c.ideal;Object.keys(c).length||delete a[k]}}});b.length&&(a.require=b);return a};38>b&&(a.log("spec: "+JSON.stringify(c)),c.audio&&(c.audio=k(c.audio)),c.video&&(c.video=k(c.video)),a.log("ff37: "+JSON.stringify(c)));
return navigator.mozGetUserMedia(c,r,h)},navigator.getUserMedia=d,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},41>b){var g=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);
navigator.mediaDevices.enumerateDevices=function(){return g().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){a.log("This appears to be Chrome");b=a.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);window.RTCPeerConnection=function(a,b){a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);a=new webkitRTCPeerConnection(a,b);var c=a.getStats.bind(a);a.getStats=function(a,b,h){var k=
this,v=arguments;if(0<arguments.length&&"function"===typeof a)return c(a,b);var m=function(a){var k={};a.result().forEach(function(a){var b={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(k){b[k]=a.stat(k)});k[b.id]=b});return k};return 2<=arguments.length?c.apply(this,[function(a){v[1](m(a))},arguments[0]]):new Promise(function(b,h){1===v.length&&null===a?c.apply(k,[function(a){b.apply(null,[m(a)])},h]):c.apply(k,[b,h])})};return a};webkitRTCPeerConnection.generateCertificate&&
Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}});["createOffer","createAnswer"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var k=1===arguments.length?arguments[0]:void 0;return new Promise(function(c,
h){b.apply(a,[c,h,k])})}return b.apply(this,arguments)}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,k=this;return new Promise(function(c,h){b.apply(k,[a[0],function(){c();2<=a.length&&a[1].apply(null,[])},function(b){h(b);3<=a.length&&a[2].apply(null,[b])}])})}});var f=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(c){if("require"!==
c&&"advanced"!==c&&"mediaSource"!==c){var k="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0!==k.exact&&"number"===typeof k.exact&&(k.min=k.max=k.exact);var h=function(a,b){return a?a+b.charAt(0).toUpperCase()+b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==k.ideal){b.optional=b.optional||[];var m={};"number"===typeof k.ideal?(m[h("min",c)]=k.ideal,b.optional.push(m),m={},m[h("max",c)]=k.ideal):m[h("",c)]=k.ideal;b.optional.push(m)}void 0!==k.exact&&"number"!==typeof k.exact?(b.mandatory=b.mandatory||
{},b.mandatory[h("",c)]=k.exact):["min","max"].forEach(function(a){void 0!==k[a]&&(b.mandatory=b.mandatory||{},b.mandatory[h(a,c)]=k[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));return b};d=function(b,c,h){b.audio&&(b.audio=f(b.audio));b.video&&(b.video=f(b.video));a.log("chrome: "+JSON.stringify(b));return navigator.webkitGetUserMedia(b,c,h)};navigator.getUserMedia=d;navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(a){var b=
{audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}});if(navigator.mediaDevices.getUserMedia){var t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(b){a.log("spec:   "+JSON.stringify(b));b.audio=f(b.audio);b.video=f(b.video);a.log("chrome: "+JSON.stringify(b));return t(b)}}else navigator.mediaDevices.getUserMedia=
function(a){return c(a)};"undefined"===typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){a.log("Dummy mediaDevices.addEventListener called.")});"undefined"===typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){a.log("Dummy mediaDevices.removeEventListener called.")})}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){if(a.log("This appears to be Edge"),b=a.extractVersion(navigator.userAgent,
/Edge\/(\d+).(\d+)$/,2),window.RTCIceGatherer){var q=Math.random().toString(36).substr(2,10),n={splitLines:function(a){return a.trim().split("\n").map(function(a){return a.trim()})},splitSections:function(a){return a.split("\r\nm\x3d").map(function(a,b){return(0<b?"m\x3d"+a:a).trim()+"\r\n"})},matchPrefix:function(a,b){return n.splitLines(a).filter(function(a){return 0===a.indexOf(b)})},parseCandidate:function(a){a=0===a.indexOf("a\x3dcandidate:")?a.substring(12).split(" "):a.substring(10).split(" ");
for(var b={foundation:a[0],component:a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],port:parseInt(a[5],10),type:a[7]},c=8;c<a.length;c+=2)switch(a[c]){case "raddr":b.relatedAddress=a[c+1];break;case "rport":b.relatedPort=parseInt(a[c+1],10);break;case "tcptype":b.tcpType=a[c+1]}return b},writeCandidate:function(a){var b=[];b.push(a.foundation);b.push(a.component);b.push(a.protocol.toUpperCase());b.push(a.priority);b.push(a.ip);b.push(a.port);var c=a.type;b.push("typ");b.push(c);
"host"!==c&&a.relatedAddress&&a.relatedPort&&(b.push("raddr"),b.push(a.relatedAddress),b.push("rport"),b.push(a.relatedPort));a.tcpType&&"tcp"===a.protocol.toLowerCase()&&(b.push("tcptype"),b.push(a.tcpType));return"candidate:"+b.join(" ")},parseRtpMap:function(a){a=a.substr(9).split(" ");var b={payloadType:parseInt(a.shift(),10)};a=a[0].split("/");b.name=a[0];b.clockRate=parseInt(a[1],10);b.numChannels=3===a.length?parseInt(a[2],10):1;return b},writeRtpMap:function(a){var b=a.payloadType;void 0!==
a.preferredPayloadType&&(b=a.preferredPayloadType);return"a\x3drtpmap:"+b+" "+a.name+"/"+a.clockRate+(1!==a.numChannels?"/"+a.numChannels:"")+"\r\n"},parseFmtp:function(a){for(var b={},c=a.substr(a.indexOf(" ")+1).split(";"),k=0;k<c.length;k++)a=c[k].trim().split("\x3d"),b[a[0].trim()]=a[1];return b},writeFtmp:function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);if(a.parameters&&a.parameters.length){var k=[];Object.keys(a.parameters).forEach(function(b){k.push(b+
"\x3d"+a.parameters[b])});b+="a\x3dfmtp:"+c+" "+k.join(";")+"\r\n"}return b},parseRtcpFb:function(a){a=a.substr(a.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},writeRtcpFb:function(a){var b="",c=a.payloadType;void 0!==a.preferredPayloadType&&(c=a.preferredPayloadType);a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(a){b+="a\x3drtcp-fb:"+c+" "+a.type+" "+a.parameter+"\r\n"});return b},parseSsrcMedia:function(a){var b=a.indexOf(" "),c={ssrc:a.substr(7,
b-7)},k=a.indexOf(":",b);-1<k?(c.attribute=a.substr(b+1,k-b-1),c.value=a.substr(k+1)):c.attribute=a.substr(b+1);return c},getDtlsParameters:function(a,b){a=n.splitLines(a);a=a.concat(n.splitLines(b));b=a.filter(function(a){return 0===a.indexOf("a\x3dfingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:b.split(" ")[0],value:b.split(" ")[1]}]}},writeDtlsParameters:function(a,b){var c="a\x3dsetup:"+b+"\r\n";a.fingerprints.forEach(function(a){c+="a\x3dfingerprint:"+a.algorithm+" "+
a.value+"\r\n"});return c},getIceParameters:function(a,b){a=n.splitLines(a);a=a.concat(n.splitLines(b));return{usernameFragment:a.filter(function(a){return 0===a.indexOf("a\x3dice-ufrag:")})[0].substr(12),password:a.filter(function(a){return 0===a.indexOf("a\x3dice-pwd:")})[0].substr(10)}},writeIceParameters:function(a){return"a\x3dice-ufrag:"+a.usernameFragment+"\r\na\x3dice-pwd:"+a.password+"\r\n"},parseRtpParameters:function(a){for(var b={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},
c=n.splitLines(a)[0].split(" "),k=3;k<c.length;k++){var v=c[k],d=n.matchPrefix(a,"a\x3drtpmap:"+v+" ")[0];if(d){d=n.parseRtpMap(d);var g=n.matchPrefix(a,"a\x3dfmtp:"+v+" ");d.parameters=g.length?n.parseFmtp(g[0]):{};d.rtcpFeedback=n.matchPrefix(a,"a\x3drtcp-fb:"+v+" ").map(n.parseRtcpFb);b.codecs.push(d)}}return b},writeRtpDescription:function(a,b){var c="";c+="m\x3d"+a+" ";c+=0<b.codecs.length?"9":"0";c+=" UDP/TLS/RTP/SAVPF ";c+=b.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:
a.payloadType}).join(" ")+"\r\n";c+="c\x3dIN IP4 0.0.0.0\r\n";c+="a\x3drtcp:9 IN IP4 0.0.0.0\r\n";b.codecs.forEach(function(a){c+=n.writeRtpMap(a);c+=n.writeFtmp(a);c+=n.writeRtcpFb(a)});return c+="a\x3drtcp-mux\r\n"},writeSessionBoilerplate:function(){return"v\x3d0\r\no\x3dthisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns\x3d-\r\nt\x3d0 0\r\n"},writeMediaSection:function(a,b,c,k){b=n.writeRtpDescription(a.kind,b);b+=n.writeIceParameters(a.iceGatherer.getLocalParameters());b+=n.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),
"offer"===c?"actpass":"active");b+="a\x3dmid:"+a.mid+"\r\n";b=a.rtpSender&&a.rtpReceiver?b+"a\x3dsendrecv\r\n":a.rtpSender?b+"a\x3dsendonly\r\n":a.rtpReceiver?b+"a\x3drecvonly\r\n":b+"a\x3dinactive\r\n";a.rtpSender&&(c="msid:"+k.id+" "+a.rtpSender.track.id+"\r\n",b=b+("a\x3d"+c)+("a\x3dssrc:"+a.sendSsrc+" "+c));return b+="a\x3dssrc:"+a.sendSsrc+" cname:"+q+"\r\n"},getDirection:function(a,b){a=n.splitLines(a);for(var c=0;c<a.length;c++)switch(a[c]){case "a\x3dsendrecv":case "a\x3dsendonly":case "a\x3drecvonly":case "a\x3dinactive":return a[c].substr(2)}return b?
n.getDirection(b):"sendrecv"}};window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a});window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a});window.RTCPeerConnection=function(a){var b=this;this.ondatachannel=this.onnegotiationneeded=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onremovestream=this.onaddstream=this.onicecandidate=null;this.localStreams=[];this.remoteStreams=[];this.getLocalStreams=function(){return b.localStreams};this.getRemoteStreams=
function(){return b.remoteStreams};this.localDescription=new RTCSessionDescription({type:"",sdp:""});this.remoteDescription=new RTCSessionDescription({type:"",sdp:""});this.signalingState="stable";this.iceConnectionState="new";this.iceOptions={gatherPolicy:"all",iceServers:[]};if(a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case "all":case "relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case "none":throw new TypeError('iceTransportPolicy "none" not supported');}a&&a.iceServers&&
a.iceServers.forEach(function(a){if(a.urls){var c="string"===typeof a.urls?a.urls:a.urls[0];-1!==c.indexOf("transport\x3dudp")&&b.iceServers.push({username:a.username,credential:a.credential,urls:c})}});this.transceivers=[];this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this;this._localIceCandidatesBuffer.forEach(function(b){if(null!==a.onicecandidate)a.onicecandidate(b)});this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype.addStream=
function(a){this.localStreams.push(a.clone());this._maybeFireNegotiationNeeded()};window.RTCPeerConnection.prototype.removeStream=function(a){a=this.localStreams.indexOf(a);-1<a&&(this.localStreams.splice(a,1),this._maybeFireNegotiationNeeded())};window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};a.codecs.forEach(function(a){for(var k=0;k<b.codecs.length;k++){var h=b.codecs[k];if(a.name.toLowerCase()===h.name.toLowerCase()&&
a.clockRate===h.clockRate&&a.numChannels===h.numChannels){c.codecs.push(h);break}}});a.headerExtensions.forEach(function(a){for(var k=0;k<b.headerExtensions.length;k++){var h=b.headerExtensions[k];if(a.uri===h.uri){c.headerExtensions.push(h);break}}});return c};window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,k=new RTCIceGatherer(c.iceOptions),v=new RTCIceTransport(k);k.onlocalcandidate=function(h){var d={};d.candidate={sdpMid:a,sdpMLineIndex:b};(h=h.candidate)&&
0!==Object.keys(h).length?(h.component="RTCP"===v.component?2:1,d.candidate.candidate=n.writeCandidate(h)):(void 0===k.state&&(k.state="completed"),d.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");h=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});if(null!==c.onicecandidate)if(c.localDescription&&""===c.localDescription.type)c._localIceCandidatesBuffer.push(d),h&&c._localIceCandidatesBuffer.push({});else if(c.onicecandidate(d),h)c.onicecandidate({})};
v.onicestatechange=function(){c._updateConnectionState()};var d=new RTCDtlsTransport(v);d.ondtlsstatechange=function(){c._updateConnectionState()};d.onerror=function(){d.state="failed";c._updateConnectionState()};return{iceGatherer:k,iceTransport:v,dtlsTransport:d}};window.RTCPeerConnection.prototype._transceive=function(a,b,c){var k=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(k.encodings=[{ssrc:a.sendSsrc}],k.rtcp={cname:q,ssrc:a.recvSsrc},a.rtpSender.send(k));
c&&a.rtpReceiver&&(k.encodings=[{ssrc:a.recvSsrc}],k.rtcp={cname:a.cname,ssrc:a.sendSsrc},a.rtpReceiver.receive(k))};window.RTCPeerConnection.prototype.setLocalDescription=function(a){var b=this;if("offer"===a.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){var c=n.splitSections(b.remoteDescription.sdp),k=c.shift();c.forEach(function(a,c){c=b.transceivers[c];var v=c.iceGatherer,h=c.iceTransport,d=c.dtlsTransport,g=c.localCapabilities,
f=c.remoteCapabilities;if("0"!==a.split("\n",1)[0].split(" ",2)[1]){var r=n.getIceParameters(a,k);h.start(v,r,"controlled");a=n.getDtlsParameters(a,k);d.start(a);a=b._getCommonCapabilities(g,f);b._transceive(c,0<a.codecs.length,!1)}})}this.localDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}var v=1<arguments.length&&"function"===typeof arguments[1];
if(v){var d=arguments[1];window.setTimeout(function(){d();b._emitBufferedCandidates()},0)}c=Promise.resolve();c.then(function(){v||window.setTimeout(b._emitBufferedCandidates.bind(b),0)});return c};window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,k=n.splitSections(a.sdp),v=k.shift();k.forEach(function(k,h){var d=n.splitLines(k)[0].substr(2).split(" "),g=d[0],f="0"===d[1];d=n.getDirection(k,v);var r=n.parseRtpParameters(k);if(!f){var m=n.getIceParameters(k,
v);var D=n.getDtlsParameters(k,v)}var p=n.matchPrefix(k,"a\x3dmid:")[0].substr(6);if(k=n.matchPrefix(k,"a\x3dssrc:").map(function(a){return n.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0]){var y=parseInt(k.ssrc,10);var t=k.value}if("offer"===a.type){m=b._createIceAndDtlsTransports(p,h);var q=RTCRtpReceiver.getCapabilities(g);f=1001*(2*h+2);k=new RTCRtpReceiver(m.dtlsTransport,g);c.addTrack(k.track);if(0<b.localStreams.length&&b.localStreams[0].getTracks().length>=h){var J=
b.localStreams[0].getTracks()[h];J=new RTCRtpSender(J,m.dtlsTransport)}b.transceivers[h]={iceGatherer:m.iceGatherer,iceTransport:m.iceTransport,dtlsTransport:m.dtlsTransport,localCapabilities:q,remoteCapabilities:r,rtpSender:J,rtpReceiver:k,kind:g,mid:p,cname:t,sendSsrc:f,recvSsrc:y};b._transceive(b.transceivers[h],!1,"sendrecv"===d||"sendonly"===d)}else if("answer"===a.type&&!f){g=b.transceivers[h];p=g.iceGatherer;var W=g.iceTransport;var X=g.dtlsTransport;J=g.rtpSender;k=g.rtpReceiver;f=g.sendSsrc;
q=g.localCapabilities;b.transceivers[h].recvSsrc=y;b.transceivers[h].remoteCapabilities=r;b.transceivers[h].cname=t;W.start(p,m,"controlling");X.start(D);b._transceive(g,"sendrecv"===d||"recvonly"===d,"sendrecv"===d||"sendonly"===d);!k||"sendrecv"!==d&&"sendonly"!==d?delete g.rtpReceiver:c.addTrack(k.track)}});this.remoteDescription=a;switch(a.type){case "offer":this._updateSignalingState("have-remote-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+
a.type+'"');}window.setTimeout(function(){null!==b.onaddstream&&c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){b.onaddstream({stream:c})},0))},0);1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&
a.rtpReceiver.stop()});this._updateSignalingState("closed")};window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;if(null!==this.onsignalingstatechange)this.onsignalingstatechange()};window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){if(null!==this.onnegotiationneeded)this.onnegotiationneeded()};window.RTCPeerConnection.prototype._updateConnectionState=function(){var a={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};
this.transceivers.forEach(function(b){a[b.iceTransport.state]++;a[b.dtlsTransport.state]++});a.connected+=a.completed;var b="new";if(0<a.failed)b="failed";else if(0<a.connecting||0<a.checking)b="connecting";else if(0<a.disconnected)b="disconnected";else if(0<a.new)b="new";else if(0<a.connecting||0<a.completed)b="connected";if(b!==this.iceConnectionState&&(this.iceConnectionState=b,null!==this.oniceconnectionstatechange))this.oniceconnectionstatechange()};window.RTCPeerConnection.prototype.createOffer=
function(){var a=this;if(this._pendingOffer)throw Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!==typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],k=0,v=0;this.localStreams.length&&(k=this.localStreams[0].getAudioTracks().length,v=this.localStreams[0].getVideoTracks().length);if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&
(k=b.offerToReceiveAudio);void 0!==b.offerToReceiveVideo&&(v=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?0<k:0<v});"audio"===a.kind?k--:"video"===a.kind&&v--});0<k||0<v;)0<k&&(c.push({kind:"audio",wantReceive:!0}),k--),0<v&&(c.push({kind:"video",wantReceive:!0}),v--);var d=n.writeSessionBoilerplate(),g=[];c.forEach(function(b,c){var k=b.track,v=b.kind,h=Math.random().toString(36).substr(2,
10),f=a._createIceAndDtlsTransports(h,c),r=RTCRtpSender.getCapabilities(v),m,D,p=1001*(2*c+1);k&&(m=new RTCRtpSender(k,f.dtlsTransport));b.wantReceive&&(D=new RTCRtpReceiver(f.dtlsTransport,v));g[c]={iceGatherer:f.iceGatherer,iceTransport:f.iceTransport,dtlsTransport:f.dtlsTransport,localCapabilities:r,remoteCapabilities:null,rtpSender:m,rtpReceiver:D,kind:v,mid:h,sendSsrc:p,recvSsrc:null};b=g[c];d+=n.writeMediaSection(b,b.localCapabilities,"offer",a.localStreams[0])});this._pendingOffer=g;b=new RTCSessionDescription({type:"offer",
sdp:d});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,b);return Promise.resolve(b)};window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,b=n.writeSessionBoilerplate();this.transceivers.forEach(function(c){var k=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities);b+=n.writeMediaSection(c,k,"answer",a.localStreams[0])});var c=new RTCSessionDescription({type:"answer",sdp:b});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],
0,c);return Promise.resolve(c)};window.RTCPeerConnection.prototype.addIceCandidate=function(a){var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}if(b=this.transceivers[b]){c=0<Object.keys(a.candidate).length?n.parseCandidate(a.candidate):{};if("tcp"===c.protocol&&0===c.port||"1"!==c.component)return;"endOfCandidates"===c.type&&(c={});b.iceTransport.addRemoteCandidate(c)}1<arguments.length&&"function"===typeof arguments[1]&&
window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=1<arguments.length&&"function"===typeof arguments[1]&&arguments[1];return new Promise(function(c){var k={};Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){k[b]=a[b]})});
b&&window.setTimeout(b,0,k);c(k)})})}}}else a.log("Browser does not appear to be WebRTC-capable");else a.log("This does not appear to be a browser");var p={};try{Object.defineProperty(p,"version",{set:function(a){b=a}})}catch(m){}})();(function(){var c=!1;if(void 0!==window.__SDKDEV__&&null!==window.__SDKDEV__&&"boolean"===typeof window.__SDKDEV__)try{c=window.__SDKDEV__}catch(b){c=!1}if(!c){c=decodeURIComponent(window.location.href);var d=c.indexOf("?");c=c.substring(d+1).match(/(^|&)debug=([^&]*)(&|$)/i);c=null!=c?c[2]:""}window.__TkSdkBuild__=!c;try{window.localStorage?window.localStorage.setItem("debug",c?"*":"none"):console.warn("[tk-sdk]window.localStorage is not exist!")}catch(b){console.warn("[tk-sdk]Browser does not support localStorage!")}})();
!function(c,d){"object"==typeof exports&&"object"==typeof module?module.exports=d():"function"==typeof define&&define.amd?define([],d):"object"==typeof exports?exports.io=d():c.io=d()}(this,function(){return function(c){function d(a){if(b[a])return b[a].exports;var g=b[a]={exports:{},id:a,loaded:!1};return c[a].call(g.exports,g,g.exports,d),g.loaded=!0,g.exports}var b={};return d.m=c,d.c=b,d.p="",d(0)}([function(c,d,b){function a(a,b){"object"===("undefined"==typeof a?"undefined":g(a))&&(b=a,a=void 0);
b=b||{};var c;a=f(a);var k=a.source,v=a.id,d=a.path;d=p[v]&&d in p[v].nsps;return b.forceNew||b["force new connection"]||!1===b.multiplex||d?(n("ignoring socket cache for %s",k),c=q(k,b)):(p[v]||(n("new io instance for %s",k),p[v]=q(k,b)),c=p[v]),a.query&&!b.query&&(b.query=a.query),c.socket(a.path,b)}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":
typeof a},f=b(1),t=b(7),q=b(13),n=b(3)("socket.io-client");c.exports=d=a;var p=d.managers={};d.protocol=t.protocol;d.connect=a;d.Manager=b(13);d.Socket=b(39)},function(c,d,b){(function(a){var d=b(2),f=b(3)("socket.io-client:url");c.exports=function(b,c){var g=b;c=c||a.location;null==b&&(b=c.protocol+"//"+c.host);"string"==typeof b&&("/"===b.charAt(0)&&(b="/"===b.charAt(1)?c.protocol+b:c.host+b),/^(https?|wss?):\/\//.test(b)||(f("protocol-less url %s",b),b="undefined"!=typeof c?c.protocol+"//"+b:"https://"+
b),f("parse %s",b),g=d(b));g.port||(/^(http|ws)$/.test(g.protocol)?g.port="80":/^(http|ws)s$/.test(g.protocol)&&(g.port="443"));g.path=g.path||"/";b=-1!==g.host.indexOf(":")?"["+g.host+"]":g.host;return g.id=g.protocol+"://"+b+":"+g.port,g.href=g.protocol+"://"+b+(c&&c.port===g.port?"":":"+g.port),g}}).call(d,function(){return this}())},function(c,d){var b=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
a="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");c.exports=function(c){var d=c,g=c.indexOf("["),q=c.indexOf("]");-1!=g&&-1!=q&&(c=c.substring(0,g)+c.substring(g,q).replace(/:/g,";")+c.substring(q,c.length));c=b.exec(c||"");for(var n={},p=14;p--;)n[a[p]]=c[p]||"";return-1!=g&&-1!=q&&(n.source=d,n.host=n.host.substring(1,n.host.length-1).replace(/;/g,":"),n.authority=n.authority.replace("[","").replace("]","").replace(/;/g,":"),n.ipv6uri=
!0),n}},function(c,d,b){(function(a){function g(){try{var b=d.storage.debug}catch(n){}return!b&&"undefined"!=typeof a&&"env"in a&&(b=a.env.DEBUG),b}d=c.exports=b(5);d.log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};d.formatArgs=function(a){var b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+d.humanize(this.diff),b){b="color: "+this.color;a.splice(1,0,b,"color: inherit");var c=0,g=0;a[0].replace(/%[a-zA-Z%]/g,
function(a){"%%"!==a&&(c++,"%c"===a&&(g=c))});a.splice(g,0,b)}};d.save=function(a){try{null==a?d.storage.removeItem("debug"):d.storage.debug=a}catch(n){}};d.load=g;d.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&
window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var f=d;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var t=chrome.storage.local;else a:{try{t=window.localStorage;break a}catch(q){}t=void 0}f.storage=t;d.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" ");
d.formatters.j=function(a){try{return JSON.stringify(a)}catch(n){return"[UnexpectedJSONParseError]: "+n.message}};d.enable(g())}).call(d,b(4))},function(c,d){function b(){throw Error("setTimeout has not been defined");}function a(){throw Error("clearTimeout has not been defined");}function g(a){if(m===setTimeout)return setTimeout(a,0);if((m===b||!m)&&setTimeout)return m=setTimeout,setTimeout(a,0);try{return m(a,0)}catch(A){try{return m.call(null,a,0)}catch(F){return m.call(this,a,0)}}}function f(b){if(r===
clearTimeout)return clearTimeout(b);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(b);try{return r(b)}catch(A){try{return r.call(null,b)}catch(F){return r.call(this,b)}}}function t(){v&&h&&(v=!1,h.length?k=h.concat(k):y=-1,k.length&&q())}function q(){if(!v){var a=g(t);v=!0;for(var b=k.length;b;){h=k;for(k=[];++y<b;)h&&h[y].run();y=-1;b=k.length}h=null;v=!1;f(a)}}function n(a,b){this.fun=a;this.array=b}function p(){}c=c.exports={};try{var m="function"==typeof setTimeout?setTimeout:
b}catch(D){m=b}try{var r="function"==typeof clearTimeout?clearTimeout:a}catch(D){r=a}!0;var h,k=[],v=!1,y=-1;c.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];k.push(new n(a,b));1!==k.length||v||g(q)};n.prototype.run=function(){this.fun.apply(null,this.array)};c.title="browser";c.browser=!0;c.env={};c.argv=[];c.version="";c.versions={};c.on=p;c.addListener=p;c.once=p;c.off=p;c.removeListener=p;c.removeAllListeners=p;
c.emit=p;c.prependListener=p;c.prependOnceListener=p;c.listeners=function(a){return[]};c.binding=function(a){throw Error("process.binding is not supported");};c.cwd=function(){return"/"};c.chdir=function(a){throw Error("process.chdir is not supported");};c.umask=function(){return 0}},function(c,d,b){function a(a){var b,c=0;for(b in a)c=(c<<5)-c+a.charCodeAt(b),c|=0;return d.colors[Math.abs(c)%d.colors.length]}function g(b){function c(){if(c.enabled){var a=+new Date;c.diff=a-(f||a);c.prev=f;f=c.curr=
a;var b=Array(arguments.length);for(a=0;a<b.length;a++)b[a]=arguments[a];b[0]=d.coerce(b[0]);"string"!=typeof b[0]&&b.unshift("%O");var g=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,function(a,h){if("%%"===a)return a;g++;h=d.formatters[h];"function"==typeof h&&(a=h.call(c,b[g]),b.splice(g,1),g--);return a});d.formatArgs.call(c,b);(c.log||d.log||console.log.bind(console)).apply(c,b)}}return c.namespace=b,c.enabled=d.enabled(b),c.useColors=d.useColors(),c.color=a(b),"function"==typeof d.init&&d.init(c),c}d=
c.exports=g.debug=g["default"]=g;d.coerce=function(a){return a instanceof Error?a.stack||a.message:a};d.disable=function(){d.enable("")};d.enable=function(a){d.save(a);d.names=[];d.skips=[];for(var b=("string"==typeof a?a:"").split(/[\s,]+/),c=b.length,g=0;g<c;g++)b[g]&&(a=b[g].replace(/\*/g,".*?"),"-"===a[0]?d.skips.push(new RegExp("^"+a.substr(1)+"$")):d.names.push(new RegExp("^"+a+"$")))};d.enabled=function(a){var b;var c=0;for(b=d.skips.length;c<b;c++)if(d.skips[c].test(a))return!1;c=0;for(b=
d.names.length;c<b;c++)if(d.names[c].test(a))return!0;return!1};d.humanize=b(6);d.names=[];d.skips=[];d.formatters={};var f},function(c,d){function b(a){if(a=String(a),!(100<a.length))if(a=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a)){var b=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return b*n;case "days":case "day":case "d":return b*q;case "hours":case "hour":case "hrs":case "hr":case "h":return b*
t;case "minutes":case "minute":case "mins":case "min":case "m":return b*f;case "seconds":case "second":case "secs":case "sec":case "s":return b*g;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return b}}}function a(a,b,c){if(!(a<b))return a<1.5*b?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var g=1E3,f=60*g,t=60*f,q=24*t,n=365.25*q;c.exports=function(c,d){d=d||{};var r=typeof c;if("string"===r&&0<c.length)return b(c);if("number"===r&&!1===isNaN(c))return d["long"]?a(c,
q,"day")||a(c,t,"hour")||a(c,f,"minute")||a(c,g,"second")||c+" ms":c>=q?Math.round(c/q)+"d":c>=t?Math.round(c/t)+"h":c>=f?Math.round(c/f)+"m":c>=g?Math.round(c/g)+"s":c+"ms";throw Error("val is not a non-empty string or a valid number. val\x3d"+JSON.stringify(c));}},function(c,d,b){function a(){}function g(a){var b=""+a.type;return d.BINARY_EVENT!==a.type&&d.BINARY_ACK!==a.type||(b+=a.attachments+"-"),a.nsp&&"/"!==a.nsp&&(b+=a.nsp+","),null!=a.id&&(b+=a.id),null!=a.data&&(b+=JSON.stringify(a.data)),
p("encoded %j as %s",a,b),b}function f(a,b){r.removeBlobs(a,function(a){var c=r.deconstructPacket(a);a=g(c.packet);c=c.buffers;c.unshift(a);b(c)})}function t(){this.reconstructor=null}function q(a){this.reconPack=a;this.buffers=[]}function n(){return{type:d.ERROR,data:"parser error"}}var p=b(3)("socket.io-parser");c=b(8);var m=b(9),r=b(11),h=b(12);d.protocol=4;d.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");d.CONNECT=0;d.DISCONNECT=1;d.EVENT=2;d.ACK=3;d.ERROR=4;d.BINARY_EVENT=
5;d.BINARY_ACK=6;d.Encoder=a;d.Decoder=t;a.prototype.encode=function(a,b){(a.type!==d.EVENT&&a.type!==d.ACK||!m(a.data)||(a.type=a.type===d.EVENT?d.BINARY_EVENT:d.BINARY_ACK),p("encoding packet %j",a),d.BINARY_EVENT===a.type||d.BINARY_ACK===a.type)?f(a,b):(a=g(a),b([a]))};c(t.prototype);t.prototype.add=function(a){if("string"==typeof a){var b=0,c={type:Number(a.charAt(0))};if(null==d.types[c.type])a=n();else{if(d.BINARY_EVENT===c.type||d.BINARY_ACK===c.type){for(var k="";"-"!==a.charAt(++b)&&(k+=
a.charAt(b),b!=a.length););if(k!=Number(k)||"-"!==a.charAt(b))throw Error("Illegal attachments");c.attachments=Number(k)}if("/"===a.charAt(b+1))for(c.nsp="";++b;){k=a.charAt(b);if(","===k)break;if(c.nsp+=k,b===a.length)break}else c.nsp="/";k=a.charAt(b+1);if(""!==k&&Number(k)==k){for(c.id="";++b;){k=a.charAt(b);if(null==k||Number(k)!=k){--b;break}if(c.id+=a.charAt(b),b===a.length)break}c.id=Number(c.id)}if(a.charAt(++b)){b:{b=a.substr(b);try{c.data=JSON.parse(b)}catch(A){b=n();break b}b=c}c=b}a=(p("decoded %s as %j",
a,c),c)}d.BINARY_EVENT===a.type||d.BINARY_ACK===a.type?(this.reconstructor=new q(a),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",a)):this.emit("decoded",a)}else{if(!h(a)&&!a.base64)throw Error("Unknown type: "+a);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(a=this.reconstructor.takeBinaryData(a))&&(this.reconstructor=null,this.emit("decoded",a))}};t.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};
q.prototype.takeBinaryData=function(a){return(this.buffers.push(a),this.buffers.length===this.reconPack.attachments)?(a=r.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),a):null};q.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(c,d,b){function a(b){if(b){for(var c in a.prototype)b[c]=a.prototype[c];return b}}c.exports=a;a.prototype.on=a.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+
a]=this._callbacks["$"+a]||[]).push(b),this};a.prototype.once=function(a,b){function c(){this.off(a,c);b.apply(this,arguments)}return c.fn=b,this.on(a,c),this};a.prototype.off=a.prototype.removeListener=a.prototype.removeAllListeners=a.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,g=0;g<c.length;g++)if(d=
c[g],d===b||d.fn===b){c.splice(g,1);break}return this};a.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,g=c.length;d<g;++d)c[d].apply(this,b)}return this};a.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]};a.prototype.hasListeners=function(a){return!!this.listeners(a).length}},function(c,d,b){(function(a){function d(b){if(!b||"object"!=typeof b)return!1;
if(f(b)){for(var c=0,g=b.length;c<g;c++)if(d(b[c]))return!0;return!1}if("function"==typeof a.Buffer&&a.Buffer.isBuffer&&a.Buffer.isBuffer(b)||"function"==typeof a.ArrayBuffer&&b instanceof ArrayBuffer||q&&b instanceof Blob||n&&b instanceof File)return!0;if(b.toJSON&&"function"==typeof b.toJSON&&1===arguments.length)return d(b.toJSON(),!0);for(c in b)if(Object.prototype.hasOwnProperty.call(b,c)&&d(b[c]))return!0;return!1}var f=b(10),t=Object.prototype.toString,q="function"==typeof a.Blob||"[object BlobConstructor]"===
t.call(a.Blob),n="function"==typeof a.File||"[object FileConstructor]"===t.call(a.File);c.exports=d}).call(d,function(){return this}())},function(c,d){var b={}.toString;c.exports=Array.isArray||function(a){return"[object Array]"==b.call(a)}},function(c,d,b){(function(a){function c(a,b){if(!a)return a;if(q(a)){var k={_placeholder:!0,num:b.length};return b.push(a),k}if(t(a)){k=Array(a.length);for(var d=0;d<a.length;d++)k[d]=c(a[d],b);return k}if("object"==typeof a&&!(a instanceof Date)){k={};for(d in a)k[d]=
c(a[d],b);return k}return a}function f(a,b){if(!a)return a;if(a&&a._placeholder)return b[a.num];if(t(a))for(var c=0;c<a.length;c++)a[c]=f(a[c],b);else if("object"==typeof a)for(c in a)a[c]=f(a[c],b);return a}var t=b(10),q=b(12),n=Object.prototype.toString,p="function"==typeof a.Blob||"[object BlobConstructor]"===n.call(a.Blob),m="function"==typeof a.File||"[object FileConstructor]"===n.call(a.File);d.deconstructPacket=function(a){var b=[];return a.data=c(a.data,b),a.attachments=b.length,{packet:a,
buffers:b}};d.reconstructPacket=function(a,b){return a.data=f(a.data,b),a.attachments=void 0,a};d.removeBlobs=function(a,b){function c(a,k,v){if(!a)return a;if(p&&a instanceof Blob||m&&a instanceof File){d++;var g=new FileReader;g.onload=function(){v?v[k]=this.result:h=this.result;--d||b(h)};g.readAsArrayBuffer(a)}else if(t(a))for(g=0;g<a.length;g++)c(a[g],g,a);else if("object"==typeof a&&!q(a))for(g in a)c(a[g],g,a)}var d=0,h=a;c(h);d||b(h)}}).call(d,function(){return this}())},function(c,d){(function(b){c.exports=
function(a){return b.Buffer&&b.Buffer.isBuffer(a)||b.ArrayBuffer&&a instanceof ArrayBuffer}}).call(d,function(){return this}())},function(c,d,b){function a(b,c){if(!(this instanceof a))return new a(b,c);b&&"object"===("undefined"==typeof b?"undefined":g(b))&&(c=b,b=void 0);c=c||{};c.path=c.path||"/socket.io";this.nsps={};this.subs=[];this.opts=c;this.reconnection(!1!==c.reconnection);this.reconnectionAttempts(c.reconnectionAttempts||1/0);this.reconnectionDelay(c.reconnectionDelay||1E3);this.reconnectionDelayMax(c.reconnectionDelayMax||
5E3);this.randomizationFactor(c.randomizationFactor||.5);this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==c.timeout?2E4:c.timeout);this.readyState="closed";this.uri=b;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];b=c.parser||q;this.encoder=new b.Encoder;this.decoder=new b.Decoder;(this.autoConnect=!1!==c.autoConnect)&&this.open()}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?
function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f=b(14),t=b(39);d=b(8);var q=b(7),n=b(41),p=b(42),m=b(3)("socket.io-client:manager"),r=b(37),h=b(43),k=Object.prototype.hasOwnProperty;c.exports=a;a.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)k.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)};a.prototype.updateSocketIds=function(){for(var a in this.nsps)k.call(this.nsps,
a)&&(this.nsps[a].id=this.generateId(a))};a.prototype.generateId=function(a){return("/"===a?"":a+"#")+this.engine.id};d(a.prototype);a.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection};a.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts};a.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),
this):this._reconnectionDelay};a.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor};a.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax};a.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout};a.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&
this._reconnection&&0===this.backoff.attempts&&this.reconnect()};a.prototype.open=a.prototype.connect=function(a,b){if(m("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;m("opening %s",this.uri);var c=this.engine=f(this.uri,this.opts),k=this;this.readyState="opening";this.skipReconnect=!1;var d=n(c,"open",function(){k.onopen();a&&a()});b=n(c,"error",function(b){if(m("connect_error"),k.cleanup(),k.readyState="closed",k.emitAll("connect_error",b),a){var c=Error("Connection error");
c.data=b;a(c)}else k.maybeReconnectOnOpen()});if(!1!==this._timeout){var h=this._timeout;m("connect attempt will timeout after %d",h);var v=setTimeout(function(){m("connect attempt timed out after %d",h);d.destroy();c.close();c.emit("error","timeout");k.emitAll("connect_timeout",h)},h);this.subs.push({destroy:function(){clearTimeout(v)}})}return this.subs.push(d),this.subs.push(b),this};a.prototype.onopen=function(){m("open");this.cleanup();this.readyState="open";this.emit("open");var a=this.engine;
this.subs.push(n(a,"data",p(this,"ondata")));this.subs.push(n(a,"ping",p(this,"onping")));this.subs.push(n(a,"pong",p(this,"onpong")));this.subs.push(n(a,"error",p(this,"onerror")));this.subs.push(n(a,"close",p(this,"onclose")));this.subs.push(n(this.decoder,"decoded",p(this,"ondecoded")))};a.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};a.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};a.prototype.ondata=function(a){this.decoder.add(a)};a.prototype.ondecoded=
function(a){this.emit("packet",a)};a.prototype.onerror=function(a){m("error",a);this.emitAll("error",a)};a.prototype.socket=function(a,b){function c(){~r(d.connecting,k)||d.connecting.push(k)}var k=this.nsps[a];if(!k){k=new t(this,a,b);this.nsps[a]=k;var d=this;k.on("connecting",c);k.on("connect",function(){k.id=d.generateId(a)});this.autoConnect&&c()}return k};a.prototype.destroy=function(a){a=r(this.connecting,a);~a&&this.connecting.splice(a,1);this.connecting.length||this.close()};a.prototype.packet=
function(a){m("writing packet %j",a);var b=this;a.query&&0===a.type&&(a.nsp+="?"+a.query);b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var k=0;k<c.length;k++)b.engine.write(c[k],a.options);b.encoding=!1;b.processPacketQueue()}))};a.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}};a.prototype.cleanup=function(){m("cleanup");for(var a=this.subs.length,b=0;b<a;b++)this.subs.shift().destroy();
this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};a.prototype.close=a.prototype.disconnect=function(){m("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};a.prototype.onclose=function(a){m("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",a);this._reconnection&&!this.skipReconnect&&this.reconnect()};
a.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)m("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();m("will wait %dms before reconnect attempt",b);this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(m("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),
a.skipReconnect||a.open(function(b){b?(m("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(m("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}};a.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",a)}},function(c,d,b){c.exports=b(15)},function(c,d,b){c.exports=b(16);c.exports.parser=b(23)},function(c,d,
b){(function(a){function d(b,c){if(!(this instanceof d))return new d(b,c);c=c||{};b&&"object"==typeof b&&(c=b,b=null);b?(b=m(b),c.hostname=b.host,c.secure="https"===b.protocol||"wss"===b.protocol,c.port=b.port,b.query&&(c.query=b.query)):c.host&&(c.hostname=m(c.host).host);this.secure=null!=c.secure?c.secure:a.location&&"https:"===location.protocol;c.hostname&&!c.port&&(c.port=this.secure?"443":"80");this.agent=c.agent||!1;this.hostname=c.hostname||(a.location?location.hostname:"localhost");this.port=
c.port||(a.location&&location.port?location.port:this.secure?443:80);this.query=c.query||{};"string"==typeof this.query&&(this.query=h.decode(this.query));this.upgrade=!1!==c.upgrade;this.path=(c.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!c.forceJSONP;this.jsonp=!1!==c.jsonp;this.forceBase64=!!c.forceBase64;this.enablesXDR=!!c.enablesXDR;this.timestampParam=c.timestampParam||"t";this.timestampRequests=c.timestampRequests;this.transports=c.transports||["polling","websocket"];this.transportOptions=
c.transportOptions||{};this.readyState="";this.writeBuffer=[];this.prevBufferLen=0;this.policyPort=c.policyPort||843;this.rememberUpgrade=c.rememberUpgrade||!1;this.binaryType=null;this.onlyBinaryUpgrades=c.onlyBinaryUpgrades;this.perMessageDeflate=!1!==c.perMessageDeflate&&(c.perMessageDeflate||{});!0===this.perMessageDeflate&&(this.perMessageDeflate={});this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024);this.pfx=c.pfx||null;this.key=c.key||null;
this.passphrase=c.passphrase||null;this.cert=c.cert||null;this.ca=c.ca||null;this.ciphers=c.ciphers||null;this.rejectUnauthorized=void 0===c.rejectUnauthorized||c.rejectUnauthorized;this.forceNode=!!c.forceNode;b="object"==typeof a&&a;b.global===b&&(c.extraHeaders&&0<Object.keys(c.extraHeaders).length&&(this.extraHeaders=c.extraHeaders),c.localAddress&&(this.localAddress=c.localAddress));this.pingTimeoutTimer=this.pingIntervalTimer=this.pingTimeout=this.pingInterval=this.upgrades=this.id=null;this.open()}
var f=b(17),t=b(8),q=b(3)("engine.io-client:socket"),n=b(37),p=b(23),m=b(2),r=b(38),h=b(31);c.exports=d;d.priorWebsocketSuccess=!1;t(d.prototype);d.protocol=p.protocol;d.Socket=d;d.Transport=b(22);d.transports=b(17);d.parser=b(23);d.prototype.createTransport=function(a){q('creating transport "%s"',a);var b=this.query,c={},k;for(k in b)b.hasOwnProperty(k)&&(c[k]=b[k]);c.EIO=p.protocol;c.transport=a;b=this.transportOptions[a]||{};this.id&&(c.sid=this.id);return new f[a]({query:c,socket:this,agent:b.agent||
this.agent,hostname:b.hostname||this.hostname,port:b.port||this.port,secure:b.secure||this.secure,path:b.path||this.path,forceJSONP:b.forceJSONP||this.forceJSONP,jsonp:b.jsonp||this.jsonp,forceBase64:b.forceBase64||this.forceBase64,enablesXDR:b.enablesXDR||this.enablesXDR,timestampRequests:b.timestampRequests||this.timestampRequests,timestampParam:b.timestampParam||this.timestampParam,policyPort:b.policyPort||this.policyPort,pfx:b.pfx||this.pfx,key:b.key||this.key,passphrase:b.passphrase||this.passphrase,
cert:b.cert||this.cert,ca:b.ca||this.ca,ciphers:b.ciphers||this.ciphers,rejectUnauthorized:b.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:b.perMessageDeflate||this.perMessageDeflate,extraHeaders:b.extraHeaders||this.extraHeaders,forceNode:b.forceNode||this.forceNode,localAddress:b.localAddress||this.localAddress,requestTimeout:b.requestTimeout||this.requestTimeout,protocols:b.protocols||void 0})};d.prototype.open=function(){if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var a=
"websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(y){return this.transports.shift(),void this.open()}a.open();this.setTransport(a)};d.prototype.setTransport=function(a){q("setting transport %s",a.name);var b=this;this.transport&&(q("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=
a;a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})};d.prototype.probe=function(a){function b(){if(t.onlyBinaryUpgrades){var b=!this.supportsBinary&&t.transport.supportsBinary;p=p||b}p||(q('probe transport "%s" opened',a),m.send([{type:"ping",data:"probe"}]),m.once("packet",function(b){if(!p)if("pong"===b.type&&"probe"===b.data){if(q('probe transport "%s" pong',a),t.upgrading=!0,
t.emit("upgrading",m),m)d.priorWebsocketSuccess="websocket"===m.name,q('pausing current transport "%s"',t.transport.name),t.transport.pause(function(){p||"closed"!==t.readyState&&(q("changing transport and sending upgrade packet"),r(),t.setTransport(m),m.send([{type:"upgrade"}]),t.emit("upgrade",m),m=null,t.upgrading=!1,t.flush())})}else q('probe transport "%s" failed',a),b=Error("probe error"),b.transport=m.name,t.emit("upgradeError",b)}))}function c(){p||(p=!0,r(),m.close(),m=null)}function k(b){var k=
Error("probe error: "+b);k.transport=m.name;c();q('probe transport "%s" failed because of error: %s',a,b);t.emit("upgradeError",k)}function h(){k("transport closed")}function g(){k("socket closed")}function f(a){m&&a.name!==m.name&&(q('"%s" works - aborting "%s"',a.name,m.name),c())}function r(){m.removeListener("open",b);m.removeListener("error",k);m.removeListener("close",h);t.removeListener("close",g);t.removeListener("upgrading",f)}q('probing transport "%s"',a);var m=this.createTransport(a,{probe:1}),
p=!1,t=this;d.priorWebsocketSuccess=!1;m.once("open",b);m.once("error",k);m.once("close",h);this.once("close",g);this.once("upgrading",f);m.open()};d.prototype.onOpen=function(){if(q("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){q("starting upgrade probes");for(var a=0,b=this.upgrades.length;a<b;a++)this.probe(this.upgrades[a])}};d.prototype.onPacket=function(a){if("opening"===
this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(q('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case "open":this.onHandshake(r(a.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var b=Error("server error");b.code=a.data;this.onError(b);break;case "message":this.emit("data",a.data),this.emit("message",a.data)}else q('packet received with socket readyState "%s"',this.readyState)};d.prototype.onHandshake=
function(a){this.emit("handshake",a);this.id=a.sid;this.transport.query.sid=a.sid;this.upgrades=this.filterUpgrades(a.upgrades);this.pingInterval=a.pingInterval;this.pingTimeout=a.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!==b.readyState&&b.onClose("ping timeout")},
a||b.pingInterval+b.pingTimeout)};d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer);a.pingIntervalTimer=setTimeout(function(){q("writing ping packet - expecting pong within %sms",a.pingTimeout);a.ping();a.onHeartbeat(a.pingTimeout)},a.pingInterval)};d.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})};d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):
this.flush()};d.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(q("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};d.prototype.write=d.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this};d.prototype.sendPacket=function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=
c,c=null),"closing"!==this.readyState&&"closed"!==this.readyState)c=c||{},c.compress=!1!==c.compress,a={type:a,data:b,options:c},this.emit("packetCreate",a),this.writeBuffer.push(a),d&&this.once("flush",d),this.flush()};d.prototype.close=function(){function a(){d.onClose("forced close");q("socket closing - telling transport to close");d.transport.close()}function b(){d.removeListener("upgrade",b);d.removeListener("upgradeError",b);a()}function c(){d.once("upgrade",b);d.once("upgradeError",b)}if("opening"===
this.readyState||"open"===this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this};d.prototype.onError=function(a){q("socket error %j",a);d.priorWebsocketSuccess=!1;this.emit("error",a);this.onClose("transport error",a)};d.prototype.onClose=function(a,b){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)q('socket close with reason: "%s"',a),clearTimeout(this.pingIntervalTimer),
clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),this.writeBuffer=[],this.prevBufferLen=0};d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;c<d;c++)~n(this.transports,a[c])&&b.push(a[c]);return b}}).call(d,function(){return this}())},function(c,d,b){(function(a){var c=b(18),f=b(20),t=b(34),q=b(35);d.polling=function(b){var d,g=!1,r=
!1,h=!1!==b.jsonp;a.location&&(r="https:"===location.protocol,(g=location.port)||(g=r?443:80),g=b.hostname!==location.hostname||g!==b.port,r=b.secure!==r);if(b.xdomain=g,b.xscheme=r,d=new c(b),"open"in d&&!b.forceJSONP)return new f(b);if(!h)throw Error("JSONP disabled");return new t(b)};d.websocket=q}).call(d,function(){return this}())},function(c,d,b){(function(a){var d=b(19);c.exports=function(b){var c=b.xdomain,g=b.xscheme;b=b.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!c||d))return new XMLHttpRequest}catch(n){}try{if("undefined"!=
typeof XDomainRequest&&!g&&b)return new XDomainRequest}catch(n){}if(!c)try{return new (a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}}).call(d,function(){return this}())},function(c,d){try{c.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(b){c.exports=!1}},function(c,d,b){(function(a){function d(){}function f(b){if(p.call(this,b),this.requestTimeout=b.requestTimeout,this.extraHeaders=b.extraHeaders,a.location){var c="https:"===location.protocol,
d=location.port;d||(d=c?443:80);this.xd=b.hostname!==a.location.hostname||d!==b.port;this.xs=b.secure!==c}}function t(a){this.method=a.method||"GET";this.uri=a.uri;this.xd=!!a.xd;this.xs=!!a.xs;this.async=!1!==a.async;this.data=void 0!==a.data?a.data:null;this.agent=a.agent;this.isBinary=a.isBinary;this.supportsBinary=a.supportsBinary;this.enablesXDR=a.enablesXDR;this.requestTimeout=a.requestTimeout;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=a.ca;this.ciphers=
a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.extraHeaders=a.extraHeaders;this.create()}function q(){for(var a in t.requests)t.requests.hasOwnProperty(a)&&t.requests[a].abort()}var n=b(18),p=b(21),m=b(8),r=b(32),h=b(3)("engine.io-client:polling-xhr");c.exports=f;c.exports.Request=t;r(f,p);f.prototype.supportsBinary=!0;f.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,
a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.requestTimeout=this.requestTimeout,a.extraHeaders=this.extraHeaders,new t(a)};f.prototype.doWrite=function(a,b){a=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==a});var c=this;a.on("success",b);a.on("error",function(a){c.onError("xhr post error",a)});this.sendXhr=a};f.prototype.doPoll=function(){h("xhr poll");var a=
this.request(),b=this;a.on("data",function(a){b.onData(a)});a.on("error",function(a){b.onError("xhr poll error",a)});this.pollXhr=a};m(t.prototype);t.prototype.create=function(){var b={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};b.pfx=this.pfx;b.key=this.key;b.passphrase=this.passphrase;b.cert=this.cert;b.ca=this.ca;b.ciphers=this.ciphers;b.rejectUnauthorized=this.rejectUnauthorized;var c=this.xhr=new n(b),d=this;try{h("xhr open %s: %s",this.method,this.uri);c.open(this.method,
this.uri,this.async);try{if(this.extraHeaders){c.setDisableHeaderCheck&&c.setDisableHeaderCheck(!0);for(var g in this.extraHeaders)this.extraHeaders.hasOwnProperty(g)&&c.setRequestHeader(g,this.extraHeaders[g])}}catch(A){}if("POST"===this.method)try{this.isBinary?c.setRequestHeader("Content-type","application/octet-stream"):c.setRequestHeader("Content-type","text/plain;charset\x3dUTF-8")}catch(A){}try{c.setRequestHeader("Accept","*/*")}catch(A){}"withCredentials"in c&&(c.withCredentials=!0);this.requestTimeout&&
(c.timeout=this.requestTimeout);this.hasXDR()?(c.onload=function(){d.onLoad()},c.onerror=function(){d.onError(c.responseText)}):c.onreadystatechange=function(){if(2===c.readyState){try{var a=c.getResponseHeader("Content-Type")}catch(F){}"application/octet-stream"===a&&(c.responseType="arraybuffer")}4===c.readyState&&(200===c.status||1223===c.status?d.onLoad():setTimeout(function(){d.onError(c.status)},0))};h("xhr data %s",this.data);c.send(this.data)}catch(A){return void setTimeout(function(){d.onError(A)},
0)}a.document&&(this.index=t.requestsCount++,t.requests[this.index]=this)};t.prototype.onSuccess=function(){this.emit("success");this.cleanup()};t.prototype.onData=function(a){this.emit("data",a);this.onSuccess()};t.prototype.onError=function(a){this.emit("error",a);this.cleanup(!0)};t.prototype.cleanup=function(b){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,b)try{this.xhr.abort()}catch(v){}a.document&&delete t.requests[this.index];
this.xhr=null}};t.prototype.onLoad=function(){try{try{var a=this.xhr.getResponseHeader("Content-Type")}catch(y){}var b="application/octet-stream"===a?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(y){this.onError(y)}null!=b&&this.onData(b)};t.prototype.hasXDR=function(){return"undefined"!=typeof a.XDomainRequest&&!this.xs&&this.enablesXDR};t.prototype.abort=function(){this.cleanup()};t.requestsCount=0;t.requests={};a.document&&(a.attachEvent?a.attachEvent("onunload",q):a.addEventListener&&
a.addEventListener("beforeunload",q,!1))}).call(d,function(){return this}())},function(c,d,b){function a(a){var b=a&&a.forceBase64;p&&!b||(this.supportsBinary=!1);g.call(this,a)}var g=b(22),f=b(31),t=b(23);d=b(32);var q=b(33),n=b(3)("engine.io-client:polling");c.exports=a;var p=null!=(new (b(18))({xdomain:!1})).responseType;d(a,g);a.prototype.name="polling";a.prototype.doOpen=function(){this.poll()};a.prototype.pause=function(a){function b(){n("paused");c.readyState="paused";a()}var c=this;if(this.readyState=
"pausing",this.polling||!this.writable){var d=0;this.polling&&(n("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){n("pre-pause polling complete");--d||b()}));this.writable||(n("we are currently writing - waiting to pause"),d++,this.once("drain",function(){n("pre-pause writing complete");--d||b()}))}else b()};a.prototype.poll=function(){n("polling");this.polling=!0;this.doPoll();this.emit("poll")};a.prototype.onData=function(a){var b=this;n("polling got data %s",
a);t.decodePayload(a,this.socket.binaryType,function(a,c,d){return"opening"===b.readyState&&b.onOpen(),"close"===a.type?(b.onClose(),!1):void b.onPacket(a)});"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():n('ignoring poll - transport state "%s"',this.readyState))};a.prototype.doClose=function(){function a(){n("writing close packet");b.write([{type:"close"}])}var b=this;"open"===this.readyState?(n("transport open - closing"),a()):(n("transport not open - deferring close"),
this.once("open",a))};a.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0;b.emit("drain")};t.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})};a.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=q());this.supportsBinary||a.sid||(a.b64=1);a=f.encode(a);this.port&&("https"===b&&443!==Number(this.port)||"http"===b&&80!==Number(this.port))&&(c=":"+this.port);a.length&&
(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a}},function(c,d,b){function a(a){this.path=a.path;this.hostname=a.hostname;this.port=a.port;this.secure=a.secure;this.query=a.query;this.timestampParam=a.timestampParam;this.timestampRequests=a.timestampRequests;this.readyState="";this.agent=a.agent||!1;this.socket=a.socket;this.enablesXDR=a.enablesXDR;this.pfx=a.pfx;this.key=a.key;this.passphrase=a.passphrase;this.cert=a.cert;this.ca=
a.ca;this.ciphers=a.ciphers;this.rejectUnauthorized=a.rejectUnauthorized;this.forceNode=a.forceNode;this.extraHeaders=a.extraHeaders;this.localAddress=a.localAddress}var g=b(23);d=b(8);c.exports=a;d(a.prototype);a.prototype.onError=function(a,b){a=Error(a);return a.type="TransportError",a.description=b,this.emit("error",a),this};a.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};a.prototype.close=function(){return"opening"!==
this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};a.prototype.send=function(a){if("open"!==this.readyState)throw Error("Transport not open");this.write(a)};a.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};a.prototype.onData=function(a){a=g.decodePacket(a,this.socket.binaryType);this.onPacket(a)};a.prototype.onPacket=function(a){this.emit("packet",a)};a.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},
function(c,d,b){(function(a){function c(a,b,c){if(!b)return d.encodeBase64Packet(a,c);var h=new FileReader;return h.onload=function(){a.data=h.result;d.encodePacket(a,b,!0,c)},h.readAsArrayBuffer(a.data)}function f(a,b,c){var d=Array(a.length);c=m(a.length,c);for(var h=function(a,c,h){b(c,function(b,c){d[a]=c;h(b,d)})},k=0;k<a.length;k++)h(k,a[k],c)}var t,q=b(24),n=b(9),p=b(25),m=b(26),r=b(27);a&&a.ArrayBuffer&&(t=b(29));var h="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),k=
"undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),v=h||k;d.protocol=3;var y=d.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},D=q(y),A={type:"error",data:"parser error"},F=b(30);d.encodePacket=function(b,h,k,g){"function"==typeof h&&(g=h,h=!1);"function"==typeof k&&(g=k,k=null);var f=void 0===b.data?void 0:b.data.buffer||b.data;if(a.ArrayBuffer&&f instanceof ArrayBuffer){if(h){k=b.data;h=new Uint8Array(k);k=new Uint8Array(1+k.byteLength);k[0]=y[b.type];for(b=
0;b<h.length;b++)k[b+1]=h[b];b=g(k.buffer)}else b=d.encodeBase64Packet(b,g);return b}if(F&&f instanceof a.Blob)return h?v?b=c(b,h,g):(h=new Uint8Array(1),h[0]=y[b.type],b=new F([h.buffer,b.data]),b=g(b)):b=d.encodeBase64Packet(b,g),b;if(f&&f.base64)return g("b"+d.packets[b.type]+b.data.data);h=y[b.type];return void 0!==b.data&&(h+=k?r.encode(String(b.data),{strict:!1}):String(b.data)),g(""+h)};d.encodeBase64Packet=function(b,c){var h="b"+d.packets[b.type];if(F&&b.data instanceof a.Blob){var k=new FileReader;
return k.onload=function(){var a=k.result.split(",")[1];c(h+a)},k.readAsDataURL(b.data)}try{var g=String.fromCharCode.apply(null,new Uint8Array(b.data))}catch(I){b=new Uint8Array(b.data);g=Array(b.length);for(var f=0;f<b.length;f++)g[f]=b[f];g=String.fromCharCode.apply(null,g)}return h+=a.btoa(g),c(h)};d.decodePacket=function(a,b,c){if(void 0===a)return A;if("string"==typeof a){if("b"===a.charAt(0))return d.decodeBase64Packet(a.substr(1),b);if(b=c){b=a;try{b=r.decode(b,{strict:!1})}catch(R){b=!1}b=
(a=b,!1===a)}if(b)return A;c=a.charAt(0);return Number(c)==c&&D[c]?1<a.length?{type:D[c],data:a.substring(1)}:{type:D[c]}:A}c=(new Uint8Array(a))[0];a=p(a,1);return F&&"blob"===b&&(a=new F([a])),{type:D[c],data:a}};d.decodeBase64Packet=function(a,b){var c=D[a.charAt(0)];if(!t)return{type:c,data:{base64:!0,data:a.substr(1)}};a=t.decode(a.substr(1));return"blob"===b&&F&&(a=new F([a])),{type:c,data:a}};d.encodePayload=function(a,b,c){function h(a,c){d.encodePacket(a,!!k&&b,!1,function(a){c(null,a.length+
":"+a)})}"function"==typeof b&&(c=b,b=null);var k=n(a);return b&&k?F&&!v?d.encodePayloadAsBlob(a,c):d.encodePayloadAsArrayBuffer(a,c):a.length?void f(a,h,function(a,b){return c(b.join(""))}):c("0:")};d.decodePayload=function(a,b,c){if("string"!=typeof a)return d.decodePayloadAsBinary(a,b,c);"function"==typeof b&&(c=b,b=null);var h;if(""===a)return c(A,0,1);for(var k,g,f="",r=0,v=a.length;r<v;r++){var m=a.charAt(r);if(":"===m){if(""===f||f!=(k=Number(f))||(g=a.substr(r+1,k),f!=g.length))return c(A,
0,1);if(g.length){if(h=d.decodePacket(g,b,!1),A.type===h.type&&A.data===h.data)return c(A,0,1);if(!1===c(h,r+k,v))return}r+=k;f=""}else f+=m}return""!==f?c(A,0,1):void 0};d.encodePayloadAsArrayBuffer=function(a,b){function c(a,b){d.encodePacket(a,!0,!0,function(a){return b(null,a)})}return a.length?void f(a,c,function(a,c){a=c.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0);var d=new Uint8Array(a),h=0;return c.forEach(function(a){var b="string"==
typeof a,c=a;if(b){c=new Uint8Array(a.length);for(var k=0;k<a.length;k++)c[k]=a.charCodeAt(k);c=c.buffer}b?d[h++]=0:d[h++]=1;a=c.byteLength.toString();for(k=0;k<a.length;k++)d[h++]=parseInt(a[k]);d[h++]=255;c=new Uint8Array(c);for(k=0;k<c.length;k++)d[h++]=c[k]}),b(d.buffer)}):b(new ArrayBuffer(0))};d.encodePayloadAsBlob=function(a,b){f(a,function(a,b){d.encodePacket(a,!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),h=0;h<a.length;h++)d[h]=
a.charCodeAt(h);a=d.buffer;c[0]=0}d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString();var k=new Uint8Array(d.length+1);for(h=0;h<d.length;h++)k[h]=parseInt(d[h]);if(k[d.length]=255,F)a=new F([c.buffer,k.buffer,a]),b(null,a)})},function(a,c){return b(new F(c))})};d.decodePayloadAsBinary=function(a,b,c){"function"==typeof b&&(c=b,b=null);for(var h=[];0<a.byteLength;){for(var k=new Uint8Array(a),g=0===k[0],f="",r=1;255!==k[r];r++){if(310<f.length)return c(A,0,1);f+=k[r]}a=p(a,2+f.length);f=parseInt(f);
k=p(a,0,f);if(g)try{k=String.fromCharCode.apply(null,new Uint8Array(k))}catch(W){for(g=new Uint8Array(k),k="",r=0;r<g.length;r++)k+=String.fromCharCode(g[r])}h.push(k);a=p(a,f)}var v=h.length;h.forEach(function(a,h){c(d.decodePacket(a,b,!0),h,v)})}}).call(d,function(){return this}())},function(c,d){c.exports=Object.keys||function(b){var a=[],c=Object.prototype.hasOwnProperty,d;for(d in b)c.call(b,d)&&a.push(d);return a}},function(c,d){c.exports=function(b,a,c){var d=b.byteLength;if(a=a||0,c=c||d,
b.slice)return b.slice(a,c);if(0>a&&(a+=d),0>c&&(c+=d),c>d&&(c=d),a>=d||a>=c||0===d)return new ArrayBuffer(0);b=new Uint8Array(b);d=new Uint8Array(c-a);for(var g=0;a<c;a++,g++)d[g]=b[a];return d.buffer}},function(c,d){function b(){}c.exports=function(a,c,d){function g(a,b){if(0>=g.count)throw Error("after called too many times");--g.count;a?(f=!0,c(a),c=d):0!==g.count||f||c(null,b)}var f=!1;return d=d||b,g.count=a,0===a?c():g}},function(c,d,b){var a;(function(b,c){!function(c){function g(a){for(var b,
c,d=[],h=0,k=a.length;h<k;)b=a.charCodeAt(h++),55296<=b&&56319>=b&&h<k?(c=a.charCodeAt(h++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),h--)):d.push(b);return d}function f(a,b){if(55296<=a&&57343>=a){if(b)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function p(){if(k>=h)throw Error("Invalid byte index");var a=255&r[k];if(k++,128==(192&a))return 63&a;throw Error("Invalid continuation byte");}function m(a){var b,c,d,g,
v;if(k>h)throw Error("Invalid byte index");if(k==h)return!1;if(b=255&r[k],k++,0==(128&b))return b;if(192==(224&b)){if(c=p(),v=(31&b)<<6|c,128<=v)return v;throw Error("Invalid continuation byte");}if(224==(240&b)){if(c=p(),d=p(),v=(15&b)<<12|c<<6|d,2048<=v)return f(v,a)?v:65533;throw Error("Invalid continuation byte");}if(240==(248&b)&&(c=p(),d=p(),g=p(),v=(7&b)<<18|c<<12|d<<6|g,65536<=v&&1114111>=v))return v;throw Error("Invalid UTF-8 detected");}c="object"==typeof d&&d;"object"==typeof b&&b&&b.exports==
c&&b;var r,h,k,v=String.fromCharCode;a={version:"2.1.2",encode:function(a,b){b=b||{};b=!1!==b.strict;a=g(a);for(var c=a.length,d=-1,h="";++d<c;){var k=a[d];var r=b;if(0==(4294967168&k))r=v(k);else{var m="";r=(0==(4294965248&k)?m=v(k>>6&31|192):0==(4294901760&k)?(f(k,r)||(k=65533),m=v(k>>12&15|224),m+=v(k>>6&63|128)):0==(4292870144&k)&&(m=v(k>>18&7|240),m+=v(k>>12&63|128),m+=v(k>>6&63|128)),m+v(63&k|128))}h+=r}return h},decode:function(a,b){b=b||{};b=!1!==b.strict;r=g(a);h=r.length;k=0;var c;for(a=
[];!1!==(c=m(b));)a.push(c);c=a.length;for(var d=-1,f="";++d<c;)b=a[d],65535<b&&(b-=65536,f+=v(b>>>10&1023|55296),b=56320|1023&b),f+=v(b);return f}};!(void 0!==a&&(b.exports=a))}(this)}).call(d,b(28)(c),function(){return this}())},function(c,d){c.exports=function(b){return b.webpackPolyfill||(b.deprecate=function(){},b.paths=[],b.children=[],b.webpackPolyfill=1),b}},function(c,d){!function(){for(var b=new Uint8Array(256),a=0;64>a;a++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(a)]=
a;d.encode=function(a){var b=new Uint8Array(a),c=b.length,d="";for(a=0;a<c;a+=3)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[a]>>2],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&b[a])<<4|b[a+1]>>4],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&b[a+1])<<2|b[a+2]>>6],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&b[a+2]];return 2===c%3?d=d.substring(0,d.length-1)+"\x3d":1===c%3&&(d=d.substring(0,
d.length-2)+"\x3d\x3d"),d};d.decode=function(a){var c=.75*a.length;var d=a.length,g=0;"\x3d"===a[a.length-1]&&(c--,"\x3d"===a[a.length-2]&&c--);var n=new ArrayBuffer(c),p=new Uint8Array(n);for(c=0;c<d;c+=4){var m=b[a.charCodeAt(c)];var r=b[a.charCodeAt(c+1)];var h=b[a.charCodeAt(c+2)];var k=b[a.charCodeAt(c+3)];p[g++]=m<<2|r>>4;p[g++]=(15&r)<<4|h>>2;p[g++]=(3&h)<<6|63&k}return n}}()},function(c,d){(function(b){function a(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=
c.buffer;if(c.byteLength!==d.byteLength){var g=new Uint8Array(c.byteLength);g.set(new Uint8Array(d,c.byteOffset,c.byteLength));d=g.buffer}a[b]=d}}}function d(b,c){c=c||{};var d=new t;a(b);for(var k=0;k<b.length;k++)d.append(b[k]);return c.type?d.getBlob(c.type):d.getBlob()}function f(b,c){return a(b),new Blob(b,c||{})}var t=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{var q=2===(new Blob(["hi"])).size}catch(m){q=!1}var n;if(n=q)try{n=2===(new Blob([new Uint8Array([1,2])])).size}catch(m){n=
!1}var p=t&&t.prototype.append&&t.prototype.getBlob;c.exports=q?n?b.Blob:f:p?d:void 0}).call(d,function(){return this}())},function(c,d){d.encode=function(b){var a="",c;for(c in b)b.hasOwnProperty(c)&&(a.length&&(a+="\x26"),a+=encodeURIComponent(c)+"\x3d"+encodeURIComponent(b[c]));return a};d.decode=function(b){var a={};b=b.split("\x26");for(var c=0,d=b.length;c<d;c++){var t=b[c].split("\x3d");a[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return a}},function(c,d){c.exports=function(b,a){var c=
function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b}},function(c,d){function b(a){var b="";do b=f[a%t]+b,a=Math.floor(a/t);while(0<a);return b}function a(){var a=b(+new Date);return a!==g?(n=0,g=a):a+"."+b(n++)}for(var g,f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),t=64,q={},n=0,p=0;p<t;p++)q[f[p]]=p;a.encode=b;a.decode=function(a){var b=0;for(p=0;p<a.length;p++)b=b*t+q[a.charAt(p)];return b};c.exports=a},function(c,d,b){(function(a){function d(){}
function f(b){t.call(this,b);this.query=this.query||{};n||(a.___eio||(a.___eio=[]),n=a.___eio);this.index=n.length;var c=this;n.push(function(a){c.onData(a)});this.query.j=this.index;a.document&&a.addEventListener&&a.addEventListener("beforeunload",function(){c.script&&(c.script.onerror=d)},!1)}var t=b(21),q=b(32);c.exports=f;var n,p=/\n/g,m=/\\n/g;q(f,t);f.prototype.supportsBinary=!1;f.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&
(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);t.prototype.doClose.call(this)};f.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);b.async=!0;b.src=this.uri();b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b);this.script=b;"undefined"!=
typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};f.prototype.doWrite=function(a,b){function c(){d();b()}function d(){if(h.iframe)try{h.form.removeChild(h.iframe)}catch(Q){h.onError("jsonp polling iframe removal error",Q)}try{g=document.createElement('\x3ciframe src\x3d"javascript:0" name\x3d"'+h.iframeId+'"\x3e')}catch(Q){g=document.createElement("iframe"),g.name=h.iframeId,
g.src="javascript:0"}g.id=h.iframeId;h.form.appendChild(g);h.iframe=g}var h=this;if(!this.form){var g,f=document.createElement("form"),r=document.createElement("textarea"),t=this.iframeId="eio_iframe_"+this.index;f.className="socketio";f.style.position="absolute";f.style.top="-1000px";f.style.left="-1000px";f.target=t;f.method="POST";f.setAttribute("accept-charset","utf-8");r.name="d";f.appendChild(r);document.body.appendChild(f);this.form=f;this.area=r}this.form.action=this.uri();d();a=a.replace(m,
"\\\n");this.area.value=a.replace(p,"\\n");try{this.form.submit()}catch(Q){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===h.iframe.readyState&&c()}:this.iframe.onload=c}}).call(d,function(){return this}())},function(c,d,b){(function(a){function d(a){a&&a.forceBase64&&(this.supportsBinary=!1);this.perMessageDeflate=a.perMessageDeflate;this.usingBrowserWebSocket=r&&!a.forceNode;this.protocols=a.protocols;this.usingBrowserWebSocket||(k=h);f.call(this,a)}var f=b(22),t=
b(23),q=b(31),n=b(32),p=b(33),m=b(3)("engine.io-client:websocket"),r=a.WebSocket||a.MozWebSocket;if("undefined"==typeof window)try{var h=b(36)}catch(v){}var k=r;k||"undefined"!=typeof window||(k=h);c.exports=d;n(d,f);d.prototype.name="websocket";d.prototype.supportsBinary=!0;d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=this.protocols,c={agent:this.agent,perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx;c.key=this.key;c.passphrase=this.passphrase;c.cert=this.cert;c.ca=this.ca;
c.ciphers=this.ciphers;c.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(c.headers=this.extraHeaders);this.localAddress&&(c.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?b?new k(a,b):new k(a):new k(a,b,c)}catch(A){return this.emit("error",A)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};d.prototype.addEventListeners=
function(){var a=this;this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(){a.onClose()};this.ws.onmessage=function(b){a.onData(b.data)};this.ws.onerror=function(b){a.onError("websocket error",b)}};d.prototype.write=function(b){function c(){d.emit("flush");setTimeout(function(){d.writable=!0;d.emit("drain")},0)}var d=this;this.writable=!1;for(var h=b.length,k=0,g=h;k<g;k++)!function(b){t.encodePacket(b,d.supportsBinary,function(k){if(!d.usingBrowserWebSocket){var g={};(b.options&&(g.compress=
b.options.compress),d.perMessageDeflate)&&("string"==typeof k?a.Buffer.byteLength(k):k.length)<d.perMessageDeflate.threshold&&(g.compress=!1)}try{d.usingBrowserWebSocket?d.ws.send(k):d.ws.send(k,g)}catch(B){m("websocket closed before onclose event")}--h||c()})}(b[k])};d.prototype.onClose=function(){f.prototype.onClose.call(this)};d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()};d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"===
b&&443!==Number(this.port)||"ws"===b&&80!==Number(this.port))&&(c=":"+this.port);this.timestampRequests&&(a[this.timestampParam]=p());this.supportsBinary||(a.b64=1);a=q.encode(a);a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a};d.prototype.check=function(){return!(!k||"__initialize"in k&&this.name===d.prototype.name)}}).call(d,function(){return this}())},function(c,d){},function(c,d){var b=[].indexOf;c.exports=function(a,
c){if(b)return a.indexOf(c);for(var d=0;d<a.length;++d)if(a[d]===c)return d;return-1}},function(c,d){(function(b){var a=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,f=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,t=/(?:^|:|,)(?:\s*\[)+/g,q=/^\s+/,n=/\s+$/;c.exports=function(c){return"string"==typeof c&&c?(c=c.replace(q,"").replace(n,""),b.JSON&&JSON.parse?JSON.parse(c):a.test(c.replace(d,"@").replace(f,"]").replace(t,""))?(new Function("return "+c))():void 0):null}}).call(d,
function(){return this}())},function(c,d,b){function a(a,b,c){this.io=a;this.nsp=b;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;c&&c.query&&(this.query=c.query);this.io.autoConnect&&this.open()}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f=b(7);d=b(8);var t=b(40),
q=b(41),n=b(42),p=b(3)("socket.io-client:socket"),m=b(31);c.exports=a;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=d.prototype.emit;d(a.prototype);a.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[q(a,"open",n(this,"onopen")),q(a,"packet",n(this,"onpacket")),q(a,"close",n(this,"onclose"))]}};a.prototype.open=a.prototype.connect=function(){return this.connected?
this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};a.prototype.send=function(){var a=t(arguments);return a.unshift("message"),this.emit.apply(this,a),this};a.prototype.emit=function(a){if(r.hasOwnProperty(a))return h.apply(this,arguments),this;var b=t(arguments),c={type:f.EVENT,data:b};return c.options={},c.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof b[b.length-1]&&(p("emitting packet with ack id %d",this.ids),
this.acks[this.ids]=b.pop(),c.id=this.ids++),this.connected?this.packet(c):this.sendBuffer.push(c),delete this.flags,this};a.prototype.packet=function(a){a.nsp=this.nsp;this.io.packet(a)};a.prototype.onopen=function(){if(p("transport is open - connecting"),"/"!==this.nsp)if(this.query){var a="object"===g(this.query)?m.encode(this.query):this.query;p("sending connect packet with query %s",a);this.packet({type:f.CONNECT,query:a})}else this.packet({type:f.CONNECT})};a.prototype.onclose=function(a){p("close (%s)",
a);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",a)};a.prototype.onpacket=function(a){if(a.nsp===this.nsp)switch(a.type){case f.CONNECT:this.onconnect();break;case f.EVENT:this.onevent(a);break;case f.BINARY_EVENT:this.onevent(a);break;case f.ACK:this.onack(a);break;case f.BINARY_ACK:this.onack(a);break;case f.DISCONNECT:this.ondisconnect();break;case f.ERROR:this.emit("error",a.data)}};a.prototype.onevent=function(a){var b=a.data||[];p("emitting event %j",b);null!=
a.id&&(p("attaching ack callback to event"),b.push(this.ack(a.id)));this.connected?h.apply(this,b):this.receiveBuffer.push(b)};a.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=t(arguments);p("sending ack %j",d);b.packet({type:f.ACK,id:a,data:d})}}};a.prototype.onack=function(a){var b=this.acks[a.id];"function"==typeof b?(p("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):p("bad ack %s",a.id)};a.prototype.onconnect=function(){this.connected=
!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};a.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)h.apply(this,this.receiveBuffer[a]);this.receiveBuffer=[];for(a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]};a.prototype.ondisconnect=function(){p("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};a.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();
this.subs=null}this.io.destroy(this)};a.prototype.close=a.prototype.disconnect=function(){return this.connected&&(p("performing disconnect (%s)",this.nsp),this.packet({type:f.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};a.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=a,this}},function(c,d){c.exports=function(b,a){for(var c=[],d=(a=a||0)||0;d<b.length;d++)c[d-a]=b[d];return c}},function(c,d){c.exports=function(b,a,c){return b.on(a,
c),{destroy:function(){b.removeListener(a,c)}}}},function(c,d){var b=[].slice;c.exports=function(a,c){if("string"==typeof c&&(c=a[c]),"function"!=typeof c)throw Error("bind() requires a function");var d=b.call(arguments,2);return function(){return c.apply(a,d.concat(b.call(arguments)))}}},function(c,d){function b(a){a=a||{};this.ms=a.min||100;this.max=a.max||1E4;this.factor=a.factor||2;this.jitter=0<a.jitter&&1>=a.jitter?a.jitter:0;this.attempts=0}c.exports=b;b.prototype.duration=function(){var a=
this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-c:a+c}return 0|Math.min(a,this.max)};b.prototype.reset=function(){this.attempts=0};b.prototype.setMin=function(a){this.ms=a};b.prototype.setMax=function(a){this.max=a};b.prototype.setJitter=function(a){this.jitter=a}}])});window.TK=window.TK||{};
TK.EventDispatcher=function(c){var d={};c=c||{};c.dispatcher={};c.dispatcher.eventListeners={};c.dispatcher.backupListerners={};d.addEventListener=function(b,a,d){void 0!==b&&null!==b&&(void 0===c.dispatcher.eventListeners[b]&&(c.dispatcher.eventListeners[b]=[]),c.dispatcher.eventListeners[b].push(a),d&&(void 0===c.dispatcher.backupListerners[d]&&(c.dispatcher.backupListerners[d]=[]),c.dispatcher.backupListerners[d].push({eventType:b,listener:a})))};d.removeEventListener=function(b,a){c.dispatcher.eventListeners[b]?
(a=c.dispatcher.eventListeners[b].indexOf(a),-1!==a&&c.dispatcher.eventListeners[b].splice(a,1)):L.Logger.info("[tk-sdk]not event type: "+b)};d.removeAllEventListener=function(b){if(b&&"object"===typeof b&&"number"===typeof b.length&&"function"===typeof b.splice&&!b.propertyIsEnumerable("length"))for(var a in b){var g=b[a];delete c.dispatcher.eventListeners[g]}else if("string"===typeof b)delete c.dispatcher.eventListeners[b];else if("object"===typeof b)for(var f in b)g=f,d.removeEventListener(g,b[f])};
d.dispatchEvent=function(b,a){var d;(void 0!=a?a:1)&&L.Logger.debug("sdk-dispatchEvent , event type: "+b.type);for(d in c.dispatcher.eventListeners[b.type])if(c.dispatcher.eventListeners[b.type].hasOwnProperty(d))c.dispatcher.eventListeners[b.type][d](b)};d.removeBackupListerner=function(b){if(b&&c.dispatcher.backupListerners[b]){for(var a=0;a<c.dispatcher.backupListerners[b].length;a++){var g=c.dispatcher.backupListerners[b][a];d.removeEventListener(g.eventType,g.listener)}c.dispatcher.backupListerners[b].length=
0;delete c.dispatcher.backupListerners[b]}};return d};TK.TalkEvent=function(c){var d={};d.type=c.type;d.data=c.data;return d};TK.RoomEvent=function(c,d){var b=TK.TalkEvent(c);b.streams=c.streams;b.message=c.message;b.user=c.user;b.userid=c.user?c.user.id:void 0;if(d&&"object"===typeof d)for(var a in d)b[a]=d[a];return b};
TK.StreamEvent=function(c,d){var b=TK.TalkEvent(c);b.stream=c.stream;b.message=c.message;b.bandwidth=c.bandwidth;b.attrs=c.attrs;b.userid=c.stream&&c.stream.extensionId&&c.stream.getAttributes&&c.stream.getAttributes()&&c.stream.getAttributes().type?c.stream.extensionId.replace(new RegExp(":"+c.stream.getAttributes().type,"g"),""):void 0;b.streamType=c.stream&&c.stream.extensionId&&c.stream.getAttributes&&c.stream.getAttributes()&&c.stream.getAttributes().type?c.stream.getAttributes().type:void 0;
b.streamInfo={audio:c.stream&&c.stream.hasAudio?c.stream.hasAudio():!1,video:c.stream&&c.stream.hasVideo?c.stream.hasVideo():!1,attributes:c.stream&&c.stream.getAttributes?c.stream.getAttributes():{}};if(d&&"object"===typeof d)for(var a in d)b[a]=d[a];return b};TK.PublisherEvent=function(c,d){c=TK.TalkEvent(c);if(d&&"object"===typeof d)for(var b in d)c[b]=d[b];return c};TK.coreEventController=TK.EventDispatcher({});window.TK=window.TK||{};
TK.FcStack=function(c){var d={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0};window.L=window.L||{};d.close=function(){L.Logger.debug("[tk-sdk]Close FcStack")};d.createOffer=function(){L.Logger.debug("[tk-sdk]FCSTACK: CreateOffer")};d.addStream=function(b){L.Logger.debug("[tk-sdk]FCSTACK: addStream",b)};d.removeStream=function(b){L.Logger.debug("[tk-sdk]FCSTACK: removeStream",b)};d.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]FCSTACK: processSignaling",b);void 0!==d.signalCallback&&
d.signalCallback(b)};d.sendSignalingMessage=function(b){L.Logger.debug("[tk-sdk]FCSTACK: Sending signaling Message",b);c.callback(b)};d.setSignalingCallback=function(b){L.Logger.debug("[tk-sdk]FCSTACK: Setting signalling callback");d.signalCallback=b};return d};window.TK=window.TK||{};
TK.FirefoxStack=function(c){function d(a){return a=a.replace(/\r?\n/g,"#talkcloudFormatSdp_r_n#").replace(/#talkcloudFormatSdp_r_n#/g,"\r\n")}function b(a){a=d(a);for(var b=a.split(/\r\n/),c=-1,h=-1,k=0,g=b.length;k<g;k++)"string"===typeof b[k]&&/^m=audio/.test(b[k])&&(c=k),"string"===typeof b[k]&&/^m=video/.test(b[k])&&(h=k);if(0<=c&&0<=h&&c<h){g=b.slice(c,h);h=b.slice(h,b.length-1);b=b.slice(0,c).concat(h,g);c="";h=0;for(g=b.length;h<g;h++)c+=b[h]+"\r\n";c&&(a=c)}return a}var a={},g=mozRTCPeerConnection,
f=mozRTCSessionDescription,t=mozRTCIceCandidate,q=L.Utils.getBrowserInfo();a.pcConfig={iceServers:[]};void 0!==c.iceServers&&(a.pcConfig.iceServers=c.iceServers);void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);a.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,mozDontOfferDataChannel:!0};var n=function(a){L.Logger.error("[tk-sdk]Error in Stack ",a)},p=function(){c.video&&c.simulcast&&a.peerConnection.getSenders().forEach(function(a){"video"===a.track.kind&&(a.getParameters(),
a.setParameters({encodings:[{rid:"spam",active:!0,priority:"high",maxBitrate:4E4,maxHeight:640,maxWidth:480},{rid:"egg",active:!0,priority:"medium",maxBitrate:1E4,maxHeight:320,maxWidth:240}]}))})},m=!1;a.peerConnection=new g(a.pcConfig,a.con);c.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(m=!0,a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a=a.candidate,c.remoteDescriptionSet?c.callback({type:"candidate",candidate:a}):(c.localCandidates.push(a),
L.Logger.debug("[tk-sdk]Local Candidates stored: ",c.localCandidates.length,c.localCandidates))):L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate")};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};var r=function(a){a=d(a);
if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},h=function(a){a=d(a);if(c.video&&c.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var b=a.match(/m=video.*\r\n/);null==
b&&(b=a.match(/m=video.*\n/));if(b&&0<b.length){var h=b[0]+"b\x3dAS:"+c.maxVideoBW+"\r\n";a=a.replace(b[0],h)}}c.audio&&c.maxAudioBW&&(b=a.match(/m=audio.*\r\n/),null==b&&(b=a.match(/m=audio.*\n/)),b&&0<b.length&&(h=b[0]+"b\x3dAS:"+c.maxAudioBW+"\r\n",a=a.replace(b[0],h)));return a},k,v=function(a){a.sdp=h(a.sdp);a.sdp=a.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.callback(a);k=a},y=function(b){b.sdp=h(b.sdp);b.sdp=b.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.callback(b);(k=b)?a.peerConnection.setLocalDescription(k):
L.Logger.error("[tk-sdk]localDesc is not exist!")};a.updateSpec=function(a){if(a.maxVideoBW||a.maxAudioBW){a.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested",a.maxVideoBW,"limit",c.limitMaxVideoBW),a.maxVideoBW>c.limitMaxVideoBW&&(a.maxVideoBW=c.limitMaxVideoBW),c.maxVideoBW=a.maxVideoBW);a.maxAudioBW&&(a.maxAudioBW>c.limitMaxAudioBW&&(a.maxAudioBW=c.limitMaxAudioBW),c.maxAudioBW=a.maxAudioBW);if(!k){L.Logger.error("[tk-sdk]localDesc is not exist!");return}k.sdp=h(k.sdp);a.Sdp?L.Logger.error("[tk-sdk]Cannot update with renegotiation in Firefox, try without renegotiation"):
(L.Logger.debug("[tk-sdk]Updating without renegotiation, newVideoBW:",c.maxVideoBW,", newAudioBW:",c.maxAudioBW),c.callback({type:"updatestream",sdp:k.sdp}))}if(a.minVideoBW||void 0!==a.slideShowMode||void 0!==a.muteStream||void 0!==a.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",a.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",a.slideShowMode),L.Logger.debug("[tk-sdk]muteStream changed to ",a.muteStream),c.callback({type:"updatestream",config:a})};a.createOffer=function(b){!0!==
b&&(p(),a.mediaConstraints={offerToReceiveAudio:!1,offerToReceiveVideo:!1,mozDontOfferDataChannel:!0});a.peerConnection.createOffer(v,n,a.mediaConstraints)};a.addStream=function(b){a.peerConnection.addStream(b)};a.removeStream=function(b){a.peerConnection.removeStream(b)};c.remoteCandidates=[];c.remoteDescriptionSet=!1;a.close=function(){try{a&&a.peerConnection&&"closed"!==a.peerConnection.signalingState&&a.peerConnection&&a.peerConnection.close&&(a.peerConnection.close(),a.state="closed")}catch(D){L.Logger.error("[tk-sdk]peerConnection close error:",
D)}};a.processSignalingMessage=function(d){if("offer"===d.type)d.sdp=h(d.sdp),TK.isHiFi&&(d.sdp=r(d.sdp)),a.peerConnection.setRemoteDescription(new f(d),function(){a.peerConnection.createAnswer(y,function(a){L.Logger.error("[tk-sdk]Error",a)},a.mediaConstraints);c.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",a)});else if("answer"===d.type)if(k){if(!c.local&&"string"===typeof q.info.browserName&&"firefox"===q.info.browserName.toLowerCase()){var g=!1;
"string"===typeof q.info.browserVersion&&/^59/.test(q.info.browserVersion)&&(g=!0);g&&(d.sdp=b(d.sdp))}TK.isHiFi&&(d.sdp=r(d.sdp));L.Logger.debug("[tk-sdk]Set remote and local description");L.Logger.debug("[tk-sdk]Local Description to set",k.sdp);L.Logger.debug("[tk-sdk]Remote Description to set",d.sdp);d.sdp=h(d.sdp);a.peerConnection.setLocalDescription(k,function(){a.peerConnection.setRemoteDescription(new f(d),function(){c.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Remote Description successfully set");0<
c.remoteCandidates.length&&m;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),a.peerConnection.addIceCandidate(c.remoteCandidates.shift());for(;0<c.localCandidates.length;)L.Logger.debug("[tk-sdk]Sending Candidate from list"),c.callback({type:"candidate",candidate:c.localCandidates.shift()})},function(a){L.Logger.error("[tk-sdk]Error Setting Remote Description",a)})},function(a){L.Logger.error("[tk-sdk]Failure setting Local Description",a)})}else L.Logger.error("[tk-sdk]localDesc is not exist!");
else if("candidate"===d.type)try{g="object"===typeof d.candidate?d.candidate:L.Utils.toJsonParse(d.candidate);g.candidate=g.candidate.replace(/ generation 0/g,"");g.candidate=g.candidate.replace(/ udp /g," UDP ");g.sdpMLineIndex=parseInt(g.sdpMLineIndex);var v=new t(g);if(c.remoteDescriptionSet&&m)for(a.peerConnection.addIceCandidate(v);0<c.remoteCandidates.length;)L.Logger.debug("[tk-sdk]Setting stored remote candidates"),a.peerConnection.addIceCandidate(c.remoteCandidates.shift());else c.remoteCandidates.push(v)}catch(U){L.Logger.error("[tk-sdk]Error parsing candidate",
d.candidate,U)}};return a};window.TK=window.TK||{};
window.TkWebkitRTCPeerConnection=function(c,d){c&&c.iceTransportPolicy&&(c.iceTransports=c.iceTransportPolicy);c=new webkitRTCPeerConnection(c,d);var b=c.getStats.bind(c);c.getStats=function(a,c,d){var g=arguments;if(0<arguments.length&&"function"===typeof a)return b(a,c);var f=function(a){var b={};a.result().forEach(function(a){var c={id:a.id,timestamp:(new Date(a.timestamp)).getTime(),type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)});b[c.id]=c});return b};if(2<=arguments.length)return b.apply(this,
[function(a){g[1](f(a))},arguments[0]])};return c};
TK.TkChromeStableStack=function(c){function d(a){return a=a.replace(/\r?\n/g,"#talkcloudFormatSdp_r_n#").replace(/#talkcloudFormatSdp_r_n#/g,"\r\n")}var b={},a=window.TkWebkitRTCPeerConnection;b.pcConfig={iceServers:[]};b.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.iceServers&&(b.pcConfig.iceServers=c.iceServers);void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);b.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};var g=function(a){L.Logger.error("[tk-sdk]Error in Stack ",
a)};b.peerConnection=new a(b.pcConfig,b.con);var f=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=" "+a});return b+"\r\n"},t=function(a){a=d(a);if(!c.video||!c.simulcast)return a;var b=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!b||0>=b.length)return a;var h=c.simulcast.numSpatialLayers||2;var k=parseInt(b[1]),g=parseInt(b[2]),r=a.match(new RegExp("a\x3dssrc:"+b[1]+" cname:(.*)\r?\n"))[1],m=a.match(new RegExp("a\x3dssrc:"+b[1]+" msid:(.*)\r?\n"))[1],p=a.match(new RegExp("a\x3dssrc:"+
b[1]+" mslabel:(.*)\r?\n"))[1],t=a.match(new RegExp("a\x3dssrc:"+b[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+b[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+b[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var n=[k],q=[g],K=1;K<h;K++)n.push(k+1E3*K),q.push(g+1E3*K);h=f(n);for(var I in n)k=n[I],g=q[I],h+="a\x3dssrc-group:FID "+k+" "+g+"\r\n";for(I in n)k=n[I],g=q[I],h+="a\x3dssrc:"+k+" cname:"+r+"\r\na\x3dssrc:"+k+" msid:"+
m+"\r\na\x3dssrc:"+k+" mslabel:"+p+"\r\na\x3dssrc:"+k+" label:"+t+"\r\na\x3dssrc:"+g+" cname:"+r+"\r\na\x3dssrc:"+g+" msid:"+m+"\r\na\x3dssrc:"+g+" mslabel:"+p+"\r\na\x3dssrc:"+g+" label:"+t+"\r\n";return a.replace(b[0],h+"a\x3dx-google-flag:conference\r\n")},q=function(a){a=d(a);if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=
b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},n=function(a){a=d(a);if(c.video&&c.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var b=a.match(/m=video.*\r\n/);null==b&&(b=a.match(/m=video.*\n/));if(b&&0<b.length){var h=b[0]+"b\x3dAS:"+c.maxVideoBW+"\r\n";a=a.replace(b[0],h)}}c.audio&&c.maxAudioBW&&(b=a.match(/m=audio.*\r\n/),null==b&&(b=a.match(/m=audio.*\n/)),b&&0<b.length&&(h=b[0]+"b\x3dAS:"+
c.maxAudioBW+"\r\n",a=a.replace(b[0],h)));return a};b.close=function(){try{b&&b.peerConnection&&"closed"!==b.peerConnection.signalingState&&b.peerConnection&&b.peerConnection.close&&(b.peerConnection.close(),b.state="closed")}catch(k){L.Logger.error("[tk-sdk]peerConnection close error:",k)}};c.localCandidates=[];b.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,
sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("[tk-sdk]Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"});c.remoteDescriptionSet?c.callback({type:"candidate",candidate:a}):(c.localCandidates.push(a),L.Logger.debug("[tk-sdk]Storing candidate: ",c.localCandidates.length,a))};b.peerConnection.onaddstream=function(a){if(b.onaddstream)b.onaddstream(a)};b.peerConnection.onremovestream=function(a){if(b.onremovestream)b.onremovestream(a)};
b.peerConnection.oniceconnectionstatechange=function(a){if(b.oniceconnectionstatechange)b.oniceconnectionstatechange(a.target.iceConnectionState)};var p,m,r=function(a,b){a||(b.sdp=t(b.sdp));b.sdp=n(b.sdp);a=b.sdp;a=d(a);var h=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==h&&(a=a.replace(h[0],h[0]+"a\x3drtcp-fb:"+h[1]+"nack\r\n"));b.sdp=a;b.sdp=b.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.sdp=b.sdp.replace(/a=rtcp-fb:\d+ transport-cc\r\n/g,"");c.callback({type:b.type,sdp:b.sdp});p=b},h=function(a){a.sdp=
n(a.sdp);c.callback({type:a.type,sdp:a.sdp});(p=a)?b.peerConnection.setLocalDescription(a):L.Logger.error("[tk-sdk]localDesc is not exist!")};b.updateSpec=function(a,d){if(a.maxVideoBW||a.maxAudioBW){a.maxVideoBW&&(L.Logger.debug("[tk-sdk]Maxvideo Requested:",a.maxVideoBW,"limit:",c.limitMaxVideoBW),a.maxVideoBW>c.limitMaxVideoBW&&(a.maxVideoBW=c.limitMaxVideoBW),c.maxVideoBW=a.maxVideoBW);a.maxAudioBW&&(a.maxAudioBW>c.limitMaxAudioBW&&(a.maxAudioBW=c.limitMaxAudioBW),c.maxAudioBW=a.maxAudioBW);if(!p){L.Logger.error("[tk-sdk]localDesc is not exist!");
return}p.sdp=n(p.sdp);a.Sdp||a.maxAudioBW?(L.Logger.debug("[tk-sdk]Updating with SDP renegotiation",c.maxVideoBW,c.maxAudioBW),b.peerConnection.setLocalDescription(p,function(){m.sdp=n(m.sdp);TK.isHiFi&&(m.sdp=q(m.sdp));b.peerConnection.setRemoteDescription(new RTCSessionDescription(m),function(){c.remoteDescriptionSet=!0;c.callback({type:"updatestream",sdp:p.sdp})})},function(a){L.Logger.error("[tk-sdk]Error updating configuration",a);d("error")})):(L.Logger.debug("[tk-sdk]Updating without SDP renegotiation, newVideoBW:",
c.maxVideoBW,"newAudioBW:",c.maxAudioBW),c.callback({type:"updatestream",sdp:p.sdp}))}if(a.minVideoBW||void 0!==a.slideShowMode||void 0!==a.muteStream||void 0!==a.qualityLayer)L.Logger.debug("[tk-sdk]MinVideo Changed to ",a.minVideoBW),L.Logger.debug("[tk-sdk]SlideShowMode Changed to ",a.slideShowMode),L.Logger.debug("[tk-sdk]muteStream changed to ",a.muteStream),c.callback({type:"updatestream",config:a})};b.createOffer=function(a){!0!==a&&(b.mediaConstraints={mandatory:{OfferToReceiveVideo:!1,OfferToReceiveAudio:!1}});
b.peerConnection.createOffer(r.bind(null,a),g,b.mediaConstraints)};b.addStream=function(a){a?b.peerConnection.addStream(a):L.Logger.error("[tk-sdk]chromeStableStack addStream : stream is not exist!")};b.removeStream=function(a){b.peerConnection.removeStream(a)};b.getStats=function(a){if(a&&"function"===typeof a)if(b.peerConnection&&b.peerConnection.getStats)try{b.peerConnection.getStats(void 0,function(b){a(b,void 0)},function(b){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",b);a(void 0,
-2)})}catch(v){L.Logger.error("[tk-sdk]that.peerConnection.getStats error:",v),a(void 0,-3)}else a(void 0,-1)};c.remoteCandidates=[];c.remoteDescriptionSet=!1;b.processSignalingMessage=function(a,d){L.Logger.debug("[tk-sdk]Process Signaling Message ",L.Utils.toJsonStringify(a));if(a.sdp&&"answer"===a.type){var g=a.sdp,k=g.indexOf("udp");if(-1!==k){var f="";d&&(f+="stream sdp info:stream id:"+d.getID()+" , extensionId is "+d.extensionId+", attrs is "+L.Utils.toJsonStringify(d.getAttributes())+". \n");
f+="udp info:"+(window.__TkSdkBuild__?L.Utils.encrypt(g.substr(k,58)):g.substr(k,58));L.Logger.info(f)}}if("offer"===a.type)a.sdp=n(a.sdp),TK.isHiFi&&(a.sdp=q(a.sdp)),b.peerConnection.setRemoteDescription(new RTCSessionDescription(a),function(){b.peerConnection.createAnswer(h,function(a){L.Logger.error("[tk-sdk]createAnswer Error: ",a)},b.mediaConstraints);c.remoteDescriptionSet=!0},function(a){L.Logger.error("[tk-sdk]Error setting Remote Description",a)});else if("answer"===a.type)p?(TK.isHiFi&&
(a.sdp=q(a.sdp)),L.Logger.debug("[tk-sdk]Set remote and local description"),L.Logger.debug("[tk-sdk]Remote Description",a.sdp),L.Logger.debug("[tk-sdk]Local Description",p.sdp),a.sdp=n(a.sdp),m=a,b.peerConnection.setLocalDescription(p,function(){b.peerConnection.setRemoteDescription(new RTCSessionDescription(a),function(){c.remoteDescriptionSet=!0;for(L.Logger.debug("[tk-sdk]Candidates to be added: ",c.remoteCandidates.length,c.remoteCandidates);0<c.remoteCandidates.length;)b.peerConnection.addIceCandidate(c.remoteCandidates.shift());
for(L.Logger.debug("[tk-sdk]Local candidates to send:",c.localCandidates.length);0<c.localCandidates.length;)c.callback({type:"candidate",candidate:c.localCandidates.shift()})})})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===a.type)try{var r="object"===typeof a.candidate?a.candidate:L.Utils.toJsonParse(a.candidate);if("end"!==r.candidate){r.candidate=r.candidate.replace(/a=/g,"");r.sdpMLineIndex=parseInt(r.sdpMLineIndex);var v=new RTCIceCandidate(r);c.remoteDescriptionSet?
b.peerConnection.addIceCandidate(v):c.remoteCandidates.push(v)}}catch(Q){L.Logger.error("[tk-sdk]Error parsing candidate",a.candidate)}};return b};window.TK=window.TK||{};
TK.BowserStack=function(c){var d={},b=webkitRTCPeerConnection;d.pcConfig={iceServers:[]};d.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.stunServerUrl&&d.pcConfig.iceServers.push({url:c.stunServerUrl});(c.turnServer||{}).url&&d.pcConfig.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url});void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);d.mediaConstraints={offerToReceiveVideo:c.video,offerToReceiveAudio:c.audio};d.peerConnection=
new b(d.pcConfig,d.con);c.remoteDescriptionSet=!1;var a=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";a=a.replace(b[0],c)}}return a},g=function(a){if(c.maxVideoBW){var b=a.match(/m=video.*\r\n/);
null==b&&(b=a.match(/m=video.*\n/));if(b&&0<b.length){var d=b[0]+"b\x3dAS:"+c.maxVideoBW+"\r\n";a=a.replace(b[0],d)}}c.maxAudioBW&&(b=a.match(/m=audio.*\r\n/),null==b&&(b=a.match(/m=audio.*\n/)),b&&0<b.length&&(d=b[0]+"b\x3dAS:"+c.maxAudioBW+"\r\n",a=a.replace(b[0],d)));return a};d.close=function(){try{d&&d.peerConnection&&"closed"!==d.peerConnection.signalingState&&d.peerConnection&&d.peerConnection.close&&(d.peerConnection.close(),d.state="closed")}catch(p){L.Logger.error("[tk-sdk]peerConnection close error:",
p)}};c.localCandidates=[];d.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),c.remoteDescriptionSet?c.callback({type:"candidate",candidate:a.candidate}):c.localCandidates.push(a.candidate)):L.Logger.debug("End of candidates.",d.peerConnection.localDescription)};d.peerConnection.onaddstream=function(a){if(d.onaddstream)d.onaddstream(a)};d.peerConnection.onremovestream=function(a){if(d.onremovestream)d.onremovestream(a)};
var f=function(a){L.Logger.debug("Error in Stack ",a)},t,q=function(a){a.sdp=g(a.sdp);L.Logger.debug("Set local description",a.sdp);(t=a)?d.peerConnection.setLocalDescription(t,function(){L.Logger.debug("The final LocalDesc",d.peerConnection.localDescription);c.callback(d.peerConnection.localDescription)},f):L.Logger.error("[tk-sdk]localDesc is not exist!")},n=function(a){a.sdp=g(a.sdp);c.callback(a);(t=a)?d.peerConnection.setLocalDescription(a):L.Logger.error("[tk-sdk]localDesc is not exist!")};
d.createOffer=function(a){!0===a?d.peerConnection.createOffer(q,f,d.mediaConstraints):d.peerConnection.createOffer(q,f)};d.addStream=function(a){d.peerConnection.addStream(a)};c.remoteCandidates=[];d.processSignalingMessage=function(b){L.Logger.debug("Process Signaling Message",b);if("offer"===b.type)b.sdp=g(b.sdp),TK.isHiFi&&(b.sdp=a(b.sdp)),d.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),d.peerConnection.createAnswer(n,null,d.mediaConstraints),c.remoteDescriptionSet=!0;else if("answer"===
b.type)TK.isHiFi&&(b.sdp=a(b.sdp)),L.Logger.debug("Set remote description",b.sdp),b.sdp=g(b.sdp),d.peerConnection.setRemoteDescription(new RTCSessionDescription(b),function(){c.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",c.remoteCandidates.length);0<c.remoteCandidates.length;)L.Logger.debug("Candidate :",c.remoteCandidates[c.remoteCandidates.length-1]),d.peerConnection.addIceCandidate(c.remoteCandidates.shift(),function(){},f);for(;0<c.localCandidates.length;)c.callback({type:"candidate",
candidate:c.localCandidates.shift()})},function(){L.Logger.warning("Error Setting Remote Description")});else if("candidate"===b.type){L.Logger.debug("Message with candidate");try{var m="object"===typeof b.candidate?b.candidate:L.Utils.toJsonParse(b.candidate);m.candidate=m.candidate.replace(/a=/g,"");m.sdpMLineIndex=parseInt(m.sdpMLineIndex);m.sdpMLineIndex="audio"===m.sdpMid?0:1;var r=new RTCIceCandidate(m);L.Logger.debug("Remote Candidate",r);c.remoteDescriptionSet?d.peerConnection.addIceCandidate(r,
function(){},f):c.remoteCandidates.push(r)}catch(h){L.Logger.error("[tk-sdk]Error parsing candidate",b.candidate)}}};return d};window.TK=window.TK||{};
TK.ChromeCanaryStack=function(c){var d={},b=webkitRTCPeerConnection;d.pcConfig={iceServers:[]};d.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.stunServerUrl&&d.pcConfig.iceServers.push({url:c.stunServerUrl});(c.turnServer||{}).url&&d.pcConfig.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url});if(void 0===c.audio||c.nop2p)c.audio=!0;if(void 0===c.video||c.nop2p)c.video=!0;d.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};
d.roapSessionId=103;d.peerConnection=new b(d.pcConfig,d.con);d.peerConnection.onicecandidate=function(a){L.Logger.debug("[tk-sdk]PeerConnection: ",c.sessionId);a.candidate?d.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]State: "+d.peerConnection.iceGatheringState),void 0===d.ices&&(d.ices=0),d.ices+=1,1<=d.ices&&d.moreIceComing&&(d.moreIceComing=!1,d.markActionNeeded()))};var a=function(a){var b;if(c.maxVideoBW&&(b=a.match(/m=video.*\r\n/))&&0<b.length){var d=b[0]+"b\x3dAS:"+c.maxVideoBW+"\r\n";a=
a.replace(b[0],d)}c.maxAudioBW&&(b=a.match(/m=audio.*\r\n/))&&0<b.length&&(d=b[0]+"b\x3dAS:"+c.maxAudioBW+"\r\n",a=a.replace(b[0],d));return a};d.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+d.sessionId);b=L.Utils.toJsonParse(b);d.incomingMessage=b;"new"===d.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},d.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),d.state="offer-received",d.markActionNeeded()):d.error("Illegal message for this state: "+
b.messageType+" in state "+d.state):"offer-sent"===d.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=a(b.sdp),d.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),d.sendOK(),d.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},d.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?d.error("Not written yet"):d.error("Illegal message for this state: "+
b.messageType+" in state "+d.state):"established"===d.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},d.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),d.state="offer-received",d.markActionNeeded()):d.error("Illegal message for this state: "+b.messageType+" in state "+d.state))};d.addStream=function(a){d.peerConnection.addStream(a);d.markActionNeeded()};d.removeStream=function(a){d.peerConnection.removeStream(a)};d.removeStream=function(){d.markActionNeeded()};d.close=
function(){try{d&&d.peerConnection&&"closed"!==d.peerConnection.signalingState&&d.peerConnection&&d.peerConnection.close&&(d.peerConnection.close(),d.state="closed")}catch(g){L.Logger.error("[tk-sdk]peerConnection close error:",g)}};d.markActionNeeded=function(){d.actionNeeded=!0;d.doLater(function(){d.onstablestate()})};d.doLater=function(a){window.setTimeout(a,1)};d.onstablestate=function(){if(d.actionNeeded){if("new"===d.state||"established"===d.state)d.peerConnection.createOffer(function(b){b.sdp=
a(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==d.prevOffer?(d.peerConnection.setLocalDescription(b),d.state="preparing-offer",d.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},null,d.mediaConstraints);else if("preparing-offer"===d.state){if(d.moreIceComing)return;d.prevOffer=d.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+d.prevOffer);d.sendMessage("OFFER",d.prevOffer);d.state="offer-sent"}else if("offer-received"===d.state)d.peerConnection.createAnswer(function(a){d.peerConnection.setLocalDescription(a);
d.state="offer-received-preparing-answer";d.iceStarted?d.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),d.iceStarted=!0)},null,d.mediaConstraints);else if("offer-received-preparing-answer"===d.state){if(d.moreIceComing)return;var b=d.peerConnection.localDescription.sdp;d.sendMessage("ANSWER",b);d.state="established"}else d.error("Dazed and confused in state "+d.state+", stopping here");d.actionNeeded=!1}};d.sendOK=function(){d.sendMessage("OK")};
d.sendMessage=function(a,b){var c={};c.messageType=a;c.sdp=b;"OFFER"===a?(c.offererSessionId=d.sessionId,c.answererSessionId=d.otherSessionId,c.seq=d.sequenceNumber+=1,c.tiebreaker=Math.floor(429496723*Math.random()+1)):(c.offererSessionId=d.incomingMessage.offererSessionId,c.answererSessionId=d.sessionId,c.seq=d.incomingMessage.seq);d.onsignalingmessage(L.Utils.toJsonStringify(c))};d.error=function(a){throw"Error in RoapOnJsep: "+a;};d.sessionId=d.roapSessionId+=1;d.sequenceNumber=0;d.actionNeeded=
!1;d.iceStarted=!1;d.moreIceComing=!0;d.iceCandidateCount=0;d.onsignalingmessage=c.callback;d.peerConnection.onopen=function(){if(d.onopen)d.onopen()};d.peerConnection.onaddstream=function(a){if(d.onaddstream)d.onaddstream(a)};d.peerConnection.onremovestream=function(a){if(d.onremovestream)d.onremovestream(a)};d.peerConnection.oniceconnectionstatechange=function(a){if(d.oniceconnectionstatechange)d.oniceconnectionstatechange(a.currentTarget.iceConnectionState)};d.onaddstream=null;d.onremovestream=
null;d.state="new";d.markActionNeeded();return d};window.TK=window.TK||{};
TK.ChromeRoapStack=function(c){var d={},b=webkitRTCPeerConnection;d.pcConfig={iceServers:[]};d.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.stunServerUrl&&d.pcConfig.iceServers.push({url:c.stunServerUrl});(c.turnServer||{}).url&&d.pcConfig.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url});if(void 0===c.audio||c.nop2p)c.audio=!0;if(void 0===c.video||c.nop2p)c.video=!0;d.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};
d.roapSessionId=103;d.peerConnection=new b(d.pcConfig,d.con);d.peerConnection.onicecandidate=function(a){L.Logger.debug("[tk-sdk]PeerConnection: ",c.sessionId);a.candidate?d.iceCandidateCount+=1:(L.Logger.debug("[tk-sdk]onicecandidate state: "+d.peerConnection.iceGatheringState),void 0===d.ices&&(d.ices=0),d.ices+=1,1<=d.ices&&d.moreIceComing&&(d.moreIceComing=!1,d.markActionNeeded()))};var a=function(a){var b;if(c.maxVideoBW&&(b=a.match(/m=video.*\r\n/))&&0<b.length){var d=b[0]+"b\x3dAS:"+c.maxVideoBW+
"\r\n";a=a.replace(b[0],d)}c.maxAudioBW&&(b=a.match(/m=audio.*\r\n/))&&0<b.length&&(d=b[0]+"b\x3dAS:"+c.maxAudioBW+"\r\n",a=a.replace(b[0],d));return a};d.processSignalingMessage=function(b){L.Logger.debug("[tk-sdk]Activity on conn "+d.sessionId);b=L.Utils.toJsonParse(b);d.incomingMessage=b;"new"===d.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},d.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),d.state="offer-received",d.markActionNeeded()):d.error("Illegal message for this state: "+
b.messageType+" in state "+d.state):"offer-sent"===d.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("[tk-sdk]Received ANSWER: ",b.sdp),b.sdp=a(b.sdp),d.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),d.sendOK(),d.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},d.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?d.error("Not written yet"):d.error("Illegal message for this state: "+
b.messageType+" in state "+d.state):"established"===d.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},d.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),d.state="offer-received",d.markActionNeeded()):d.error("Illegal message for this state: "+b.messageType+" in state "+d.state))};d.addStream=function(a){d.peerConnection.addStream(a);d.markActionNeeded()};d.removeStream=function(a){d.peerConnection.removeStream(a)};d.removeStream=function(){d.markActionNeeded()};d.close=
function(){try{d&&d.peerConnection&&"closed"!==d.peerConnection.signalingState&&d.peerConnection&&d.peerConnection.close&&(d.peerConnection.close(),d.state="closed")}catch(g){L.Logger.error("[tk-sdk]peerConnection close error:",g)}};d.markActionNeeded=function(){d.actionNeeded=!0;d.doLater(function(){d.onstablestate()})};d.doLater=function(a){window.setTimeout(a,1)};d.onstablestate=function(){if(d.actionNeeded){if("new"===d.state||"established"===d.state)d.peerConnection.createOffer(function(b){b.sdp=
a(b.sdp);L.Logger.debug("[tk-sdk]Changed",b.sdp);b.sdp!==d.prevOffer?(d.peerConnection.setLocalDescription(b),d.state="preparing-offer",d.markActionNeeded()):L.Logger.debug("[tk-sdk]Not sending a new offer")},null,d.mediaConstraints);else if("preparing-offer"===d.state){if(d.moreIceComing)return;d.prevOffer=d.peerConnection.localDescription.sdp;L.Logger.debug("[tk-sdk]Sending OFFER: "+d.prevOffer);d.sendMessage("OFFER",d.prevOffer);d.state="offer-sent"}else if("offer-received"===d.state)d.peerConnection.createAnswer(function(a){d.peerConnection.setLocalDescription(a);
d.state="offer-received-preparing-answer";d.iceStarted?d.markActionNeeded():(L.Logger.debug("[tk-sdk]"+(new Date).getTime()+": Starting ICE in responder"),d.iceStarted=!0)},null,d.mediaConstraints);else if("offer-received-preparing-answer"===d.state){if(d.moreIceComing)return;var b=d.peerConnection.localDescription.sdp;d.sendMessage("ANSWER",b);d.state="established"}else d.error("Dazed and confused in state "+d.state+", stopping here");d.actionNeeded=!1}};d.sendOK=function(){d.sendMessage("OK")};
d.sendMessage=function(a,b){var c={};c.messageType=a;c.sdp=b;"OFFER"===a?(c.offererSessionId=d.sessionId,c.answererSessionId=d.otherSessionId,c.seq=d.sequenceNumber+=1,c.tiebreaker=Math.floor(429496723*Math.random()+1)):(c.offererSessionId=d.incomingMessage.offererSessionId,c.answererSessionId=d.sessionId,c.seq=d.incomingMessage.seq);d.onsignalingmessage(L.Utils.toJsonStringify(c))};d.error=function(a){throw"Error in RoapOnJsep: "+a;};d.sessionId=d.roapSessionId+=1;d.sequenceNumber=0;d.actionNeeded=
!1;d.iceStarted=!1;d.moreIceComing=!0;d.iceCandidateCount=0;d.onsignalingmessage=c.callback;d.peerConnection.onopen=function(){if(d.onopen)d.onopen()};d.peerConnection.onaddstream=function(a){if(d.onaddstream)d.onaddstream(a)};d.peerConnection.onremovestream=function(a){if(d.onremovestream)d.onremovestream(a)};d.peerConnection.oniceconnectionstatechange=function(a){if(d.oniceconnectionstatechange)d.oniceconnectionstatechange(a.currentTarget.iceConnectionState)};d.onaddstream=null;d.onremovestream=
null;d.state="new";d.markActionNeeded();return d};window.TK=window.TK||{};TK.nativeEntry=function(){var c=document.getElementById("window.tknative");c&&c.nodeName&&"embed"===c.nodeName.toLowerCase()||(c=document.createElement("embed"),document.body.appendChild(c),c.setAttribute("id","window.tknative"),c.setAttribute("mainentry",!0),c.setAttribute("hidden",!0),c.setAttribute("type","application/x-ppapi-proxy"));return c};
TK.nativePeerConnection=function(c){var d={},b={},a=c.audio,g=c.video,f=c.screen,t=!0;void 0===f&&(f=!1);d.onicecandidate=null;d.onaddstream=null;d.onremovestream=null;d.oniceconnectionstatechange=null;var q=function(){if(!c.cnnId)throw Error("Invalid native-peer-connection ID");return c.media?c.cnnId+":file":c.screen?c.cnnId+":screen":c.cnnId};window.tknative.addEventListener("message",function(a){var c=a.data.name;if(a.data.connectionId==q()){if("onLocalDescription"===c){var f={};f.sdp=a.data.sdp;
f.type="offer";"function"===typeof b.createOffer_suc&&b.createOffer_suc(f);delete b.createOffer_suc;delete b.createOffer_fai}"onIceCandidate"===c&&d.onicecandidate&&(f={candidate:{}},f.candidate.sdpMLineIndex=a.data.sdpMLineIndex,f.candidate.sdpMid=a.data.sdpMid,f.candidate.candidate=a.data.candidate,d.onicecandidate(f));if("onIceStatusChanged"===c){a=a.data.state;if(1==a)d.oniceconnectionstatechange("checking");if(2==a)d.oniceconnectionstatechange("connected");if(3==a)d.oniceconnectionstatechange("completed");
if(4==a)d.oniceconnectionstatechange("failed");if(5==a)d.oniceconnectionstatechange("disconnected");if(6==a)d.oniceconnectionstatechange("closed")}if("onAddStream"===c)d.onaddstream({stream:{}})}},!1);d.close=function(){window.tknative.postMessage({command:"closeConnection",streamId:q().toString(),offerToSend:t,type:Number(c.media?1:c.screen?2:0)})};d.createOffer=function(c,d,m){m&&(t=!1);window.tknative.postMessage({command:"createOffer",streamId:q().toString(),includeLocalMedia:t,hasAudio:a,hasVideo:g,
hasScreen:f,offerToSend:t});b.createOffer_suc=c;b.createOffer_fai=d};d.setRemoteDescription=function(a,b,c){window.tknative.postMessage({command:"setRemoteDescription",sdpAnswer:a.sdp,streamId:q().toString()});b&&"function"===typeof b&&b()};d.addIceCandidate=function(a){window.tknative.postMessage({command:"setIceCandidate",candidate:a.candidate,sdpMid:0,sdpMLineIndex:a.sdpMLineIndex,streamId:q().toString()})};d.addStream=function(a){window.tknative.postMessage({command:"addStream",streamId:q().toString(),
type:Number(c.media?1:c.screen?2:0)})};d.removeStream=function(a){window.tknative.postMessage({command:"removeStream",streamId:q().toString(),type:Number(c.media?1:c.screen?2:0)})};d.setLocalDescription=function(a){};d.getStats=function(a){a&&"function"===typeof a&&a(void 0,-1)};return d};window.TK=window.TK||{};
TK.TkNativeStack=function(c){var d={},b=TK.nativePeerConnection;d.isNative=!0;d.pcConfig={iceServers:[]};d.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==c.iceServers&&(d.pcConfig.iceServers=c.iceServers);void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);d.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};var a=function(a){L.Logger.error("Error in Stack ",a)};d.peerConnection=new b(c);var g=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=
" "+a});return b+"\r\n"},f=function(a){if(!c.video||!c.simulcast)return a;var b=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!b||0>=b.length)return a;var d=c.simulcast.numSpatialLayers||2;var f=parseInt(b[1]),r=parseInt(b[2]),m=a.match(new RegExp("a\x3dssrc:"+b[1]+" cname:(.*)\r?\n"))[1],p=a.match(new RegExp("a\x3dssrc:"+b[1]+" msid:(.*)\r?\n"))[1],t=a.match(new RegExp("a\x3dssrc:"+b[1]+" mslabel:(.*)\r?\n"))[1],q=a.match(new RegExp("a\x3dssrc:"+b[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+
b[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+b[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var n=[f],S=[r],R=1;R<d;R++)n.push(f+1E3*R),S.push(r+1E3*R);d=g(n);for(var B in n)f=n[B],r=S[B],d+="a\x3dssrc-group:FID "+f+" "+r+"\r\n";for(B in n)f=n[B],r=S[B],d+="a\x3dssrc:"+f+" cname:"+m+"\r\na\x3dssrc:"+f+" msid:"+p+"\r\na\x3dssrc:"+f+" mslabel:"+t+"\r\na\x3dssrc:"+f+" label:"+q+"\r\na\x3dssrc:"+r+" cname:"+m+"\r\na\x3dssrc:"+r+" msid:"+
p+"\r\na\x3dssrc:"+r+" mslabel:"+t+"\r\na\x3dssrc:"+r+" label:"+q+"\r\n";return a.replace(b[0],d+"a\x3dx-google-flag:conference\r\n")},t=function(a){if(TK.isHiFi){a=a.replace(/a=fmtp:111 minptime=10;useinbandfec=1;maxaveragebitrate=128000;maxplaybackrate=48000;stereo=1\r\n/g,"");var b=a.match(/a=rtpmap:111.*\r\n/);null==b&&(b=a.match(/a=rtpmap:111.*\n/));if(b&&0<b.length){var c=b[0]+"a\x3dfmtp:111 minptime\x3d10;useinbandfec\x3d1;maxaveragebitrate\x3d128000;maxplaybackrate\x3d48000;stereo\x3d1\r\n";
a=a.replace(b[0],c)}}return a},q=function(a){if(c.video&&c.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var b=a.match(/m=video.*\r\n/);null==b&&(b=a.match(/m=video.*\n/));if(b&&0<b.length){var d=b[0]+"b\x3dAS:"+c.maxVideoBW+"\r\n";a=a.replace(b[0],d)}}c.audio&&c.maxAudioBW&&(b=a.match(/m=audio.*\r\n/),null==b&&(b=a.match(/m=audio.*\n/)),b&&0<b.length&&(d=b[0]+"b\x3dAS:"+c.maxAudioBW+"\r\n",a=a.replace(b[0],d)));return a};d.close=function(){try{d&&d.peerConnection&&"closed"!==d.peerConnection.signalingState&&
d.peerConnection&&d.peerConnection.close&&(d.peerConnection.close(),d.state="closed")}catch(r){L.Logger.error("[tk-sdk]peerConnection close error:",r)}};c.localCandidates=[];d.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.debug("Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,
sdpMid:"end",candidate:"end"});c.remoteDescriptionSet?c.callback({type:"candidate",candidate:a}):(c.localCandidates.push(a),L.Logger.debug("Storing candidate: ",c.localCandidates.length,a))};d.peerConnection.onaddstream=function(a){if(d.onaddstream)d.onaddstream(a)};d.peerConnection.onremovestream=function(a){if(d.onremovestream)d.onremovestream(a)};d.peerConnection.oniceconnectionstatechange=function(a){if(d.oniceconnectionstatechange)d.oniceconnectionstatechange(a)};var n,p=function(a,b){a||(b.sdp=
f(b.sdp));b.sdp=q(b.sdp);a=b.sdp;var d=a.match(/a=rtpmap:(.*)opus.*\r\n/);null!==d&&(a=a.replace(d[0],d[0]+"a\x3drtcp-fb:"+d[1]+"nack\r\n"));b.sdp=a;b.sdp=b.sdp.replace(/a=ice-options:google-ice\r\n/g,"");c.callback({type:b.type,sdp:b.sdp});n=b},m=function(a){a.sdp=q(a.sdp);c.callback({type:a.type,sdp:a.sdp});(n=a)?d.peerConnection.setLocalDescription(a):L.Logger.error("[tk-sdk]localDesc is not exist!")};d.updateSpec=function(a,b){if(a.maxVideoBW||a.maxAudioBW){a.maxVideoBW&&(L.Logger.debug("Maxvideo Requested:",
a.maxVideoBW,"limit:",c.limitMaxVideoBW),a.maxVideoBW>c.limitMaxVideoBW&&(a.maxVideoBW=c.limitMaxVideoBW),c.maxVideoBW=a.maxVideoBW,L.Logger.debug("Result",c.maxVideoBW));a.maxAudioBW&&(a.maxAudioBW>c.limitMaxAudioBW&&(a.maxAudioBW=c.limitMaxAudioBW),c.maxAudioBW=a.maxAudioBW);if(!n){L.Logger.error("[tk-sdk]localDesc is not exist!");return}n.sdp=q(n.sdp);a.Sdp||a.maxAudioBW?(L.Logger.debug("Updating with SDP renegotiation",c.maxVideoBW,c.maxAudioBW),(void 0).sdp=q((void 0).sdp),TK.isHiFi&&((void 0).sdp=
t((void 0).sdp)),d.peerConnection.setRemoteDescription(void 0,function(){c.remoteDescriptionSet=!0;c.callback({type:"updatestream",sdp:n.sdp})})):(L.Logger.debug("Updating without SDP renegotiation, newVideoBW:",c.maxVideoBW,"newAudioBW:",c.maxAudioBW),c.callback({type:"updatestream",sdp:n.sdp}))}if(a.minVideoBW||void 0!==a.slideShowMode||void 0!==a.muteStream||void 0!==a.qualityLayer)L.Logger.debug("MinVideo Changed to ",a.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",a.slideShowMode),L.Logger.debug("muteStream changed to ",
a.muteStream),c.callback({type:"updatestream",config:a})};d.createOffer=function(b){d.peerConnection.createOffer(p.bind(null,b),a,b)};d.addStream=function(a){d.peerConnection.addStream(a)};d.removeStream=function(a){d.peerConnection.removeStream(a)};c.remoteCandidates=[];c.remoteDescriptionSet=!1;d.processSignalingMessage=function(a){L.Logger.debug("Process Signaling Message",a);if("offer"===a.type)a.sdp=q(a.sdp),TK.isHiFi&&(a.sdp=t(a.sdp)),d.peerConnection.setRemoteDescription(a.sdp,m,function(a){L.Logger.error("Error: ",
a)});else if("answer"===a.type)n?(TK.isHiFi&&(a.sdp=t(a.sdp)),L.Logger.debug("Set remote and local description"),L.Logger.debug("Remote Description",a.sdp),L.Logger.debug("Local Description",n.sdp),a.sdp=q(a.sdp),d.peerConnection.setRemoteDescription(new RTCSessionDescription(a),function(){c.remoteDescriptionSet=!0;for(L.Logger.debug("Candidates to be added: ",c.remoteCandidates.length,c.remoteCandidates);0<c.remoteCandidates.length;)d.peerConnection.addIceCandidate(c.remoteCandidates.shift());for(L.Logger.debug("Local candidates to send:",
c.localCandidates.length);0<c.localCandidates.length;)c.callback({type:"candidate",candidate:c.localCandidates.shift()})})):L.Logger.error("[tk-sdk]localDesc is not exist!");else if("candidate"===a.type)try{var b="object"===typeof a.candidate?a.candidate:L.Utils.toJsonParse(a.candidate);if("end"!==b.candidate){b.candidate=b.candidate.replace(/a=/g,"");b.sdpMLineIndex=parseInt(b.sdpMLineIndex);var k=new RTCIceCandidate(b);c.remoteDescriptionSet?d.peerConnection.addIceCandidate(k):c.remoteCandidates.push(k)}}catch(v){L.Logger.error("Error parsing candidate",
a.candidate)}};return d};window.TK=window.TK||{};TK.sessionId=103;
TK.Connection=function(c,d){var b={};c.sessionId=TK.sessionId+=1;b.browser=TK.getBrowser();if(!0===d)L.Logger.debug("Talk-Client Stack"),b=TK.TkNativeStack(c);else if("mozilla"===b.browser)L.Logger.debug("[tk-sdk]Firefox Stack"),b=TK.FirefoxStack(c);else if("bowser"===b.browser)L.Logger.debug("[tk-sdk]Bowser Stack"),b=TK.BowserStack(c);else if("chrome-stable"===b.browser||"electron"===b.browser)L.Logger.debug("[tk-sdk]Chrome Stable Stack"),b=TK.TkChromeStableStack(c);else throw L.Logger.error("[tk-sdk]No stack available for this browser"),
"WebRTC stack not available";b.updateSpec||(b.updateSpec=function(a,b){L.Logger.error("[tk-sdk]Update Configuration not implemented in this browser");b&&b("unimplemented")});return b};
TK.getBrowser=function(){var c="none";null!==window.navigator.userAgent.match("Firefox")?c="mozilla":null!==window.navigator.userAgent.match("Bowser")?c="bowser":null!==window.navigator.userAgent.match("Chrome")?(c="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(c="electron")):null!==window.navigator.userAgent.match("Safari")?c="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(c="bowser");return c};window.TK=window.TK||{};TK.Stream=function(c,d){return!0===d?TK.NativeStream(c):TK.StreamInner(c)};
TK.StreamInner=function(c){function d(){b();if("function"!==typeof p.onSuccess){if(L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),b(),void 0!==p.onFailure&&L.Utils.isFunction(p.onFailure))p.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",a.extensionId)}else{try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext}catch(h){L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume:Web Audio API(audioContext) not supported");
b();if(void 0!==p.onFailure&&L.Utils.isFunction(p.onFailure))p.onFailure(h,a.extensionId);return}try{if(t&&t.stop&&(t.stop(),t=void 0),TK.audioContext&&a.stream&&TK.DeviceMgr&&TK.DeviceMgr.getsSoundMeterInstance)if((t=TK.DeviceMgr.getsSoundMeterInstance(TK.audioContext,a))&&t.connectToSource)t.connectToSource(a.stream,function(c){if(c){if(L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume connectToSource error:",c),b(),void 0!==p.onFailure&&L.Utils.isFunction(p.onFailure))p.onFailure(c,a.extensionId)}else{if(t.instant&&
t.instant.toFixed){if(c=Math.floor(100*t.instant.toFixed(2)),void 0!==p.onSuccess&&L.Utils.isFunction(p.onSuccess))p.onSuccess(c,a.extensionId)}else if(void 0!==p.onSuccess&&L.Utils.isFunction(p.onSuccess))p.onSuccess(0,a.extensionId);clearInterval(q);q=setInterval(function(){if(void 0!==p.onSuccess&&L.Utils.isFunction(p.onSuccess))if(t.instant&&t.instant.toFixed){var c=Math.floor(100*t.instant.toFixed(2));p.onSuccess(c,a.extensionId)}else p.onSuccess(0,a.extensionId);else if(L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),
b(),void 0!==p.onFailure&&L.Utils.isFunction(p.onFailure))p.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",a.extensionId)},p.interval)}});else{if(void 0!==p.onSuccess&&L.Utils.isFunction(p.onSuccess))p.onSuccess(0,a.extensionId)}else if(void 0!==p.onSuccess&&L.Utils.isFunction(p.onSuccess))p.onSuccess(0,a.extensionId)}catch(h){if(L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume error :",h),void 0!==p.onFailure&&L.Utils.isFunction(p.onFailure))p.onFailure(h,a.extensionId)}}}
function b(){t&&t.stop&&t.stop();clearInterval(q);q=t=void 0}var a=TK.EventDispatcher(c),g=!1,f="destroy",t=void 0,q=void 0,n=void 0;void 0!==c.video&&"number"===typeof c.video&&(c.video=0!==c.video);void 0!==c.audio&&"number"===typeof c.audio&&(c.audio=0!==c.audio);a.classInstanceName="Stream";a.stream=c.stream;a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream);a.url=c.url;a.recording=c.recording;a.room=c.room;a.playing=!1;a.local=!1;a.video=c.video;a.audio=c.audio;a.screen=c.screen;a.scale=c.scale;
a.media=c.media;a.videoSize=c.videoSize;a.videoFrameRate=c.videoFrameRate;a.extensionId=c.extensionId;a.desktopStreamId=c.desktopStreamId;a.path=c.path||"";a.videoMuted=!1;a.audioMuted=!1;a.attributes=c.attributes||{};a.isTkNative=!1;a.checkMyAudioAndVideoEnable=c.checkMyAudioAndVideoEnable;a.sendControlMessage=c.sendControlMessage;a.isInit=!1;var p={isWaiting:!1};if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===c.local||
!0===c.local)a.local=!0;a.getID=function(){return a.local&&!c.streamID?"local":c.streamID};a.id=a.getID();a.publisherId=function(){return c.extensionId.replace(new RegExp(":"+c.attributes.type,"g"),"")};a.getAttributes=function(){return c.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=function(a){if(a&&"object"===typeof a)for(var b in a)c.attributes[b]=a[b]};a.hasAudio=function(){return c.audio};a.changeAudio=function(a){c.audio=a};a.hasVideo=function(){return c.video};
a.changeVideo=function(a){c.video=a};a.hasData=function(){return c.data};a.changeData=function(a){c.data=a};a.hasScreen=function(){return c.screen};a.hasMedia=function(){return c.media};a.changeScreen=function(a){c.screen=a};a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};a.init=function(b,d,f){d=d||{};if(TK.isPlayback)f&&"function"===typeof f&&f({type:"access-denied",stream:a});else if("video"===a.getAttributes().type&&a.local)if(a.isIniting||
a.isInit)f&&"function"===typeof f&&f({type:"access-denied",stream:a});else{d.initDeviceId&&("object"===typeof d.initDeviceId?(d.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.initDeviceId.videoinput),d.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,d.initDeviceId.audioinput),d.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,d.initDeviceId.audiooutput)):L.Logger.warning("[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));
try{a.isIniting=!0;L.Logger.debug("[tk-sdk]Requested access to local media");var h=function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");var c=void 0;b&&void 0!==b.getUserMediaFailureCode&&(c=b.getUserMediaFailureCode);a.stream=b;a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream);r=TK.StreamEvent({type:"access-accepted",stream:a,message:{getUserMediaFailureCode:c}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(r);f&&"function"===typeof f&&f({type:"access-accepted",stream:a,
message:{getUserMediaFailureCode:c}});a.stream.getTracks().forEach(function(b){b.onended=function(){a.stream.getTracks().forEach(function(a){a.onended=null});r=TK.StreamEvent({type:"stream-ended",stream:a,message:b.kind});a.dispatchEvent(r)}})},k=function(b){L.Logger.error("[tk-sdk]Failed to get access to local media. Error name was "+b.name+".");var c=L.Constant.accessDenied.streamFail,d=TK.StreamEvent({type:"access-denied",stream:a,message:{code:c,msg:b}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(d);
f&&"function"===typeof f&&f({type:"access-denied",stream:a,message:{code:c,msg:b}})},g={dispatchEvent:b,isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:TK.isInnerVersions,isStopLocalStream:!0};if(L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)){var m={audio:c.audio?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)}:!1,video:c.video?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)}:
!1};TK.DeviceMgr.getUserMedia(h,k,m,g)}else TK.DeviceMgr.enumerateDevices(function(a){a={audio:c.audio?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)}:!1,video:c.video?{sourceId:L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)}:!1};TK.DeviceMgr.getUserMedia(h,k,a,g)},{isSetlocalStorage:!0})}catch(Q){b=L.Constant.accessDenied.ohterError;d="[tk-sdk]Failed to get access to local media. Error was "+Q+".";L.Logger.error(d);var r=TK.StreamEvent({type:"access-denied",
stream:a,message:{code:b,msg:d}});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(r);f&&"function"===typeof f&&f({type:"access-denied",stream:a,message:{code:b,msg:d}})}}else L.Logger.warning("[tk-sdk]stream init must is localStream and stream type must is video!"),f&&"function"===typeof f&&f({type:"access-denied",stream:a})};a.play=function(b,c){function h(){c=c||{};a.elementID=b;if(void 0!==b){if("living"!==f){L.Logger.warning("[tk-sdk]stream.play:player life state not is living , not play stream!");
return}a.player&&a.stop();a.local&&(c.mirror=L.Utils.isBoolean(c.mirror)?c.mirror:g);a.player=new TK.VideoPlayer({id:a.extensionId,stream:a,elementID:b,options:c,bundleId:a.extensionId});a.playing=!0;TK.isOnlyAudioRoom&&a.player.hideVideo();p.isWaiting&&!q&&d()}a&&a.getAttributes&&a.getAttributes()&&"video"===a.getAttributes().type&&a.extensionId&&a.checkMyAudioAndVideoEnable&&"function"===typeof a.checkMyAudioAndVideoEnable&&a.checkMyAudioAndVideoEnable(a.extensionId)}f="living";!a.local||"video"!==
a.getAttributes().type||a.isInit||TK.isPlayback?h():(L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(a));h()}))};a.stop=function(){f="destroy";a.playing&&(void 0!==a.player&&a.player.destroy(),a.player=void 0,a.playing=!1)};a.updateVideoPlayerOptions=function(b){a.player&&a.player.updateVideoPlayerOptions&&a.player.updateVideoPlayerOptions(b)};
a.show=function(){void 0!==a.player&&a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};a.setMute=function(b){void 0!==a.player&&a.player.setMute&&a.player.setMute(b)};a.setVolume=function(b){void 0!==a.player&&a.player.setVolume&&("number"!==typeof b?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):a.player.setVolume(b))};a.getVolume=function(b){if(void 0!==a.player&&a.player.getVolume)return a.player.getVolume(b)};a.changeMediaStreamUrl=function(c){a.player&&
L.Utils.isFunction(a.player.changeMediaStreamUrl)&&a.player.changeMediaStreamUrl(c);p.isWaiting&&(b(),d())};a.startIntervalGetRealtimeVolume=function(b,c,f){"function"!==typeof b?(L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG")):(a.stopIntervalGetRealtimeVolume(),p.isWaiting=!0,p.onSuccess=b,p.onFailure=f,p.interval="number"===typeof c?c:100,d())};a.stopIntervalGetRealtimeVolume=function(){b();p={isWaiting:!1}};
a.hideLoading=function(){void 0!==a.player&&a.player.hideLoading&&a.player.hideLoading()};a.showLoading=function(){void 0!==a.player&&a.player.showLoading&&a.player.showLoading()};var m=function(){if(void 0!==a.player&&void 0!==a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),10),f=parseInt(c.getPropertyValue("height"),10),g=parseInt(c.getPropertyValue("left"),10);c=parseInt(c.getPropertyValue("top"),10);var m="object"===typeof a.elementID&&
"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var r=document.defaultView.getComputedStyle(m);m=parseInt(r.getPropertyValue("width"),10);r=parseInt(r.getPropertyValue("height"),10);var p=document.createElement("canvas");p.id="testing";p.width=m;p.height=r;p.setAttribute("style","display: none");p.getContext("2d").drawImage(b,g,c,d,f);return p}return null};a.getVideoFrameURL=function(a){var b=m();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=
function(){var a=m();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),
b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(void 0!==a.pc&&a.pc.updateSpec){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,d){b={qualityLayer:{spatialLayer:b,temporalLayer:c}};a.checkOptions(b,!0);a.pc.updateSpec(b,d)};
var r=function(b,c,d){!0!==c&&(c=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];L.Utils.isFunction(a.sendControlMessage)&&0<b.length&&a.sendControlMessage(a,"control",{name:"controlhandlers",enable:d,publisherSide:c,handlers:b})};a.disableHandlers=function(a,b){r(a,b,!1)};a.enableHandlers=function(a,b){r(a,b,!0)};a.updateConfiguration=function(b,c){void 0!==b&&(a.pc?(a.checkOptions(b,!0),a.pc.updateSpec(b,c)):c("This stream has no peerConnection attached, ignoring"))};a.muteVideo=function(b,
c){L.Logger.debug("[tk-sdk]call muteVideo , video muted state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.videoMuted=b;void 0!==a.peerConnectionStream&&a.peerConnectionStream&&a.peerConnectionStream.getTracks&&a.peerConnectionStream.getTracks().forEach(function(a){"video"===a.kind&&(a.enabled=!b)});a.updateMuteToServer(c)};a.muteAudio=function(b,c){L.Logger.debug("[tk-sdk]call muteAudio , audio muted state:"+b+" , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.audioMuted=b;void 0!==a.peerConnectionStream&&a.peerConnectionStream&&a.peerConnectionStream.getTracks&&a.peerConnectionStream.getTracks().forEach(function(a){"audio"===a.kind&&(a.enabled=!b)});a.updateMuteToServer(c)};a.setLocalVideoMirror=function(b){a.local&&(g=b,a.updateVideoPlayerOptions({mirror:b}))};a.getRealtimeVolume=function(b,c){if(L.Utils.isFunction(b))try{n&&n.stop&&(n.stop(),n=void 0),
window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,TK.audioContext=TK.audioContext||new window.AudioContext,TK.audioContext&&a.stream&&TK.DeviceMgr&&TK.DeviceMgr.getsSoundMeterInstance?(n=TK.DeviceMgr.getsSoundMeterInstance(TK.audioContext,a))&&n.connectToSource?n.connectToSource(a.stream,function(a){a?(L.Logger.error("[tk-sdk]getRealtimeVolume connectToSource error:",a),L.Utils.isFunction(c)&&c(a)):(n&&n.instant&&n.instant.toFixed?(a=
Math.floor(100*n.instant.toFixed(2)),b(a)):b(0),n&&n.stop&&(n.stop(),n=void 0))}):b(0):b(0)}catch(v){L.Logger.error("[tk-sdk]getRealtimeVolume:Web Audio API(audioContext) not supported",v),L.Utils.isFunction(c)&&c(v)}else L.Logger.error("[tk-sdk] getRealtimeVolume: onVolume is not function"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")};return a};window.TK=window.TK||{};
TK.NativeStream=function(c){function d(){b();if("function"!==typeof n.onSuccess){if(L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),b(),void 0!==n.onFailure&&L.Utils.isFunction(n.onFailure))n.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",a.extensionId)}else n.onSuccess(q,a.extensionId),clearInterval(t),t=setInterval(function(){if(L.Utils.isFunction(n.onSuccess))n.onSuccess(q,a.extensionId);else if(L.Logger.error("[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"),b(),
L.Utils.isFunction(n.onFailure))n.onFailure("startIntervalGetRealtimeVolume intervalCallback must is function",a.extensionId)},n.interval)}function b(){clearInterval(t);t=void 0;q=0}var a=TK.EventDispatcher(c),g=!1,f="destroy",t=void 0,q=0;void 0!==c.video&&"number"===typeof c.video&&(c.video=0!==c.video);void 0!==c.audio&&"number"===typeof c.audio&&(c.audio=0!==c.audio);a.classInstanceName="Stream";a.stream=c.stream;a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream);a.url=c.url;a.recording=c.recording;
a.room=c.room;a.playing=!1;a.local=!1;a.video=c.video;a.audio=c.audio;a.screen=c.screen;a.scale=c.scale;a.media=c.media;a.videoSize=c.videoSize;a.videoFrameRate=c.videoFrameRate;a.extensionId=c.extensionId;a.desktopStreamId=c.desktopStreamId;a.path=c.path||"";a.videoMuted=!1;a.audioMuted=!1;a.attributes=c.attributes||{};a.isTkNative=!0;a.checkMyAudioAndVideoEnable=c.checkMyAudioAndVideoEnable;a.pushVideoMuted=!0;a.pushAudioMuted=!0;a.isInit=!1;a.sendControlMessage=c.sendControlMessage;var n={isWaiting:!1};
if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===c.local||!0===c.local)a.local=!0;var p=function(){return a.media?1:a.screen?2:0};a.getID=function(){return a.local&&!c.streamID?"local":c.streamID};a.id=a.getID();a.publisherId=function(){return c.extensionId.replace(new RegExp(":"+c.attributes.type,"g"),"")};a.getAttributes=function(){return c.attributes};a.setAttributes=function(b){a.updateLocalAttributes(b)};a.updateLocalAttributes=
function(a){if(a&&"object"===typeof a)for(var b in a)c.attributes[b]=a[b]};a.hasAudio=function(){return c.audio};a.changeAudio=function(a){c.audio=a};a.hasVideo=function(){return c.video};a.changeVideo=function(a){c.video=a};a.hasData=function(){return c.data};a.changeData=function(a){c.data=a};a.hasScreen=function(){return c.screen};a.hasMedia=function(){return c.media};a.changeScreen=function(a){c.screen=a};a.sendData=function(){L.Logger.error("[tk-sdk]Failed to send data. This Stream object has not that channel enabled.")};
a.init=function(b,d,f){d=d||{};if(TK.isPlayback)f&&"function"===typeof f&&f({type:"access-denied",stream:a});else if("video"===a.getAttributes().type&&a.local)if(a.isIniting||a.isInit)f&&"function"===typeof f&&f({type:"access-denied",stream:a});else{d.initDeviceId&&("object"===typeof d.initDeviceId?(d.initDeviceId.videoinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,d.initDeviceId.videoinput),d.initDeviceId.audioinput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,
d.initDeviceId.audioinput),d.initDeviceId.audiooutput&&L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,d.initDeviceId.audiooutput)):L.Logger.warning("[tk-sdk]stream.init options.initDeviceId must is json , key is (videoinput | audioinput | audiooutput )!"));try{if(c.audio||c.video){a.isIniting=!0;L.Logger.debug("[tk-sdk]Requested access to local media");var h=c.video;!0===h||!0===c.screen?(h=!0===h?{}:h,void 0!==a.videoSize&&(h.mandatory=h.mandatory||{},h.mandatory.minWidth=a.videoSize[0],
h.mandatory.minHeight=a.videoSize[1],h.mandatory.maxWidth=a.videoSize[2],h.mandatory.maxHeight=a.videoSize[3]),void 0!==a.videoFrameRate&&(h.optional=h.optional||[],h.optional.push({minFrameRate:a.videoFrameRate[0]}),h.optional.push({maxFrameRate:a.videoFrameRate[1]}))):!0===c.screen&&void 0===h&&(h=!0);var g={video:h,audio:c.audio,fake:c.fake,screen:c.screen,extensionId:a.extensionId,desktopStreamId:a.desktopStreamId},k=function(b){L.Logger.debug("[tk-sdk]User has granted access to local media.");
a.stream=b;a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream);r=TK.StreamEvent({type:"access-accepted",stream:a});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(r);f&&"function"===typeof f&&f({type:"access-accepted",stream:a})},m=function(b){var c=TK.StreamEvent({type:"access-denied",stream:a,message:b});a.isInit=!0;a.isIniting=!1;a.dispatchEvent(c);f&&"function"===typeof f&&f({type:"access-denied",message:b,stream:a})};L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?
TK.DeviceMgr.getUserMedia(k,m,g,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0}):TK.DeviceMgr.enumerateDevices(function(a){TK.DeviceMgr.getUserMedia(k,m,g,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!0,isStopLocalStream:!0})},{isSetlocalStorage:!0})}else{L.Logger.warning("[tk-sdk]The stream has no audio and video needs to be initialized.");var r=TK.StreamEvent({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."});
a.isInit=!0;a.isIniting=!1;a.dispatchEvent(r);f&&"function"===typeof f&&f({type:"access-denied",stream:a,message:"The stream has no audio and video needs to be initialized."})}}catch(Q){r=TK.StreamEvent({type:"access-denied",stream:a,message:Q}),a.isInit=!0,a.isIniting=!1,a.dispatchEvent(r),f&&"function"===typeof f&&f({type:"access-denied",message:Q,stream:a})}}else L.Logger.warning("[tk-sdk]stream init must is localStream and stream type must is video!"),f&&"function"===typeof f&&f({type:"access-denied",
stream:a})};a.create=function(){a.local?window.tknative.postMessage({command:"playStream",connectionId:c.extensionId.toString(),isLocal:!0,type:Number(p()),args:{path:"string"===typeof a.path?a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:c.extensionId.toString(),isLocal:!1,type:Number(p())})};a.destroy=function(){a.local?window.tknative.postMessage({command:"stopStream",connectionId:c.extensionId.toString(),
isLocal:!0,type:Number(p())}):window.tknative.postMessage({command:"stopStream",connectionId:c.extensionId.toString(),isLocal:!1,type:Number(p())})};a.play=function(b,k){function h(){k=k||{};a.elementID=b;if(void 0!==b){if("living"!==f){L.Logger.warning("[tk-sdk]stream.play:player life state not is living , not play stream!");return}a.player&&a.stop();a.local&&(k.mirror=L.Utils.isBoolean(k.mirror)?k.mirror:g);a.player=new TK.NativeVideoPlayer({id:c.extensionId,stream:a,elementID:b,options:k,bundleId:a.extensionId});
a.playing=!0;TK.isOnlyAudioRoom&&a.player.hideVideo();a.local?window.tknative.postMessage({command:"playStream",connectionId:c.extensionId.toString(),isLocal:!0,type:Number(p()),args:{path:"string"===typeof a.path?a.path.toString():"",scale:"boolean"===typeof a.scale?a.scale:a.getAttributes().type===TK.STREAM_FILE}}):window.tknative.postMessage({command:"playStream",connectionId:c.extensionId.toString(),isLocal:!1,type:Number(p())});n.isWaiting&&!t&&d()}a&&a.getAttributes&&a.getAttributes()&&"video"===
a.getAttributes().type&&a.extensionId&&a.checkMyAudioAndVideoEnable&&"function"===typeof a.checkMyAudioAndVideoEnable&&a.checkMyAudioAndVideoEnable(a.extensionId)}f="living";!a.local||"video"!==a.getAttributes().type||a.isInit||TK.isPlayback?h():(L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init start!"),a.init(!0,void 0,function(a){L.Logger.info("[tk-sdk]stream.play:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(a));h()}))};a.stop=
function(){f="destroy";a.playing&&(void 0!==a.player&&a.player.destroy(),a.player=void 0,a.playing=!1,a.local?window.tknative.postMessage({command:"stopStream",connectionId:c.extensionId.toString(),isLocal:!0,type:Number(p())}):window.tknative.postMessage({command:"stopStream",connectionId:c.extensionId.toString(),isLocal:!1,type:Number(p())}))};a.updateVideoPlayerOptions=function(b){a.player&&a.player.updateVideoPlayerOptions&&a.player.updateVideoPlayerOptions(b)};a.show=function(){void 0!==a.player&&
a.player.showVideo()};a.hide=function(){void 0!==a.player&&a.player.hideVideo()};a.setMute=function(b){void 0!==a.player&&a.player.setMute&&a.player.setMute(b)};a.setVolume=function(b){void 0!==a.player&&a.player.setVolume&&("number"!==typeof b?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):a.player.setVolume(b))};a.getVolume=function(b){if(void 0!==a.player&&a.player.getVolume)return a.player.getVolume(b)};a.startIntervalGetRealtimeVolume=function(b,c,f){"function"!==typeof b?
L.Logger.warning("[tk-sdk]startIntervalGetRealtimeVolume intervalCallback must is function!"):(a.stopIntervalGetRealtimeVolume(),n.isWaiting=!0,n.onSuccess=b,n.onFailure=f,n.interval="number"===typeof c?c:100,d())};a.stopIntervalGetRealtimeVolume=function(){b();n={isWaiting:!1}};a.hideLoading=function(){void 0!==a.player&&a.player.hideLoading&&a.player.hideLoading()};a.showLoading=function(){void 0!==a.player&&a.player.showLoading&&a.player.showLoading()};var m=function(){if(void 0!==a.player&&void 0!==
a.stream){var b=a.player.video,c=document.defaultView.getComputedStyle(b),d=parseInt(c.getPropertyValue("width"),10),f=parseInt(c.getPropertyValue("height"),10),g=parseInt(c.getPropertyValue("left"),10);c=parseInt(c.getPropertyValue("top"),10);var m="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var r=document.defaultView.getComputedStyle(m);m=parseInt(r.getPropertyValue("width"),10);r=parseInt(r.getPropertyValue("height"),
10);var p=document.createElement("canvas");p.id="testing";p.width=m;p.height=r;p.setAttribute("style","display: none");p.getContext("2d").drawImage(b,g,c,d,f);return p}return null};a.getVideoFrameURL=function(a){var b=m();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=m();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,c){if(!0===c){if(b.video||b.audio||b.screen)L.Logger.warning("[tk-sdk]Cannot update type of subscription"),
b.video=void 0,b.audio=void 0,b.screen=void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to video when there is no video, won't subscribe to video"),b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("[tk-sdk]Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("[tk-sdk]Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),
b.slideShowMode=!1)};a.updateMuteToServer=function(b){if(void 0!==a.pc&&a.pc.updateSpec){var c={muteStream:{video:a.videoMuted,audio:a.audioMuted}};a.checkOptions(c,!0);a.pc.updateSpec(c,b)}};a._setQualityLayer=function(b,c,d){b={qualityLayer:{spatialLayer:b,temporalLayer:c}};a.checkOptions(b,!0);a.pc.updateSpec(b,d)};a.pushVideo=function(b){a.pushVideoMuted!=b&&(a.pushVideoMuted=b,window.tknative.postMessage({command:"pushVideo",enable:b}))};a.pushAudio=function(b){a.pushAudioMuted!=b&&(a.pushAudioMuted=
b,window.tknative.postMessage({command:"pushAudio",enable:b}))};var r=function(b,c,d){!0!==c&&(c=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];L.Utils.isFunction(a.sendControlMessage)&&0<b.length&&a.sendControlMessage(a,"control",{name:"controlhandlers",enable:d,publisherSide:c,handlers:b})};a.disableHandlers=function(a,b){r(a,b,!1)};a.enableHandlers=function(a,b){r(a,b,!0)};a.updateConfiguration=function(b,c){void 0!==b&&(a.pc?(a.checkOptions(b,!0),a.pc.updateSpec(b,c)):c("This stream has no peerConnection attached, ignoring"))};
a.muteVideo=function(b,c){L.Logger.debug("[tk-sdk]call muteVideo , video muted state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));a.videoMuted=b;a.local&&window.tknative.postMessage({command:"enableVideo",enable:!b});a.updateMuteToServer(c)};a.muteAudio=function(b,c){L.Logger.debug("[tk-sdk]call muteAudio , audio muted state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));
a.audioMuted=b;a.local&&window.tknative.postMessage({command:"enableAudio",enable:!b});void 0===a.stream&&L.Logger.warning("[tk-sdk]not deviceStream to muteAudio");a.updateMuteToServer(c)};a.onRemoteAudioVolume=function(b){q=b;if(a.player&&L.Utils.isFunction(a.player.onRemoteAudioVolume))a.player.onRemoteAudioVolume(b)};a.onMicVolumeReport=function(b){if(a&&a.local&&(q=b,a.player&&L.Utils.isFunction(a.player.onMicVolumeReport)))a.player.onMicVolumeReport(b)};a.setLocalVideoMirror=function(b){a.local&&
(g=b,a.updateVideoPlayerOptions({mirror:b}))};a.getRealtimeVolume=function(a,b){L.Utils.isFunction(a)?a(q):(L.Logger.error("[tk-sdk] getRealtimeVolume: onVolume is not function"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"))};return a};window.TK=window.TK||{};TK.MSG_TO_ALLUSER="__all";TK.MSG_TO_ALLEXCEPTSENDER="__allExceptSender";TK.MSG_TO_ALLEXCEPTAUDITOR="__allExceptAuditor";TK.MSG_TO_NONEUSER="__none";TK.STREAM_VIDEO="video";TK.STREAM_MEDIA="media";TK.STREAM_SCREEN="screen";TK.STREAM_FILE="file";TK.LOG_DEBUG=0;TK.LOG_TRACE=1;TK.LOG_INFO=2;TK.LOG_WARNING=3;TK.LOG_ERROR=4;TK.LOG_NONE=5;TK.REC_TYPE_RECFILE="0";TK.REC_TYPE_VIDEOLIST="1";TK.REC_TYPE_MP3="2";TK.REC_TYPE_MIXVIDEO="3";TK.nativeCallSeq=0;TK.waitNativeToCallbackList={};
TK.SDKTYPE="pc";TK.isInnerVersions=!1;TK.isHiFi=!1;TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;TK.isRetainPublishstateOnOnlyAudioRoom=!1;TK.APPVERSION="customer";window.tknative=void 0;TK.SDKVERSIONS="2.2.0.8";TK.SDKVERSIONSTIME="2018080318";TK.getSdkVersion=function(){return TK.SDKVERSIONS};TK.NativeInfo=function(){try{var c={};return c=talk_window}catch(d){return null}};
TK.CheckNativeInterfaceAvailable=function(){window.tknative=window.tknative||TK.nativeEntry();return!L.Utils.isNull(window.tknative)&&L.Utils.isFunction(window.tknative.postMessage)?!0:!1};
TK.Initialize=function(c,d){try{if(c){if(TK.isTkNative=!0,TK.isTkMacNative=d,window.tknative=window.tknative||TK.nativeEntry(),TK.NativeProxy.initialize(),TK.DeviceMgr=null,TK.DeviceMgr=TK.NativeAVMgr(),window.tknative.postMessage({command:"maximizeNativeClient"}),f=void 0,g=TK.NativeInfo())f=g.clientversion}else{TK.isTkNative=!1;TK.isTkMacNative=!1;var b=document.getElementById("window.tknative");if(b&&b.nodeName&&"embed"===b.nodeName.toLowerCase()){var a=b.parentNode;a&&a.removeChild(b)}var g=TK.NativeInfo(),
f=void 0;g&&g.maxmizeWindow&&"function"===typeof g.maxmizeWindow&&(g.maxmizeWindow(),f=g.clientversion)}TK.clientversion=f;TK.subscribe_from_native=TK.isTkNative&&!TK.isTkMacNative&&2018031E3<=f;L.Logger.info("[tk-sdk]isClient:"+TK.isTkNative+",clientVersion:"+f)}catch(t){L.Logger.error("[tk-sdk]Initialize error:",t)}};
TK.Room=function(c){function d(a){e._web_protocol=a.web_protocol||e._web_protocol;e._web_host=a.web_host||e._web_host;e._web_port=a.web_port||e._web_port;e._doc_protocol=a.doc_protocol||e._doc_protocol;e._doc_host=a.doc_host||e._doc_host;e._doc_port=a.doc_port||e._doc_port;e._socket_protocol=a.socket_protocol||e._socket_protocol;e._socket_host=a.socket_host||e._socket_host;e._socket_port=a.socket_port||e._socket_port;e._backup_doc_protocol=a.backup_doc_protocol||e._backup_doc_protocol;e._backup_doc_host=
a.backup_doc_host||e._backup_doc_host;e._backup_doc_port=a.backup_doc_port||e._backup_doc_port;e._backup_doc_host_list=a.backup_doc_host_list||e._backup_doc_host_list;void 0===e._doc_host&&(e._doc_host=e._web_host);void 0===e._doc_port&&(e._doc_port=e._web_port);void 0===e._backup_doc_host&&(e._backup_doc_host=e._web_host);void 0===e._backup_doc_port&&(e._backup_doc_port=e._web_port);e._docServerAddr||(e._doc_host=e._web_host,e._doc_port=e._web_port);e._hasDocServerAddrBackup?e._backup_doc_host_list.length||
(e._backup_doc_host_list=[e._backup_doc_host]):(e._backup_doc_host=e._web_host,e._backup_doc_port=e._web_port,e._backup_doc_host_list=[e._backup_doc_host]);if(E&&E.changeCommonWhiteBoardConfigration){a=[];for(var b=0,c=e._backup_doc_host_list.length;b<c;b++)a.push({protocol:e._backup_doc_protocol,hostname:e._backup_doc_host_list[b],port:e._backup_doc_port});E.changeCommonWhiteBoardConfigration({webAddress:{protocol:e._web_protocol,hostname:e._web_host,port:e._web_port},docAddress:{protocol:e._doc_protocol,
hostname:e._doc_host,port:e._doc_port},backupDocAddress:{protocol:e._backup_doc_protocol,hostname:e._backup_doc_host,port:e._backup_doc_port},backupDocAddressList:a})}a=TK.RoomEvent({type:"room-serveraddress-update",message:{protocol:e._web_protocol,web_protocol:e._web_protocol,web_host:e._web_host,web_port:e._web_port,doc_protocol:e._doc_protocol,doc_host:e._doc_host,doc_port:e._doc_port,backup_doc_protocol:e._backup_doc_protocol,backup_doc_host:e._backup_doc_host,backup_doc_port:e._backup_doc_port,
backup_doc_host_list:e._backup_doc_host_list}});l.dispatchEvent(a)}function b(a,b,c){function u(a){A(e._web_host,e._web_port,function(b,c){L.Logger.debug("[tk-sdk]reconnected room:step2GetFileList result \x3d "+b+" , message:"+L.Utils.toJsonStringify(c));if(0===b){e._room_filelist=[];if(c&&Array.isArray(c)&&c.length){b=0;for(var u=c.length;b<u;b++){var d=c[b];d&&e._room_filelist.push({fileid:Number(d.fileid),companyid:d.companyid,filename:d.filename,uploaduserid:d.uploaduserid,uploadusername:d.uploadusername,
downloadpath:d.downloadpath,swfpath:d.swfpath,isContentDocument:void 0!==d.isContentDocument&&null!==d.isContentDocument&&"number"===typeof Number(d.isContentDocument)?Number(d.isContentDocument):0,filetype:d.filetype&&"string"===typeof d.filetype?d.filetype.toLocaleLowerCase():d.filetype,pagenum:Number(d.pagenum),dynamicppt:Number(d.dynamicppt),filecategory:Number(d.filecategory),fileprop:Number(d.fileprop),type:Number(d.type)})}}c=TK.RoomEvent({type:"room-files",message:e._room_filelist});l.dispatchEvent(c)}else L.Logger.info("[tk-sdk]"+
w+":step2GetFileList code is "+b);"function"===typeof a&&a()})}var d=e._room_uri;a=a||{};a.source=a.source||"unknown source";var w=a.source;D(e._web_host,e._web_port,function(a,O){if(0!=a)L.Logger.error("[tk-sdk]"+w+":step2GetConfig failure --\x3e result and responseText:",a,O);else{if(d!==e._room_uri||"forceReconnect room"===w){l.needReconnectSocket=!0;TK.isTkNative&&(e._handlerCallbackJson=!1,window.tknative.postMessage({command:"nativeClear"}));try{l.socket&&l.socket.disconnect&&l.socket.disconnect()}catch(Qa){L.Logger.warning("[tk-sdk]"+
w+":Socket already disconnected , disconnect errorInfo:",Qa)}l.socket=void 0;if("select service reconnect"===w||"forceReconnect room"===w)p(),a=TK.RoomEvent({type:"room-disconnected",message:"select service reconnect , need socket disconnect"}),l.dispatchEvent(a)}"forceReconnect room"===w?u(function(){L.Logger.info("[tk-sdk]"+w+":room socket force reconnect room  ,room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(e._room_uri):e._room_uri)+"! ");U()}):d!==e._room_uri?u(function(){L.Logger.info("[tk-sdk]"+
w+":room socket url  changed  , old room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(d):d)+"  , now room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(e._room_uri):e._room_uri)+"! ");U()}):(L.Logger.info("[tk-sdk]"+w+":room socket url not change  , room socket url:"+(window.__TkSdkBuild__?L.Utils.encrypt(e._room_uri):e._room_uri)+"! "),"reconnected room"===w?u(function(){Q(b,c)}):"select service reconnect"===w&&(L.Logger.warning("[tk-sdk]room uri is not change , no need to perform a reload server"),
e._isConnected&&e._myself&&e._myself.id&&e._users[e._myself.id]&&e._serverName!==e._myself.servername&&l.changeUserProperty(e._myself.id,"__all",{servername:e._serverName})))}},{notSpeedNetwordk:!0})}function a(a,b){a=a||e._serverList;b=b||e._serverName;if("object"===typeof a&&L.Utils.getJsonLength(a)&&void 0!==b)for(var c in a)a[c].isUseServer=b===c?!0:!1}function g(a,b){if(!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)&&b&&a){var c=a.indexOf(".");0<c&&(c=a.substring(0,c),a=a.replace(new RegExp(c),
b))}return a}function f(a,b,c){a=a||e._myself.publishstate;b=b||{hasvideo:e._myself.hasvideo,disablevideo:e._myself.disablevideo};c=c||{hasaudio:e._myself.hasaudio,disableaudio:e._myself.disableaudio};a>TK.PUBLISH_STATE_NONE&&(q(b.hasvideo&&!b.disablevideo&&(a===TK.PUBLISH_STATE_VIDEOONLY||a===TK.PUBLISH_STATE_BOTH)),t(c.hasaudio&&!c.disableaudio&&(a===TK.PUBLISH_STATE_AUDIOONLY||a===TK.PUBLISH_STATE_BOTH)))}function t(a){e._default_stream.muteAudio(!a,function(a){if(void 0!==e._default_stream.getID()||
"local"!==e._default_stream.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=J(a),P("signaling_message",{streamId:e._default_stream.getID(),msg:a})})}function q(a){TK.isOnlyAudioRoom&&(a=!1);e._default_stream.muteVideo(!a,function(a){if(void 0!==e._default_stream.getID()||"local"!==e._default_stream.getID())L.Logger.debug("[tk-sdk]Sending message",a),a=J(a),P("signaling_message",{streamId:e._default_stream.getID(),msg:a})})}function n(a,b,c){"failed"===b&&(void 0===a.reconnectionNumber&&(a.reconnectionNumber=
0),0!==l.state&&a&&3>a.reconnectionNumber?"publish"===c?a.extensionId===e._myself.id?(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),H(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+
" !");e._myself.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3epublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.reconnectionNumber++,T(a,{reconnection:!0})):L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed --\x3emy publishstate is 0 , not need afresh publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},
1E3)},{reconnection:!0})):(H(a),L.Logger.info("[tk-sdk]publish stream stream.extensionId !\x3d privateVariableJson._myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):"subscribe"===c&&(L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eunsubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),fa(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]oniceconnectionstatechange failed: unsubscribe in not success , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");l.remoteStreams[a.getID()]?(a.reconnectionNumber++,L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),e._nativeStatsDelivered[a.extensionId]=void 0,delete e._nativeStatsDelivered[a.extensionId],delete e._createStreams[a.publisherId()+":"+
a.getAttributes().type],a.getAttributes().type===TK.STREAM_VIDEO?ha(a):V(a,!1),L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),ia(a,{reconnection:!0})):L.Logger.info("[tk-sdk]oniceconnectionstatechange failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},
1E3)},{reconnection:!0})):3<=a.reconnectionNumber&&("publish"===c?a.extensionId===e._myself.id&&e._myself.publishstate>TK.PUBLISH_STATE_NONE?l.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):H(a):"subscribe"===c&&fa(a),a.isCompleted||e._myself.udpstate===L.Constant.udpState.notOnceSuccess||l.changeUserProperty(e._myself.id,"__all",{udpstate:L.Constant.udpState.notOnceSuccess}),L.Logger.info("[tk-sdk]stream-reconnection-failed , source is "+c+", isCompleted is "+a.isCompleted+
", reconnectionNumber is "+a.reconnectionNumber+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),ja(a,a.isCompleted?window.TK.ERROR_NOTICE.UDP_CONNECTION_INTERRUPT:window.TK.ERROR_NOTICE.UDP_CONNECTION_FAILED,a.isCompleted?"The UDP link was interrupted and the attempt to reconnect for "+a.reconnectionNumber+" times failed, possibly due to a network exception":"Attempts to reconnect "+a.reconnectionNumber+" times failed, possibly because the UDP did not work",
a.isCompleted?window.TK.ERROR_NOTICE.UDP_CONNECTION_INTERRUPT:window.TK.ERROR_NOTICE.UDP_CONNECTION_FAILED)))}function p(){var a;TK.isOnlyAudioRoom=!1;TK.needOnlyAudioRoom=0;e._myself&&(e._myself.publishstate=TK.PUBLISH_STATE_NONE);for(a in l.remoteStreams)if(l.remoteStreams.hasOwnProperty(a)){var b=l.remoteStreams[a];sa(b);delete l.remoteStreams[a];b&&!b.failed&&(L.Logger.info("[tk-sdk]_resetRoomState--\x3estream-removed(), stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),
e._nativeStatsDelivered[b.extensionId]=void 0,delete e._nativeStatsDelivered[b.extensionId],delete e._createStreams[b.publisherId()+":"+b.getAttributes().type],b.getAttributes().type===TK.STREAM_VIDEO?ha(b):V(b,!1))}l.remoteStreams={};for(a in l.localStreams)if(l.localStreams.hasOwnProperty(a)){b=l.localStreams[a];if(l.p2p)for(var c in b.pc)b.pc[c].close();else b.pc.close();l.localStreams[a]&&(l.localStreams[a].isPublishing=!1,l.localStreams[a].isUnpublishing=!1,l.localStreams[a].peerConnectionStream=
void 0);delete l.localStreams[a]}e._default_stream&&e._default_stream.pc&&e._default_stream.pc.close&&e._default_stream.pc.close();e._users&&r(e._users);e._myself&&(e._myself._videopublished_=!1,e._myself._audiopublished_=!1,e._myself._videoplayed_=!1,e._myself._audioplayed_=!1);e._userId_to_elementId_map={};e._createStreams={};L.Utils.isNull(e._playAVStreams[e._myself.id])?L.Utils.isNull(e._playAVStreams[e._myself.id])?e._playAVStreams={}:(b=e._playAVStreams[e._local_def_ext_id],e._playAVStreams=
{},e._playAVStreams[e._local_def_ext_id]=b):(b=e._playAVStreams[e._myself.id],e._playAVStreams={},e._playAVStreams[e._myself.id]=b);e._default_stream&&(e._default_stream.isPublishing=!1,e._default_stream.isUnpublishing=!1);e._isConnected=!1;E&&E.changeCommonWhiteBoardConfigration&&E.changeCommonWhiteBoardConfigration({isConnectedRoom:e._isConnected})}function m(a){L.Logger.debug("[tk-sdk]setStatus to: "+a);C!=a&&(C=a,6==C?(e._users[e._myself.id]=e._myself,e._myself.publishstate>TK.PUBLISH_STATE_NONE&&
(f(e._myself.publishstate),T(e._default_stream))):8==C?p():0==C&&p())}function r(a){for(var b in a)delete a[b]}function h(a,b,c,e,d,f){var u=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");u.open(a,b,c);u.setRequestHeader("Content-Type",f?f:"application/x-www-form-urlencoded;charset\x3dutf-8");u.send(e);u.onreadystatechange=d;return u}function k(a,b,c,d){a=Number(a);b=Number(b);c=Number(c);d=Number(d);void 0!==c&&void 0!==d&&"number"===typeof Number(c)&&"number"===
typeof Number(d)?(c=Number(c),d=Number(d),e._room_video_width=c,e._room_video_height=d,e._room_max_video_width=c,e._room_max_video_height=d):(a+=1,e._room_video_width=ma[a][0],e._room_video_height=ma[a][1],e._room_max_video_width=ma[a][0],e._room_max_video_height=ma[a][1]);e._room_video_fps=10>b?10:30<b?30:b;e._room_max_video_fps=10>b?10:30<b?30:b;e._room_video_maxbps=v(e._room_video_width,e._room_video_fps);Y.setAVMgrProperty({room_video_width:e._room_video_width,room_video_height:e._room_video_height,
room_video_fps:e._room_video_fps});L.Logger.info("[tk-sdk]video config[privateVariableJson._room_video_width * privateVariableJson._room_video_height  , privateVariableJson._room_video_fps , privateVariableJson._room_video_maxbps]:"+e._room_video_width+"*"+e._room_video_height+", "+e._room_video_fps+", "+e._room_video_maxbps)}function v(a,b){return 80>=a?20>b?64:96:176>=a?20>b?128:192:320>=a?20>b?256:384:640>=a?20>b?384:512:1280>=a?15>b?1024:15<=b&&20>=b?1280:1536:15>b?1280:15<=b&&20>=b?1536:2048}
function y(a,b,c,f,h,g,k,m){e._serverName=a;e._ipFalsification=Z(g);e._isIpFalsification=!!g;a=b;c=Number(c);b={};if(k&&"object"===typeof k)for(var u in k)b[u]=k[u];/https/g.test(e._socket_protocol)||(c+=1);e._testIP&&e._testPort&&(a=e._testIP,c=e._testPort);b.socket_host=a;b.socket_port=c;f&&(b.web_host=f);h&&Array.isArray(h)&&h.length?(e._hasDocServerAddrBackup=!0,b.backup_doc_host=h[0],b.backup_doc_host_list=h):e._hasDocServerAddrBackup=!1;d(b);e._room_uri=e._socket_protocol+"://"+e._socket_host+
":"+e._socket_port;L.Logger.debug("[tk-sdk]privateVariableJson._room_uri \x3d "+e._room_uri);L.Utils.isFunction(m)&&m()}function D(a,b,c,d){d=d||{};m(2);if(void 0==e._room_id)c(3,null);else{e._backupCourseAddrList=[];L.Logger.debug("[tk-sdk]Going to getConfig");b=e._web_protocol+"://"+a+":"+b+"/ClientAPI/getconfig?ts\x3d"+(new Date).getTime();var u=h("POST",b,!0,"serial\x3d"+e._room_id+"\x26userrole\x3d"+e._myself.role+"\x26selfip\x3d"+e._myIp,function(){if(4==u.readyState)if(200==u.status){var b=
L.Utils.toJsonParse(u.responseText);L.Logger.debug("[tk-sdk]getConfig resp \x3d ",L.Utils.toJsonStringify(b));e._configuration=b;var w=a,f="8889",O={};if(e._testIP&&e._testPort)w=e._testIP,f=e._testPort;else{if(void 0!==b.courseserver){var h=b.courseserver;null!==h&&void 0!==h&&0<h.length&&(w=h)}void 0!==b.courseserverport&&(f=Number(b.courseserverport))}b.ClassDocServerAddr&&(e._docServerAddr=b.ClassDocServerAddr,O.doc_host=b.ClassDocServerAddr);if(b.newcourseaddr&&Array.isArray(b.newcourseaddr)&&
b.newcourseaddr.length)if(e._backupCourseAddrList=e._backupCourseAddrList.concat(b.newcourseaddr),1<b.newcourseaddr.length)if(d&&d.notSpeedNetwordk)h=b.newcourseaddr[0],e._backupCourseAddrList.splice(0,1),y(h.name,h.signaladdr,h.signalport,h.webaddr,h.docaddr,h.change,O,function(){c(b?0:3,u.responseText)});else{var g={},k=!1;h=function(a){var d=b.newcourseaddr[a],h=d.webaddr;g[h+"_"+a]=Sa(d.webaddr,e._web_port,function(m){g[h+"_"+a]=void 0;delete g[h+"_"+a];if(0!==m||k){if(g[h+"_"+a]=void 0,delete g[h+
"_"+a],!k){m=0;for(var r in g)m++;m||(r=[],b.ClassDocServerAddrBackup&&r.push(b.ClassDocServerAddrBackup),F(w,e._webInterfaceHtmlPort,void 0,!1),y(e._serverName,w,f,void 0,r,e._isIpFalsification&&e._ipFalsification?e._ipFalsification:"",O,function(){c(b?0:3,u.responseText)}))}}else k=!0,e._backupCourseAddrList.splice(a,1),y(d.name,d.signaladdr,d.signalport,d.webaddr,d.docaddr,d.change,O,function(){c(b?0:3,u.responseText)})})};for(var m=0,r=b.newcourseaddr.length;m<r;m++)h(m)}else h=b.newcourseaddr[0],
y(h.name,h.signaladdr,h.signalport,h.webaddr,h.docaddr,h.change,O,function(){c(b?0:3,u.responseText)});else h=[],b.ClassDocServerAddrBackup&&h.push(b.ClassDocServerAddrBackup),F(w,e._webInterfaceHtmlPort,void 0,!1),y(e._serverName,w,f,void 0,h,e._isIpFalsification&&e._ipFalsification?e._ipFalsification:"",O,function(){c(b?0:3,u.responseText)})}else L.Logger.error("[tk-sdk]getConfig fail[readyState-status]:",u.readyState,u.status),c(3,u.responseText)})}}function A(a,b,c){if(void 0===e._room_id)c(3,
void 0);else if(e._isGetFileList){L.Logger.debug("[tk-sdk]Going to getFileList");a=e._web_protocol+"://"+a+":"+b+"/ClientAPI/getroomfile?ts\x3d"+(new Date).getTime();var u=h("POST",a,!0,"serial\x3d"+e._room_id,function(){if(4==u.readyState)if(200==u.status){var a=L.Utils.toJsonParse(u.responseText);L.Logger.debug("[tk-sdk]getFileList resp \x3d ",L.Utils.toJsonStringify(a));var b=a.result,e;0==b&&void 0!==a.roomfile?e=a.roomfile:L.Logger.info("[tk-sdk]getFileList resp.roomfile is not exist , nRet:"+
b);c(b,e)}else L.Logger.error("[tk-sdk]getFileList fail[readyState-status]:",u.readyState,u.status),c(3,void 0)})}else c(-1,void 0)}function F(a,b,c,d){d=L.Utils.isBoolean(d)?d:!0;b=e._web_protocol+"://"+a+":"+b+"/where.html?ts\x3d"+(new Date).getTime();/(192.168.|127.0.0.1|127.17.|localhost)/g.test(a)?e._isIpFalsification=!1:e._isIpFalsification=!0;$.ajax({url:b,type:"get",async:d}).done(function(a){L.Logger.info("[tk-sdk]getFalsificationIp resp :",window.__TkSdkBuild__?L.Utils.encrypt("object"===
typeof a?L.Utils.toJsonStringify(a):a):"object"===typeof a?L.Utils.toJsonStringify(a):a);"string"===typeof a&&(a=L.Utils.toJsonParse(a));a&&"object"===typeof a?(a.name&&"string"===typeof a.name&&(e._ipFalsificationName=Z(a.name),e._serverName=e._ipFalsificationName),a.selfip&&"string"===typeof a.selfip&&(e._myIp=Z(a.selfip)),a.ip&&"string"===typeof a.ip&&(e._ipFalsification=Z(a.ip)),a.nochange&&(e._isIpFalsification=!1,L.Logger.info("[tk-sdk]no strings change SDP  , ipFalsificationName is "+e._ipFalsificationName)),
L.Utils.isFunction(c)&&c(0,a)):(L.Logger.error("[tk-sdk]getFalsificationIp resp not is json"),L.Utils.isFunction(c)&&c(-1,"getFalsificationIp resp not is json"))}).fail(function(a){L.Logger.error("[tk-sdk]getFalsificationIp fail:",a);L.Utils.isFunction(c)&&c(-1,a)})}function U(){L.Logger.debug("[tk-sdk]step3Connect");3<=C||(m(3),L.Logger.info("[tk-sdk]socket connect address:"+(window.__TkSdkBuild__?L.Utils.encrypt(e._room_uri):e._room_uri)),e._isConnected=!1,E&&E.changeCommonWhiteBoardConfigration&&
E.changeCommonWhiteBoardConfigration({isConnectedRoom:e._isConnected}),ta(x._handler_connectSocketSuccess,x._handler_connectSocketFail))}function Q(a,b){if(!(5<=C))if(void 0==e._myself.id||void 0==e._room_id)L.Logger.error("[tk-sdk]Invalid status",e._myself,e._room_id);else{m(5);e._myself&&(e._serverName&&(e._myself.servername=e._serverName),e._myself.udpstate=L.Constant.udpState.ok);var c={},u;for(u in e._myself)"id"!=u&&"watchStatus"!=u&&(c[u]=e._myself[u]);c={userId:e._myself.id,roomId:e._room_id,
maxVideo:e._room_max_videocount,videofps:e._room_video_fps,videowidth:e._room_video_width,videoheight:e._room_video_height,properties:c,roomtype:e._room_properties.roomtype,version:3,vcodec:"number"===typeof e._video_codec?e._video_codec:0};if(e._isPlayback){if(!e._recordfilepath){L.Logger.error("[tk-sdk]The playback file address does not exist!");return}c.recordfilepath=e._recordfilepath}L.Logger.info("joinRoom params info:"+(window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(c)):L.Utils.toJsonStringify(c)));
M("joinRoom",c,a,b)}}function S(a,b,c){L.Logger.debug("[tk-sdk]Going to webInterfaceGetserver");a=e._web_protocol+"://"+a+":"+b+"/ClientAPI/getserverarea?ts\x3d"+(new Date).getTime();$.ajax({url:a,type:"post",async:!0}).done(function(a){L.Logger.info("[tk-sdk]webInterfaceGetserver resp \x3d ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(a)):L.Utils.toJsonStringify(a));a=L.Utils.toJsonParse(a);var b=a.result;e._serverList={};if(0==b&&void 0!==a.serverarealist)for(var u in a.serverarealist){var d=
a.serverarealist[u];e._serverList[d.serverareaname]=d}else L.Logger.info("[tk-sdk]webInterfaceGetserver resp.serverarealist is not exist , nRet:"+b);c(b,L.Utils.toJsonStringify(a))}).fail(function(a){L.Logger.error("[tk-sdk]webInterfaceGetserver fail[readyState-status]:",a);c(3,void 0)})}function R(a,b,c){var u=void 0,d=!1,w=e._web_protocol+"://"+e._web_host+":"+e._web_port+"/ClientAPI/uploaddocument?ts\x3d"+(new Date).getTime();if(a)return a&&"object"===typeof a&&"function"===typeof a.get?u=a.get("fieltype"):
a&&"object"===typeof a&&void 0!==a.fieltype&&(u=a.fieltype),a&&"object"===typeof a&&"function"===typeof a.get?d=1===Number(a.get("writedb")):a&&"object"===typeof a&&void 0!==a.writedb&&(d=1===Number(a.writedb)),$.ajax({url:w,dataType:"json",type:"POST",data:a,async:!0,processData:!1,contentType:!1,xhr:function(){var a=$.ajaxSettings.xhr();if(a.upload)return c&&"function"===typeof c&&(L.Utils.removeEvent(a.upload,"progress",X.bind(l,c),!1),L.Utils.addEvent(a.upload,"progress",X.bind(l,c),!1)),a}}).done(function(a){L.Logger.debug("[tk-sdk]uploadFile resp \x3d ",
L.Utils.toJsonStringify(a));var c=a.result;if(0===c&&d){var e=L.Utils.toJsonParse(L.Utils.toJsonStringify(a));delete e.result;e.filetype=e.filetype||u;B(e,!1)}b&&"function"===typeof b&&b(c,a)}).fail(function(a,c,u){L.Logger.error("[tk-sdk]uploadFile fail[ jqXHR , textStatus , errorThrown ]:",a,c,u);b&&"function"===typeof b&&b(3,void 0)});L.Logger.error("[tk-sdk]uploadFile formData is required!")}function B(a,b){if(a&&"object"===typeof a){var c=Number(a.fileprop),u=a.filetype&&"string"===typeof a.filetype?
a.filetype.toLocaleLowerCase():a.filetype,e=1===c||2===c;c=3===c;var d=!e&&!c,w=/(mp3|mp4|webm)/g.test(u);a={name:"DocumentChange",id:"DocumentChange",toID:b?"__all":"__allExceptSender",data:L.Utils.toJsonStringify({isDel:b,isGeneralFile:d,isMedia:w,isDynamicPPT:e,isH5Document:c,action:"",mediaType:w?u:"",filedata:{fileid:Number(a.fileid),currpage:1,pagenum:Number(a.pagenum),filetype:u,filename:a.filename,isContentDocument:void 0!==a.isContentDocument&&null!==a.isContentDocument&&"number"===typeof Number(a.isContentDocument)?
Number(a.isContentDocument):0,swfpath:e||c?a.downloadpath:a.swfpath,pptslide:1,pptstep:0,steptotal:0,filecategory:void 0!==a.filecategory?Number(a.filecategory):0}}),save:!1};l.pubMsg(a)}}function K(a,b){var c=e._web_protocol+"://"+e._web_host+":"+e._web_port+"/ClientAPI/delroomfile?ts\x3d"+(new Date).getTime();void 0===a||null===a?L.Logger.error("[tk-sdk]deleteFile fileid is required!"):$.ajax({url:c,dataType:"json",type:"POST",anync:!1,data:{serial:e._room_properties.serial,fileid:a}}).done(function(c){L.Logger.debug("[tk-sdk]deleteFile resp \x3d ",
L.Utils.toJsonStringify(c));var u=c.result,d;a:{for(d=0;d<e._room_filelist.length;d++)if(e._room_filelist[d].fileid==a){d={file:e._room_filelist[d],index:d};break a}d=void 0}0===u&&d&&d.file&&"object"===typeof d.file&&(d=L.Utils.toJsonParse(L.Utils.toJsonStringify(d.file)),B(d,!0));b&&"function"===typeof b&&b(u,c)}).fail(function(a,c,u){L.Logger.error("[tk-sdk]deleteFile fail[ jqXHR , textStatus , errorThrown ]:",a,c,u);b(3,void 0)})}function I(){TK.DeviceMgr.getUserMedia(function(a){if(e._default_stream.stream){for(var b in a)/^customdata_/g.test(b)&&
(e._default_stream.stream[b]=a[b]);var c=e._default_stream.stream.getTracks();for(b=0;b<c.length;b++){var u=c[b];u.stop();e._default_stream.stream.removeTrack(u)}a=a.getTracks();for(b=0;b<a.length;b++)u=a[b],e._default_stream.stream.addTrack(u)}else e._default_stream.stream=a;e._default_stream.mediaStreamClone=L.Utils.cloneMediaStream(e._default_stream.stream);e._default_stream&&L.Utils.isFunction(e._default_stream.changeMediaStreamUrl)&&e._default_stream.changeMediaStreamUrl(e._default_stream.stream);
var d=void 0!==e._myself.publishstate&&null!==e._myself.publishstate?e._myself.publishstate:TK.PUBLISH_STATE_NONE;d>TK.PUBLISH_STATE_NONE&&H(e._default_stream,function(a,b){t(!0);q(!0);e._myself._audiopublished_=!1;e._myself._videopublished_=!1;void 0!==a&&(f(e._myself.publishstate),d>TK.PUBLISH_STATE_NONE&&T(e._default_stream))})},void 0,void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1})}function ca(a){clearTimeout(l._deviceChangeCallbackTimer);l._deviceChangeCallbackTimer=
setTimeout(function(){if(e._isConnected&&e._myself&&void 0!==e._myself.id&&e._users[e._myself.id]&&!e._isPlayback){var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);TK.DeviceMgr.enumerateDevices(function(c){c=c.hasdevice;var u={},d=!1,w=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);e._myself.hasvideo!==c.videoinput&&(u.hasvideo=
c.videoinput,d=!0);e._myself.hasaudio!==c.audioinput&&(u.hasaudio=c.audioinput,d=!0);d?(L.Logger.info("[tk-sdk]change device:my old device info  [hasvideo , hasaudio] is ["+e._myself.hasvideo+" ,"+e._myself.hasaudio+"] , change device property is "+L.Utils.toJsonStringify(u)),0===l.changeUserProperty(e._myself.id,"__all",u)&&(void 0!==u.hasvideo&&e._myself.hasvideo!==u.hasvideo&&(e._myself.hasvideo=u.hasvideo),void 0!==u.hasaudio&&e._myself.hasaudio!==u.hasaudio&&(e._myself.hasaudio=u.hasaudio)),
e._default_stream&&(e._default_stream.hasVideo()!==e._myself.hasvideo&&e._default_stream.changeVideo(e._myself.hasvideo),e._default_stream.hasAudio()!==e._myself.hasaudio&&e._default_stream.changeAudio(e._myself.hasaudio)),I()):a===w&&b===f||I()},{isSetlocalStorage:!0})}var c=document.getElementsByTagName("audio"),u=document.getElementsByTagName("video"),d=[];if(c&&0<c.length)for(var f=0;f<c.length;f++)d.push(c[f]);if(u&&0<u.length)for(f=0;f<u.length;f++)d.push(u[f]);0<d.length&&TK.DeviceMgr.setElementSinkIdToAudioouputDevice(d);
l.dispatchEvent({type:"device_change"})},250)}function J(a){if(!e._isIpFalsification||!e._ipFalsification)return a;if("offer"===a.type||"candidate"===a.type){var b=L.Utils.toJsonStringify(a),c=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;c.test(b)&&(a=L.Utils.toJsonParse(b.replace(c,"254.254.254.254")))}return a}function W(a,b){var c=!1,u=!1;u=a.getID()!==e._default_stream.getID();var d=0,f=0,w=0,h=0,g=d=0,k=0,m=0,r=0,l=0,p=0,v=0,t=0,q=0,n=0,D=0,A=0,
y=0,ca=0,F=0,U=0,Q=0,S=0,I=0,K=g=0,B=0,R=0,J=B=0,x=0,z=0,E=0,C=0,W=0,G=0,H=0,M=0,N=K=0,P=0,Z=0,X=0,T=function(a){"ssrc"===a.type&&"video"===a.mediaType?/send/g.test(a.id)?(n=Number(a.bytesSent),D=Number(a.packetsSent),l=Number(a.googRtt),A=Number(a.packetsLost),p=Number(a.googFrameWidthSent),v=Number(a.googFrameHeightSent),q=Number(a.googFrameRateSent),t=a.timestamp,u=!1):/recv/g.test(a.id)&&(y=Number(a.bytesReceived),S=Number(a.packetsReceived),ca=Number(a.googCurrentDelayMs),I=Number(a.packetsLost),
F=Number(a.googFrameWidthReceived),U=Number(a.googFrameHeightReceived),Q=Number(a.googFrameRateReceived),t=a.timestamp,u=!0):"ssrc"===a.type&&"audio"===a.mediaType&&(/send/g.test(a.id)?(C=Number(a.bytesSent),W=Number(a.packetsSent),E=Number(a.googRtt),G=Number(a.packetsLost),M=Number(a.googJitterReceived),H=a.timestamp,u=!1):/recv/g.test(a.id)&&(N=Number(a.bytesReceived),P=Number(a.packetsReceived),Z=Number(a.googCurrentDelayMs),X=Number(a.packetsLost),M=Number(a.googJitterReceived),H=a.timestamp,
u=!0))};if(b&&"object"===typeof b&&b.forEach)b.forEach(function(a,b){T(a)});else for(var V in b)T(b[V]);a.report||(a.report={},c=!0);a.report.timestamp=a.report.timestamp||t;a.report.audioTimestamp=a.report.audioTimestamp||H;u?(a.report.bytesReceived=a.report.bytesReceived||y,a.report.packetsReceived=a.report.packetsReceived||S,a.report.packetsLostReceived=a.report.packetsLostReceived||I,a.report.audioBytesReceived=a.report.audioBytesReceived||N,a.report.audioPacketsReceived=a.report.audioPacketsReceived||
P,a.report.audioPacketsLostReceived=a.report.audioPacketsLostReceived||X):(a.report.bytesSent=a.report.bytesSent||n,a.report.packetsSent=a.report.packetsSent||D,a.report.packetsLostSend=a.report.packetsLostSend||A,a.report.audioBytesSent=a.report.audioBytesSent||C,a.report.audioPacketsSent=a.report.audioPacketsSent||W,a.report.audioPacketsLostSend=a.report.audioPacketsLostSend||G);if(!c)return u?(g=8*(y-a.report.bytesReceived),f=isNaN(p)?0:F,w=isNaN(v)?0:U,h=Q,d=ca,r=isNaN(d)?0:d,d=(I-a.report.packetsLostReceived)/
(S-a.report.packetsReceived)*100,m=S,k=I,K=8*(N-a.report.audioBytesReceived),B=Z,z=isNaN(B)?0:B,x=M,J=(X-a.report.audioPacketsLostReceived)/(P-a.report.audioPacketsReceived)*100,R=P,B=X):(g=8*(n-a.report.bytesSent),f=isNaN(p)?0:p,w=isNaN(v)?0:v,h=q,d=l,r=isNaN(d)?0:Math.round(d/2),d=(A-a.report.packetsLostSend)/(D-a.report.packetsSent)*100,m=D,k=A,K=8*(C-a.report.audioBytesSent),B=E,z=isNaN(B)?0:Math.round(B/2),x=M,J=(G-a.report.audioPacketsLostSend)/(W-a.report.audioPacketsSent)*100,R=W,B=G),g=g/
((t-a.report.timestamp)/1E3)/1024,K=K/((H-a.report.audioTimestamp)/1E3)/1024,u?(a.report.bytesReceived=y,a.report.packetsReceived=S,a.report.packetsLostReceived=I,a.report.audioBytesReceived=N,a.report.audioPacketsReceived=P,a.report.audioPacketsLostReceived=X):(a.report.bytesSent=n,a.report.packetsSent=D,a.report.packetsLostSend=A,a.report.audioBytesSent=C,a.report.audioPacketsSent=W,a.report.audioPacketsLostSend=G),a.report.timestamp=t,a.report.audioTimestamp=H,d=isNaN(d)?0:100>=Math.round(d)?Math.round(d):
100,J=isNaN(J)?0:100>=Math.round(J)?Math.round(J):100,r=isNaN(r)?0:r,z=isNaN(z)?0:z,{video:{bitsPerSecond:isNaN(g)?0:Math.round(g),packetsLost:isNaN(k)?0:k,totalPackets:isNaN(m)?0:m,packetsLostRate:d,currentDelay:r,frameRate:isNaN(h)?0:Math.round(h),frameWidth:f,frameHeight:w,timestamp:t,netquality:na(d,r)},audio:{bitsPerSecond:isNaN(K)?0:Math.round(K),packetsLost:isNaN(B)?0:B,totalPackets:isNaN(R)?0:R,packetsLostRate:J,currentDelay:z,jitter:isNaN(x)?0:x,timestamp:H,netquality:na(J,z)}}}function X(a,
b){var c=Math.floor(100*b.loaded/b.total);a&&"function"===typeof a&&a(b,c)}function Z(a){return a.replace(/(^\s*)|(\s*$)/g,"")}function Ha(a,b,c){var u={},d=a.result;if(0===d){e._isPlayback&&(a.nickname="playback",a.roomrole=-1,a.thirdid=ua()+":playback");var f=a.room;var w=a.pullinfo;f.roomtype=Number(f.roomtype);f.maxvideo=parseInt(f.maxvideo);a.roomrole=Number(a.roomrole);var h={},g={};if(w&&w.data&&w.data.pullConfigureList){var O=w.data.pullConfigureList,m;for(m in O){var r=O[m];h[r.pullProtocol]=
r.pullUrlList}}if(w&&w.data&&w.data.pushConfigureInfo)for(m in w=w.data.pushConfigureInfo,w)O=w[m],g[O.pushProtocol]=O.pushUrl;f.pullConfigure=h;f.pushConfigure=g;e._room_properties=f;e._room_name=f.roomname;e._room_type=f.roomtype;e._room_max_videocount=f.maxvideo;e._video_codec=void 0!==f.vcodec&&null!==f.vcodec&&"number"===typeof Number(f.vcodec)?Number(f.vcodec):e._video_codec;u.properties={};u.properties.role=a.roomrole;u.properties.nickname=a.nickname;h=a.thirdid;u.id=void 0!==h&&null!==h&&
"0"!=h&&""!=h?h:c?c:ua();"string"!==typeof u.id&&(u.id=""+u.id);h=void 0;L.Utils.isNull(e._myself.id)||!L.Utils.isNull(c)&&""!==c||(h=e._myself.id);e._myself=TK.RoomUser(u);L.Utils.isNull(h)||(e._myself.id=h);L.Utils.isNull(e._default_stream)||(e._default_stream.extensionId=e._myself.id);L.Utils.isNull(e._playAVStreams[e._local_def_ext_id])||(c=e._playAVStreams[e._local_def_ext_id],delete e._playAVStreams[e._local_def_ext_id],e._playAVStreams[e._myself.id]=c);e._isPlayback?(e._myself.hasvideo=!1,
e._myself.hasaudio=!1):(L.Logger.info("[tk-sdk]call enumerateDevices to checkroom set myself.hasvideo and  myself.hasaudio start!"),Y.enumerateDevices(function(a){L.Logger.info("[tk-sdk]call enumerateDevices to checkroom set myself.hasvideo and  myself.hasaudio finshed!");a=a.hasdevice;e._myself.hasvideo=a.videoinput;e._myself.hasaudio=a.audioinput}));e._isPlayback?(e._room_id=f.serial+"_"+e._myself.id,e._room_id&&-1===e._room_id.indexOf(":playback")&&(e._room_id+=":playback")):e._room_id=f.serial;
e._isPlayback||k(f.videotype,f.videoframerate,f.videowidth,f.videoheight);e._roomCheckRoomInfoString=a?"string"===typeof a?a:L.Utils.toJsonStringify(a):"";TK.isTkNative&&!e._handlerCallbackJson&&(e._handlerCallbackJson=!0,window.tknative.postMessage({command:"initNative",localId:e._myself.id.toString(),width:Number(e._room_video_width),height:Number(e._room_video_height),fps:Number(e._room_video_fps),roomInfo:e._roomCheckRoomInfoString,webAddr:e._web_host.toString(),webPort:e._web_port.toString()}));
f=e._room_properties.chairmancontrol;e._mediaFileScale=!e._isPlayback&&f&&"string"===typeof f?1!==Number(f.substr(95,1)):!0;L.Logger.info("[tk-sdk]"+(e._isPlayback?"initPlaybackInfo to checkroom finshed--\x3e":"")+"privateVariableJson._room_max_videocount:"+e._room_max_videocount,"my id:"+e._myself.id,"room id:"+e._room_id,"room properties chairmancontrol is:"+(e._room_properties.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(e._room_properties.chairmancontrol):e._room_properties.chairmancontrol:
void 0))}else L.Logger.warning("[tk-sdk]checkroom failure code is "+d);L.Logger.info("[tk-sdk]checkroom finshed!");b(d,u,a)}function oa(a){if(a.extensionId&&a.extensionId!==e._myself.id&&e._users[a.extensionId]&&"video"===a.getAttributes().type&&a.stream){var b=e._users[a.extensionId];if(b.publishstate!==TK.PUBLISH_STATE_NONE)switch(b.publishstate){case TK.PUBLISH_STATE_VIDEOONLY:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!0);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!1);break;case TK.PUBLISH_STATE_AUDIOONLY:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,
!1);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!0);break;case TK.PUBLISH_STATE_BOTH:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!0);TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!0);break;case TK.PUBLISH_STATE_MUTEALL:TK.DeviceMgr.enabledStreamVideoTrack(a.stream,!1),TK.DeviceMgr.enabledStreamAudioTrack(a.stream,!1)}}}function ua(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function sa(a){void 0!==a.stream&&
(a.hide(),a.pc&&(a.pc.close(),delete a.pc),a.local&&a.stream.stop(),delete a.stream)}function ta(a,d){var u=function(a,b){a.pc=TK.Connection({callback:function(c){c=J(c);P("signaling_message",{streamId:a.getID(),peerSocket:b,msg:c})},iceServers:l.iceServers,maxAudioBW:z.maxAudioBW,maxVideoBW:"screen"===a.getAttributes().type?z.maxScreenBW:"file"===a.getAttributes().type?z.maxLocalFileMediaBW:z.maxVideoBW,limitMaxAudioBW:z.maxAudioBW,limitMaxVideoBW:"screen"===a.getAttributes().type?z.maxScreenBW:
"file"===a.getAttributes().type?z.maxLocalFileMediaBW:z.maxVideoBW,cnnId:a.extensionId,local:a.local},a.isTkNative);a.pc.onaddstream=function(b){l.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,a.getAttributes().type===TK.STREAM_VIDEO&&a.publisherId()===e._myself.id?a.mediaStreamClone=L.Utils.cloneMediaStream(e._default_stream.stream):a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream),a.extensionId!==e._myself.id&&"video"===a.getAttributes().type&&oa(a),
L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream), stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.getAttributes().type===TK.STREAM_VIDEO?(b=!1,e._users[a.publisherId()]&&e._users[a.publisherId()].publishstate===TK.PUBLISH_STATE_MUTEALL&&(b=!0),da(a,void 0,b)):V(a,!0)):L.Logger.info("[tk-sdk]createRemotePc(stream.pc.onaddstream):remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))}};l.state=1;l.socket=io.connect(e._room_uri,{secure:!0,reconnection:!0,transports:["websocket"]});var w=0,h=!1;l.socket.on("connect_error",function(a){L.Logger.error("[tk-sdk]connect_error info:",a);w++;if(!h&&e._backupCourseAddrList.length&&5<=w){var b=e._backupCourseAddrList[0];e._backupCourseAddrList.splice(0,1);L.Logger.warning("[tk-sdk]Not Connected,change address reconnection, address info:"+
L.Utils.toJsonStringify(b)+" ,error info: "+a);y(b.name,b.signaladdr,b.signalport,b.webaddr,b.docaddr,b.change,void 0,function(){try{l.socket&&l.socket.disconnect&&l.socket.disconnect()}catch(Pa){L.Logger.warning("[tk-sdk]Socket already disconnected , disconnect errorInfo:",Pa)}l.socket=void 0;l.needReconnectSocket=!0;ta(x._handler_connectSocketSuccess,x._handler_connectSocketFail)})}});l.socket.on("connect",function(){L.Logger.debug("[tk-sdk]tk connectd");h=!0;w=0;l.state=2;m(4);if(0===e._connectedNumber||
l.needReconnectSocket)l.socket.on("onAddStream",function(a){var b=!1,c=!1;"media"===a.attributes.type?b=!0:a.attributes.type&&(b=a.extensionId.replace(new RegExp(":"+a.attributes.type,"g"),"")===e._myself.id?!1:!0);TK.subscribe_from_native&&b&&(c=!0);c=TK.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes,extensionId:a.extensionId,room:l,checkMyAudioAndVideoEnable:function(a){e._myself&&e._myself.id&&(a=a||e._myself.id,a===e._myself.id&&
(TK.isTkNative&&(t(!0),q(!0)),e._myself.publishstate>TK.PUBLISH_STATE_NONE&&f()))},sendControlMessage:function(a,b,c){va(a,b,c)}},c);for(var u in l.remoteStreams)l.remoteStreams[u]&&l.remoteStreams[u].extensionId===c.extensionId&&delete l.remoteStreams[u];l.remoteStreams[a.id]=c;c.extensionId===e._myself.id&&(l.publishedDefaultStream=c);b&&ia(c);"video"===c.getAttributes().type&&e._myself.id===c.extensionId&&(f(e._myself.publishstate),e._isPlayback||Ia());L.Logger.info("[tk-sdk]stream-added , stream id:"+
c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()));c.publisherId()===e._myself.id&&("video"===c.getAttributes().type?(a=!1,e._users[c.publisherId()]&&e._users[c.publisherId()].publishstate===TK.PUBLISH_STATE_MUTEALL&&(a=!0),da(e._default_stream,void 0,a),e._myself.publishstate===TK.PUBLISH_STATE_NONE&&e._default_stream&&!e._default_stream.isUnpublishing&&l.localStreams[e._default_stream.getID()]&&H(e._default_stream)):"media"!==c.getAttributes().type&&
V(c,!0))}),l.socket.on("signaling_message_mediaserver",function(a){L.Logger.debug("[tk-sdk]signaling_message_mediaserver",a);var b=a.mess;if(e._isIpFalsification&&e._ipFalsification&&"answer"===b.type){var u=L.Utils.toJsonStringify(b),d=e._ipFalsification,f=/(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))/g;f.test(u)&&(b=L.Utils.toJsonParse(u.replace(f,d)))}a.mess=b;a.peerId?(b=l.remoteStreams[a.peerId],!c.autoSubscribeAV&&a&&a.mess&&"started"===a.mess.type&&
(b.video&&b.muteVideo(!0),b.audio&&b.muteAudio(!0))):b=l.localStreams[a.streamId];a&&a.mess&&"ready"===a.mess.type&&(b.isCompleted=!0,b.reconnectionNumber=0,e._myself.udpstate!==L.Constant.udpState.ok&&l.changeUserProperty(e._myself.id,"__all",{udpstate:L.Constant.udpState.ok}),TK.isTkNative&&TK.subscribe_from_native&&b&&b.hideLoading&&b.hideLoading());b&&!b.failed&&(b.pc&&b.pc.processSignalingMessage?b.pc.processSignalingMessage(a.mess,b):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),
l.socket.on("signaling_message_peer",function(a){var b=l.localStreams[a.streamId];L.Logger.debug("signaling_message_peer",a);b&&!b.failed?b.pc[a.peerSocket].processSignalingMessage(a.msg):(b=l.remoteStreams[a.streamId],b.pc||u(b,a.peerSocket),b.pc&&b.pc.processSignalingMessage?b.pc.processSignalingMessage(a.msg):L.Logger.warning("stream.pc is not exist , Can't call processSignalingMessage method!"))}),l.socket.on("publish_me",function(a){var b=l.localStreams[a.streamId];void 0===b.pc&&(b.pc={});b.pc[a.peerSocket]=
TK.Connection({callback:function(b){b=J(b);P("signaling_message",{streamId:a.streamId,peerSocket:a.peerSocket,msg:b})},audio:b.hasAudio(),video:b.hasVideo(),media:b.hasMedia(),iceServers:l.iceServers,cnnId:b.extensionId,local:b.local},TK.isTkNative);b.pc[a.peerSocket].oniceconnectionstatechange=function(c){"failed"===c&&(b.pc[a.peerSocket].close(),delete b.pc[a.peerSocket])};b.pc[a.peerSocket].addStream(b.stream);b.pc[a.peerSocket].createOffer()}),l.socket.on("onUpdateAttributeStream",function(a){var b=
l.remoteStreams[a.id];if(void 0!==b){if(b.updateLocalAttributes(a.attrs),a=a.attrs,b){var c="room-user"+b.getAttributes().type+"attributes-update";if(void 0!==c){var u={};u.userId=b.publisherId();u.type=b.getAttributes().type;u.attributes=b.getAttributes();u.attributes.video=b.hasVideo();u.attributes.audio=b.hasAudio();u.updateAttributes=a;b=TK.RoomEvent({type:c,message:u});l.dispatchEvent(b)}}}else L.Logger.warning("[tk-sdk]onUpdateAttributeStream stream invalid",a)}),l.socket.on("publish_failed",
function(a){L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed server info: "+L.Utils.toJsonStringify(a));var b=l.localStreams[a.streamId];l.localStreams[a.streamId]&&(l.localStreams[a.streamId].peerConnectionStream=void 0);delete l.localStreams[a.streamId];b&&L.Logger.info("[tk-sdk]stream-publish_mediaserver_failed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes()))}),l.socket.on("subscribe_failed",function(a){L.Logger.warning("[tk-sdk]stream-subscribe_mediaserver_failed server info: "+
L.Utils.toJsonStringify(a));var b=l.remoteStreams[a.streamId];b?L.Logger.info("[tk-sdk]stream-subscribe_mediaserver_failed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())):L.Logger.warning("[tk-sdk]stream-publish_mediaserver_failed stream is not exist , server info: "+L.Utils.toJsonStringify(a))}),l.socket.on("onRemoveStream",function(a){var b=l.remoteStreams[a.id];b&&b.failed?L.Logger.debug("[tk-sdk]Received onRemoveStream for a stream that we already marked as failed ",
a.id):b?(l.localStreams[a.id]&&(l.localStreams[a.id].peerConnectionStream=void 0),b&&b.stop&&b.stop(),delete l.remoteStreams[a.id],delete l.localStreams[a.id],sa(b),L.Logger.info("[tk-sdk]stream-removed , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),e._nativeStatsDelivered[b.extensionId]=void 0,delete e._nativeStatsDelivered[b.extensionId],delete e._createStreams[b.publisherId()+":"+b.getAttributes().type],"video"===b.getAttributes().type?
ha(b):V(b,!1),b&&e._roomMode===window.TK.ROOM_MODE.BIG_ROOM&&"video"===b.getAttributes().type&&b.publisherId()!==e._myself.id&&e._users[b.publisherId()]&&e._users[b.publisherId()].role!==window.TK.ROOM_ROLE.TEACHER&&e._users[b.publisherId()].role!==window.TK.ROOM_ROLE.ASSISTANT&&e._users[b.publisherId()].publishstate===TK.PUBLISH_STATE_NONE&&delete e._users[b.publisherId()]):L.Logger.debug("[tk-sdk]Received a removeStream for",a.id,"and it has not been registered here, ignoring.")}),l.socket.on("disconnect",
function(a){l.needReconnectSocket||(L.Logger.debug("[tk-sdk]Socket disconnected, lost connection to TKController",a),0!==l.state&&(m(8),l.state=0,TK.isTkNative&&(e._handlerCallbackJson=!1,window.tknative.postMessage({command:"nativeClear"})),a=TK.RoomEvent({type:"room-disconnected",message:"unexpected-disconnection"}),l.dispatchEvent(a)))}),l.socket.on("reconnecting",function(a){L.Logger.debug("[tk-sdk]reconnecting info:",a);a=TK.RoomEvent({type:"room-reconnecting",message:{number:a,info:"room-reconnecting number:"+
a}});l.dispatchEvent(a)}),l.socket.on("participantLeft",x._handler_participantLeft),l.socket.on("participantJoined",x._handler_participantJoined),l.socket.on("participantPublished",x._handler_participantPublished),l.socket.on("participantEvicted",function(a){a=a||{};L.Logger.info("[tk-sdk]user evicted room  , user info: "+L.Utils.toJsonStringify(e._myself)+" , participantEvicted  messages:"+L.Utils.toJsonStringify(a));l.leaveroom(!0);a=TK.RoomEvent({type:"room-participant_evicted",message:a,user:e._myself});
l.dispatchEvent(a)}),l.socket.on("sendMessage",x._handler_sendMessage),l.socket.on("msgList",function(a){L.Logger.debug("[tk-sdk]msgList info:",L.Utils.toJsonStringify(a));a=TK.RoomEvent({type:"room-msglist",message:a});l.dispatchEvent(a)}),l.socket.on("pubMsg",x._handler_pubMsg),l.socket.on("delMsg",x._handler_delMsg),l.socket.on("setProperty",x._handler_setProperty),l.socket.on("playback_clearAll",x._handler_playback_clearAll),l.socket.on("duration",x._handler_duration),l.socket.on("playbackEnd",
x._handler_playbackEnd),l.socket.on("playback_updatetime",x._handler_playback_updatetime),l.socket.on("forceReconnect",function(){L.Logger.info("[tk-sdk]service notice forceReconnect , call reconnected room! ");b({source:"forceReconnect room"},a,d)}),e._connectedNumber++,L.Logger.info("[tk-sdk]connected room  , current connected number is "+e._connectedNumber+"! "),l.needReconnectSocket||L.Logger.info("[tk-sdk]Reconnect Socket ,  join room start! "),l.needReconnectSocket=!1,Q(a,d);else{L.Logger.info("[tk-sdk]reconnected room! ");
var g=TK.RoomEvent({type:"room-reconnected"});l.dispatchEvent(g);b({source:"reconnected room"},a,d)}})}function M(a,b,c,e){L.Logger.debug("[tk-sdk]sendMessageSocket",a,b);l.socket.emit(a,b,function(a,u){"success"===a?(L.Logger.debug("[tk-sdk]sendMessageSocket success",b,u),L.Utils.isFunction(c)&&c(u)):"error"===a?L.Utils.isFunction(e)&&e(u):L.Utils.isFunction(c)&&c(a,u)})}function P(a,b,c,e){0!==l.state?l.socket.emit(a,b,c,function(a,b){L.Utils.isFunction(e)&&e(a,b)}):L.Logger.warning("[tk-sdk]Trying to send a message over a disconnected Socket")}
function Ta(a){L.Logger.debug("[tk-sdk]onChangeMyPublishState "+e._myself.publishstate+" to "+a);e._myself.publishstate!==a&&(e._myself.publishstate=a);a>TK.PUBLISH_STATE_NONE?(f(a),e._default_stream&&void 0===l.localStreams[e._default_stream.getID()]&&!e._default_stream.isPublishing&&T(e._default_stream,void 0,function(){e._myself.publishstate===TK.PUBLISH_STATE_NONE&&e._default_stream&&!e._default_stream.isUnpublishing&&l.localStreams[e._default_stream.getID()]&&H(e._default_stream)})):e._default_stream&&
!e._default_stream.isUnpublishing&&l.localStreams[e._default_stream.getID()]&&H(e._default_stream,function(){e._myself.publishstate>TK.PUBLISH_STATE_NONE&&e._default_stream&&void 0===l.localStreams[e._default_stream.getID()]&&!e._default_stream.isPublishing&&T(e._default_stream)});e._myself.publishstate=a}function aa(a){var b=!1;a&&a.getAttributes&&a.getAttributes()&&a.extensionId&&("media"===a.getAttributes().type?b=!1:a.getAttributes().type&&(b=new RegExp(":"+a.getAttributes().type,"g"),a=a.extensionId.replace(b,
""),b=a===e._myself.id||a===e._local_def_ext_id));return b}function N(a,b){var c=void 0;if("media"===b)for(var u in l.remoteStreams){var d=l.remoteStreams[u];if(d.extensionId===a+":"+b){c=d;break}}else if(b)if(a===e._myself.id||a===e._local_def_ext_id)c="video"===b?e._default_stream:e._createStreams[a+":"+b];else for(u in l.remoteStreams)if(d=l.remoteStreams[u],"video"===b){if(d.extensionId===a){c=d;break}}else if(d.extensionId===a+":"+b){c=d;break}return c}function Ja(a,b){var c=void 0;if(!b&&e._myself.id&&
(new RegExp(e._myself.id,"g")).test(a))c=a===e._myself.id?e._default_stream:e._createStreams[a];else for(var d in l.remoteStreams)if((b=l.remoteStreams[d])&&b.extensionId===a){c=a===e._myself.id?e._default_stream:b;break}return c}function ea(a,b,c){c=c||{};b.playInfo=b.playInfo||{video:!1,audio:!1};void 0!==c.video&&(TK.isOnlyAudioRoom&&(c.video=!1),b.playInfo.video=c.video);void 0!==c.audio&&(b.playInfo.audio=c.audio);b&&b.player?a!==b.player.elementID?(b.stop(),b.play(a,c),e._playAVStreams[b.extensionId]=
b):"object"===typeof c&&b.updateVideoPlayerOptions(c):(b.play(a,c),e._playAVStreams[b.extensionId]=b);b.video&&(b.playInfo.video?(b.updateVideoPlayerOptions(c),b.show()):b.hide());"video"!==b.getAttributes().type&&b.audio&&(b.playInfo.audio?b.setMute(!1):b.setMute(!0));aa(b)||(b.video&&b.muteVideo(!b.playInfo.video),b.audio&&b.muteAudio(!b.playInfo.audio))}function wa(a,b){b=b||{};a.playInfo=a.playInfo||{video:!1,audio:!1};void 0!==b.video&&a.playInfo.video&&b.video&&(a.playInfo.video=!b.video,a.video&&
(a.playInfo.video?a.show():a.hide()),aa(a)||a.video&&a.muteVideo(!a.playInfo.video));void 0!==b.audio&&a.playInfo.audio&&b.audio&&(a.playInfo.audio=!b.audio,"video"!==a.getAttributes().type&&a.audio&&(a.playInfo.audio?a.setMute(!1):a.setMute(!0)),aa(a)||a.audio&&a.muteAudio(!a.playInfo.audio));a&&a.stop&&!a.playInfo.video&&!a.playInfo.audio&&(a.stop(),delete e._playAVStreams[a.extensionId])}function ba(a,b){var c={checkMyAudioAndVideoEnable:function(a){e._myself&&e._myself.id&&(a=a||e._myself.id,
a===e._myself.id&&(TK.isTkNative&&(t(!0),q(!0)),e._myself.publishstate>TK.PUBLISH_STATE_NONE&&f()))},sendControlMessage:function(a,b,c){va(a,b,c)}};b=b||{};var d={type:a};if(b.attributes&&"object"===typeof b.attributes)for(var u in b.attributes)"type"!==u&&(d[u]=b.attributes[u]);c.audio=b.audio||!1;c.video=b.video||!1;c.data=!1;c.attributes=d;switch(a){case "video":c.screen=!1;c.media=!1;c.extensionId=L.Utils.isNull(e._myself.id)?e._local_def_ext_id:e._myself.id;break;case "screen":c.screen=!0;c.media=
!1;c.extensionId=e._myself.id+":"+a;break;case "file":c.screen=!1,c.media=!0,c.path=b.path,c.scale=L.Utils.isBoolean(b.scale)?b.scale:e._mediaFileScale,c.extensionId=e._myself.id+":"+a}b=TK.Stream(c,TK.isTkNative);return e._createStreams[e._myself.id+":"+a]=b}function xa(a,b){if(TK.isOnlyAudioRoom!==a){TK.isOnlyAudioRoom=a;if(TK.isOnlyAudioRoom)for(var c in l.remoteStreams)(a=l.remoteStreams[c])&&a.video&&("file"===a.getAttributes().type&&a.publisherId()===e._myself.id?TK.isTkNative&&G.stopShareMediaFile():
"screen"===a.getAttributes().type&&a.publisherId()===e._myself.id?TK.isTkNative&&G.stopShareScreen():"media"===a.getAttributes().type&&a.publisherId()===e._myself.id&&l.stopShareMedia());e._default_stream&&(e._myself.publishstate>TK.PUBLISH_STATE_NONE&&e._myself.publishstate>TK.PUBLISH_STATE_NONE&&(TK.isOnlyAudioRoom?e._myself.publishstate!==TK.PUBLISH_STATE_AUDIOONLY&&l.changeUserProperty(e._myself.id,"__all",{publishstate:TK.PUBLISH_STATE_AUDIOONLY}):e._myself.publishstate!==TK.PUBLISH_STATE_BOTH&&
l.changeUserProperty(e._myself.id,"__all",{publishstate:TK.PUBLISH_STATE_BOTH})),TK.isOnlyAudioRoom?(e._default_stream.hide(),e._default_stream.playInfo=e._default_stream.playInfo||{video:!1,audio:!1},e._default_stream.playInfo.video=!1):(e._default_stream.show(),e._default_stream.playInfo=e._default_stream.playInfo||{video:!1,audio:!1},e._default_stream.playInfo.video=!0));b=TK.RoomEvent({type:"room-audiovideostate-switched",message:{fromId:b,onlyAudio:TK.isOnlyAudioRoom}});l.dispatchEvent(b)}}function Ka(a){"string"===
typeof a&&(a=L.Utils.toJsonParse(a));a&&a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));var b=a.fromID,c=a.data,d=function(a){for(var b=0;b<e._room_filelist.length;b++)if(e._room_filelist[b].fileid==a)return{file:e._room_filelist[b],index:b}}(c.filedata.fileid);if(c.isDel)d&&d.file&&(e._room_filelist.splice(d.index,1),a=TK.RoomEvent({type:"room-delete-file",message:{fileid:d.file.fileid,fileinfo:d.file,fromID:b}}),l.dispatchEvent(a));else{var u=function(a){var u=c.filedata;
a={fileid:Number(u.fileid),companyid:e._room_properties.companyid,filename:u.filename,uploaduserid:b,uploadusername:a?a.nickname:"",downloadpath:u.swfpath,isContentDocument:void 0!==u.isContentDocument&&null!==u.isContentDocument&&"number"===typeof Number(u.isContentDocument)?Number(u.isContentDocument):0,swfpath:u.swfpath,filetype:u.filetype&&"string"===typeof u.filetype?u.filetype.toLocaleLowerCase():u.filetype,pagenum:Number(u.pagenum),dynamicppt:c.isDynamicPPT?1:0,filecategory:Number(u.filecategory),
fileprop:c.isDynamicPPT?2:c.isH5Document?3:0,type:0};if(d){u={};var f=!1;for(h in a)d.file[h]!==a[h]&&(d.file[h]=a[h],u[h]=a[h],f=!0);if(f){var h=TK.RoomEvent({type:"room-update-file",message:{fileid:a.fileid,updateFileinfo:u,fromID:b}});l.dispatchEvent(h)}}else e._room_filelist.push(a),h=TK.RoomEvent({type:"room-add-file",message:{fileid:a.fileid,fromID:b}}),l.dispatchEvent(h)};l.getRoomUser(b,function(a){u(a)},function(){u()})}}function da(a,b,c){if("video"===a.getAttributes().type){a.publisherId()===
e._myself.id&&(a=e._default_stream);void 0===b&&(b=!1);var d=e._users[a.publisherId()];if(d){void 0===d._audiopublished_&&(d._audiopublished_=!1);void 0===d._videopublished_&&(d._videopublished_=!1);var u=d.publishstate,f=u===TK.PUBLISH_STATE_AUDIOONLY||u===TK.PUBLISH_STATE_BOTH;u=u===TK.PUBLISH_STATE_VIDEOONLY||u===TK.PUBLISH_STATE_BOTH;a.audio&&(d._audiopublished_!==f||b&&d._audiopublished_||c)&&(f={userId:a.publisherId(),published:b?!1:f,type:a.getAttributes().type,publishstate:d.publishstate},
d._audiopublished_=f.published,f=TK.RoomEvent({type:"room-useraudiostate-changed",message:f}),l.dispatchEvent(f));a.video&&(d._videopublished_!==u||b&&d._videopublished_||c)&&(f={userId:a.publisherId(),published:b?!1:u,type:a.getAttributes().type,publishstate:d.publishstate},d._videopublished_=f.published,a=TK.RoomEvent({type:"room-uservideostate-changed",message:f}),l.dispatchEvent(a))}}}function ha(a){if("video"===a.getAttributes().type){a.publisherId()===e._myself.id&&(a=e._default_stream);var b=
e._users[a.publisherId()];if(b){b._audiopublished_=!1;b._videopublished_=!1;if(a.audio){var c={userId:a.publisherId(),published:!1,type:a.getAttributes().type,publishstate:b.publishstate};c=TK.RoomEvent({type:"room-useraudiostate-changed",message:c});l.dispatchEvent(c)}a.video&&(c={userId:a.publisherId(),published:!1,type:a.getAttributes().type,publishstate:b.publishstate},a=TK.RoomEvent({type:"room-uservideostate-changed",message:c}),l.dispatchEvent(a))}}}function V(a,b){if(a&&void 0!==b){var c=
{},d="room-user"+a.getAttributes().type+"state-changed";void 0!==d&&(c.userId=a.publisherId(),c.published=b,c.type=a.getAttributes().type,c.attributes=a.getAttributes(),c.attributes.video=a.hasVideo(),c.attributes.audio=a.hasAudio(),a=TK.RoomEvent({type:d,message:c}),l.dispatchEvent(a))}}function La(a){e._wait_to_play&&(ea(e._wait_to_play_param.elementId,e._default_stream,e._wait_to_play_param.options),e._wait_to_play=!1,e._wait_to_play_param={});e._wait_to_publish&&(e._wait_to_publish=!1,e._myself.publishstate>
TK.PUBLISH_STATE_NONE?ya(e._default_stream):e._default_stream.isPublishing=!1);L.Utils.isNull(a)||L.Utils.isNull(a.type)||"access-denied"===a.type&&L.Utils.isNull(a.message)||(L.Utils.isNull(a.stream)||delete a.stream,a=TK.RoomEvent(a),l.dispatchEvent(a))}function Ua(){var a=e._web_protocol+"://"+e._web_host+":"+e._web_port+"/ClientAPI/equipment?ts\x3d"+(new Date).getTime(),b,c="",d=!0,f="PC",g=L.Utils.getBrowserInfo();f=TK.isTkNative?TK.isTkMacNative?"MacClient":"WindowClient":"Mac"===L.Utils.detectOS()?
"MacPC":"WindowPC";var k={companyid:e._room_properties.companyid,serial:e._room_properties.serial,peerId:e._myself.id,peerName:e._myself.nickname,peerRole:e._myself.role,devicetype:f,systemversion:TK.isTkNative&&TK.clientversion?TK.clientversion:g.info.browserName+" "+g.info.browserVersion,version:TK.APPVERSION,sdkVersion:TK.SDKVERSIONS,appType:"webpageApp",deviceName:TK.isTkNative?f:g.info.browserName,OSVersion:L.Utils.detectOS(),CpuArchitecture:"x86",ip:e._myIp};(function(){for(var e in k)d?d=!1:
c+="\x26",c=c+e+"\x3d"+k[e];b=h("POST",a,!0,c,function(){4===b.readyState&&(200===b.status?L.Logger.debug("[tk-sdk]equipment resp : "+b.responseText):L.Logger.error("[tk-sdk]equipment fail[readyState-status]:",b.readyState,b.status))})})()}function Ia(){function a(){c&&f&&0===d&&(c=!1,za(b))}var b=[],c=!1,d=0,f=!1;if(e._isSendAllPublishUserNetworkequipment){for(var h in l.remoteStreams){var g=l.remoteStreams[h];"video"===g.getAttributes().type&&e._users[g.extensionId]&&(c=!0,d++,function(c){pa(c,
function(u){d--;if(u&&e._users[c.extensionId]){var f=L.Utils.toJsonParse(L.Utils.toJsonStringify(u.video));u=L.Utils.toJsonParse(L.Utils.toJsonStringify(u.audio));delete f.packetsLostRate;delete u.packetsLostRate;f={video:f,audio:u,cpuOccupancy:0,peerId:e._users[c.extensionId].id,peerName:e._users[c.extensionId].nickname,streamId:c.getID()};b.push(f);a()}c=void 0},function(){d--})}(g))}f=!0;a()}else l.remoteStreams[e._default_stream.getID()]&&pa(e._default_stream,function(a){if(a){var c=L.Utils.toJsonParse(L.Utils.toJsonStringify(a.video));
a=L.Utils.toJsonParse(L.Utils.toJsonStringify(a.audio));delete c.packetsLostRate;delete a.packetsLostRate;c={video:c,audio:a,cpuOccupancy:0,peerId:e._myself.id,peerName:e._myself.nickname,streamId:e._default_stream.getID()};b.push(c);za(b)}})}function ya(a,b,c){L.Logger.info("[tk-sdk]calling publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));b=b||{};b.maxVideoBW=b.maxVideoBW||z.defaultVideoBW;b.maxVideoBW>z.maxVideoBW&&(b.maxVideoBW=
z.maxVideoBW);if("screen"===a.getAttributes().type)b.maxVideoBW=z.maxScreenBW;else if("file"===a.getAttributes().type){var d=a.getAttributes().width,u=a.getAttributes().height;if(d&&u){var f=640,h=d,g=u;a.scale||(f=1920<Math.max(d,u)?1920:d);d>=u?d>f&&(h=f,g=u/d*h):u>f&&(g=f,h=d/u*g);h=Math.floor(h);g=Math.floor(g);a.updateLocalAttributes({width:h,height:g,videowidth:h,videoheight:g});b.maxVideoBW=v(h,30);a.scale&&b.maxVideoBW>z.maxLocalFileMediaBW&&(b.maxVideoBW=z.maxLocalFileMediaBW)}else b.maxVideoBW=
z.maxLocalFileMediaBW}void 0===b.minVideoBW&&(b.minVideoBW=0);b.minVideoBW>z.maxVideoBW&&(b.minVideoBW=z.maxVideoBW);b.simulcast=b.simulcast||b._simulcast||!1;a&&void 0===l.localStreams[a.getID()]?(a.failed&&delete a.failed,clearTimeout(a._publishTimer),a._publishTimer=setTimeout(function(){H(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]publish timeout 15s: unpublish in not success , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+
" !");a.getAttributes().type===TK.STREAM_VIDEO&&a.extensionId===e._myself.id?3>a.timeoutRePublishNumber?(void 0===a.timeoutRePublishNumber&&(a.timeoutRePublishNumber=0),e._myself.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]publish timeout 15s--\x3epublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.timeoutRePublishNumber++,T(a,{timeoutPublishReconnection:!0})):L.Logger.warning("[tk-sdk]publish timeout 15s--\x3emy publishstate is 0 , not need afresh publish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):(L.Logger.info("[tk-sdk]publish timeout 15s--\x3erePublish number \x3e 3 , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.extensionId===e._myself.id&&e._myself.publishstate>TK.PUBLISH_STATE_NONE&&l.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}),ka(a,"publish timeout",window.TK_ERR.TIMEOUT_ERROR),
L.Utils.isFunction(c)&&c(void 0,"TK_ERR_PUBLISH_TIMEOUT")):(L.Logger.info("[tk-sdk]publish timeout 15s--\x3e publish stream stream.extensionId !\x3d privateVariableJson._myself.id   , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),ka(a,"publish timeout",window.TK_ERR.TIMEOUT_ERROR))},1E3)})},15E3),L.Logger.debug("[tk-sdk]Publishing to ms Normally, is createOffer",b.createOffer,a.extensionId),P("publish",{state:"ms",data:a.hasData(),
audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),minVideoBW:b.minVideoBW,attributes:a.getAttributes(),extensionId:a.extensionId,createOffer:b.createOffer,metadata:b.metadata,scheme:b.scheme},void 0,function(d,u){a.isPublishing=!1;a.isUnpublishing=!1;clearTimeout(a._publishTimer);0!==d?(L.Logger.error("[tk-sdk]Error when publishing the stream: ",d,u),L.Logger.info("[tk-sdk]stream-publish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),
a.extensionId===e._myself.id?3>a.publishReconnectionNumber?(void 0===a.publishReconnectionNumber&&(a.publishReconnectionNumber=0),H(a,function(b){setTimeout(function(){e._myself.publishstate>TK.PUBLISH_STATE_NONE?(L.Logger.info("[tk-sdk]stream-publish-fail:publish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber++,T(a,{publishReconnection:!0})):L.Logger.warning("[tk-sdk]stream-publish-fail:my publishstate is 0 , not need afresh publish , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{publishReconnection:!0})):(a.extensionId===e._myself.id&&e._myself.publishstate>TK.PUBLISH_STATE_NONE?l.changeUserProperty(a.extensionId,"__all",{publishstate:TK.PUBLISH_STATE_NONE}):H(a),ka(a,u,d),L.Utils.isFunction(c)&&c(void 0,d)):(L.Logger.info("[tk-sdk]stream-publish-fail:publish stream stream.extensionId !\x3d privateVariableJson._myself.id   , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),H(a),ka(a,u,d),L.Utils.isFunction(c)&&c(void 0,d))):(L.Logger.debug("[tk-sdk]Stream assigned an Id, starting the publish process , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.publishReconnectionNumber=0,a.timeoutRePublishNumber=0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.getID=function(){return u},a.id=a.getID(),a.hasData()&&(a.sendData=
function(b){a.local?M("sendDataStream",{id:a.getID(),msg:b}):L.Logger.error("[tk-sdk]You can not send data through a remote stream")}),a.setAttributes=function(b){a&&"object"===typeof b&&(l.remoteStreams[a.getID()]?(a.local&&a.updateLocalAttributes(b),M("updateStreamAttributes",{id:a.getID(),attrs:b})):L.Logger.warning("[tk-sdk]You can not update attributes to server, because the stream does not exist on the server."))},l.localStreams[u]=a,a.room=l,a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message",
b);b=J(b);P("signaling_message",{streamId:a.getID(),msg:b},void 0,function(){})},iceServers:l.iceServers,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW,simulcast:b.simulcast,audio:a.hasAudio(),video:a.hasVideo(),screen:a.hasScreen(),media:a.hasMedia(),cnnId:e._myself.id,local:a.local},TK.isTkNative),a.mediaStreamClone=a.mediaStreamClone||L.Utils.cloneMediaStream(a.stream),a.peerConnectionStream=a.mediaStreamClone,a.pc.addStream(a.peerConnectionStream),
a.pc.oniceconnectionstatechange=function(b){L.Logger.info("[tk-sdk]publish ice state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===b&&0!==l.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Publishing Stream ",a.getID()," has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),n(a,b,"publish"))},b.createOffer||
a.pc.createOffer(),L.Utils.isFunction(c)&&c(!0,u))})):(L.Logger.warning("[tk-sdk]Trying to publish invalid stream , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.isPublishing=!1,L.Utils.isFunction(c)&&c(void 0,"Trying to publish invalid stream"))}function Aa(a,b){var c=b?"audioinput":"videoinput";if(1>a.length){L.Logger.error("[tk-sdk] "+c+" devices are un-available. reason: maybe NotReadable");var d=TK.RoomEvent({type:"device-failure",
message:{kind:c}},{code:TK_ERR.DEVICE_ERROR_UnknownError});l.dispatchEvent(d)}else TK.DeviceMgr.getUserMedia(function(a){a&&a.getTracks&&a.getTracks().forEach(function(a){a.stop()});a=null;L.Logger.info("[tk-sdk] "+c+" devices are available");a=TK.RoomEvent({type:"device-success",message:{kind:c}});l.dispatchEvent(a)},function(d){switch(d.name){case "NotAllowedError":case "PermissionDeniedError":L.Logger.error("[tk-sdk] "+c+" devices are un-available. reason: NotAllowed");d=TK.RoomEvent({type:"device-failure",
message:{kind:c}},{code:window.TK_ERR.DEVICE_ERROR_NotAllowedError});l.dispatchEvent(d);return}a.splice(0,1);Aa(a,b)},{video:b?!1:{sourceId:a[0].deviceId},audio:b?{sourceId:a[0].deviceId}:!1})}function la(a){0!==l.state&&L.Logger.warning("[tk-sdk]Room already connected",l.state);if(void 0===e._web_host||void 0===e._web_port||void 0===e._myself)return L.Logger.warning("[tk-sdk]web_host or web_port or myself is undefined , web_host is "+e._web_host+" , web_port is "+e._web_port+",myself is "+e._myself),
-1;if(!e._room_properties)return L.Logger.warning("[tk-sdk]No checkroom cannot joinroom , room_properties is "+e._room_properties),-1;l.needReconnectSocket=!0;TK.default_stream=e._default_stream;e._myself.publishstate!==TK.PUBLISH_STATE_NONE&&(e._myself.publishstate=TK.PUBLISH_STATE_NONE);e._default_stream.checkMyAudioAndVideoEnable=function(a){e._myself&&e._myself.id&&(a=a||e._myself.id,a===e._myself.id&&(TK.isTkNative&&(t(!0),q(!0)),e._myself.publishstate>TK.PUBLISH_STATE_NONE&&f()))};if(e._userJsonOptions&&
e._userJsonOptions.userProperties&&"object"===typeof e._userJsonOptions.userProperties)for(var b in e._userJsonOptions.userProperties)void 0===e._myself[b]&&(e._myself[b]=e._userJsonOptions.userProperties[b]);e._roomJsonOptions&&e._roomJsonOptions.group&&(Array.isArray(e._roomJsonOptions.group)?e._myself.group=e._roomJsonOptions.group:L.Logger.warning("[tk-sdk]joinroomOptions.group must is a array!"));L.Logger.info("[tk-sdk]joinroom:my device info  [hasvideo , hasaudio] is ["+e._myself.hasvideo+" ,"+
e._myself.hasaudio+"]");L.Logger.debug("[tk-sdk]joinroom:my room user",e._myself);e._users={};a=a||e._web_host;D(a,e._web_port,function(a,b){0!=a?(L.Logger.error("[tk-sdk]step2GetConfig failure --\x3e result and responseText:",a,b),b=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.GETCONFIGERROR,error:a}}),l.dispatchEvent(b),b=TK.RoomEvent({type:"room-connect-fail",message:{source:L.Constant.roomError.GETCONFIGERROR,error:a}}),l.dispatchEvent(b)):A(e._web_host,e._web_port,function(a,
b){L.Logger.debug("[tk-sdk]step2GetFileList result \x3d "+a+" , message:"+L.Utils.toJsonStringify(b));if(0===a){e._room_filelist=[];if(b&&Array.isArray(b)&&b.length){a=0;for(var c=b.length;a<c;a++){var d=b[a];d&&e._room_filelist.push({fileid:Number(d.fileid),companyid:d.companyid,filename:d.filename,uploaduserid:d.uploaduserid,uploadusername:d.uploadusername,downloadpath:d.downloadpath,swfpath:d.swfpath,isContentDocument:void 0!==d.isContentDocument&&null!==d.isContentDocument&&"number"===typeof Number(d.isContentDocument)?
Number(d.isContentDocument):0,filetype:d.filetype&&"string"===typeof d.filetype?d.filetype.toLocaleLowerCase():d.filetype,pagenum:Number(d.pagenum),dynamicppt:Number(d.dynamicppt),filecategory:Number(d.filecategory),fileprop:Number(d.fileprop),type:Number(d.type)})}}b=TK.RoomEvent({type:"room-files",message:e._room_filelist});l.dispatchEvent(b)}else L.Logger.info("[tk-sdk]step2GetFileList code is "+a);L.Utils.isFunction(e._roomJsonOptions.awitConnectRoomCallback)?(e._roomJsonOptions.awitConnectRoomCallback(function(){U()}),
delete e._roomJsonOptions.awitConnectRoomCallback):U()})},{notSpeedNetwordk:!e._roomJsonOptions.autoServer})}function qa(a){var b=void 0;e._isPlayback?(b=ba("video",{video:!1,audio:!1,attributes:{}}),e._default_stream=b,delete e._createStreams[e._myself.id+":video"],la(a)):e._roomJsonOptions&&"object"===typeof e._roomJsonOptions&&void 0!==e._roomJsonOptions.video&&void 0!==e._roomJsonOptions.audio?(L.Utils.isNull(e._default_stream)&&(b=ba("video",{video:e._roomJsonOptions.video,audio:e._roomJsonOptions.audio,
attributes:{}}),e._default_stream=b,delete e._createStreams[e._myself.id+":video"]),void 0===e._myself.hasvideo||void 0===e._myself.hasaudio?(L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio start!"),Y.enumerateDevices(function(b){L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio finshed!");b=b.hasdevice;e._myself.hasvideo=b.videoinput;e._myself.hasaudio=b.audioinput;la(a)})):la(a)):void 0===e._myself.hasvideo||
void 0===e._myself.hasaudio?(L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream start!"),Y.enumerateDevices(function(c){L.Logger.info("[tk-sdk]call enumerateDevices to joinroom set myself.hasvideo and  myself.hasaudio and create my stream finshed!");c=c.hasdevice;e._myself.hasvideo=c.videoinput;e._myself.hasaudio=c.audioinput;L.Utils.isNull(e._default_stream)&&(b=ba("video",{video:e._roomJsonOptions&&"object"===typeof e._roomJsonOptions&&
void 0!==e._roomJsonOptions.video?e._roomJsonOptions.video:e._myself.hasvideo,audio:e._roomJsonOptions&&"object"===typeof e._roomJsonOptions&&void 0!==e._roomJsonOptions.audio?e._roomJsonOptions.audio:e._myself.hasaudio,attributes:{}}),e._default_stream=b,delete e._createStreams[e._myself.id+":video"]);la(a)})):(L.Utils.isNull(e._default_stream)&&(b=ba("video",{video:e._roomJsonOptions&&"object"===typeof e._roomJsonOptions&&void 0!==e._roomJsonOptions.video?e._roomJsonOptions.video:e._myself.hasvideo,
audio:e._roomJsonOptions&&"object"===typeof e._roomJsonOptions&&void 0!==e._roomJsonOptions.audio?e._roomJsonOptions.audio:e._myself.hasaudio,attributes:{}}),e._default_stream=b),la(a))}function Va(a){if(e._default_stream){e._default_stream.hasVideo()!==e._myself.hasvideo&&e._default_stream.changeVideo(e._myself.hasvideo);e._default_stream.hasAudio()!==e._myself.hasaudio&&e._default_stream.changeAudio(e._myself.hasaudio);if(e._default_stream.stream){for(var b in a)/^customdata_/g.test(b)&&(e._default_stream.stream[b]=
a[b]);var c=e._default_stream.stream.getTracks();for(b=0;b<c.length;b++){var d=c[b];d.stop();e._default_stream.stream.removeTrack(d)}a=a.getTracks();for(b=0;b<a.length;b++)d=a[b],e._default_stream.stream.addTrack(d)}else e._default_stream.stream=a;e._default_stream.mediaStreamClone=L.Utils.cloneMediaStream(e._default_stream.stream);e._default_stream&&L.Utils.isFunction(e._default_stream.changeMediaStreamUrl)&&e._default_stream.changeMediaStreamUrl(e._default_stream.stream);if(e._isConnected&&e._myself&&
void 0!=e._myself.id&&e._users[e._myself.id]){var u=e._myself.publishstate;u>TK.PUBLISH_STATE_NONE&&H(e._default_stream,function(a,b){t(!0);q(!0);f(e._myself.publishstate);u>TK.PUBLISH_STATE_NONE&&T(e._default_stream)})}}else L.Logger.warning("[tk-sdk]_getUserMediaCallback local stream is not exist!")}function Ba(a,b,c,d,e,f){a?b?c&&"object"!==typeof c?(L.Logger.error("[tk-sdk]  "+f+" method options is not json!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")):(e=N(a,e))?(c.audio=!0,c.video=!0,ea(b,
e,c)):(L.Logger.debug("[tk-sdk]  "+f+": user has not stream, user id is "+a),L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM")):(L.Logger.error("[tk-sdk]  "+f+" method got invalid elementId!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")):(L.Logger.error("[tk-sdk] "+f+" method got invalid userId!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"))}function Ca(a,b,c,d){a?(c=e._playAVStreams[a+c])?wa(c,{audio:!0,video:!0}):(L.Logger.debug("[tk-sdk] "+d+": user has not stream, user id is "+a),L.Utils.isFunction(b)&&
b("TK_NO_THIS_STREAM")):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] "+d+" method got invalid userId!"))}function Da(){if(e._roomMode===window.TK.ROOM_MODE.BIG_ROOM)for(var a in e._users)a!==e._myself.id&&e._users[a].role!==window.TK.ROOM_ROLE.TEACHER&&e._users[a].role!==window.TK.ROOM_ROLE.ASSISTANT&&e._users[a].publishstate===TK.PUBLISH_STATE_NONE&&delete e._users[a]}function ra(a,b){l.socket.emit("controlmedia",a,b)}function Ea(a,b,c){if(a){var d=void 0;switch(a.getAttributes().type){case TK.STREAM_VIDEO:d=
window.TK.ERROR_NOTICE.SUBSCRIBE_AUDIO_VIDEO_FAILURE;break;case TK.STREAM_MEDIA:d=window.TK.ERROR_NOTICE.SUBSCRIBE_MEDIA_FAILURE;break;case TK.STREAM_FILE:d=window.TK.ERROR_NOTICE.SUBSCRIBE_FILE_FAILURE;break;case TK.STREAM_SCREEN:d=window.TK.ERROR_NOTICE.SUBSCRIBE_SCREEN_FAILURE}ja(a,d,b,c)}}function ka(a,b,c){if(a){var d=void 0;switch(a.getAttributes().type){case TK.STREAM_VIDEO:d=window.TK.ERROR_NOTICE.PUBLISH_AUDIO_VIDEO_FAILURE;break;case TK.STREAM_MEDIA:d=window.TK.ERROR_NOTICE.SHARE_MEDIA_FAILURE;
break;case TK.STREAM_FILE:d=window.TK.ERROR_NOTICE.SHARE_FILE_FAILURE;break;case TK.STREAM_SCREEN:d=window.TK.ERROR_NOTICE.SHARE_SCREEN_FAILURE}ja(a,d,b,c)}}function Fa(a,b,c){if(a){var d=void 0;switch(a.getAttributes().type){case TK.STREAM_VIDEO:d=window.TK.ERROR_NOTICE.UNPUBLISH_AUDIO_VIDEO_FAILURE;break;case TK.STREAM_MEDIA:d=window.TK.ERROR_NOTICE.STOP_MEDIA_FAILURE;break;case TK.STREAM_FILE:d=window.TK.ERROR_NOTICE.STOP_FILE_FAILURE;break;case TK.STREAM_SCREEN:d=window.TK.ERROR_NOTICE.STOP_SCREEN_FAILURE}ja(a,
d,b,c)}}function ja(a,b,c,d){if(a&&void 0!==b){var e={userId:a.publisherId(),type:a.getAttributes().type};a.getAttributes().type!==TK.STREAM_VIDEO&&(e.attributes=a.getAttributes(),e.attributes.video=a.hasVideo(),e.attributes.audio=a.hasAudio());void 0!==d&&(e.causeCode=d);a=TK.RoomEvent({type:"room-error-notice",message:e},{errorCode:b,errorInfo:c});l.dispatchEvent(a)}}function T(a,b,c){if(6!==C)return L.Logger.warning("[tk-sdk]publish with wrong room status",C),L.Utils.isFunction(c)&&c(void 0,"publish with wrong room status is "+
C),2;if(a.isPublishing)L.Utils.isFunction(c)&&c(void 0,"publishing");else return a.isPublishing=!0,"video"!==a.getAttributes().type||!aa(a)||a.isInit||e._isPlayback||a.isIniting?"video"===a.getAttributes().type&&aa(a)&&a.isIniting?e._wait_to_publish=!0:ya(a,b,c):(L.Logger.info("[tk-sdk]publish:my stream is not init , call stream init start!"),a.init(!0,void 0,function(d){L.Logger.info("[tk-sdk]publish:my stream is not init , call stream init finshed , result is :",L.Utils.toJsonStringify(d));La(d);
e._myself.publishstate>TK.PUBLISH_STATE_NONE&&ya(a,b,c)})),0}function H(a,b,c){if(6!==C)return b(void 0,"room not connected!"),2;if(a.isUnpublishing)L.Utils.isFunction(b)&&b(void 0,"unpublishing");else{c=c||{};L.Logger.info("[tk-sdk]calling unpublish , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));if(a&&l.localStreams[a.getID()])return a.isUnpublishing=!0,M("unpublish",a.getID(),function(d,e){a.isUnpublishing=!1;a.isPublishing=!1;
0!==d?(L.Logger.error("[tk-sdk]Error unpublishing stream, stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()),"error info:",e),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c.ignoreFailNotice||Fa(a,e,d),L.Utils.isFunction(b)&&b(void 0,e)):(L.Logger.debug("[tk-sdk]Stream unpublished  , stream id:"+a.getID()+" , extensionId is "+
a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.room=void 0,(a.hasAudio()||a.hasVideo()||a.hasScreen())&&void 0===a.url&&(a.pc&&a.pc.close(),a.pc=void 0),l.localStreams[a.getID()]&&(l.localStreams[a.getID()].peerConnectionStream=void 0),delete l.localStreams[a.getID()],a.getID=function(){return"local"},a.id=a.getID(),a.sendData=function(){},a.setAttributes=function(){},a.failed&&delete a.failed,L.Utils.isFunction(b)&&
b(!0))}),0;L.Logger.warning("[tk-sdk]unpublish warning:","Cannot unpublish, stream does not exist or is not local");L.Utils.isFunction(b)&&b(void 0,"Cannot unpublish, stream does not exist or is not local")}}function ia(a,b,c){if(6!=C)return L.Logger.warning("[tk-sdk]subscribe when not ready"),2;clearTimeout(a._subscribeTimer);a._subscribeTimer=setTimeout(function(){fa(a,function(b){setTimeout(function(){b||L.Logger.warning("[tk-sdk]subscribe timeout 15s: unsubscribe in not success , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())+" !");l.remoteStreams[a.getID()]?3>a.timeoutReSubcribeNumber?(L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3esubscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),void 0===a.timeoutReSubcribeNumber&&(a.timeoutReSubcribeNumber=0),a.timeoutReSubcribeNumber++,L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3estream-removed(initiative) , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),e._nativeStatsDelivered[a.extensionId]=void 0,delete e._nativeStatsDelivered[a.extensionId],delete e._createStreams[a.publisherId()+":"+a.getAttributes().type],a.getAttributes().type===TK.STREAM_VIDEO?ha(a):V(a,!1),ia(a,{timeoutSubscribeReconnection:!0})):(L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3ereSubscribe number \x3e 3 , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+
L.Utils.toJsonStringify(a.getAttributes())),Ea(a,"subscribe timeout",window.TK_ERR.TIMEOUT_ERROR),L.Utils.isFunction(c)&&c(void 0,"subscribe timeout")):L.Logger.info("[tk-sdk]subscribe timeout 15s--\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{timeoutSubscribeReconnection:!0})},15E3);b=b||{};if(!a||a.local||a.failed){var d="Error on subscribe";a?a.local?
(L.Logger.warning("[tk-sdk]Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),d="Local copy of stream"):a.failed&&(L.Logger.warning("[tk-sdk]Cannot subscribe to failed stream, you should wait a new stream-added event."),d="Failed stream"):(L.Logger.warning("[tk-sdk]Cannot subscribe to invalid stream",a),d="Invalid or undefined stream");L.Utils.isFunction(c)&&c(void 0,d)}else{if(a.hasVideo()||a.hasAudio()||a.hasScreen())a.hasVideo()||a.hasScreen()||
(b.video=!1),a.hasAudio()||(b.audio=!1),b.maxVideoBW=b.maxVideoBW||z.defaultVideoBW,b.maxVideoBW>z.maxVideoBW&&(b.maxVideoBW=z.maxVideoBW),"screen"===a.getAttributes().type?b.maxVideoBW=z.maxScreenBW:"file"===a.getAttributes().type&&(d=a.getAttributes().width,b.maxVideoBW=d?v(d,30):z.maxLocalFileMediaBW),L.Logger.debug("[tk-sdk]Checking subscribe options for",a.getID()),a.checkOptions(b),P("subscribe",{streamId:a.getID(),audio:b.audio,video:b.video,data:b.data,browser:TK.getBrowser(),createOffer:b.createOffer,
metadata:b.metadata,slideShowMode:b.slideShowMode},void 0,function(d,u){clearTimeout(a._subscribeTimer);0!==d?(L.Logger.error("[tk-sdk]Error subscribing to stream ",u),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),l.remoteStreams[a.getID()]?3>a.subscribeReconnectionNumber?(void 0===a.subscribeReconnectionNumber&&(a.subscribeReconnectionNumber=0),fa(a,function(b){setTimeout(function(){l.remoteStreams[a.getID()]?
(a.subscribeReconnectionNumber++,L.Logger.info("[tk-sdk]stream-subscribe-fail--\x3estream-removed(initiative) , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),e._nativeStatsDelivered[a.extensionId]=void 0,delete e._nativeStatsDelivered[a.extensionId],delete e._createStreams[a.publisherId()+":"+a.getAttributes().type],a.getAttributes().type===TK.STREAM_VIDEO?ha(a):V(a,!1),ia(a,{subscribeReconnection:!0})):L.Logger.info("[tk-sdk]stream-subscribe-fail(subscribe-fail):  failed --\x3eremoteStreams does not contain streams , not need afresh subscribe , stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},1E3)},{subscribeReconnection:!0})):(fa(a),Ea(a,u,d),L.Utils.isFunction(c)&&c(void 0,u)):L.Logger.info("[tk-sdk]stream-subscribe-fail:remoteStreams does not contain streams , not need afresh subscribe , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))):(L.Logger.debug("[tk-sdk]Subscriber added"),a.subscribeReconnectionNumber=0,a.timeoutReSubcribeNumber=
0,b.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.pc=TK.Connection({callback:function(b){L.Logger.debug("[tk-sdk]Sending message ",b);b=J(b);var c="chrome-stable";a.pc&&a.pc.browser&&(c=a.pc.browser);P("signaling_message",{streamId:a.getID(),msg:b,browser:c},void 0,function(){})},nop2p:!0,audio:b.audio,video:b.video,screen:!1,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW,iceServers:l.iceServers,cnnId:a.extensionId,local:a.local},
a.isTkNative),a.pc.onaddstream=function(b){l.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.stream=b.stream,a.getAttributes().type===TK.STREAM_VIDEO&&a.publisherId()===e._myself.id?a.mediaStreamClone=L.Utils.cloneMediaStream(e._default_stream.stream):a.mediaStreamClone=L.Utils.cloneMediaStream(a.stream),a.extensionId!==e._myself.id&&"video"===a.getAttributes().type&&oa(a),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+
L.Utils.toJsonStringify(a.getAttributes())),a.getAttributes().type===TK.STREAM_VIDEO?(b=!1,e._users[a.publisherId()]&&e._users[a.publisherId()].publishstate===TK.PUBLISH_STATE_MUTEALL&&(b=!0),da(a,void 0,b)):V(a,!0)):L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()))},a.pc.oniceconnectionstatechange=
function(b){L.Logger.info("[tk-sdk]subscribe ice state:"+b+" , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));"failed"===b&&0!==l.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("[tk-sdk]Subscribing stream ",a.getID()," has failed after successful ICE checks , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),n(a,b,"subscribe"))},a.pc.createOffer(!0),c&&c(!0))});
else if(a.hasData()&&!1!==b.data)P("subscribe",{streamId:a.getID(),data:b.data,metadata:b.metadata},void 0,function(b,d){0!==b?(L.Logger.error("[tk-sdk]Error subscribing to stream ",d),L.Logger.info("[tk-sdk]stream-subscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),Ea(a,d,b),L.Utils.isFunction(c)&&c(void 0,d)):l.remoteStreams[a.getID()]?(L.Logger.debug("[tk-sdk]Stream subscribed"),a.extensionId!==e._myself.id&&"video"===
a.getAttributes().type&&oa(a),L.Logger.info("[tk-sdk]stream-subscribed , stream id:"+a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),a.getAttributes().type===TK.STREAM_VIDEO?(b=!1,e._users[a.publisherId()]&&e._users[a.publisherId()].publishstate===TK.PUBLISH_STATE_MUTEALL&&(b=!0),da(a,void 0,b)):V(a,!0),c&&c(!0)):(L.Logger.info("[tk-sdk]stream-subscribe:remoteStreams does not contain streams ,stream  subscribe  information does not need to be passed to the interface layer , stream id:"+
a.getID()+" , hasData is "+a.hasData()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes())),c&&c(!1))});else{L.Logger.warning("[tk-sdk]There's nothing to subscribe to");L.Utils.isFunction(c)&&c(void 0,"Nothing to subscribe to");return}L.Logger.debug("[tk-sdk]Subscribing to: "+a.getID());return 0}}function fa(a,b,c){void 0!==l.socket&&a&&!a.local&&(c=c||{},M("unsubscribe",a.getID(),function(d,e){if(0!==d){L.Logger.error("[tk-sdk]Error unsubscribe stream, stream id:"+
a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()),"error code is "+d+" ,error info:",e);L.Logger.info("[tk-sdk]stream-unsubscribe-fail , stream id:"+a.getID()+" , extensionId is "+a.extensionId+", attrs is "+L.Utils.toJsonStringify(a.getAttributes()));if((!c||!c.ignoreFailNotice)&&a){var u=void 0;switch(a.getAttributes().type){case TK.STREAM_VIDEO:u=window.TK.ERROR_NOTICE.UNSUBSCRIBE_AUDIO_VIDEO_FAILURE;break;case TK.STREAM_MEDIA:u=window.TK.ERROR_NOTICE.UNSUBSCRIBE_MEDIA_FAILURE;
break;case TK.STREAM_FILE:u=window.TK.ERROR_NOTICE.UNSUBSCRIBE_FILE_FAILURE;break;case TK.STREAM_SCREEN:u=window.TK.ERROR_NOTICE.UNSUBSCRIBE_SCREEN_FAILURE}ja(a,u,e,d)}L.Utils.isFunction(b)&&b(void 0,e)}else c.reconnection||(delete a.isCompleted,a.reconnectionNumber=0),a.failed&&delete a.failed,sa(a),L.Utils.isFunction(b)&&b(!0)},function(){L.Logger.error("[tk-sdk]Error calling unsubscribe.")}))}function Wa(a,b,c,d,f,g){m(1);L.Utils.getJsonLength(e._serverList)||e._isPlayback||l.requestServerList(e._web_host,
e._web_port,void 0,{checkroom:!0});a=e._web_protocol+"://"+e._web_host+":"+e._web_port+"/ClientAPI/checkroom?ts\x3d"+(new Date).getTime();b=!0;g="";if("string"===typeof c)g=c,e._isPlayback&&(g+="\x26playback\x3dtrue"),g+="\x26clientType\x3d"+(TK.isTkNative?4:1);else{e._isPlayback&&(c.playback=!0);c.clientType=TK.isTkNative?4:1;for(var u in c)b?b=!1:g+="\x26",g=g+u+"\x3d"+c[u]}L.Logger.debug("[tk-sdk]Going to checkroom",g);L.Logger.info("[tk-sdk]call checkroom start!");var k=h("POST",a,!0,g,function(){L.Logger.debug("[tk-sdk]Http status ",
k.readyState);if(4==k.readyState)if(200==k.status){L.Logger.debug("[tk-sdk]checkroom resp : "+k.responseText);var a=L.Utils.toJsonParse(k.responseText);Ha(a,d,f)}else L.Logger.error("[tk-sdk]checkroom fail[readyState-status]:",k.readyState,k.status),d(3,k.responseText)})}function Xa(a,b,c,f,h,g){var u=function(){if(void 0===c.roomtype||void 0===c.serial||void 0===c.recordfilepath)L.Logger.error("[tk-sdk]The params must be included [roomtype , serial , recordfilepath] ! "),L.Utils.isFunction(g)&&g("TK_ERR_INVALID_ARG");
else{m(1);d({web_host:a,web_port:b});var u={room:{roomtype:c.roomtype,maxvideo:void 0!==c.maxvideo?c.maxvideo:1E4,roomrole:-1,serial:c.serial,roomname:c.roomname||"Play Back",recordfilepath:c.recordfilepath,domain:c.domain,host:c.host||a,companyid:c.companyid||-1},nickname:"playback",roomrole:-1,thirdid:ua()+":playback"},h={};var k=u.room;k.roomtype=Number(k.roomtype);k.maxvideo=parseInt(k.maxvideo);k.roomrole=Number(k.roomrole);e._room_properties=k;e._room_id=k.serial;e._room_name=k.roomname;e._room_type=
k.roomtype;e._room_max_videocount=k.maxvideo;e._recordfilepath=k.recordfilepath;h.properties={};h.properties.role=u.roomrole;h.properties.nickname=u.nickname;h.properties.hasvideo=!1;h.properties.hasaudio=!1;h.id=u.thirdid;e._isPlayback=!0;TK.isPlayback=e._isPlayback;e._myself=TK.RoomUser(h);e._isPlayback&&(e._room_id=e._room_id+"_"+e._myself.id,e._room_id&&-1===e._room_id.indexOf(":playback")&&(e._room_id+=":playback"));e._isGetFileList=!1;e._roomCheckRoomInfoString=u?"string"===typeof u?u:L.Utils.toJsonStringify(u):
"";TK.isTkNative&&!e._handlerCallbackJson&&(e._handlerCallbackJson=!0,window.tknative.postMessage({command:"initNative",localId:e._myself.id.toString(),width:Number(e._room_video_width),height:Number(e._room_video_height),fps:Number(e._room_video_fps),roomInfo:e._roomCheckRoomInfoString,webAddr:e._web_host.toString(),webPort:e._web_port.toString()}));L.Logger.info("[tk-sdk]initPlaybackInfo--\x3eprivateVariableJson._room_max_videocount:"+e._room_max_videocount+" , my id:"+e._myself.id+" , room id:"+
e._room_id,"room properties chairmancontrol is:"+(e._room_properties.chairmancontrol?window.__TkSdkBuild__?L.Utils.encrypt(e._room_properties.chairmancontrol):e._room_properties.chairmancontrol:void 0));f&&"function"===typeof f&&f(0,h,u)}};h?u():c.recordfilepath?(m(1),d({web_host:a,web_port:b}),e._isPlayback=!0,TK.isPlayback=e._isPlayback,e._recordfilepath=c.recordfilepath,e._isGetFileList=!1,c.playback=!0,L.Logger.info("[tk-sdk]initPlaybackInfo to checkroom start , params is "+(window.__TkSdkBuild__?
L.Utils.encrypt(L.Utils.toJsonStringify(c)):L.Utils.toJsonStringify(c))+"!"),h=c.recordfilepath+"room.json",/room.json/g.test(c.recordfilepath)&&(h=c.recordfilepath),/https:/g.test(window.location.protocol)&&!/https:/g.test(h)&&(h=h.replace(/http:/g,"https:").replace(/:\d+/g,"")),$.ajax({url:h,dataType:"json",type:"GET",async:!0}).done(function(a){L.Logger.debug("[tk-sdk]getPlaybackRoomJson resp \x3d ",L.Utils.toJsonStringify(a));a&&"object"===typeof a?Ha(a,function(a,b,c){0===a?f&&"function"===typeof f&&
f(a,b,c):u()}):(L.Logger.error("[tk-sdk]getPlaybackRoomJson resp must is json , call oldInitPlaybackInterface handler!"),u())}).fail(function(a,b,c){L.Logger.error("[tk-sdk]getPlaybackRoomJson fail[ jqXHR , textStatus , errorThrown ]:",a,b,c);u()})):(L.Logger.error("[tk-sdk]params.recordfilepath is required !"),L.Utils.isFunction(g)&&g("TK_ERR_INVALID_ARG"))}function na(a,b){return Math.max(1>a?window.TK.NET_QUALITY.TK_NET_QUALITY_EXCELLENT:5>a?window.TK.NET_QUALITY.TK_NET_QUALITY_GOOD:10>a?window.TK.NET_QUALITY.TK_NET_QUALITY_ACCEPTED:
20>a?window.TK.NET_QUALITY.TK_NET_QUALITY_BAD:window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD,80>b?window.TK.NET_QUALITY.TK_NET_QUALITY_EXCELLENT:150>b?window.TK.NET_QUALITY.TK_NET_QUALITY_GOOD:300>b?window.TK.NET_QUALITY.TK_NET_QUALITY_ACCEPTED:500>b?window.TK.NET_QUALITY.TK_NET_QUALITY_BAD:window.TK.NET_QUALITY.TK_NET_QUALITY_VERYBAD)}function za(a){var b=e._web_protocol+"://"+e._web_host+":"+e._web_port+"/ClientAPI/networkequipment?ts\x3d"+(new Date).getTime();$.ajax({url:b,dataType:"json",type:"POST",
async:!0,data:{companyid:e._room_properties.companyid,serial:e._room_properties.serial,myPeerId:e._myself.id,statistical:a}}).done(function(a){L.Logger.debug("[tk-sdk]networkequipment resp \x3d ",L.Utils.toJsonStringify(a))}).fail(function(a,b,c){L.Logger.error("[tk-sdk]networkequipment fail[ jqXHR , textStatus , errorThrown ]:",a,b,c)})}function va(a,b,c){l.checkInit()&&a&&a.getID()&&(b={type:b||"control",action:c},P("signaling_message",{streamId:a.getID(),msg:b}))}function pa(a,b,c,d){if(l.checkInit(c))if(a)if(a.getAttributes().type===
TK.STREAM_VIDEO&&a.extensionId===e._myself.id&&(a=e._default_stream),a.pc&&a.pc.isNative){var u=e._nativeStatsDelivered[a.extensionId];u?(L.Utils.isFunction(b)&&b(u),Ma(a,u)):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA")}else if(a.pc&&a.pc.getStats)try{a.pc.getStats(function(e,u){e&&(void 0===u||-1!==u&&-2!==u&&-3!==u)?(e=W(a,e))?(L.Utils.isFunction(b)&&b(e),Ma(a,e)):d?(L.Logger.error("[tk-sdk]pc.getStats -\x3enot get data!"),L.Utils.isFunction(c)&&c("TK_ERR_UNKNOWN")):pa(a,b,c,!0):(L.Logger.error("[tk-sdk]pc.getStats -\x3e getStats not exist!"),
L.Utils.isFunction(c)&&c("TK_ERR_UNKNOWN"))})}catch(Ra){L.Logger.error("[tk-sdk]pc.getStats error:",Ra),L.Utils.isFunction(c)&&c("TK_ERR_UNKNOWN")}else L.Logger.debug("[tk-sdk]stream.pc is not exist , stream id and extensionId:"+a.getID()+","+a.extensionId+"!"),L.Utils.isFunction(c)&&c("TK_ERR_NOT_PUBLISH");else L.Logger.error("[tk-sdk]stream is not exist!"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")}function Na(a,b,c){if(Ja(a,!0)&&a&&"object"===typeof b)if(e._nativeStatsDelivered[a]=e._nativeStatsDelivered[a]||
{},e._nativeStatsDelivered[a].video=e._nativeStatsDelivered[a].video||{bitsPerSecond:0,packetsLost:0,totalPackets:0,packetsLostRate:0,currentDelay:0,frameRate:0,frameWidth:0,frameHeight:0,timestamp:0,netquality:na(0,0)},e._nativeStatsDelivered[a].audio=e._nativeStatsDelivered[a].audio||{bitsPerSecond:0,packetsLost:0,totalPackets:0,packetsLostRate:0,currentDelay:0,jitter:0,timestamp:0,netquality:na(0,0)},c){c=(b.packetsLost-e._nativeStatsDelivered[a].video.packetsLost)/(b.totalPackets-e._nativeStatsDelivered[a].video.totalPackets)*
100;e._nativeStatsDelivered[a].video.packetsLostRate=isNaN(c)?0:100>=Math.round(c)?Math.round(c):100;for(var d in b)"timeStamp"===d?e._nativeStatsDelivered[a].video.timestamp=b[d]:"netQuality"===d?e._nativeStatsDelivered[a].video.netquality=b[d]:e._nativeStatsDelivered[a].video[d]=b[d]}else for(d in c=(b.packetsLost-e._nativeStatsDelivered[a].audio.packetsLost)/(b.totalPackets-e._nativeStatsDelivered[a].audio.totalPackets)*100,e._nativeStatsDelivered[a].audio.packetsLostRate=isNaN(c)?0:100>=Math.round(c)?
Math.round(c):100,b)"timeStamp"===d?e._nativeStatsDelivered[a].audio.timestamp=b[d]:"netQuality"===d?e._nativeStatsDelivered[a].audio.netquality=b[d]:e._nativeStatsDelivered[a].audio[d]=b[d];else!Ja(a,!0)&&e._nativeStatsDelivered[a]&&(e._nativeStatsDelivered[a]=void 0,delete e._nativeStatsDelivered[a])}function Ma(a,b){a.networkStatus=b;b={userId:a.publisherId(),type:a.getAttributes().type,networkStatus:b};switch(a.getAttributes().type){case TK.STREAM_VIDEO:a=TK.RoomEvent({type:"room-usernetworkstate-changed",
message:b},!1);l.dispatchEvent(a,!1);break;case TK.STREAM_MEDIA:case TK.STREAM_FILE:case TK.STREAM_SCREEN:a=TK.RoomEvent({type:"room-"+a.getAttributes().type+"networkstate-changed",message:b},!1),l.dispatchEvent(a,!1)}}function Sa(a,b,c){var d=(new Date).getTime(),u=e._web_protocol+"://"+a+":"+b+"/speed.php?ts\x3d"+d;a=Ya(512);return $.ajax({url:u,type:"GET",async:!0,data:{data:a}}).done(function(a){L.Logger.info("[tk-sdk]speedNetwordk finshed,url is "+u+" ,elapsed time is "+((new Date).getTime()-
d)+" ms");L.Utils.isFunction(c)&&c(0)}).fail(function(a){L.Logger.error("[tk-sdk]speedNetwordk fail,url is "+u+" ,elapsed time is "+((new Date).getTime()-d)+" ms, error info:",a);L.Utils.isFunction(c)&&c(-1)})}function Ya(a){a=a||1024;for(var b="",c=0;c<a;c++)b+="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678".charAt(Math.floor(48*Math.random()));b.toLowerCase();return b}c=c||{};"object"!==typeof c&&(L.Logger.error("[tk-sdk]TK.Room roomOptios must is json!"),c={});c.autoSubscribeAV=void 0!==c.autoSubscribeAV?
c.autoSubscribeAV:!1;L.Logger.info("[tk-sdk-version]sdk-version:"+TK.SDKVERSIONS+" , sdk-time: "+TK.SDKVERSIONSTIME);var z={},e={},l=TK.EventDispatcher(z),ma=[[80,60],[200,150],[320,240],[640,480],[1280,720],[1920,1080]],Y=TK.DeviceMgr,E=void 0,G=TK.NativeProxy,Ga=!1,C=0,x={},Oa=function(){e._web_protocol="https";e._doc_protocol="https";e._socket_protocol="https";e._backup_doc_protocol="https";e._web_host=void 0;e._temp_web_host=void 0;e._old_web_host=void 0;e._temp_web_port=void 0;e._web_port=void 0;
e._doc_host=void 0;e._doc_port=void 0;e._socket_host=void 0;e._socket_port=void 0;e._backup_doc_host=void 0;e._backup_doc_host_list=[];e._backup_doc_port=void 0;e._room_uri=void 0;e._room_id=void 0;e._room_type=0;e._room_name=void 0;e._room_properties=void 0;e._room_video_width=320;e._room_video_height=240;e._room_video_fps=15;e._room_max_video_width=320;e._room_max_video_height=240;e._room_max_video_fps=15;e._room_video_maxbps=256;e._room_max_videocount=6;e._configuration=void 0;e._testIP=void 0;
e._testPort=void 0;e._default_stream=void 0;e._myself={};e._serverList={};e._ipFalsificationName=void 0;e._serverName=void 0;e._isIpFalsification=!1;e._ipFalsification=void 0;e._isPlayback=!1;e._isGetFileList=!1;e._recordfilepath=void 0;e._webInterfaceHtmlPort=8080;e._connectedNumber=0;e._isConnected=!1;e._requestServerListPermission=!0;e._handlerCallbackJson=!1;e._docServerAddr=void 0;e._hasDocServerAddrBackup=!1;e._roomCheckRoomInfoString="";e._createStreams={};e._playAVStreams={};e._roomJsonOptions=
{};e._userJsonOptions={};e._autoProcessDevChangeEvent=!1;e._durationTime={};e._myIp="0.0.0.0";e._video_codec=0;e._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM;e._isSendAllPublishUserNetworkequipment=!0;e._room_filelist=[];e._users={};e._userId_to_elementId_map={};e._wait_to_publish=!1;e._wait_to_play=!1;e._wait_to_play_param={};e._local_def_ext_id="_local_default_extension_id_";e._sentAloneNetQualityBadList={};e._mediaFileScale=!0;e._nativeStatsDelivered={};e._isLocalVideoMirror=!1;e._backupCourseAddrList=
[]};Oa();l.remoteStreams={};l.localStreams={};l.roomID="";l.socket={};l.p2p=!1;l.state=0;TK.default_stream=e._default_stream;TK.isPlayback=e._isPlayback;l.init=function(a,b,d,f,h){L.Logger.debug("[tk-sdk] room-sdk initializing.");h=h||{};if(L.Utils.isNull(a))L.Logger.error("[tk-sdk] the appKey can not be empty when initializing room-sdk"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else{h.useHttpProtocol&&(e._web_protocol="http",e._doc_protocol="http",e._socket_protocol="http",e._backup_doc_protocol=
"http",e._webInterfaceHtmlPort=81);c.autoSubscribeAV=void 0!==h.autoSubscribeAV?h.autoSubscribeAV:c.autoSubscribeAV;e._isGetFileList=L.Utils.isBoolean(h.isGetFileList)?h.isGetFileList:!1;TK.isInnerVersions=L.Utils.isBoolean(h.isInnerVersions)?h.isInnerVersions:!1;f=L.Utils.isBoolean(f)?f:!0;a={video:!0,audio:!0};var u=function(){TK.DeviceMgr.getDevices(function(a){var b=a.devices;a=b.audioinput;b=b.videoinput;if(0===a.length){L.Logger.error("[tk-sdk] audioinput devices are un-available. reason: NotFound");
var c=TK.RoomEvent({type:"device-failure",message:{kind:"audioinput"}},{code:window.TK_ERR.DEVICE_ERROR_NotFoundError});l.dispatchEvent(c)}0===b.length&&(L.Logger.error("[tk-sdk] videoinput devices are un-available. reason: NotFound"),c=TK.RoomEvent({type:"device-failure",message:{kind:"videoinput"}},{code:window.TK_ERR.DEVICE_ERROR_NotFoundError}),l.dispatchEvent(c));0<a.length&&Aa(a,!0);0<b.length&&Aa(b,!1)})};d=function(a){a&&a.getTracks&&a.getTracks().forEach(function(a){a.stop()});a=null;u()};
h=function(a){L.Logger.warning("[tk-sdk] failed to getUserMedia when initilize the room sdk.",a);u()};!TK.isTkNative&&f&&TK.DeviceMgr.getUserMedia(d,h,a);Ga=!0;L.Utils.isFunction(b)&&b()}};l.uninit=function(a,b){8!==C&&l.leaveroom();e._default_stream&&(e._default_stream.stop(),TK.DeviceMgr.stopStreamTracks(e._default_stream.stream),TK.DeviceMgr.stopStreamTracks(e._default_stream.mediaStreamClone),TK.DeviceMgr.stopStreamTracks(e._default_stream.peerConnectionStream),e._default_stream.stream=void 0,
e._default_stream.mediaStreamClone=void 0,e._default_stream.peerConnectionStream=void 0,e._default_stream=void 0);Ga=!1;Oa();L.Utils.isFunction(a)&&a()};l.checkInit=function(a){if(Ga)return!0;L.Logger.error("[tk-sdk]The room is not initialized and cannot execute methods on the room class. Please call the init method for initialization!");L.Utils.isFunction(a)&&a("TK_ERR_ROOM_NOT_INIT");return!1};l.setLogIsDebug=function(a,b){a=a||!1;void 0!==b&&(a=0===b?!0:!1);TK.tkLogPrintConfig({debug:a},{development:a,
logLevel:void 0!==b&&"number"===typeof b?b:a?L.Constant.LOGLEVEL.DEBUG:L.Constant.LOGLEVEL.INFO},{webrtcLogDebug:a})};l.getFileList=function(){return e._room_filelist};l.getFileinfo=function(a){for(var b=void 0,c=0,d=e._room_filelist.length;c<d;c++)if(e._room_filelist[c]&&e._room_filelist[c].fileid==a){b=e._room_filelist[c];break}return b};l.getDeviceMgr=function(){return Y};l.getRoomProperties=function(){return e._room_properties};l.getMySelf=function(){return e._myself};l.getUser=function(a){if(void 0!==
a)return e._users[a]};l.getUsers=function(){return e._users};l.changeUserPropertyByRole=function(a,b,c){if(l.checkInit()){if(!Array.isArray(a))return L.Logger.error("[tk-sdk]changeUserPropertyByRole roles params must is array!"),4;"object"!==typeof c?L.Logger.error("[tk-sdk]changeUserPropertyByRole properties params must is json !"):l.changeUserProperty({roles:a},b,c)}};l.batchChangeUserProperty=function(a,b,c){if(l.checkInit()){if(!Array.isArray(a))return L.Logger.error("[tk-sdk]batchChangeUserProperty ids params must is array!"),
4;if("object"!==typeof c)L.Logger.error("[tk-sdk]batchChangeUserProperty properties params must is json !");else{if(e._roomMode!==window.TK.ROOM_MODE.BIG_ROOM)for(var d=a.length-1;0<=d;d--)a[d]&&!e._users[a[d]]&&(L.Logger.warning("[tk-sdk]batchChangeUserProperty:user is not exist, user id: "+a[d]+" !"),a.splice(d,1));l.changeUserProperty({ids:a},b,c)}}};l.changeUserProperty=function(a,b,c){if(l.checkInit()){if(6!=C)return 2;if(!TK.isOnlyAudioRoom||void 0===c.publishstate||c.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&
c.publishstate!==TK.PUBLISH_STATE_BOTH){if(void 0===c||void 0===a)return L.Logger.error("[tk-sdk]changeUserProperty properties or id is not exist!"),4;if("object"!==typeof c)L.Logger.error("[tk-sdk]changeUserProperty properties must is json !");else{var d={};d.id=a;d.toID=b||"__all";c.hasOwnProperty("id")&&(L.Logger.warning("[tk-sdk]Method changeUserProperty cannot modify the id properties"),delete c.id);d.properties=c;if("object"===typeof a){if(a.hasOwnProperty("ids")&&Array.isArray(a.ids))for(var f in a.ids)a.ids[f]===
e._myself.id&&void 0!==c.publishstate&&(e._myself.publishstate=c.publishstate)}else{if(e._roomMode!==window.TK.ROOM_MODE.BIG_ROOM&&!e._users[a]){L.Logger.error("[tk-sdk]changeUserProperty:user is not exist , user id: "+a+"!");return}a===e._myself.id&&void 0!==c.publishstate&&(e._myself.publishstate=c.publishstate)}M("setProperty",d);return 0}}else L.Logger.warning("[tk-sdk]The publishstate of a pure audio room cannot be "+c.publishstate+"!")}};l.sendMessage=function(a,b,c){if(l.checkInit()){if(6!=
C)return 2;var d={};d.toID=b||"__all";b={};"string"===typeof a&&(a=L.Utils.toJsonParse(a));if("object"===typeof a)for(var e in a)b[e]=a[e];else b.msg=a;"string"===typeof c&&(c=L.Utils.toJsonParse(c));if(c&&"object"===typeof c)for(e in c)b[e]=c[e];d.message=L.Utils.toJsonStringify(b);M("sendMessage",d);return 0}};l.pubMsg=function(a){if(l.checkInit()){if(6!==C)return 2;if("object"!==typeof a)L.Logger.error("[tk-sdk]pubMsg params must is json!");else{var b={};b.name=a.name||a.msgName;b.id=a.id||a.msgId||
b.name;b.toID=a.toID||a.toId||"__all";b.data=a.data;a.save||(b.do_not_save="");void 0!==a.associatedMsgID&&(b.associatedMsgID=a.associatedMsgID);void 0!==a.associatedUserID&&(b.associatedUserID=a.associatedUserID);var c={},d;for(d in a)void 0===b[d]&&void 0!==a[d]&&"save"!==d&&"name"!==d&&"msgName"!==d&&"id"!==d&&"msgId"!==d&&"toID"!==d&&"toId"!==d&&"data"!==d&&"associatedMsgID"!==d&&"associatedUserID"!==d&&(c[d]=a[d]);for(d in c)void 0===b[d]&&"save"!==d&&(b[d]=c[d]);if(void 0===b.name||null===b.name)L.Logger.error("[tk-sdk]pubMsg name is must exist!");
else return"DocumentChange"===b.name&&"__allExceptSender"===b.toID&&(a=L.Utils.toJsonParse(L.Utils.toJsonStringify(b)),a.fromID=e._myself.id,a&&a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data)),Ka(a)),M("pubMsg",b),0}}};l.delMsg=function(a){if(l.checkInit()){if(6!==C)return 2;if("object"!==typeof a)L.Logger.error("[tk-sdk]delMsg params must is json!");else{if(1===arguments.length&&a&&"object"===typeof a){var b=a.name||a.msgName;var c=a.id||a.msgId;var d=a.toID||a.toId;var e=a.data}else b=
arguments[0],c=arguments[1],d=arguments[2],e=arguments[3];var f={};f.name=b;f.id=c||f.name;f.toID=d||"__all";f.data=e;if(void 0===f.name||null===f.name)L.Logger.error("[tk-sdk]delMsg name is must exist!");else if(void 0===f.id||null===f.id)L.Logger.error("[tk-sdk]delMsg id is must exist!");else return M("delMsg",f),0}}};l.evictUser=function(a,b){if(l.checkInit()){L.Logger.debug("[tk-sdk]evictUser",a);if(6!=C)return 2;var c={};c.id=a;if(b&&"object"===typeof b)for(var d in b)c[d]=b[d];M("evictParticipant",
c);return 0}};l.joinPlaybackRoom=function(a,b,c,d,f,h,k){if(l.checkInit(d))if(L.Utils.isNull(a)||L.Utils.isNull(b)||L.Utils.isNull(c)||"object"!==typeof c)L.Logger.error("[tk-sdk] startPlayback function got wrong arguments"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else{e._roomJsonOptions={};e._userJsonOptions=e._userJsonOptions||{};e._userJsonOptions.userProperties={};e._roomJsonOptions.video=!0;e._roomJsonOptions.audio=!0;e._roomJsonOptions.autoServer=L.Utils.isBoolean(c.autoServer)?c.autoServer:
!0;e._testIP=f;e._testPort=h;L.Logger.info("[tk-sdk]call startPlayback start!");var u=!1,m=!1,r=!1,p=e._web_host;F(a,e._webInterfaceHtmlPort,function(a){u=!0;0===a&&(p=g(e._web_host,e._serverName));u&&m&&!r&&(r=!0,qa(p))});Xa(a,b,c,function(a,b,c){m=!0;b=TK.RoomEvent({type:"room-checkroom-playback",message:{ret:a,userinfo:b,roominfo:c}});l.dispatchEvent(b);0===a?u&&m&&!r&&(r=!0,qa(p)):(b=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.CHECKROOMERROR,error:a}}),l.dispatchEvent(b),
b=TK.RoomEvent({type:"room-connect-fail",message:{source:L.Constant.roomError.CHECKROOMERROR,error:a}}),l.dispatchEvent(b))},k,d)}};l.joinroom=function(a,b,c,f,h,k,m,r){if(l.checkInit()){d({web_host:a,web_port:b});e._roomJsonOptions="object"===typeof h?h:{};e._userJsonOptions=e._userJsonOptions||{};e._userJsonOptions.userProperties=k||{};e._roomJsonOptions.video=!0;e._roomJsonOptions.audio=!0;e._roomJsonOptions.autoServer=L.Utils.isBoolean(e._roomJsonOptions.autoServer)?e._roomJsonOptions.autoServer:
!0;e._testIP=m;e._testPort=r;h={serial:e._roomJsonOptions.serial,password:e._roomJsonOptions.password||""};c&&(h.nickname=c);L.Logger.info("[tk-sdk]call joinroom start!");var u=!1,p=!1,v=!1,t=e._web_host;F(a,e._webInterfaceHtmlPort,function(a){u=!0;0===a&&(t=g(e._web_host,e._serverName));u&&p&&!v&&(v=!0,qa(t))});Wa(a,b,e._roomJsonOptions.checkroomParamsUrl||h,function(a,b,c){p=!0;b=TK.RoomEvent({type:"room-checkroom",message:{ret:a,userinfo:b,roominfo:c}});l.dispatchEvent(b);0===a?u&&p&&!v&&(v=!0,
qa(t)):(b=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.CHECKROOMERROR,error:a}}),l.dispatchEvent(b),b=TK.RoomEvent({type:"room-connect-fail",message:{source:L.Constant.roomError.CHECKROOMERROR,error:a}}),l.dispatchEvent(b))},f)}};l.leaveroom=function(a){if(l.checkInit()){a=a||!1;L.Logger.debug("[tk-sdk]leaveroom:Disconnection requested");m(8);try{l.socket&&l.socket.disconnect&&l.socket.disconnect()}catch(w){L.Logger.warning("[tk-sdk]Socket already disconnected , disconnect errorInfo:",
w)}l.socket=void 0;e._isConnected=!1;E&&E.changeCommonWhiteBoardConfigration&&E.changeCommonWhiteBoardConfigration({isConnectedRoom:e._isConnected});a=TK.RoomEvent({type:"room-leaveroom",message:a});l.dispatchEvent(a)}};l.startServerRecord=function(a){if(l.checkInit()){a=a||{};var b=L.Utils.isNull(a.recordType)?TK.REC_TYPE_VIDEOLIST:a.recordType;b!==TK.REC_TYPE_RECFILE&&b!==TK.REC_TYPE_VIDEOLIST&&b!==TK.REC_TYPE_MP3&&b!==TK.REC_TYPE_MIXVIDEO&&(b=TK.REC_TYPE_VIDEOLIST);var c=void 0!==a.recordChat&&
"boolean"===typeof a.recordChat?a.recordChat:!0,d=L.Utils.isNull(a.convert)?0:a.convert;a=L.Utils.isNull(a.layout)?0:a.layout;b={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{recordtype:b,convert:d,layout:a},save:!0};c&&(b.data.recordchat=!0);b.data=L.Utils.toJsonStringify(b.data);l.pubMsg(b)}};l.stopServerRecord=function(){if(l.checkInit()){var a={name:"ClassBegin",id:"ClassBegin",toID:"__all",data:{}};a.data=L.Utils.toJsonStringify(a.data);l.delMsg(a)}};l.seekPlayback=function(a,b){if(l.checkInit(b))if(e._isPlayback)try{a=
Number(a),l.socket.emit("seekPlayback",a)}catch(O){L.Utils.isFunction(b)&&b("TK_ERR_UNKNOWN"),L.Logger.error("[tk-sdk]The seek posttion must be a number, in milliseconds !")}else L.Logger.warning("[tk-sdk]No playback environment!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_PLAYBACK_ENVIRONMENT")};l.pausePlayback=function(a,b){l.checkInit(b)&&(e._isPlayback?L.Utils.isBoolean(a)?a?l.socket.emit("pausePlayback"):l.socket.emit("Playback"):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] pausePlayback function got wrong arguments")):
(L.Logger.warning("[tk-sdk]No playback environment!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_PLAYBACK_ENVIRONMENT")))};l.getUploadFileParams=function(a,b,c,d){if(l.checkInit())return a={serial:e._room_properties.serial,userid:e._myself.id,sender:e._myself.nickname,conversion:1,isconversiondone:0,writedb:(void 0!==c?c:1)?1:0,fileoldname:a,fieltype:b,alluser:1},d&&(a.codeid=d),a};l.uploadFile=function(a,b,c){if(l.checkInit())return R(a,b,c)};l.deleteFile=function(a,b){l.checkInit()&&K(a,b)};l.setAutoProcessDeviceChangeEvent=
function(a){"boolean"===typeof a&&(e._autoProcessDevChangeEvent=a)};l.requestServerList=function(b,c,d){if(l.checkInit())if(e._requestServerListPermission)if(l.webInterfaceGetservering)L.Logger.info("[tk-sdk]requestServerList  interface is being requested and cannot be executed again requestServerList"),d&&"function"===typeof d&&(a(e._serverList,e._serverName),d(e._serverList,-2));else{if(L.Utils.getJsonLength(e._serverList))return d&&"function"===typeof d&&(a(e._serverList,e._serverName),d(e._serverList,
-1)),e._serverList;if(void 0===b||null===b||void 0===c||null===c)L.Logger.error("[tk-sdk]first requestServerList web_host or web_port is not exist!");else{e._temp_web_host=b;e._temp_web_port=c;L.Logger.debug("[tk-sdk]Going to requestServerList");var f=!1,h=function(){if(f){a(e._serverList,e._serverName);L.Logger.info("[tk-sdk]requestServerList finshed , serverName is "+e._serverName+" , serverlist info : ",window.__TkSdkBuild__?L.Utils.encrypt(L.Utils.toJsonStringify(e._serverList)):L.Utils.toJsonStringify(e._serverList));
var b=TK.RoomEvent({type:"room-serverlist",message:{serverList:e._serverList,serverName:e._serverName}});l.dispatchEvent(b);d&&"function"===typeof d&&d(e._serverList,0)}};l.webInterfaceGetservering=!0;L.Utils.getJsonLength(e._serverList)?(l.webInterfaceGetservering=!1,f=!0,h()):S(b,c,function(a,b){l.webInterfaceGetservering=!1;f=!0;h()})}}else d&&"function"===typeof d&&d(void 0,-2)};l.switchServerByName=function(c){if(l.checkInit()){if(!L.Utils.getJsonLength(e._serverList))return L.Logger.error("[tk-sdk]selectServerByName --\x3e service list not request  , list is not exist!"),
!1;if(!e._serverList[c])return L.Logger.error("[tk-sdk]selectServerByName --\x3e the service list  has no option name  "+c+"!"),!1;void 0!==e._web_host&&void 0!==e._web_port?0<e._connectedNumber?(e._serverName=c,a(e._serverList,e._serverName),!/(192.168.|127.0.0.1|127.17.|localhost)/g.test(e._web_host)&&e._serverName&&(void 0!==e._web_host?(c=e._web_host.indexOf("."),0<c?(c=e._web_host.substring(0,c),c=new RegExp(c),e._old_web_host=e._web_host,c=e._web_host.replace(c,e._serverName),c!==e._web_host?
(L.Logger.info("[tk-sdk]changeWebRequest host , old host is "+(window.__TkSdkBuild__?L.Utils.encrypt(e._old_web_host):e._old_web_host)+", now host is "+(window.__TkSdkBuild__?L.Utils.encrypt(c):c)),d({web_host:c})):L.Logger.info("[tk-sdk]changeWebRequest host , host is not change ,   host is "+(window.__TkSdkBuild__?L.Utils.encrypt(e._web_host):e._web_host))):L.Logger.error("[tk-sdk]web request host not find first dot , cannot address to replace , current host is "+(window.__TkSdkBuild__?L.Utils.encrypt(e._web_host):
e._web_host)+" ! ")):L.Logger.error("[tk-sdk]web request host is not exist , cannot call changeWebRequestAddress ! ")),e._old_web_host!==e._web_host?b({source:"select service reconnect"}):L.Logger.info("[tk-sdk]web request host is not change , not need reconnect service!")):L.Logger.error("[tk-sdk]selectServerByName--\x3eThe room has no connection success and cannot perform a reswitch server! "):L.Logger.error("[tk-sdk]selectServerByName--\x3eweb request host and port is not exist , cannot perform a reswitch server! ");
return!0}};l.publishVideo=function(){l.checkInit()&&(TK.isOnlyAudioRoom?L.Logger.warning("[tk-sdk]only audio room not execute method publishVideo method !"):e._myself.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&e._myself.publishstate!==TK.PUBLISH_STATE_BOTH&&l.changeUserPublish(e._myself.id,e._myself.publishstate===TK.PUBLISH_STATE_MUTEALL||e._myself.publishstate===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_BOTH))};l.unpublishVideo=function(){l.checkInit()&&(TK.isOnlyAudioRoom?
L.Logger.warning("[tk-sdk]only audio room not execute method unpublishVideo method !"):e._myself.publishstate===TK.PUBLISH_STATE_NONE?L.Logger.warning("[tk-sdk]Local streams are not published and cannot be executed unpublishVideo."):e._myself.publishstate!==TK.PUBLISH_STATE_AUDIOONLY&&l.changeUserPublish(e._myself.id,e._myself.publishstate===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_NONE))};l.publishAudio=function(){l.checkInit()&&e._myself.publishstate!==TK.PUBLISH_STATE_AUDIOONLY&&
e._myself.publishstate!==TK.PUBLISH_STATE_BOTH&&l.changeUserPublish(e._myself.id,e._myself.publishstate===TK.PUBLISH_STATE_MUTEALL||e._myself.publishstate===TK.PUBLISH_STATE_NONE?TK.PUBLISH_STATE_AUDIOONLY:TK.PUBLISH_STATE_BOTH)};l.unpublishAudio=function(){l.checkInit()&&(e._myself.publishstate===TK.PUBLISH_STATE_NONE?L.Logger.warning("[tk-sdk]Local streams are not published and cannot be executed unpublishAudio."):e._myself.publishstate!==TK.PUBLISH_STATE_VIDEOONLY&&l.changeUserPublish(e._myself.id,
e._myself.publishstate===TK.PUBLISH_STATE_BOTH?TK.PUBLISH_STATE_VIDEOONLY:TK.PUBLISH_STATE_NONE))};l.playRemoteMedia=function(a,b,c,d){l.checkInit(d)&&(c=c||{},Ba(a,b,c,d,TK.STREAM_MEDIA,"playRemoteMedia"))};l.unplayRemoteMedia=function(a,b){l.checkInit(b)&&Ca(a,b,TK.STREAM_MEDIA,"unplayRemoteMedia")};l.playRemoteMediaFile=function(a,b,c,d){l.checkInit(d)&&(c=c||{},Ba(a,b,c,d,TK.STREAM_FILE,"playRemoteMediaFile"))};l.unplayRemoteMediaFile=function(a,b){l.checkInit(b)&&Ca(a,b,TK.STREAM_FILE,"unplayRemoteMediaFile")};
l.playRemoteScreen=function(a,b,c,d){l.checkInit(d)&&(a===e._myself.id?L.Utils.isFunction(d)&&d("TK_ERR_NOT_PLAY_SELF_SCREEN"):(c=c||{},Ba(a,b,c,d,TK.STREAM_SCREEN,"playRemoteScreen")))};l.unplayRemoteScreen=function(a,b){l.checkInit(b)&&(a===e._myself.id?L.Utils.isFunction(b)&&b("TK_ERR_NOT_UNPLAY_SELF_SCREEN"):Ca(a,b,TK.STREAM_SCREEN,"playRemoteScreen"))};l.setRemoteAudioVolume=function(a,b,c,d){l.checkInit()&&("number"!==typeof a?(L.Logger.error("[tk-sdk] setRemoteAudioVolume method volume muset is number!"),
L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")):(d=N(b,d||TK.STREAM_VIDEO))?d.setVolume(a):(L.Logger.debug("[tk-sdk] setRemoteAudioVolume: user is not stream  , user id is "+b),L.Utils.isFunction(c)&&c("TK_NO_THIS_STREAM")))};l.getAudioVolume=function(a,b,c,d){l.checkInit()&&(L.Utils.isFunction(b)?(d=N(a,d||TK.STREAM_VIDEO))?d.getRealtimeVolume(b,c):(L.Logger.debug("[tk-sdk] getAudioVolume: user has not stream, user id is "+a),L.Utils.isFunction(c)&&c("TK_NO_THIS_STREAM")):(L.Logger.error("[tk-sdk] getAudioVolume: onVolume is not function"),
L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")))};l.registerAudioVolumeListener=function(a,b,c,d,f){if(l.checkInit(d))if(""===a&&(a=L.Utils.isNull(e._myself.id)?e._local_def_ext_id:e._myself.id),L.Utils.isNull(a))L.Logger.error("[tk-sdk] registerAudioVolumeListener: userId is invalid"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else if("number"!==typeof b)L.Logger.error("[tk-sdk] registerAudioVolumeListener: msInterval is invalid"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else if(L.Utils.isFunction(c)){50>
b&&(b=50);var h=N(a,f||TK.STREAM_VIDEO);h?(l.unregisterAudioVolumeListener(a,f),h.startIntervalGetRealtimeVolume(function(a,b){b!==e._local_def_ext_id||L.Utils.isNull(e._myself.id)||(b=e._myself.id);L.Utils.isFunction(c)&&c(a,b)},b,d)):(L.Logger.debug("[tk-sdk] registerAudioVolumeListener: user has not stream, user id is "+a),L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM"))}else L.Logger.error("[tk-sdk] registerAudioVolumeListener: onVolume is not function"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG")};
l.unregisterAudioVolumeListener=function(a,b,c){l.checkInit()&&(""===a&&(a=L.Utils.isNull(e._myself.id)?e._local_def_ext_id:e._myself.id),L.Utils.isNull(a)?(L.Logger.error("[tk-sdk] unregisterAudioVolumeListener: userId is invalid"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG")):(c=N(a,c||TK.STREAM_VIDEO))?c.stopIntervalGetRealtimeVolume():(L.Logger.debug("[tk-sdk] unregisterAudioVolumeListener: user has not stream, user id is "+a),L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM")))};l.switchOnlyAudioRoom=
function(a){if(l.checkInit()){var b={};a?(TK.needOnlyAudioRoom=1,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",toID:"__all",data:b,save:!0},l.pubMsg(a)):(TK.needOnlyAudioRoom=2,a={name:"OnlyAudioRoom",id:"OnlyAudioRoom",toID:"__all",data:b},l.delMsg(a))}};l.startShareMedia=function(a,b,c,d){function f(){L.Logger.info("[tk-sdk]calling startShareMedia  , url is "+a+" , isVideo is "+b+" , options is "+L.Utils.toJsonStringify(d));P("publish",{state:"url",data:u.data,audio:u.audio,video:u.video,attributes:u.attributes,
extensionId:u.extensionId,metadata:void 0,createOffer:void 0},u.url,function(b,d){0===b?L.Logger.debug("[tk-sdk]mediaStream published , stream id:"+d+" , extensionId is "+u.extensionId+", attrs is "+L.Utils.toJsonStringify(u.attributes)):(L.Logger.error("[tk-sdk]Error when publishing mediaStream",b,d),L.Logger.info("[tk-sdk]stream-publish-fail , stream url:"+a+" , extensionId is "+u.extensionId+", attrs is "+L.Utils.toJsonStringify(u.attributes)),ka(k,d,b),L.Utils.isFunction(c)&&c(b))})}if(l.checkInit(c))if(d=
d||{},b=void 0!==b?b:!1,e._isConnected)if(a)if(TK.isOnlyAudioRoom&&b)L.Logger.warning("[tk-sdk]only audio room not execute method startShareMedia to video media !"),c&&"function"===typeof c&&c("TK_ERR_NOT_SUPPORT");else{var h={type:"media"};void 0!==d.toID&&(h.toID=d.toID);if(d.attrs&&"object"===typeof d.attrs)for(var g in d.attrs)"toID"!==g&&"type"!==g&&(h[g]=d.attrs[g]);var u={audio:!0,video:b,url:a,extensionId:e._myself.id+":media",attributes:h};h=!1;for(g in l.remoteStreams){var k=l.remoteStreams[g];
k&&"media"===k.getAttributes().type&&(h=!0,l.stopShareMedia(function(a){f()},function(){f()}))}h||f()}else L.Logger.error("[tk-fake-sdk]startShareMedia url can not be empty!"),c&&"function"===typeof c&&c("TK_ERR_INVALID_ARG");else L.Utils.isFunction(c)&&c("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call startShareMedia method after join room success")};l.stopShareMedia=function(a,b,c){function d(c){L.Logger.info("[tk-sdk]calling stopShareMedia , stream id:"+c.getID()+" , extensionId is "+
c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()));M("unpublish",c.getID(),function(d,e){0!==d?(L.Logger.error("[tk-sdk]Error unpublishing stream, stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()),"error code is "+d+" ,error info:",e),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),Fa(c,e,d),L.Utils.isFunction(a)&&
a(e)):(L.Logger.debug("[tk-sdk]meidaStream unpublished , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),c.failed&&delete c.failed,L.Utils.isFunction(b)&&b())})}if(l.checkInit(a))if(c=c||{},e._isConnected){var f=!1,h;for(h in l.remoteStreams){var g=l.remoteStreams[h];!g||"media"!==g.getAttributes().type||c&&"object"===typeof c&&c.onlyStopMyself&&g.publisherId()!==e._myself.id||(f=!0,d(g))}f||(L.Logger.warning("[tk-sdk]No media are Shared!"),
a&&"function"===typeof a&&a("TK_ERR_NOT_MEDIA_SHARED"))}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call stopShareMedia method after join room success")};l.pauseShareMedia=function(a,b){if(l.checkInit(b))if(e._isConnected)if(L.Utils.isBoolean(a)){var c=!1,d;for(d in l.remoteStreams){var f=l.remoteStreams[d];"media"===f.getAttributes().type&&(c=!0,ra(f.getID(),{type:"pause",pause:a}))}c||(L.Logger.warning("[tk-sdk]No media are Shared and the execution pauseShareMedia method is invalid!"),
b&&"function"===typeof b&&b("TK_ERR_NOT_MEDIA_SHARED"))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] pauseShareMedia function got wrong arguments");else L.Utils.isFunction(b)&&b("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call pauseShareMedia method after join room success")};l.seekMedia=function(a,b){if(l.checkInit(b))if(e._isConnected)if(L.Utils.isNumber(a)){var c=!1;0>a&&(a=0);1<a&&(a=1);for(var d in l.remoteStreams){var f=l.remoteStreams[d];if("media"===
f.getAttributes().type){c=!0;var h=parseInt(a*f.getAttributes().duration);h>f.getAttributes().duration&&(h=f.getAttributes().duration);ra(f.getID(),{type:"seek",pos:h})}}c||(L.Logger.warning("[tk-sdk]No media are Shared and the execution seekShareMedia method is invalid!"),b&&"function"===typeof b&&b("TK_ERR_NOT_MEDIA_SHARED"))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] seekShareMedia function got wrong arguments");else L.Utils.isFunction(b)&&b("TK_ERR_NOT_JOINED"),
L.Logger.error("[tk-sdk] please call seekShareMedia method after join room success")};l.playVideo=function(a,b,c,d){if(l.checkInit(d))if(L.Logger.debug("[tk-sdk] playVideo. userId:",a,";elementId:",b,";options:",c),c=c||{},""===a&&(a=L.Utils.isNull(e._myself.id)?e._local_def_ext_id:e._myself.id),a)if(b)if(c&&"object"!==typeof c)L.Logger.error("[tk-sdk]playVideo method options is not json!"),L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");else{if(!L.Utils.isNull(e._myself.id)&&a===e._myself.id||a===
e._local_def_ext_id){var f=e._playAVStreams[a];if(!L.Utils.isNull(f)){L.Logger.info("[tk-sdk]playVideo: video has been played already, userId:",a,";elementId:",b,";options:",c);L.Utils.isFunction(d)&&d("TK_ERR_OPERATION_IN_PROGRESS");return}}if(a===e._local_def_ext_id&&L.Utils.isNull(e._default_stream)){var h=ba("video",{video:!0,audio:!0,attributes:{}});e._default_stream=h}for(var g in e._userId_to_elementId_map){if(g===e._local_def_ext_id)break;if(g===a){h=e._users[a];if(!h){L.Logger.error("[tk-sdk]playVideo method got invalid user!");
L.Utils.isFunction(d)&&d("TK_ERR_NO_THIS_USER");return}if(!h._videoplayed_&&void 0!==h._audioplayed_&&!0===h._audioplayed_&&(g=e._userId_to_elementId_map[g],void 0!==g&&g!==b)){L.Logger.error("[tk-sdk]playVideo method got invalid elementId!");L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG");return}break}}(f=N(a,"video"))?(h=e._users[a],void 0!==h?(h._videoplayed_=!0,e._userId_to_elementId_map[a]=b):a===e._local_def_ext_id&&(e._userId_to_elementId_map[a]=b),e._default_stream&&f.extensionId===e._default_stream.extensionId&&
(c.mirror=L.Utils.isBoolean(c.mirror)?c.mirror:e._isLocalVideoMirror),aa(f)&&"video"===f.getAttributes().type&&!e._isPlayback?(c.audio=!1,c.video=!0,f.isInit||f.isIniting?!f.isInit&&f.isIniting?(e._wait_to_play=!0,e._wait_to_play_param.elementId=b,e._wait_to_play_param.options=c):ea(b,f,c):(L.Logger.info("[tk-sdk] playVideo:local stream has not been initialized, initialize stream now!"),e._default_stream.init(!0,void 0,function(a){L.Logger.info("[tk-sdk] initialize stream finished, result is :",L.Utils.toJsonStringify(a));
ea(b,f,c);La(a)}))):(a=!0,f.playInfo&&f.playInfo.audio||(a=!1),c.audio=a,c.video=!0,ea(b,f,c))):(L.Logger.debug("[tk-sdk]playVideo: user has not stream, user id is "+a),L.Utils.isFunction(d)&&d("TK_NO_THIS_STREAM"))}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method got invalid elementId!");else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]playVideo method got invalid userId!")};l.unplayVideo=function(a,b){if(l.checkInit(b))if(L.Logger.debug("[tk-sdk] unplayVideo. userId:",
a),""===a&&(a=L.Utils.isNull(e._myself.id)?e._local_def_ext_id:e._myself.id),a){var c=e._users[a];void 0!==c?(c._videoplayed_=!1,(void 0===c._audioplayed_||void 0!==c._audioplayed_&&!1===c._audioplayed_)&&delete e._userId_to_elementId_map[a],c.id===e._myself.id&&delete e._userId_to_elementId_map[e._local_def_ext_id]):a===e._local_def_ext_id&&(delete e._userId_to_elementId_map[e._local_def_ext_id],L.Utils.isNull(e._myself.id)||delete e._userId_to_elementId_map[e._myself.id]);(!L.Utils.isNull(e._myself.id)&&
e._myself.id===a||a===e._local_def_ext_id)&&e._wait_to_play&&(e._wait_to_play=!1,e._wait_to_play_param={});(c=e._playAVStreams[a])?(a=!1,c.playInfo&&c.playInfo.audio||(a=!0),wa(c,{audio:a,video:!0})):(L.Logger.debug("[tk-sdk]unplayVideo: user has not stream, user id is "+a),L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM"))}else L.Logger.error("[tk-sdk]unplayVideo method got invalid userId!"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG")};l.playAudio=function(a,b,c){if(l.checkInit(c))if(L.Logger.debug("[tk-sdk] playAudio. userId:",
a,";elementId:",b),a)if(b){var d=N(a,"video");if(d)if(aa(d)&&!e._isPlayback)L.Logger.info("[tk-sdk]playAudio:play local audio are not allowed, user id is "+a),L.Utils.isFunction(c)&&c("play local audio are not allowed!");else{for(var f in e._userId_to_elementId_map)if(f===a){var h=e._users[a];if(!h){L.Logger.error("[tk-sdk]playAudio method got invalid user!");L.Utils.isFunction(c)&&c("TK_ERR_NO_THIS_USER");return}if(!h._audioplayed_&&void 0!==h._videoplayed_&&!0===h._videoplayed_&&(f=e._userId_to_elementId_map[f],
void 0!==f&&f!==b)){L.Logger.error("[tk-sdk]playAudio method got invalid elementId!");L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG");return}break}h=e._users[a];void 0!==h&&(h._audioplayed_=!0,e._userId_to_elementId_map[a]=b);a={};c=!0;d.playInfo&&d.playInfo.video||(c=!1);a.audio=!0;a.video=c;ea(b,d,a)}else L.Logger.debug("[tk-sdk]playAudio: user has not stream, user id is "+a),L.Utils.isFunction(c)&&c("TK_NO_THIS_STREAM")}else L.Logger.error("[tk-sdk]playAudio method got invalid elementId!"),L.Utils.isFunction(c)&&
c("TK_ERR_INVALID_ARG");else L.Logger.error("[tk-sdk]playAudio method got invalid userId!"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")};l.unplayAudio=function(a,b){if(l.checkInit(b))if(L.Logger.debug("[tk-sdk] unplayAudio. userId:",a),a){var c=e._users[a];void 0!==c&&(c._audioplayed_=!1,(void 0===c._videoplayed_||void 0!==c._videoplayed_&&!1===c._videoplayed_)&&delete e._userId_to_elementId_map[a]);(c=e._playAVStreams[a])?(a=!1,c.playInfo&&c.playInfo.video||(a=!0),wa(c,{audio:!0,video:a})):(L.Logger.debug("[tk-sdk]unplayAudio: user has not stream, user id is "+
a),L.Utils.isFunction(b)&&b("TK_NO_THIS_STREAM"))}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk]unplayAudio method got invalid userId!")};l.setLocalVideoMirror=function(a){a=L.Utils.isBoolean(a)?a:e._isLocalVideoMirror;e._isLocalVideoMirror=a;e._default_stream&&L.Utils.isFunction(e._default_stream.setLocalVideoMirror)&&e._default_stream.setLocalVideoMirror(a)};l.getVideoProfile=function(a,b){l.checkInit(b)&&(e._room_properties?L.Utils.isFunction(a)&&a({width:e._room_video_width,
height:e._room_video_height,maxfps:e._room_video_fps}):(L.Utils.isFunction(b)&&b("[tk-sdk] please call this method after join room success"),L.Logger.error("[tk-sdk] please call getVideoProfile method after join room success")))};l.setVideoProfile=function(a,b){l.checkInit(b)&&(e._room_properties?"object"!==typeof a?(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments")):a.hasOwnProperty("width")&&a.hasOwnProperty("height")&&a.hasOwnProperty("maxfps")?
"number"!==typeof a.width||"number"!==typeof a.height||"number"!==typeof a.maxfps?(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments")):(a.width*a.height>e._room_max_video_width*e._room_max_video_height&&(b=a.width*a.height/(e._room_max_video_width*e._room_max_video_height),a.width=Math.floor(a.width/b),a.height=Math.floor(a.height/b)),a.maxfps>e._room_max_video_fps&&(a.maxfps=e._room_max_video_width),e._room_video_width=parseInt(1>
a.width?1:a.width),e._room_video_height=parseInt(1>a.height?1:a.height),e._room_video_fps=parseInt(a.maxfps),Y.setAVMgrProperty({room_video_width:e._room_video_width,room_video_height:e._room_video_height,room_video_fps:e._room_video_fps}),I(),L.Logger.info("[tk-sdk]setVideoProfile [privateVariableJson._room_video_width * privateVariableJson._room_video_height, privateVariableJson._room_video_fps, privateVariableJson._room_video_maxbps]:"+e._room_video_width+"*"+e._room_video_height+", "+e._room_video_fps+
", "+e._room_video_maxbps)):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] setVideoProfile method got invalid arguments")):(L.Utils.isFunction(b)&&b("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call setVideoProfile method after join room success")))};l.getRoomUserNum=function(a,b,c,d){if(!l.checkInit(c))return 0;if(e._isConnected){L.Utils.isFunction(a)||(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] The parameter onSuccess of method getRoomUserNum must be a function"));
var f={companyid:e._room_properties.companyid,serial:e._room_properties.serial};void 0!==b&&Array.isArray(b)&&(f.role=b);d&&L.Utils.isString(d)&&(f.search=d);b=e._web_protocol+"://"+e._web_host+":"+e._web_port+"/ClientAPI/getroomusernum?ts\x3d"+(new Date).getTime();$.ajax({url:b,dataType:"json",type:"GET",async:!0,data:f}).done(function(b){L.Logger.debug("[tk-sdk]getroomusernum resp \x3d ",L.Utils.toJsonStringify(b));0===b.result?a(L.Utils.isNumber(Number(b.num))?Number(b.num):0):(L.Logger.warning("[tk-sdk]getroomusernum interface request fail , code is "+
b.result),L.Utils.isFunction(c)&&c("TK_ERR_HTTP_REQUEST_FAILED"))}).fail(function(a,b,d){L.Logger.error("[tk-sdk]getroomusernum fail[ jqXHR , textStatus , errorThrown ]:",a,b,d);L.Utils.isFunction(c)&&c("TK_ERR_HTTP_REQUEST_FAILED")})}else L.Utils.isFunction(c)&&c("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call getRoomUserNum method after join room success")};l.getRoomUsers=function(a,b,c,d,f,h,g){if(!l.checkInit(f))return[];if(e._isConnected){L.Utils.isFunction(a)||(L.Utils.isFunction(f)&&
f("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] The parameter onSuccess of method getRoomUsers must be a function"));var k={companyid:e._room_properties.companyid,serial:e._room_properties.serial};void 0!==b&&L.Utils.isNumber(b)&&(k.start=b);void 0!==c&&L.Utils.isNumber(c)&&(k.max=c);void 0!==d&&Array.isArray(d)&&(k.role=d);h&&L.Utils.isString(h)&&(k.search=h);if(g&&Array.isArray(g)){b=[];c=0;for(d=g.length;c<d&&!("object"===typeof g[c]&&b.push(g[c]),3<=b.length);c++);b.length&&(k.order=b)}g=e._web_protocol+
"://"+e._web_host+":"+e._web_port+"/ClientAPI/getroomusers?ts\x3d"+(new Date).getTime();$.ajax({url:g,dataType:"json",type:"POST",async:!0,data:k}).done(function(b){L.Logger.debug("[tk-sdk]getroomusers resp \x3d ",L.Utils.toJsonStringify(b));if(0===b.result){var c=[];if(b.userlist&&Array.isArray(b.userlist))for(var d=0,e=b.userlist.length;d<e;d++)c.push(TK.RoomUser(b.userlist[d]));a(c,b.total)}else L.Logger.warning("[tk-sdk]getroomusers interface request fail , code is "+b.result),L.Utils.isFunction(f)&&
f("TK_ERR_HTTP_REQUEST_FAILED")}).fail(function(a,b,c){L.Logger.error("[tk-sdk]getroomusers fail[ jqXHR , textStatus , errorThrown ]:",a,b,c);L.Utils.isFunction(f)&&f("TK_ERR_HTTP_REQUEST_FAILED")})}else L.Utils.isFunction(f)&&f("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call getRoomUsers method after join room success")};l.getNativeInterface=function(a){if(TK.isTkNative)return G;L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED");L.Logger.error("[tk-sdk] getNativeInterface method must be called in the native environment!")};
l.getRoomUser=function(a,b,c){if(l.checkInit(c))if(e._isConnected)if(a&&L.Utils.isFunction(b))if(e._roomMode!==window.TK.ROOM_MODE.NORMAL_ROOM)e._users[a]?b(e._users[a]):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA");else{var d=[];d.push(a);M("getUser",d,function(a,d){0===a?Array.isArray(d)&&d.length&&d[0]?b(TK.RoomUser(d[0])):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA"):L.Utils.isFunction(c)&&c("TK_ERR_NOT_DATA")})}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] getRoomUser method got invalid elementId!");
else L.Utils.isFunction(c)&&c("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call getRoomUser method after join room success")};l.liveSimulateServerCommunicationInterface=function(a){if(l.checkInit()&&x["_handler_"+a]&&"function"===typeof x["_handler_"+a]){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);x["_handler_"+a].apply(null,b)}};l.changeUserPublish=function(a,b){if(l.checkInit()){if(6!=C)return 2;if(void 0===a)return 4;l.changeUserProperty(a,"__all",{publishstate:b});return 0}};
l.changeMyDisableVideoState=function(a){if(l.checkInit())if("boolean"!==typeof a)L.Logger.warning("[tk-sdk]changeMyDisableVideoState:disablevideo must boolean !");else return l.changeUserProperty(e._myself.id,"__all",{disablevideo:a}),0};l.changeMyDisableAudioState=function(a){if(l.checkInit())if("boolean"!==typeof a)L.Logger.warning("[tk-sdk]changeMyDisableAudioState:disableaudio must boolean !");else return l.changeUserProperty(e._myself.id,"__all",{disableaudio:a}),0};l.updateVideoPlayerOptions=
function(a,b,c,d){l.checkInit()&&("object"!==typeof a?(L.Logger.error("[tk-sdk] updateVideoPlayerOptions method options muset is json!"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")):(d=N(b,d||TK.STREAM_VIDEO))?d.updateVideoPlayerOptions(a):(L.Logger.debug("[tk-sdk] updateVideoPlayerOptions: user is not stream  , user id is "+b),L.Utils.isFunction(c)&&c("TK_NO_THIS_STREAM")))};l.registerRoomWhiteBoardDelegate=function(a){if(a&&"TKWhiteBoardManager"===a.className&&"function"===typeof a.registerRoomDelegate){if(E=
a)if(E.registerRoomDelegate&&E.registerRoomDelegate(l),E.changeCommonWhiteBoardConfigration){a={};e._web_protocol&&e._web_host&&void 0!==e._web_port&&(a.webAddress={protocol:e._web_protocol,hostname:e._web_host,port:e._web_port});e._doc_protocol&&e._doc_host&&void 0!==e._doc_port&&(a.docAddress={protocol:e._doc_protocol,hostname:e._doc_host,port:e._doc_port});e._backup_doc_protocol&&e._backup_doc_host&&void 0!==e._backup_doc_port&&(a.backupDocAddress={protocol:e._backup_doc_protocol,hostname:e._backup_doc_host,
port:e._backup_doc_port});if(e._backup_doc_host_list.length){for(var b=[],c=0,d=e._backup_doc_host_list.length;c<d;c++)b.push({protocol:e._backup_doc_protocol,hostname:e._backup_doc_host_list[c],port:e._backup_doc_port});a.backupDocAddressList=b}void 0!==e._myself.id&&(a.myUserId=e._myself.id);void 0!==e._myself.nickname&&(a.myName=e._myself.nickname);void 0!==e._myself.role&&(a.myRole=e._myself.role);a.isPlayback=e._isPlayback;E.changeCommonWhiteBoardConfigration(a)}}else L.Logger.warning("[tk-sdk]register whiteboardManagerInstance not is a TKWhiteBoardManager instance class , cannot execute registerRoomWhiteBoardDelegate method.")};
l.stopShareLocalMedia=function(a,b,c){function d(c){L.Logger.info("[tk-sdk]calling stopShareLocalMedia , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()));M("unpublish",c.getID(),function(d,e){0!==d?(L.Logger.error("[tk-sdk]Error unpublishing stream, stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes()),"error code is "+d+" ,error info:",e),L.Logger.info("[tk-sdk]stream-unpublish-fail , stream id:"+
c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),Fa(c,e,d),L.Utils.isFunction(a)&&a(e)):(L.Logger.debug("[tk-sdk]meidaStream unpublished , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),c.failed&&delete c.failed,L.Utils.isFunction(b)&&b())})}if(l.checkInit(a))if(c=c||{},e._isConnected){var f=!1,h;for(h in l.remoteStreams){var g=l.remoteStreams[h];!g||"file"!==g.getAttributes().type||
c&&"object"===typeof c&&c.onlyStopMyself&&g.publisherId()!==e._myself.id||(f=!0,TK.isTkNative&&g.publisherId()===e._myself.id?G.stopShareMediaFile():d(g))}f||(L.Logger.warning("[tk-sdk]No media file are Shared!"),a&&"function"===typeof a&&a("TK_ERR_NOT_LOCAL_MEDIA_FILE_SHARED"))}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_JOINED"),L.Logger.error("[tk-sdk] please call stopShareLocalMedia method after join room success")};x._handler_participantLeft=function(a,b){L.Logger.debug("[tk-sdk]participantLeft userid:"+
a);var c=e._users[a];void 0===c?L.Logger.error("[tk-sdk]participantLeft user is not exist , userid is "+a+"!"):(L.Logger.info("[tk-sdk]user leave room  , user info: "+L.Utils.toJsonStringify(c)),e._isPlayback&&void 0!==b&&(c.leaveTs=b),delete e._users[a],delete e._userId_to_elementId_map[a],e._isPlayback&&"object"===typeof a&&(c.leaveTs=a.ts),a=TK.RoomEvent({type:"room-participant_leave",user:c}),l.dispatchEvent(a))};x._handler_participantJoined=function(a){L.Logger.debug("[tk-sdk]participantJoined userinfo:"+
L.Utils.toJsonStringify(a));var b=TK.RoomUser(a);L.Logger.info("[tk-sdk]user join room  , user info: "+L.Utils.toJsonStringify(b));e._users[b.id]=b;e._isPlayback&&"object"===typeof a&&(b.joinTs=a.ts);a=TK.RoomEvent({type:"room-participant_join",user:b});l.dispatchEvent(a)};x._handler_participantPublished=function(a){L.Logger.debug("[tk-sdk]participantPublished userinfo:"+L.Utils.toJsonStringify(a));if(e._roomMode===window.TK.ROOM_MODE.BIG_ROOM){var b=TK.RoomUser(a),c=e._users[b.id];if(c)for(var d in b)c[d]=
b[d];else c=b;e._users[c.id]=c;e._isPlayback&&"object"===typeof a&&(c.joinTs=a.ts)}};x._handler_sendMessage=function(a){L.Logger.debug("[tk-sdk]room-text-message info:"+(a&&"object"===typeof a?L.Utils.toJsonStringify(a):a));if(a&&a.hasOwnProperty("message")){var b=e._users[a.fromID];b||(b={id:a.fromID,nickname:b?b.nickname:a.nickname,role:b?b.role:a.role});a&&a.message&&"string"===typeof a.message&&(a.message=L.Utils.toJsonParse(a.message));e._isPlayback&&void 0!==a.ts&&"object"===typeof a.message&&
(a.message.ts=a.ts);a=TK.RoomEvent({type:"room-text-message",user:b,message:a.message},{userid:a.fromID,nickname:b?b.nickname:a.nickname,role:b?b.role:a.role});l.dispatchEvent(a)}else L.Logger.error("[tk-sdk]room-text-message messages or messages.message is not exist!")};x._handler_pubMsg=function(a){L.Logger.debug("[tk-sdk]pubMsg info:",L.Utils.toJsonStringify(a));a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));if("OnlyAudioRoom"===
a.name)xa(!0,a.fromID);else{"DocumentChange"===a.name&&Ka(a);if("BigRoom"===a.name){e._roomMode=window.TK.ROOM_MODE.BIG_ROOM;Da();L.Logger.info("[tk-sdk]room mode changed,current mode is "+e._roomMode);var b=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:e._roomMode}});l.dispatchEvent(b)}b=TK.RoomEvent({type:"room-pubmsg",message:a});l.dispatchEvent(b)}};x._handler_delMsg=function(a){L.Logger.debug("[tk-sdk]delMsg info:",L.Utils.toJsonStringify(a));a&&"string"===typeof a&&(a=L.Utils.toJsonParse(a));
a.data&&"string"===typeof a.data&&(a.data=L.Utils.toJsonParse(a.data));if("OnlyAudioRoom"===a.name)xa(!1,a.fromID);else{if("BigRoom"===a.name){e._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM;Da();L.Logger.info("[tk-sdk]room mode changed,current mode is "+e._roomMode);var b=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:e._roomMode}});l.dispatchEvent(b)}b=TK.RoomEvent({type:"room-delmsg",message:a});l.dispatchEvent(b)}};x._handler_setProperty=function(b){L.Logger.debug("[tk-sdk]setProperty info:",
L.Utils.toJsonStringify(b));var c=b.id;if(b.hasOwnProperty("properties")){var d=b.properties,h=e._users[c];if(e._myself.id===c)if(h=e._myself,d.hasOwnProperty("publishstate"))Ta(d.publishstate),e._myself.publishstate>TK.PUBLISH_STATE_NONE&&l.remoteStreams[e._default_stream.getID()]&&da(e._default_stream);else if(d.hasOwnProperty("disablevideo")){var g=d.disablevideo;L.Logger.debug("[tk-sdk]onChangeMyDisableVideoState "+e._myself.disablevideo+" to "+g);e._myself.disablevideo!=g&&(e._myself.disablevideo=
g,e._myself.publishstate>TK.PUBLISH_STATE_NONE&&f())}else d.hasOwnProperty("disableaudio")?(g=d.disableaudio,L.Logger.debug("[tk-sdk]onChangeMyDisableAudioState "+e._myself.disableaudio+" to "+g),e._myself.disableaudio!=g&&(e._myself.disableaudio=g,e._myself.publishstate>TK.PUBLISH_STATE_NONE&&f())):d.hasOwnProperty("hasaudio")?e._default_stream.audio=d.hasaudio:d.hasOwnProperty("hasvideo")&&(e._default_stream.video=d.hasvideo);if(h){g=h.servername;for(var k in d)"id"!=k&&"watchStatus"!=k&&(h[k]=
d[k]);if(e._myself.id!==h.id&&d.hasOwnProperty("publishstate"))for(k in l.remoteStreams){var m=l.remoteStreams[k];m.extensionId!==e._myself.id&&m.extensionId===h.id&&"video"===m.getAttributes().type&&(oa(m),l.remoteStreams[m.getID()]&&da(m))}h=TK.RoomEvent({type:"room-userproperty-changed",user:h,message:d},{fromID:b.fromID,userId:h.id});l.dispatchEvent(h);e._myself.id===c&&d.hasOwnProperty("servername")&&(e._myself.id!==b.fromID?d.servername&&d.servername!==g&&l.switchServerByName(d.servername):
d.servername&&d.servername!==g&&(e._serverName=d.servername,a(e._serverList,e._serverName)))}else e._roomMode!==window.TK.ROOM_MODE.NORMAL_ROOM&&L.Logger.info("[tk-sdk]setProperty user is not exist , userid is "+c+", change user property inof:"+L.Utils.toJsonStringify(b)+"!")}};x._handler_playback_clearAll=function(){if(e._isPlayback){e._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM;L.Logger.info("[tk-sdk]room mode changed,current mode is "+e._roomMode);var a=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:e._roomMode}});
l.dispatchEvent(a);a=TK.RoomEvent({type:"room-playback-clear_all"});l.dispatchEvent(a);e._isPlayback?(e._users&&r(e._users),e._myself&&(e._myself.publishstate=TK.PUBLISH_STATE_NONE,e._users[e._myself.id]=e._myself)):L.Logger.error("[tk-sdk]No playback environment, no execution playbackClearAll!")}else L.Logger.warning("[tk-sdk]No playback environment!")};x._handler_duration=function(a){if(e._isPlayback){var b=TK.RoomEvent({type:"room-playback-duration",message:a});e._durationTime=a;l.dispatchEvent(b)}else L.Logger.warning("[tk-sdk]No playback environment!")};
x._handler_playbackEnd=function(){if(e._isPlayback){var a=TK.RoomEvent({type:"room-playback-playbackEnd"});l.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]No playback environment!")};x._handler_playback_updatetime=function(a){e._isPlayback?(a=TK.RoomEvent({type:"room-playback-playback_updatetime",message:a}),l.dispatchEvent(a)):L.Logger.warning("[tk-sdk]No playback environment!")};x._handler_connectSocketSuccess=function(a,b){TK.isTkNative&&!e._handlerCallbackJson&&(e._handlerCallbackJson=!0,window.tknative.postMessage({command:"initNative",
localId:e._myself.id.toString(),width:Number(e._room_video_width),height:Number(e._room_video_height),fps:Number(e._room_video_fps),roomInfo:e._roomCheckRoomInfoString,webAddr:e._web_host.toString(),webPort:e._web_port.toString()}));var c=b.roominfo,d=b.msglist,h=b.userlist;a=[];var g=c.streams||[];l.p2p=c.p2p;var k=c.id;l.iceServers=c.iceServers;z.defaultVideoBW=e._room_video_maxbps;z.maxVideoBW=e._room_video_maxbps;z.defaultScreenBW=v(1280,20);z.maxScreenBW=v(1280,20);z.defaultLocalFileMediaBW=
v(640,30);z.maxLocalFileMediaBW=v(640,30);e._users={};m(6);for(var r in g)if(g.hasOwnProperty(r)){c=g[r];var p=!1;TK.subscribe_from_native&&(p=!0);p=TK.Stream({streamID:c.id,local:!1,audio:c.audio,video:c.video,data:c.data,screen:c.screen,attributes:c.attributes,extensionId:c.extensionId,room:l,checkMyAudioAndVideoEnable:function(a){e._myself&&e._myself.id&&(a=a||e._myself.id,a===e._myself.id&&(TK.isTkNative&&(t(!0),q(!0)),e._myself.publishstate>TK.PUBLISH_STATE_NONE&&f()))},sendControlMessage:function(a,
b,c){va(a,b,c)}},p);a.push(p);l.remoteStreams[c.id]=p;L.Logger.info("[tk-sdk]room-connected --\x3e stream info , stream id:"+p.getID()+" , extensionId is "+p.extensionId+", attrs is "+L.Utils.toJsonStringify(p.getAttributes()));ia(p)}for(r in h)h.hasOwnProperty(r)&&(g=TK.RoomUser(h[r]),void 0!==g&&(e._users[g.id]=g,L.Logger.info("[tk-sdk]room-connected --\x3e user info: "+L.Utils.toJsonStringify(g))));L.Logger.info("[tk-sdk]room-connected --\x3e myself info: "+L.Utils.toJsonStringify(e._myself));
r=[];d&&"string"===typeof d&&(d=L.Utils.toJsonParse(d));d.hasOwnProperty("OnlyAudioRoom")?(xa(!0,d.OnlyAudioRoom.fromID),2===TK.needOnlyAudioRoom&&l.switchOnlyAudioRoom(!1)):1===TK.needOnlyAudioRoom&&l.switchOnlyAudioRoom(!0);d.hasOwnProperty("BigRoom")?(e._roomMode=window.TK.ROOM_MODE.BIG_ROOM,Da()):e._roomMode=window.TK.ROOM_MODE.NORMAL_ROOM;L.Logger.info("[tk-sdk]room mode changed,current mode is "+e._roomMode);h=TK.RoomEvent({type:"room-mode-changed",message:{roomMode:e._roomMode}});l.dispatchEvent(h);
for(var u in d)d.hasOwnProperty(u)&&r.push(d[u]);r.sort(function(a,b){return void 0!==a&&a.hasOwnProperty("seq")&&void 0!==b&&b.hasOwnProperty("seq")?a.seq-b.seq:0});l.roomID=k;e._isConnected=!0;L.Logger.debug("[tk-sdk]Connected to room "+l.roomID);L.Logger.debug("[tk-sdk]connected response:",L.Utils.toJsonStringify(b));L.Logger.info("[tk-sdk]room-connected ,streams length is "+a.length+" , signalling list length "+r.length);if(E&&E.changeCommonWhiteBoardConfigration){b=[];u=0;for(d=e._backup_doc_host_list.length;u<
d;u++)b.push({protocol:e._backup_doc_protocol,hostname:e._backup_doc_host_list[u],port:e._backup_doc_port});E.changeCommonWhiteBoardConfigration({webAddress:{protocol:e._web_protocol,hostname:e._web_host,port:e._web_port},docAddress:{protocol:e._doc_protocol,hostname:e._doc_host,port:e._doc_port},backupDocAddress:{protocol:e._backup_doc_protocol,hostname:e._backup_doc_host,port:e._backup_doc_port},backupDocAddressList:b,myUserId:e._myself.id,myName:e._myself.nickname,myRole:e._myself.role,isConnectedRoom:e._isConnected,
isPlayback:e._isPlayback})}e._isPlayback||(Ua(),clearInterval(l._networkequipmentPhpTimer),l._networkequipmentPhpTimer=setInterval(function(){e._sentAloneNetQualityBadList={};Ia()},6E4),clearInterval(l._networkequipmentTimer),l._networkequipmentTimer=setInterval(function(){for(var a in l.remoteStreams){var b=l.remoteStreams[a];"video"===b.getAttributes().type&&e._users[b.extensionId]&&function(a){pa(a,function(b){if(b&&e._users[a.extensionId]&&(b.audio.netquality>=window.TK.NET_QUALITY.TK_NET_QUALITY_BAD||
b.video.netquality>=window.TK.NET_QUALITY.TK_NET_QUALITY_BAD)&&!e._sentAloneNetQualityBadList[a.getID()]){e._sentAloneNetQualityBadList[a.getID()]=!0;var c=L.Utils.toJsonParse(L.Utils.toJsonStringify(b.video));b=L.Utils.toJsonParse(L.Utils.toJsonStringify(b.audio));delete c.packetsLostRate;delete b.packetsLostRate;c={video:c,audio:b,cpuOccupancy:0,peerId:e._users[a.extensionId].id,peerName:e._users[a.extensionId].nickname,streamId:a.getID()};b=[];b.push(c);za(b)}a=void 0})}(b)}},2E3));a=TK.RoomEvent({type:"room-connected",
streams:a,message:r});l.dispatchEvent(a)};x._handler_connectSocketFail=function(a){if(e._backupCourseAddrList.length){var b=e._backupCourseAddrList[0];e._backupCourseAddrList.splice(0,1);L.Logger.warning("[tk-sdk]Not Connected,change address reconnection, address info:"+L.Utils.toJsonStringify(b)+" ,error info: "+a);y(b.name,b.signaladdr,b.signalport,b.webaddr,b.docaddr,b.change,void 0,function(){try{l.socket&&l.socket.disconnect&&l.socket.disconnect()}catch(O){L.Logger.warning("[tk-sdk]Socket already disconnected , disconnect errorInfo:",
O)}l.socket=void 0;l.needReconnectSocket=!0;ta(x._handler_connectSocketSuccess,x._handler_connectSocketFail)})}else L.Logger.error("[tk-sdk]Not Connected! Error: "+a),b=TK.RoomEvent({type:"room-error",message:{source:L.Constant.roomError.ROOMCONNECTERROR,error:a}}),l.dispatchEvent(b),b=TK.RoomEvent({type:"room-connect-fail",message:{source:L.Constant.roomError.ROOMCONNECTERROR,error:a}}),l.dispatchEvent(b)};G.onNativeStartShareMediaFile=function(a,b,c,d){var f=e._createStreams[e._myself.id+":file"];
L.Utils.isNull(f)?(f=ba("file",a),d&&d.IgnoreElementId?(f.create(),G.pauseShareMediaFile(!0)):f.play(b),L.Logger.info("[tk-sdk]calling localFilePublish stream , stream id:"+f.getID()+" , extensionId is "+f.extensionId+", attrs is "+L.Utils.toJsonStringify(f.getAttributes())),f&&void 0===l.remoteStreams[f.getID()]?T(f,void 0,function(a,b){a||L.Utils.isFunction(c)&&c(b)}):(L.Logger.error("[tk-sdk]Trying to publish invalid LocalFileStream",f),L.Utils.isFunction(c)&&c(void 0,"Trying to publish invalid LocalFileStream"))):
(L.Utils.isFunction(c)&&c("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error("[tk-sdk]Share media file in progress."))};G.onNativeStopShareMediaFile=function(a){var b=e._createStreams[e._myself.id+":file"];L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning("[tk-sdk]Could not find the specify stream while stop sharing media file.")):(b.stop(),L.Logger.info("[tk-sdk]calling unpublishLocalFile , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+
L.Utils.toJsonStringify(b.getAttributes())),H(b,function(b,c){b||L.Utils.isFunction(a)&&a(c)}),delete e._createStreams[e._myself.id+":file"])};G.onNativeStartShareScreen=function(a,b){var c=e._createStreams[e._myself.id+":screen"];L.Utils.isNull(c)?(c=ba("screen",a),L.Logger.info("[tk-sdk]calling screenPublish stream , stream id:"+c.getID()+" , extensionId is "+c.extensionId+", attrs is "+L.Utils.toJsonStringify(c.getAttributes())),c&&!c.failed&&void 0===l.remoteStreams[c.getID()]?T(c,void 0,function(a,
c){a||L.Utils.isFunction(b)&&b(c)}):(L.Logger.error("[tk-sdk]Trying to publish invalid screenStream",c),L.Utils.isFunction(b)&&b(void 0,"Trying to publish invalid screenStream"))):(L.Utils.isFunction(b)&&b("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.error("[tk-sdk]Share screen in progress."))};G.onNativeStopShareScreen=function(a){var b=e._createStreams[e._myself.id+":screen"];L.Utils.isNull(b)?(L.Utils.isFunction(a)&&a("TK_ERR_OPERATION_TERMINATED"),L.Logger.warning("[tk-sdk]Could not find the specify stream while stop sharing screen.")):
(L.Logger.info("[tk-sdk]calling unpublishScreen , stream id:"+b.getID()+" , extensionId is "+b.extensionId+", attrs is "+L.Utils.toJsonStringify(b.getAttributes())),H(b,function(b,c){b||L.Utils.isFunction(a)&&a(c)}),delete e._createStreams[e._myself.id+":screen"])};G.onNativeNotification=function(a){if("object"===typeof a)switch(a.name){case "onMediaFileEnded":if(a=N(e._myself.id,"file"))G.pauseShareMediaFile(!0),G.seekMediaFile(1),a.getAttributes()&&!a.getAttributes().pauseWhenOver&&G.stopShareMediaFile();
a=TK.RoomEvent({type:"room-clientNotification-onMediaFileEnded"});l.dispatchEvent(a);break;case "onRemoteAudioVolume":var b=a.args;if(!L.Utils.isNull(b)&&(a=N(b.id,b.type||TK.STREAM_VIDEO))&&L.Utils.isFunction(a.onRemoteAudioVolume))a.onRemoteAudioVolume(b.volume);break;case "onAudioStatsDelivered":a&&"object"===typeof a.args&&Na(a.args.connectionId,a.args.stats,!1);break;case "onVideoStatsDelivered":a&&"object"===typeof a.args&&Na(a.args.connectionId,a.args.stats,!0);break;default:a=TK.RoomEvent({type:"room-native-notification",
message:a}),l.dispatchEvent(a)}};G.onMicVolumeReport=function(a){if("object"===typeof a){var b=N(e._myself.id,TK.STREAM_VIDEO);if(b&&L.Utils.isFunction(b.onMicVolumeReport))b.onMicVolumeReport(a.volume)}};G.onPauseMediaFile=function(a){var b=N(e._myself.id,TK.STREAM_FILE);b&&l.remoteStreams[b.getID()]&&"file"===b.getAttributes().type&&ra(b.getID(),{type:"pause",pause:a})};G.onSeekMediaFile=function(a){var b=N(e._myself.id,TK.STREAM_FILE);b&&l.remoteStreams[b.getID()]&&"file"===b.getAttributes().type&&
(a=parseInt(a*b.getAttributes().duration),a>b.getAttributes().duration&&(a=b.getAttributes().duration),ra(b.getID(),{type:"seek",pos:a}))};Y.onDevicesSetted=function(a){Va(a)};Y.onDeviceChanged=function(a){e._autoProcessDevChangeEvent&&ca(a)};window.onNativeWindowClose=function(){if(TK.isTkNative){var a=TK.RoomEvent({type:"room-client-close"});l.dispatchEvent(a)}else L.Logger.warning("[tk-sdk]window.onNativeWindowClose method must be in the client environment!")};TK&&TK.coreEventController&&(TK.coreEventController.addEventListener("getUserMedia_success",
function(a){l.dispatchEvent(a)}),TK.coreEventController.addEventListener("getUserMedia_failure",function(a){l.dispatchEvent(a)}),TK.coreEventController.addEventListener("getUserMedia_failure_reGetOnlyAudioStream",function(a){l.dispatchEvent(a)}));return TK.roomInstance=l};window.TK=window.TK||{};TK.PUBLISH_STATE_NONE=0;TK.PUBLISH_STATE_AUDIOONLY=1;TK.PUBLISH_STATE_VIDEOONLY=2;TK.PUBLISH_STATE_BOTH=3;TK.PUBLISH_STATE_MUTEALL=4;TK.RoomUser=function(c){if(void 0==c||void 0===c.properties)L.Logger.warning("[tk-sdk]Invalidate user info",d,b);else{var d=c.id,b=c.properties;L.Logger.debug("[tk-sdk]RoomUser",d,b);c={};c.id=d;c.watchStatus=0;for(var a in b)"id"!=a&&"watchStatus"!=a&&(c[a]=b[a]);c.publishstate=c.publishstate||TK.PUBLISH_STATE_NONE;return c}};window.L=window.L||{};window.TK=window.TK||{};
L.Logger=function(c){var d="",b=!1;var a=function(a,d){try{switch(d){case c.Logger.DEBUG:b?console.warn.apply(console,a):console.debug.apply(console,a);break;case c.Logger.TRACE:console.trace.apply(console,a);break;case c.Logger.INFO:b?console.warn.apply(console,a):console.info.apply(console,a);break;case c.Logger.WARNING:console.warn.apply(console,a);break;case c.Logger.ERROR:console.error.apply(console,a);break;case c.Logger.NONE:console.warn("log level is none!");break;default:b?console.warn.apply(console,
a):console.log.apply(console,a)}}catch(t){console.log.apply(console,a)}};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogDevelopment:function(a){b=a},enableLogPanel:function(){c.Logger.panel=document.createElement("textarea");c.Logger.panel.setAttribute("id","licode-logs");c.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");c.Logger.panel.setAttribute("rows",20);c.Logger.panel.setAttribute("cols",20);c.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(c.Logger.panel)},
setLogLevel:function(a){a>c.Logger.NONE?a=c.Logger.NONE:a<c.Logger.DEBUG&&(a=c.Logger.DEBUG);c.Logger.logLevel=a},setOutputFunction:function(b){a=b},setLogPrefix:function(a){d=a},print:function(b){var f=d;if(!(b<c.Logger.logLevel)){b===c.Logger.DEBUG?f=f+"DEBUG("+(new Date).toLocaleString()+")":b===c.Logger.TRACE?f=f+"TRACE("+(new Date).toLocaleString()+")":b===c.Logger.INFO?f=f+"INFO("+(new Date).toLocaleString()+")":b===c.Logger.WARNING?f=f+"WARNING("+(new Date).toLocaleString()+")":b===c.Logger.ERROR&&
(f=f+"ERROR("+(new Date).toLocaleString()+")");f+=":";for(var g=[],q=0;q<arguments.length;q++)g[q]=arguments[q];g=g.slice(1);g=[f].concat(g);if(void 0!==c.Logger.panel){f="";for(q=0;q<g.length;q++)f+=g[q];c.Logger.panel.value=c.Logger.panel.value+"\n"+f}else a.apply(c.Logger,[g,b])}},debug:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.print.apply(c.Logger,[c.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.print.apply(c.Logger,
[c.Logger.TRACE].concat(a))},info:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.print.apply(c.Logger,[c.Logger.INFO].concat(a))},warning:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.print.apply(c.Logger,[c.Logger.WARNING].concat(a))},error:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.Logger.print.apply(c.Logger,[c.Logger.ERROR].concat(a))}}}(L);
TK.tkLogPrintConfig=function(c,d,b){d=d||{};c=c||{};b=b||{};var a=void 0!=d.logLevel?d.logLevel:0;c=void 0!=c.debug?c.debug:!0;b=void 0!=b.webrtcLogDebug?b.webrtcLogDebug:!0;L.Logger.setLogDevelopment(void 0!=d.development?d.development:!0);L.Logger.setLogLevel(a);L.Utils.localStorage&&L.Utils.localStorage.setItem("debug",c?"*":"none");window.webrtcLogDebug=b};TK.Logger=L.Logger;window.L=window.L||{};
L.Base64=function(){var c,d,b;var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var g=[];for(b=0;b<a.length;b+=1)g[a[b]]=b;var f=function(a){c=a;d=0};var t=function(){if(!c||d>=c.length)return-1;var a=c.charCodeAt(d)&255;d+=1;return a};var q=function(){if(!c)return-1;for(;;){if(d>=c.length)return-1;var a=c.charAt(d);d+=1;if(g[a])return g[a];if("A"===a)return 0}};var n=function(a){a=a.toString(16);1===a.length&&(a="0"+a);return unescape("%"+a)};return{encodeBase64:function(b){var c;
f(b);b="";var d=Array(3);var h=0;for(c=!1;!c&&-1!==(d[0]=t());)d[1]=t(),d[2]=t(),b+=a[d[0]>>2],-1!==d[1]?(b+=a[d[0]<<4&48|d[1]>>4],-1!==d[2]?(b+=a[d[1]<<2&60|d[2]>>6],b+=a[d[2]&63]):(b+=a[d[1]<<2&60],b+="\x3d",c=!0)):(b+=a[d[0]<<4&48],b+="\x3d",b+="\x3d",c=!0),h+=4,76<=h&&(b+="\n",h=0);return b},decodeBase64:function(a){var b;f(a);a="";var c=Array(4);for(b=!1;!b&&-1!==(c[0]=q())&&-1!==(c[1]=q());)c[2]=q(),c[3]=q(),a+=n(c[0]<<2&255|c[1]>>4),-1!==c[2]?(a+=n(c[1]<<4&255|c[2]>>2),-1!==c[3]?a+=n(c[2]<<
6&255|c[3]):b=!0):b=!0;return a}}}(L);window.TK=window.TK||{};
TK.VideoPlayer=function(c){c.options=c.options||{};c.options.mirror=c.options.mirror||!1;c.options.mode=c.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN;c.options.loader=L.Utils.isBoolean(c.options.loader)?c.options.loader:!0;var d=void 0!==c.options.audioPlayer?c.options.audioPlayer:c.stream&&c.stream.hasVideo&&c.stream.hasAudio?!c.stream.hasVideo()&&c.stream.hasAudio():!1,b=TK.EventDispatcher({}),a=100,g=!1,f=c.options.loader,t=void 0,q=!1,n=!1;b.id=c.id;b.local=c.stream.local;b.videoPlayerMediaStreamClone=
c.stream.stream;b.type=c.stream&&c.stream.getAttributes&&c.stream.getAttributes()?c.stream.getAttributes().type:void 0;b.elementID=c.elementID;b.isAudioPlayer=d;b.bundleId=c.bundleId;b.destroy=function(){try{b.video&&(L.Utils.mediaPause(b.video),b.video.src="",b.video.srcObject=null);b.audio&&(L.Utils.mediaPause(b.audio),b.audio.src="",b.audio.srcObject=null);if(b.div)try{b.container.removeChild(b.div)}catch(v){L.Logger.error("[tk-sdk]VideoPlayer removeChild error:",v)}clearTimeout(t);b.videoPlayerMediaStreamClone=
void 0;if(b.audioMeidaStream&&L.Utils.isFunction(b.audioMeidaStream.getTracks))for(var a=0,c=b.audioMeidaStream.getTracks().length;a<c;a++)b.audioMeidaStream.getTracks()[a].stop();b=b.audioMeidaStream=void 0}catch(v){L.Logger.error("[tk-sdk]videoplayer destroy error , removeChild method error info:",v)}};b.videoPlayerMediaStreamClone&&"object"===typeof b.videoPlayerMediaStreamClone&&b.videoPlayerMediaStreamClone.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream "+b.videoPlayerMediaStreamClone),
b.videoPlayerMediaStreamCloneUrl=b.videoPlayerMediaStreamClone.playbackquUrl):b.videoPlayerMediaStreamClone&&(L.Logger.debug("[tk-sdk]Creating URL from stream "+b.videoPlayerMediaStreamClone),b.videoPlayerMediaStreamCloneUrl=(window.URL||webkitURL).createObjectURL(b.videoPlayerMediaStreamClone));b.div=document.createElement("div");b.div.setAttribute("id","player_"+b.id);b.div.setAttribute("class","Talk_player");b.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+
(d?"  display: none;":" "));c.options.loader&&(b.loader=document.createElement("div"),b.loader.setAttribute("id","back_"+b.id),b.loader.setAttribute("class","Talk_loader"),b.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,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")  no-repeat center center ;background-size: cover;z-index:1;'));
b.video=d?document.createElement("audio"):document.createElement("video");b.video.setAttribute("id","stream"+b.id);b.video.setAttribute("class","Talk_stream");b.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(c.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":"")+(c.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?" -webkit-object-fit:cover; -moz-object-fit:cover;-o-object-fit:cover;-ms-object-fit:cover;object-fit:cover;":
""));b.video.setAttribute("autoplay","autoplay");b.video.setAttribute("webkit-playsinline","true");b.video.setAttribute("x-webkit-airplay","true");b.video.setAttribute("playsinline","true");b.video.setAttribute("x5-video-player-type","h5");b.video.setAttribute("x5-video-player-fullscreen","true");b.videoSupernatant=document.createElement("div");b.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");b.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");
b.updateVideoPlayerOptions=function(a){if(a&&"object"===typeof a&&(void 0!==a.mirror&&(c.options.mirror=a.mirror,b.video.style.webkitTransform=a.mirror?"rotateY(180deg)":"",b.video.style.mozTransform=a.mirror?"rotateY(180deg)":"",b.video.style.oTransform=a.mirror?"rotateY(180deg)":"",b.video.style.msTransform=a.mirror?"rotateY(180deg)":"",b.video.style.transform=a.mirror?"rotateY(180deg)":""),void 0!==a.mode&&(c.options.mode=a.mode,b.video.style.webkitObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?
"cover":"",b.video.style.mozObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",b.video.style.oObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",b.video.style.msObjectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":"",b.video.style.objectFit=a.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"cover":""),void 0!==a.loader))if(c.options.loader=a.loader,c.options.loader&&!b.loader)b.loader=document.createElement("div"),b.loader.setAttribute("id","back_"+
b.id),b.loader.setAttribute("class","Talk_loader"),b.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,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")  no-repeat center center ;background-size: cover;z-index:1;'),
f?b.showLoading():b.hideLoading();else if(!c.options.loader&&b.loader){try{b.div.removeChild(b.loader)}catch(k){L.Logger.error("[tk-sdk]VideoPlayer removeChild error:",k)}b.loader=void 0}};b.showVideoContainer=function(){b.container&&(b.container.style.display="block")};b.hideVideoContainer=function(){b.container&&(b.container.style.display="none")};b.showVideo=function(){b.video&&(b.video.style.display="block");f&&b.loader&&(b.loader.style.display="")};b.hideVideo=function(){b.video&&(b.video.style.display=
"none");f&&b.loader&&(b.loader.style.display="")};b.changeMediaStreamUrl=function(a){b.video&&a&&(b.video.srcObject=null,b.video.src="",b.videoPlayerMediaStreamClone=a,b.videoPlayerMediaStreamClone&&"object"===typeof b.videoPlayerMediaStreamClone&&b.videoPlayerMediaStreamClone.playbackquUrl?(L.Logger.debug("[tk-sdk]Creating palyback URL from stream:",b.videoPlayerMediaStreamClone),b.videoPlayerMediaStreamCloneUrl=b.videoPlayerMediaStreamClone.playbackquUrl):b.videoPlayerMediaStreamClone&&(L.Logger.debug("[tk-sdk]Creating URL from stream: ",
b.videoPlayerMediaStreamClone),b.videoPlayerMediaStreamCloneUrl=(window.URL||webkitURL).createObjectURL(b.videoPlayerMediaStreamClone)),b.videoPlayerMediaStreamClone&&void 0!==b.video.srcObject?(b.video.srcObject=b.videoPlayerMediaStreamClone,b.video.load()):b.videoPlayerMediaStreamCloneUrl&&(b.video.src=b.videoPlayerMediaStreamCloneUrl,b.video.load()))};b.setMute=function(a){"boolean"!==typeof a?L.Logger.error("[tk-sdk]Stream setMute isMute type must is boolean!"):(b.local&&"video"===b.type?(L.Logger.debug("[tk-sdk]videoPlayer setMute:local video must is mute!"),
g=!0):g=a,b.video&&void 0!==b.video.muted&&(b.video.muted=g),b.audio&&void 0!==b.audio.muted&&(b.audio.muted=g))};b.setVolume=function(c){"number"!==typeof c?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):(b.local&&"video"===b.type?(L.Logger.debug("[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),a=0):a=c,b.video&&void 0!==b.video.volume&&(b.video.volume=a/100),b.audio&&void 0!==b.audio.volume&&(b.audio.volume=a/100))};b.getVolume=function(c){if(c&&
"function"===typeof c){if(b.video&&void 0!==b.video.volume)return c(parseInt(100*b.video.volume)),parseInt(100*b.video.volume);L.Logger.warning("[tk-sdk]videoPlayer getVolume failure , video is not exist!");c(a);return a}L.Logger.warning("[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!");return a};b.hideLoading=function(){f=!1;b.loader&&(b.loader.style.display="none");b.div.style.backgroundColor="transparent"};b.showLoading=function(){f=!0;b.loader&&(b.loader.style.display=
"");b.div.style.backgroundColor=""};TK.isOnlyAudioRoom&&b.hideVideo();b.local&&"video"===b.type&&(b.setVolume(0),b.setMute(!0));b.container=void 0!==b.elementID?"object"===typeof b.elementID&&"function"===typeof b.elementID.appendChild?b.elementID:document.getElementById(b.elementID):document.body;b.container.appendChild(b.div);b.loader&&(f?b.showLoading():b.hideLoading(),b.div.appendChild(b.loader));b.div.appendChild(b.video);b.div.appendChild(b.videoSupernatant);b.containerWidth=0;b.containerHeight=
0;b.videoPlayerMediaStreamClone&&void 0!==b.video.srcObject?(b.video.srcObject=b.videoPlayerMediaStreamClone,b.video.load()):b.videoPlayerMediaStreamCloneUrl&&(b.video.src=b.videoPlayerMediaStreamCloneUrl,b.video.load());var p=function(){if(b.video&&0!==b.video.readyState&&b.audio){if(b.div&&b.div.removeChild&&b.audio){b.audio.src="";b.audio.srcObject=null;try{b.div.removeChild(b.audio)}catch(v){L.Logger.error("[tk-sdk]VideoPlayer removeChild error:",v)}}b.audio=void 0;if(b.audioMeidaStream&&L.Utils.isFunction(b.audioMeidaStream.getTracks))for(var a=
0,d=b.audioMeidaStream.getTracks().length;a<d;a++)b.audioMeidaStream.getTracks()[a].stop();b.audioMeidaStream=void 0}b.video&&0!==b.video.readyState&&(q||(q=!0,TK.roomInstance&&!c.deviceCheck&&(a=c.stream&&L.Utils.isFunction(c.stream.publisherId)&&c.stream.publisherId(),"_local_default_extension_id_"===a&&(a=""),d=b.type,a=TK.RoomEvent({type:"room-first-audio-frame",message:{userId:a,mediaType:d}}),TK.roomInstance.dispatchEvent(a))),n||(n=!0,TK.roomInstance&&!c.deviceCheck&&(a=c.stream&&L.Utils.isFunction(c.stream.publisherId)&&
c.stream.publisherId(),"_local_default_extension_id_"===a&&(a=""),d=b.type,a=TK.RoomEvent({type:"room-first-video-frame",message:{userId:a,mediaType:d,width:b.video&&b.video.videoWidth||0,height:b.video&&b.video.videoHeight||0}}),TK.roomInstance.dispatchEvent(a))))};b.video.oncanplay=function(a){b.hideLoading();b.video.oncanplay=void 0;b.video.onloadeddata=void 0;b.video.onloadedmetadata=void 0;p()};b.video.onloadeddata=function(a){b.hideLoading();b.video.oncanplay=void 0;b.video.onloadeddata=void 0;
b.video.onloadedmetadata=void 0;p()};b.video.onloadedmetadata=function(a){b.hideLoading();b.video.oncanplay=void 0;b.video.onloadeddata=void 0;b.video.onloadedmetadata=void 0;p()};b.video.onreadystatechange=function(a){p()};if(b.videoPlayerMediaStreamClone){if("object"!==typeof b.videoPlayerMediaStreamClone||!b.videoPlayerMediaStreamClone.playbackquUrl){var m=b.videoPlayerMediaStreamClone.getVideoTracks?b.videoPlayerMediaStreamClone.getVideoTracks():void 0;m&&0<m.length||(L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not videoTracks , hide video element , VideoPlayer id is "+
b.id+"!"),b.hideVideo())}}else L.Logger.warning("[tk-sdk]TK.VideoPlayer stream is not exist , hide video element , VideoPlayer id is "+b.id+"!"),b.hideVideo();var r=function(){try{if(!d&&b&&b.video&&0===b.video.readyState&&!b.local&&(t=setTimeout(function(){if(b&&b.video&&0===b.video.readyState&&b.videoPlayerMediaStreamCloneUrl&&b.div){b.audio=document.createElement("audio");b.audio.setAttribute("id","stream_temp_audio_"+b.id);b.audio.setAttribute("autoplay","autoplay");b.audio.style.display="none";
b.audio.oncanplay=function(){b.audio.oncanplay=void 0;if(!q&&(q=!0,TK.roomInstance&&!c.deviceCheck)){var a=c.stream&&L.Utils.isFunction(c.stream.publisherId)&&c.stream.publisherId();"_local_default_extension_id_"===a&&(a="");a=TK.RoomEvent({type:"room-first-audio-frame",message:{userId:a,mediaType:b.type}});TK.roomInstance.dispatchEvent(a)}};b.div.appendChild(b.audio);var a=b.videoPlayerMediaStreamCloneUrl;b.audioMeidaStream=L.Utils.cloneMediaStream(b.videoPlayerMediaStreamClone,!0,!1);b.audioMeidaStream&&
(a=(window.URL||webkitURL).createObjectURL(b.audioMeidaStream));b.audioMeidaStream&&void 0!==b.audio.srcObject?(b.audio.srcObject=b.audioMeidaStream,b.audio.load()):a&&(b.audio.src=a,b.audio.load());b.local&&"video"===b.type&&(b.setVolume(0),b.setMute(!0));var d=function(){if(b.audio&&b.audio.play){var a=L.Utils.mediaPlay(b.audio);a&&a.catch&&a.catch(function(a){L.Logger.warning("[tk-sdk]audio.play method catch error , videoPlayer id is "+b.id+" , error info:"+a)})}};(a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))?
TK.DeviceMgr.setElementSinkIdToAudioouputDevice(b.audio,a,function(){d()}):d()}},250)),b&&b.video&&b.video.play){var a=L.Utils.mediaPlay(b.video);a&&a.catch&&a.catch(function(a){L.Logger.warning("[tk-sdk]video.play method catch error , videoPlayer id is "+b.id+" , error info:"+a)})}}catch(k){L.Logger.warning("[tk-sdk]video.play method error , videoPlayer id is "+(b?b.id:"undefined")+" !")}};m=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);b.video&&m?TK.DeviceMgr.setElementSinkIdToAudioouputDevice(b.video,
m,function(){r()}):r();return b};window.TK=window.TK||{};
TK.NativeVideoPlayer=function(c){c.options=c.options||{};c.options.bar=void 0!==c.options.bar?c.options.bar:!1;c.options.mirror=c.options.mirror||!1;c.options.mode=c.options.mode||window.TK_VIDEO_MODE.ASPECT_RATIO_CONTAIN;c.options.loader=L.Utils.isBoolean(c.options.loader)?c.options.loader:!0;var d=void 0!==c.options.audioPlayer?c.options.audioPlayer:!1,b=TK.EventDispatcher({}),a=100,g=!1,f=c.options.loader;b.id=c.id;b.local=c.stream.local;b.videoPlayerMediaStreamClone=c.stream.stream;b.type=c.stream&&
c.stream.getAttributes&&c.stream.getAttributes()?c.stream.getAttributes().type:void 0;b.elementID=c.elementID;b.onRemoteAudioVolume=function(a){};b.onMicVolumeReport=function(a){};b.destroy=function(){try{b.container.removeChild(b.div)}catch(t){L.Logger.error("[tk-sdk]NativeVideoPlayer removeChild error:",t)}b=b.videoPlayerMediaStreamClone=void 0};b.div=document.createElement("div");b.div.setAttribute("id","player_"+b.id);b.div.setAttribute("class","Talk_player");b.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"+
(d?"  display: none;":" "));c.options.loader&&(b.loader=document.createElement("div"),b.loader.setAttribute("id","back_"+b.id),b.loader.setAttribute("class","Talk_loader"),b.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,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")  no-repeat center center ;background-size: cover;z-index:1;'));
b.video=document.createElement("embed");b.video.setAttribute("id",b.id);b.video.setAttribute("class","Talk_stream");b.video.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:#000; "+(c.options.mirror?" -webkit-transform: rotateY(180deg); -moz-transform: rotateY(180deg);-o-transform: rotateY(180deg);-ms-transform: rotateY(180deg);transform: rotateY(180deg);":""));b.video.setAttribute("tk-render-mode",c.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":
"ASPECT_RATIO_CONTAIN");b.video.setAttribute("type","application/x-ppapi-proxy");b.videoSupernatant=document.createElement("div");b.videoSupernatant.setAttribute("class","Talk_stream_videoSupernatant");b.videoSupernatant.setAttribute("style","width: 100%; height: 100%; position: absolute;background-color:transparent;left:0;top:0;");b.updateVideoPlayerOptions=function(a){if(a&&"object"===typeof a&&(void 0!==a.mirror&&(c.options.mirror=a.mirror,b.video.style.webkitTransform=a.mirror?"rotateY(180deg)":
"",b.video.style.mozTransform=a.mirror?"rotateY(180deg)":"",b.video.style.oTransform=a.mirror?"rotateY(180deg)":"",b.video.style.msTransform=a.mirror?"rotateY(180deg)":"",b.video.style.transform=a.mirror?"rotateY(180deg)":""),void 0!==a.mode&&(c.options.mode=a.mode,b.video.setAttribute("tk-render-mode",c.options.mode===window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"),window.tknative.postMessage({command:"updateRenderMode",args:{connections:[b.id],mode:c.options.mode===
window.TK_VIDEO_MODE.ASPECT_RATIO_COVER?"ASPECT_RATIO_COVER":"ASPECT_RATIO_CONTAIN"}})),void 0!==a.loader))if(c.options.loader=a.loader,c.options.loader&&!b.loader)b.loader=document.createElement("div"),b.loader.setAttribute("id","back_"+b.id),b.loader.setAttribute("class","Talk_loader"),b.loader.setAttribute("style",'width:35px;height: 35px;position: absolute;top: 50%;left: 50%;margin-top:-17.5px;margin-left: -17.5px;background: url("data:image/gif;base64,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")  no-repeat center center ;background-size: cover;z-index:1;'),
f?b.showLoading():b.hideLoading();else if(!c.options.loader&&b.loader){try{b.div.removeChild(b.loader)}catch(q){L.Logger.error("[tk-sdk]NativeVideoPlayer removeChild error:",q)}b.loader=void 0}};b.showVideo=function(){b.video&&(b.video.style.opacity=1);f&&(b.loader&&(b.loader.style.display=""),b.div.style.backgroundColor="")};b.hideVideo=function(){b.video&&(b.video.style.opacity=0);f&&(b.loader&&(b.loader.style.display=""),b.div.style.backgroundColor="")};b.setMute=function(c){"boolean"!==typeof c?
L.Logger.error("[tk-sdk]Stream setMute isMute type must is boolean!"):(b.local&&"video"===b.type?(L.Logger.debug("[tk-sdk]videoPlayer setMute:local video must is mute!"),g=!0):g=c,g?window.tknative.postMessage({command:"setEmbedVolume",connectionId:b.id,volume:0}):window.tknative.postMessage({command:"setEmbedVolume",connectionId:b.id,volume:a}))};b.setVolume=function(c){"number"!==typeof c?L.Logger.error("[tk-sdk]Stream setVolume volume type must is number!"):(c*=2.55,b.local&&"video"===b.type?(L.Logger.debug("[tk-sdk]videoPlayer setVolume:local video must is mute , volume must is 0!"),
a=0):a=c,window.tknative.postMessage({command:"setEmbedVolume",connectionId:b.id,volume:c}))};b.getVolume=function(b){if(b&&"function"===typeof b){if(TK.isTkNative)return b(a),a}else return L.Logger.warning("[tk-sdk]videoPlayer getVolume callback is not exist , callback must is function!"),a};b.hideLoading=function(){f=!1;b.loader&&(b.loader.style.display="none");b.div.style.backgroundColor="transparent"};b.showLoading=function(){f=!0;b.loader&&(b.loader.style.display="");b.div.style.backgroundColor=
""};TK.isOnlyAudioRoom&&b.hideVideo();b.local&&"video"===b.type&&(b.setVolume(0),b.setMute(!0));b.container=void 0!==b.elementID?"object"===typeof b.elementID&&"function"===typeof b.elementID.appendChild?b.elementID:document.getElementById(b.elementID):document.body;b.container.appendChild(b.div);b.loader&&(f?b.showLoading():b.hideLoading(),b.div.appendChild(b.loader));b.div.appendChild(b.video);b.div.appendChild(b.videoSupernatant);b.containerWidth=0;b.containerHeight=0;d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);
b.video&&d&&TK.DeviceMgr.setElementSinkIdToAudioouputDevice(b.video,d);b.hideLoading();return b};window.L=window.L||{};
L.Constant=function(){return{roomError:{ROOMCONNECTERROR:0,GETCONFIGERROR:1,GETFILELISTERROR:2,CHECKROOMERROR:3},getUserMedia:{SUCCESS_ONLY_VIDEO:1,SUCCESS_ONLY_AUDIO:2,SUCCESS_ALL:3,SUCCESS_NOT_ALL:4,FAILURE_ONLY_VIDEO:-1,FAILURE_ONLY_AUDIO:-2,FAILURE_ALL:-3,FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO:0,FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO:0},accessDenied:{streamFail:0,notAudioAndVideo:1,notAudioAndVideoAndScreenOrUrlNotUndefined:2,ohterError:-1},deviceStorage:{audioinput:"audioinputDeviceId",audiooutput:"audiooutputDeviceId",
videoinput:"videoinputDeviceId"},streamReconnection:{notOnceSuccess:1,midwayReconnectionNotSuccess:2,midwayReconnectionChangePublishstate_0:3},getStats:{nativeFailure:1,pcNotGetStats:2,peerConnectionNotGetStats:3,getStatsFailure:4,getStatsError:5},udpState:{ok:1,notOnceSuccess:2},localRecord:{onlyRecordAudio:0,recordAudioAndVideo:1},LOGLEVEL:{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5}}}(L);window.L=window.L||{};L.aexInstance=void 0;
(function(){var c={cipher:function(a,b){for(var d=b.length/4-1,g=[[],[],[],[]],q=0;16>q;q++)g[q%4][Math.floor(q/4)]=a[q];g=c.addRoundKey(g,b,0,4);for(q=1;q<d;q++)g=c.subBytes(g,4),g=c.shiftRows(g,4),g=c.mixColumns(g,4),g=c.addRoundKey(g,b,q,4);g=c.subBytes(g,4);g=c.shiftRows(g,4);g=c.addRoundKey(g,b,d,4);b=Array(16);for(q=0;16>q;q++)b[q]=g[q%4][Math.floor(q/4)];return b},keyExpansion:function(a){for(var b=a.length/4,d=b+6,t=Array(4*(d+1)),q=Array(4),n=0;n<b;n++)t[n]=[a[4*n],a[4*n+1],a[4*n+2],a[4*
n+3]];for(n=b;n<4*(d+1);n++){t[n]=Array(4);for(a=0;4>a;a++)q[a]=t[n-1][a];if(0==n%b)for(q=c.subWord(c.rotWord(q)),a=0;4>a;a++)q[a]^=c.rCon[n/b][a];else 6<b&&4==n%b&&(q=c.subWord(q));for(a=0;4>a;a++)t[n][a]=t[n-b][a]^q[a]}return t},subBytes:function(a,b){for(var d=0;4>d;d++)for(var g=0;g<b;g++)a[d][g]=c.sBox[a[d][g]];return a},shiftRows:function(a,b){for(var c=Array(4),d=1;4>d;d++){for(var g=0;4>g;g++)c[g]=a[d][(g+d)%b];for(g=0;4>g;g++)a[d][g]=c[g]}return a},mixColumns:function(a,b){for(b=0;4>b;b++){for(var c=
Array(4),d=Array(4),g=0;4>g;g++)c[g]=a[g][b],d[g]=a[g][b]&128?a[g][b]<<1^283:a[g][b]<<1;a[0][b]=d[0]^c[1]^d[1]^c[2]^c[3];a[1][b]=c[0]^d[1]^c[2]^d[2]^c[3];a[2][b]=c[0]^c[1]^d[2]^c[3]^d[3];a[3][b]=c[0]^d[0]^c[1]^c[2]^d[3]}return a},addRoundKey:function(a,b,c,d){for(var f=0;4>f;f++)for(var g=0;g<d;g++)a[f][g]^=b[4*c+g][f];return a},subWord:function(a){for(var b=0;4>b;b++)a[b]=c.sBox[a[b]];return a},rotWord:function(a){for(var b=a[0],c=0;3>c;c++)a[c]=a[c+1];a[3]=b;return a},sBox:[99,124,119,123,242,107,
111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,
34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],rCon:[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,
0,0,0]],Ctr:{}};c.Ctr.encrypt=function(a,g,f){g=g||"talk_2018_@beijing_20180310_talk_2018_@beijing";f=f||256;if(128!=f&&192!=f&&256!=f)return"";a=b.encode(a);g=b.encode(g);var t=f/8,q=Array(t);for(f=0;f<t;f++)q[f]=isNaN(g.charCodeAt(f))?0:g.charCodeAt(f);q=c.cipher(q,c.keyExpansion(q));q=q.concat(q.slice(0,t-16));g=Array(16);f=(new Date).getTime();t=f%1E3;var n=Math.floor(f/1E3),p=Math.floor(65535*Math.random());for(f=0;2>f;f++)g[f]=t>>>8*f&255;for(f=0;2>f;f++)g[f+2]=p>>>8*f&255;for(f=0;4>f;f++)g[f+
4]=n>>>8*f&255;t="";for(f=0;8>f;f++)t+=String.fromCharCode(g[f]);q=c.keyExpansion(q);n=Math.ceil(a.length/16);p=Array(n);for(var m=0;m<n;m++){for(f=0;4>f;f++)g[15-f]=m>>>8*f&255;for(f=0;4>f;f++)g[15-f-4]=m/4294967296>>>8*f;var r=c.cipher(g,q),h=m<n-1?16:(a.length-1)%16+1,k=Array(h);for(f=0;f<h;f++)k[f]=r[f]^a.charCodeAt(16*m+f),k[f]=String.fromCharCode(k[f]);p[m]=k.join("")}a=t+p.join("");return a=d.encode(a)};c.Ctr.decrypt=function(a,g,f){g=g||"talk_2018_@beijing_20180310_talk_2018_@beijing";f=f||
256;if(128!=f&&192!=f&&256!=f)return"";a=d.decode(a);g=b.encode(g);var t=f/8,q=Array(t);for(f=0;f<t;f++)q[f]=isNaN(g.charCodeAt(f))?0:g.charCodeAt(f);q=c.cipher(q,c.keyExpansion(q));q=q.concat(q.slice(0,t-16));g=Array(8);t=a.slice(0,8);for(f=0;8>f;f++)g[f]=t.charCodeAt(f);t=c.keyExpansion(q);q=Math.ceil((a.length-8)/16);f=Array(q);for(var n=0;n<q;n++)f[n]=a.slice(8+16*n,16*n+24);a=f;var p=Array(a.length);for(n=0;n<q;n++){for(f=0;4>f;f++)g[15-f]=n>>>8*f&255;for(f=0;4>f;f++)g[15-f-4]=(n+1)/4294967296-
1>>>8*f&255;var m=c.cipher(g,t),r=Array(a[n].length);for(f=0;f<a[n].length;f++)r[f]=m[f]^a[n].charCodeAt(f),r[f]=String.fromCharCode(r[f]);p[n]=r.join("")}a=p.join("");return a=b.decode(a)};var d={code:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",encode:function(a,b){var c=[],g="",q=d.code;b=("undefined"==typeof b?0:b)?a.encodeUTF8():a;a=b.length%3;if(0<a)for(;3>a++;)g+="\x3d",b+="\x00";for(a=0;a<b.length;a+=3){var n=b.charCodeAt(a);var p=b.charCodeAt(a+1);var m=b.charCodeAt(a+
2);var r=n<<16|p<<8|m;n=r>>18&63;p=r>>12&63;m=r>>6&63;r&=63;c[a/3]=q.charAt(n)+q.charAt(p)+q.charAt(m)+q.charAt(r)}c=c.join("");return c=c.slice(0,c.length-g.length)+g},decode:function(a,b){b="undefined"==typeof b?!1:b;var c=[],g=d.code;var q=b?a.decodeUTF8():a;for(var n=0;n<q.length;n+=4){var p=g.indexOf(q.charAt(n));var m=g.indexOf(q.charAt(n+1));a=g.indexOf(q.charAt(n+2));var r=g.indexOf(q.charAt(n+3));var h=p<<18|m<<12|a<<6|r;p=h>>>16&255;m=h>>>8&255;h&=255;c[n/4]=String.fromCharCode(p,m,h);64==
r&&(c[n/4]=String.fromCharCode(p,m));64==a&&(c[n/4]=String.fromCharCode(p))}c=c.join("");return b?c.decodeUTF8():c}},b={encode:function(a){a=a.replace(/[\u0080-\u07ff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(192|a>>6,128|a&63)});return a=a.replace(/[\u0800-\uffff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(224|a>>12,128|a>>6&63,128|a&63)})},decode:function(a){a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&15)<<12|(a.charCodeAt(1)&
63)<<6|a.charCodeAt(2)&63;return String.fromCharCode(a)});return a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&31)<<6|a.charCodeAt(1)&63;return String.fromCharCode(a)})}};L.aexInstance=c.Ctr})();
L.Utils=function(){var c=void 0,d=!1,b=!1;c={handleMediaPlayOnEvent:function(a,b){try{if(L.Utils.removeEvent(a,"canplay",c.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadedmetadata",c.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadeddata",c.handleMediaPlayOnEvent.bind(null,a,b)),a&&a.play&&"function"===typeof a.play){var d=a.play();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(c){L.Logger.error("[tk-sdk]media play err:",L.Utils.toJsonStringify(c),
b?" , media element id is "+b:" media element:",b?"":a)})}}catch(t){L.Logger.error("[tk-sdk]media play error:",L.Utils.toJsonStringify(t),b?" , media element id is "+b:" media element:",b?"":a)}},handleMediaPauseOnEvent:function(a,b){try{if(L.Utils.removeEvent(a,"canplay",c.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadedmetadata",c.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadeddata",c.handleMediaPauseOnEvent.bind(null,a,b)),a&&a.pause&&"function"===typeof a.pause){var d=
a.pause();d&&d.catch&&"function"===typeof d.catch&&d.catch(function(c){L.Logger.error("[tk-sdk]media pause err:",L.Utils.toJsonStringify(c),b?" , media element id is "+b:" media element:",b?"":a)})}}catch(t){L.Logger.error("[tk-sdk]media pause error:",L.Utils.toJsonStringify(t),b?" , media element id is "+b:" media element:",b?"":a)}}};return{addEvent:function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,void 0!=d&&null!=d?d:!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,
b,c,d){a.removeEventListener?a.removeEventListener(b,c,void 0!=d&&null!=d?d:!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},toJsonStringify:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("object"!==typeof a)return a;var c=JSON.stringify(a);c?a=c:L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}catch(t){L.Logger.debug("[tk-sdk]toJsonStringify:data is not json!")}return a},toJsonParse:function(a,b){if(void 0!=b&&!b||!a)return a;try{if("string"!==typeof a)return a;var c=JSON.parse(a);
c?a=c:L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}catch(t){L.Logger.debug("[tk-sdk]toJsonParse:data is not json string!")}return a},encrypt:function(a,b,c,d){if(!a)return a;c=c||TK.hexEncryptDecryptKey;d=d||TK.hexEncryptDecryptBit;b=void 0!=b?b:"talk_2018_@beijing";a=L.aexInstance.encrypt(a,c,d);return b+a+b},decrypt:function(a,b,c,d){if(!a)return a;c=c||TK.hexEncryptDecryptKey;d=d||TK.hexEncryptDecryptBit;a=a.replace(new RegExp(void 0!=b?b:"talk_2018_@beijing","gm"),"");return L.aexInstance.decrypt(a,
c,d)},mediaPlay:function(a){var b=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(b=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&(0!==a.readyState?c.handleMediaPlayOnEvent(a,b):(L.Utils.removeEvent(a,"canplay",c.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadedmetadata",c.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadeddata",
c.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"canplay",c.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadedmetadata",c.handleMediaPlayOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadeddata",c.handleMediaPlayOnEvent.bind(null,a,b))))},mediaPause:function(a){var b=void 0;a&&"string"===typeof a?a=document.getElementById(a):a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&a.getAttribute&&"function"===typeof a.getAttribute&&(b=a.getAttribute("id"));a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&
(0!==a.readyState?c.handleMediaPauseOnEvent(a,b):(L.Utils.removeEvent(a,"canplay",c.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadedmetadata",c.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.removeEvent(a,"loadeddata",c.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"canplay",c.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadedmetadata",c.handleMediaPauseOnEvent.bind(null,a,b)),L.Utils.addEvent(a,"loadeddata",c.handleMediaPauseOnEvent.bind(null,a,
b))))},localStorage:{setItem:function(a,b){try{window.localStorage?window.localStorage.setItem?window.localStorage.setItem(a,b):L.Logger.warning("[tk-sdk]Browser does not support localStorage.setItem , key is "+a+" , value is "+b+"!"):d||(d=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"))}catch(f){d||(d=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(f)))}},getItem:function(a){try{if(window.localStorage){if(window.localStorage.getItem)return window.localStorage.getItem(a);
L.Logger.warning("[tk-sdk]Browser does not support localStorage.getItem , key is "+a+" !");return""}d||(d=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"));return""}catch(g){return d||(d=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(g))),""}},removeItem:function(a){try{if(window.localStorage){if(window.localStorage.removeItem)return window.localStorage.removeItem(a);L.Logger.warning("[tk-sdk]Browser does not support localStorage.removeItem , key is "+
a+" !");return""}d||(d=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage!"));return""}catch(g){return d||(d=!0,L.Logger.warning("[tk-sdk]Browser does not support localStorage , error info:",L.Utils.toJsonStringify(g))),""}}},sessionStorage:{setItem:function(a,c){try{window.sessionStorage?window.sessionStorage.setItem?window.sessionStorage.setItem(a,c):L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.setItem , key is "+a+" , value is "+c+"!"):b||(b=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"))}catch(f){b||
(b=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(f)))}},getItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.getItem)return window.sessionStorage.getItem(a);L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.getItem , key is "+a+" !");return""}b||(b=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"));return""}catch(g){return b||(b=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",
L.Utils.toJsonStringify(g))),""}},removeItem:function(a){try{if(window.sessionStorage){if(window.sessionStorage.removeItem)return window.sessionStorage.removeItem(a);L.Logger.warning("[tk-sdk]Browser does not support sessionStorage.removeItem , key is "+a+" !");return""}b||(b=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage!"));return""}catch(g){return b||(b=!0,L.Logger.warning("[tk-sdk]Browser does not support sessionStorage , error info:",L.Utils.toJsonStringify(g))),""}}},getBrowserInfo:function(){var a=
/(msie\s|trident.*rv:)([\w.]+)/,b=/edge\/(\d+).(\d+)$/,c=/(firefox)\/([\w.]+)/,d=/(opera).+version\/([\w.]+)/,q=/(chrome)\/([\w.]+)/,n=/version\/([\w.]+).*(safari)/,p=function(f){var h=a.exec(f);return h?{browser:"IE",version:h[2]||"0"}:(h=b.exec(f))?{browser:"Edge",version:h[2]||"0"}:(h=c.exec(f))?{browser:h[1]||"Firefox",version:h[2]||"0"}:(h=d.exec(f))?{browser:h[1]||"Opera",version:h[2]||"0"}:(h=q.exec(f))?{browser:h[1]||"Chrome",version:h[2]||"0"}:(h=n.exec(f))?{browser:h[2]||"Safari",version:h[1]||
"0"}:{browser:"unknown",version:"unknown"}}(window.navigator.userAgent.toLowerCase()),m=navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||navigator.language;return{versions:function(){var a=navigator.userAgent;return{edge:-1<a.indexOf("Edge"),trident:-1<a.indexOf("Trident"),presto:-1<a.indexOf("Presto"),webKit:-1<a.indexOf("AppleWebKit"),gecko:-1<a.indexOf("Gecko")&&-1==a.indexOf("KHTML"),mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
android:-1<a.indexOf("Android")||-1<a.indexOf("Linux"),iPhone:-1<a.indexOf("iPhone"),iPad:-1<a.indexOf("iPad"),webApp:-1==a.indexOf("Safari")}}(),language:m?m.toLowerCase():void 0,info:{browserName:p.browser,browserVersion:p.version,appCodeName:navigator.appCodeName,appMinorVersion:navigator.appMinorVersion,appName:navigator.appName,appVersion:navigator.appVersion,browserLanguage:navigator.browserLanguage,cookieEnabled:navigator.cookieEnabled,cpuClass:navigator.cpuClass,onLine:navigator.onLine,platform:navigator.platform,
systemLanguage:navigator.systemLanguage,userAgent:navigator.userAgent,userLanguage:navigator.userLanguage}}},getJsonLength:function(a){var b=0;if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&++b;return b},detectOS:function(){try{var a=navigator.userAgent,b="Win32"===navigator.platform||"Windows"===navigator.platform,c="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(c)return"Mac";if("X11"===navigator.platform&&
!b&&!c)return"Unix";if(-1<String(navigator.platform).indexOf("Linux"))return"Linux";if(b){if(-1<a.indexOf("Windows NT 5.0")||-1<a.indexOf("Windows 2000"))return"Win2000";if(-1<a.indexOf("Windows NT 5.1")||-1<a.indexOf("Windows XP"))return"WinXP";if(-1<a.indexOf("Windows NT 5.2")||-1<a.indexOf("Windows 2003"))return"Win2003";if(-1<a.indexOf("Windows NT 6.0")||-1<a.indexOf("Windows Vista"))return"WinVista";if(-1<a.indexOf("Windows NT 6.1")||-1<a.indexOf("Windows 7"))return"Win7";if(-1<a.indexOf("Windows NT 6.2")||
-1<a.indexOf("Windows 8"))return"Win8";if(-1<a.indexOf("Windows NT 10.0")||-1<a.indexOf("Windows 10"))return"Win10"}return"Other"}catch(t){return L.Logger.error("[tk-sdk]detectOS method error:",t),"Other"}},isFunction:function(a){return"function"===typeof a},isString:function(a){return"string"===typeof a},isNumber:function(a){return"number"===typeof a},isBoolean:function(a){return"boolean"===typeof a},isNull:function(a){return!a&&0!==a&&"boolean"!==typeof a},getFileName:function(a){if("string"!==
typeof a)return"";var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");return a.substring(Math.max(b,c)+1)},cloneMediaStream:function(a,b,c){b="boolean"===typeof b?b:!0;c="boolean"===typeof c?c:!0;if(!a)return a;var d=function(){var d=a&&"function"===typeof a.clone?a.clone():void 0;if(!d)return a;if(d&&0<d.getTracks().length)for(var f=d.getTracks().length-1;0<=f;f--){var g=d.getTracks()[f];g.stop();d.removeTrack(g)}d=d&&"function"===typeof d.clone?d.clone():void 0;if(!d)return a;if(b&&0<a.getAudioTracks().length)for(f=
0,g=a.getAudioTracks().length;f<g;f++){var m=a.getAudioTracks()[f];d.addTrack(L.Utils.isFunction(m.clone)?m.clone():m)}if(c&&0<a.getVideoTracks().length)for(f=0,g=a.getVideoTracks().length;f<g;f++)m=a.getVideoTracks()[f],d.addTrack(L.Utils.isFunction(m.clone)?m.clone():m);return d};if(window.MediaStream&&"function"===typeof window.MediaStream)try{var f=new window.MediaStream;if(b&&0<a.getAudioTracks().length)for(var g=0,p=a.getAudioTracks().length;g<p;g++){var m=a.getAudioTracks()[g];f.addTrack(L.Utils.isFunction(m.clone)?
m.clone():m)}if(c&&0<a.getVideoTracks().length)for(g=0,p=a.getVideoTracks().length;g<p;g++){var r=a.getVideoTracks()[g];f.addTrack(L.Utils.isFunction(r.clone)?r.clone():r)}return f}catch(h){return d()}else return d()}}}(L);window.TK=window.TK||{};window.TK_ERR={DEVICE_ERROR_UnknownError:1E4,DEVICE_ERROR_NotFoundError:10001,DEVICE_ERROR_NotAllowedError:10002,DEVICE_ERROR_NotReadableError:10003,DEVICE_ERROR_OverconstrainedError:10004,DEVICE_ERROR_TypeError:10005,TIMEOUT_ERROR:10006};window.TK_VIDEO_MODE={ASPECT_RATIO_CONTAIN:20001,ASPECT_RATIO_COVER:20002};window.TK.ROOM_ROLE={TEACHER:0,ASSISTANT:1,STUDENT:2,AUDIT:3,PATROL:4,SYSTEM_ADMIN:10,ENTERPRISE_ADMIN:11,ADMIN:12,PLAYBACK:-1};
window.TK.ROOM_MODE={NORMAL_ROOM:"normalRoom",BIG_ROOM:"bigRoom"};
window.TK.ERROR_NOTICE={PUBLISH_AUDIO_VIDEO_FAILURE:40001,SHARE_MEDIA_FAILURE:40003,SHARE_FILE_FAILURE:40004,SHARE_SCREEN_FAILURE:40005,SUBSCRIBE_AUDIO_VIDEO_FAILURE:40007,SUBSCRIBE_MEDIA_FAILURE:40008,SUBSCRIBE_FILE_FAILURE:40009,SUBSCRIBE_SCREEN_FAILURE:40010,UNSUBSCRIBE_AUDIO_VIDEO_FAILURE:40013,UNSUBSCRIBE_MEDIA_FAILURE:40014,UNSUBSCRIBE_FILE_FAILURE:40015,UNSUBSCRIBE_SCREEN_FAILURE:40016,UNPUBLISH_AUDIO_VIDEO_FAILURE:40019,STOP_MEDIA_FAILURE:40020,STOP_FILE_FAILURE:40021,STOP_SCREEN_FAILURE:40022,
UDP_CONNECTION_FAILED:40023,UDP_CONNECTION_INTERRUPT:40024};window.TK.NET_QUALITY={TK_NET_QUALITY_EXCELLENT:1,TK_NET_QUALITY_GOOD:2,TK_NET_QUALITY_ACCEPTED:3,TK_NET_QUALITY_BAD:4,TK_NET_QUALITY_VERYBAD:5};window.TK.MEDIA_TYPE={DEVICE_AV:"video",FILE:"file",SCREEN:"screen",MEDIA:"media"};window.TK=window.TK||{};TK.mediaStream=void 0;
TK.DeviceMgr=function(){function c(a,b,c){if(TK.roomInstance){var d=void 0,f="",h=window.TK_ERR.DEVICE_ERROR_UnknownError,g={};if("object"===typeof a){f=a.name;for(var k in a)if("code"===k||"name"===k||"message"===k)g[k]=a[k]}switch(f){case "NotFoundError":case "DevicesNotFoundError":h=window.TK_ERR.DEVICE_ERROR_NotFoundError;break;case "NotAllowedError":case "PermissionDeniedError":h=window.TK_ERR.DEVICE_ERROR_NotAllowedError;break;case "NotReadableError":case "TrackStartError":h=window.TK_ERR.DEVICE_ERROR_NotReadableError;
break;case "OverconstrainedError":case "ConstraintNotSatisfiedError":h=window.TK_ERR.DEVICE_ERROR_OverconstrainedError;break;case "TypeError":h=window.TK_ERR.DEVICE_ERROR_UnknownError,d={causeCode:window.TK_ERR.DEVICE_ERROR_TypeError,causeInfo:g}}L.Logger.warning("[tk-sdk]device-not-available , error code is "+h+"  , kind is "+b+" , deviceId is "+c+",errorInfo:"+L.Utils.toJsonStringify(g));a={kind:b,deviceId:c};d&&(a.detailsInfo=d);d=TK.RoomEvent({type:"device-not-available",message:a},{code:h});
TK.roomInstance.dispatchEvent(d)}}function d(a,b,c,d){var h={};b=b||{};for(var g in b)L.Constant.deviceStorage[g]&&b[g]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[g])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[g],b[g]),h[g]=!0);!h.videoinput&&!h.audioinput&&TK&&TK.default_stream&&TK.default_stream.stream&&(b.videoinput&&TK.default_stream.stream.getVideoTracks&&TK.default_stream.stream.getVideoTracks()&&0===TK.default_stream.stream.getVideoTracks().length&&(h.videoinput=!0),
b.audioinput&&TK.default_stream.stream.getAudioTracks&&TK.default_stream.stream.getAudioTracks()&&0===TK.default_stream.stream.getAudioTracks().length&&(h.audioinput=!0));h.audiooutput&&f.setElementSinkIdToAudioouputDevice(d);h.videoinput||h.audioinput?f.getUserMedia(function(b){a&&"function"===typeof a&&a(b);c&&"function"===typeof c&&c(b,0)},function(a){c&&"function"===typeof c&&c(void 0,0)},void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,isStopLocalStream:!1}):h.audiooutput?c&&
"function"===typeof c&&c(void 0,1):c&&"function"===typeof c&&c(void 0,2)}function b(a,b,c){b=void 0!==b?b:!0;c=void 0!==c?c:!0;if(b&&c&&a&&a.getTracks&&"function"===typeof a.getTracks){if((a=a.getTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}else{if(b&&a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(b=a.getVideoTracks())&&0<b.length)for(var d=0;d<b.length;d++)b[d]&&b[d].stop&&"function"===typeof b[d].stop&&b[d].stop();if(c&&a&&
a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(c=0;c<a.length;c++)a[c]&&a[c].stop&&"function"===typeof a[c].stop&&a[c].stop()}}function a(a,b,c,d){d=d||{};a?b?(a.videoPlayer&&a.videoPlayer.destroy&&a.videoPlayer.destroy(),a.videoPlayer=TK.VideoPlayer({id:"deviceStream_"+(new Date).getTime(),stream:{stream:a},elementID:b,options:d,deviceCheck:!0}),"function"===typeof c&&c(a.videoPlayer)):L.Logger.error("[tk-sdk]playDeviceStream elementID can not be empty!"):
L.Logger.error("[tk-sdk]playDeviceStream stream can not be empty!")}function g(a){a?a&&a.videoPlayer&&a.videoPlayer.destroy&&(a.videoPlayer.destroy(),a.videoPlayer=void 0,delete a.videoPlayer):L.Logger.error("[tk-sdk]unplayDeviceStream stream can not be empty!")}var f={room_video_width:320,room_video_height:240,room_video_fps:10,streamJson:{selectStream:void 0},onDevicesSetted:null,onDeviceChanged:null},t={},q={},n=void 0;f.setAVMgrProperty=function(a){for(var b in a)f.hasOwnProperty(b)&&(f[b]=a[b])};
var p=function(a,b,c){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(a).then(b).catch(c):(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getMedia(a,b,c))},m=function(a,d,h){L.Logger.debug("[tk-sdk]checkGetUserMediaing , videoinputDeviceId:"+d+" , audioinputDeviceId:"+h);a&&"function"===typeof a||L.Logger.error("[tk-sdk]checkGetUserMedia callback must function");
var g=!1,k=!1,m,r,v=function(){g&&k&&a({videoinput:{old:d,now:m},audioinput:{old:h,now:r}})},n=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia video finshed , videoinputDeviceId:"+d+" , successVideoinputId:"+a);g=!0;m=a;v()},q=function(a){L.Logger.debug("[tk-sdk]checkGetUserMedia audio finshed , audioinputDeviceId:"+h+" , successAudioinputId:"+a);k=!0;r=a;v()};p({audio:{deviceId:{exact:h}},video:{deviceId:{exact:d}}},function(a){b(a,!0,!0);n(d);q(h)},function(a){p({audio:!1,video:{deviceId:{exact:d}}},
function(a){b(a,!0,!1);n(d)},function(a){c(a,"videoinput",d);f.enumerateDevices(function(a){if(a&&a.devices&&a.devices.videoinput){var c=a.devices.videoinput;if(c&&0<c.length){var d=c[0],f=function(a){p({audio:!1,video:{deviceId:{exact:a}}},function(d){c.shift();b(d,!0,!1);n(a)},function(a){c.shift();(d=c[0])?f(d.deviceId):n()})};d?f(d.deviceId):n()}else n()}else n()})});p({video:!1,audio:{deviceId:{exact:h}}},function(a){b(a,!1,!0);q(h)},function(a){c(a,"audioinput",h);f.enumerateDevices(function(a){if(a&&
a.devices&&a.devices.audioinput){var c=a.devices.audioinput;if(c&&0<c.length){var d=c[0],f=function(a){p({video:!1,audio:{deviceId:{exact:a}}},function(d){c.shift();b(d,!1,!0);q(a)},function(a){c.shift();(d=c[0])?f(d.deviceId):q()})};d?f(d.deviceId):q()}else q()}else q()})})})},r=function(a,b,d,h){var g=void 0,k,m={};var r=function(b){var d=g&&"string"===typeof g?L.Utils.toJsonParse(g):g;b.customdata_createID=(new Date).getTime();b.customdata_deviceJsonId={};d&&(d.video&&"object"===typeof d.video&&
(b.customdata_deviceJsonId.videoinput="object"===typeof d.video.deviceId?d.video.deviceId.exact:d.video.deviceId),d.audio&&"object"===typeof d.audio&&(b.customdata_deviceJsonId.audioinput="object"===typeof d.audio.deviceId?d.audio.deviceId.exact:d.audio.deviceId));f.streamJson.selectStream=b;d={videoTracks:!0,audioTracks:!0};if(b){var r=b.getVideoTracks?b.getVideoTracks():void 0,p=b.getAudioTracks?b.getAudioTracks():void 0;r&&0<r.length||(d.videoTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not videoTracks  , currUserMediaConfig info:"+
g+"!"));p&&0<p.length||(d.audioTracks=!1,L.Logger.warning("[tk-sdk]getUserMedia stream is  not audioTracks  , currUserMediaConfig info:"+g+"!"))}else L.Logger.error("[tk-sdk]getUserMedia stream is not exist!"),d.videoTracks=!1,d.audioTracks=!1;r=[];r.push(b);r.push(d);b.customdata_tracksInfo=d;h&&h.externalJson&&void 0!==h.externalJson.getUserMediaFailureCode&&(b.getUserMediaFailureCode=h.externalJson.getUserMediaFailureCode);h.isNeedCheckChangeLocalStream&&h.deviceInfo.initDeviceId.audioinput!==
b.customdata_deviceJsonId.audioinput&&(L.Logger.info("[tk-sdk]getUserMedia changed audioinput device , old device id is "+h.deviceInfo.initDeviceId.audioinput+" , now device id is "+b.customdata_deviceJsonId.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,b.customdata_deviceJsonId.audioinput||""));h.isNeedCheckChangeLocalStream&&h.deviceInfo.initDeviceId.videoinput!==b.customdata_deviceJsonId.videoinput&&(L.Logger.info("[tk-sdk]getUserMedia changed videoinput device , old device id is "+
h.deviceInfo.initDeviceId.videoinput+" , now device id is "+b.customdata_deviceJsonId.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,b.customdata_deviceJsonId.videoinput||""));h&&h.dispatchEvent&&(p=L.Constant.getUserMedia.SUCCESS_ALL,d.videoTracks||d.audioTracks?d.videoTracks?d.audioTracks||(p=L.Constant.getUserMedia.SUCCESS_ONLY_VIDEO):p=L.Constant.getUserMedia.SUCCESS_ONLY_AUDIO:p=L.Constant.getUserMedia.SUCCESS_NOT_ALL,TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_success",
message:{mediaStream:b,customdata_tracksInfo:d,code:p,externalJson:h.externalJson}},!1));h.isDemotionLocalStream&&(d=k&&"string"===typeof k?L.Utils.toJsonParse(k):k,m.videoinput&&!b.customdata_deviceJsonId.videoinput&&d.video&&"object"===typeof d.video&&c(m.videoinput,"videoinput","object"===typeof d.video.deviceId?d.video.deviceId.exact:d.video.deviceId),m.audioinput&&!b.customdata_deviceJsonId.audioinput&&d.audio&&"object"===typeof d.audio&&c(m.audioinput,"audioinput","object"===typeof d.audio.deviceId?
d.audio.deviceId.exact:d.audio.deviceId));a.apply(a,r)};var n=function(a){L.Logger.error("[tk-sdk]getUserMedia error info: name is "+a.name+" , message is "+a.message+" , constraintName is "+a.constraintName);var d=g&&"string"===typeof g?L.Utils.toJsonParse(g):g,f=k&&"string"===typeof k?L.Utils.toJsonParse(k):k;if(h.isDemotionLocalStream){if(d.video&&"object"===typeof d.video&&!h.deviceInfo.demotion.videoinput){h.deviceInfo.demotion.videoinput=!0;f.video=!1;h.externalJson.getUserMediaFailureCode=
L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO;L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the audio device stream , oldUserMediaConfig info:"+g+" , nowUserMediaConfig info:"+L.Utils.toJsonStringify(f)+"!");h&&h.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyAudioStream",message:{errorMsg:r,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_AUDIO,externalJson:h.externalJson}},
!1);m.videoinput=a;v(f);return}if(d.audio&&"object"===typeof d.audio&&!h.deviceInfo.demotion.audioinput){h.deviceInfo.demotion.audioinput=!0;f.audio=!1;h.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO;L.Logger.warning("[tk-sdk]Gets the data stream failed and now only gets the video device stream , oldUserMediaConfig info:"+g+" , nowUserMediaConfig info:"+L.Utils.toJsonStringify(f)+"!");h&&h.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure_reGetOnlyVideoStream",
message:{errorMsg:r,code:L.Constant.getUserMedia.FAILURE_USERMEDIA_AGAIN_ONLY_GET_VIDEO,externalJson:h.externalJson}},!1);m.audioinput=a;v(f);return}}var r="[tk-sdk]Gets the data stream failed[video , audio] ,currUserMediaConfig info:"+g+"!";L.Logger.warning(r);h.externalJson.getUserMediaFailureCode=L.Constant.getUserMedia.FAILURE_ALL;h&&h.dispatchEvent&&TK&&TK.coreEventController&&TK.coreEventController.dispatchEvent({type:"getUserMedia_failure",message:{errorMsg:r,code:L.Constant.getUserMedia.FAILURE_ALL,
externalJson:h.externalJson}},!1);h.isDemotionLocalStream&&(m.videoinput&&f.video&&"object"===typeof f.video&&c(m.videoinput,"videoinput","object"===typeof f.video.deviceId?f.video.deviceId.exact:f.video.deviceId),m.audioinput&&f.audio&&"object"===typeof f.audio&&c(m.audioinput,"audioinput","object"===typeof f.audio.deviceId?f.audio.deviceId.exact:f.audio.deviceId),f.audio||f.video||(c(a,"videoinput",""),c(a,"audioinput","")));if(b&&"function"===typeof b){d=[];for(f=0;f<arguments.length;f++)d[f]=
arguments[f];h&&h.externalJson&&void 0!==h.externalJson.getUserMediaFailureCode&&d.push({getUserMediaFailureCode:h.externalJson.getUserMediaFailureCode});b.apply(b,d)}};var v=function(a){g=a&&"object"===typeof a?L.Utils.toJsonStringify(a):a;k||(k=g);p(a,r,n)};v(d)},h=function(a,b){var c={video:{},audio:{}};a?(void 0!==a.audio&&(c.audio=a.audio),void 0!==a.video&&(c.video=a.video),c.audio&&"object"===typeof c.audio&&void 0!==c.audio.sourceId&&(c.audio.deviceId=c.audio.sourceId,delete c.audio.sourceId),
c.video&&"object"===typeof c.video&&void 0!==c.video.sourceId&&(c.video.deviceId=c.video.sourceId,delete c.video.sourceId)):(c.audio.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),c.video.deviceId=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput));if(c.video&&"object"===typeof c.video){a=f.room_video_width||320;var d=f.room_video_width||320,h=f.room_video_height||240,g=f.room_video_height||240,k=Number(f.room_video_fps||10),m=Number(f.room_video_fps||10);
void 0===c.video.width&&(c.video.width={ideal:a,max:d});void 0===c.video.height&&(c.video.height={ideal:h,max:g});void 0===c.video.frameRate&&(c.video.frameRate={ideal:k,max:m})}b.audio.sourceId?(c.audio="object"===typeof c.audio?c.audio:{},c.audio.deviceId=b.audio.sourceId):b.audio.deviceId&&(c.audio="object"===typeof c.audio?c.audio:{},c.audio.deviceId=b.audio.deviceId);b.video.sourceId?(c.video="object"===typeof c.video?c.video:{},c.video.deviceId=b.video.sourceId):b.video.deviceId&&(c.video="object"===
typeof c.video?c.video:{},c.video.deviceId=b.video.deviceId);b.exclude&&b.exclude.audio?c.audio=!1:c.audio&&"object"===typeof c.audio&&void 0!==c.audio.deviceId&&(c.audio.deviceId="object"!==c.audio.deviceId?{exact:c.audio.deviceId}:c.audio.deviceId);b.exclude&&b.exclude.video?c.video=!1:c.video&&"object"===typeof c.video&&void 0!==c.video.deviceId&&(c.video.deviceId="object"!==c.video.deviceId?{exact:c.video.deviceId}:c.video.deviceId);return c},k=function(a){L.Logger.debug("[tk-sdk]DeviceMgr:onDeviceChangeEvent. event:",
a);if(void 0!==f.onDeviceChanged&&null!==f.onDeviceChanged&&L.Utils.isFunction(f.onDeviceChanged))f.onDeviceChanged(a);void 0!==n&&null!==n&&L.Utils.isFunction(n)&&n(a)};f.getUserMedia=function(a,b,c,d){d=void 0!=d&&null!=d&&"object"===typeof d?d:{video:{},audio:{},exclude:{}};var g=function(){d.video=d.video||{};d.audio=d.audio||{};d.exclude=d.exclude||{};d.externalJson=d.externalJson||{};d.deviceInfo={initDeviceId:{videoinput:void 0,audioinput:void 0},demotion:{videoinput:!1,audioinput:!1}};c=h(c,
d);c.audio&&"object"===typeof c.audio&&(d.deviceInfo.initDeviceId.audioinput="object"===typeof c.audio.deviceId?c.audio.deviceId.exact:c.audio.deviceId);c.video&&"object"===typeof c.video&&(d.deviceInfo.initDeviceId.videoinput="object"===typeof c.video.deviceId?c.video.deviceId.exact:c.video.deviceId);!d.isNeedCheckChangeLocalStream&&TK.isInnerVersions&&(c.video&&"object"===typeof c.video&&("object"===typeof c.video.deviceId?c.video.deviceId.exact||(c.video=!1):c.video.deviceId||(c.video=!1)),c.audio&&
"object"===typeof c.audio&&("object"===typeof c.audio.deviceId?c.audio.deviceId.exact||(c.audio=!1):c.audio.deviceId||(c.audio=!1)));d.isNeedCheckChangeLocalStream?m(function(f){var h=f.videoinput;f=f.audioinput;c.video&&"object"===typeof c.video&&h.old!==h.now?h.now?c.video.deviceId={exact:h.now}:c.video=!1:h.old||(c.video=!1);c.audio&&"object"===typeof c.audio&&f.old!==f.now?f.now?c.audio.deviceId={exact:f.now}:c.audio=!1:f.old||(c.audio=!1);r(a,b,c,d)},d.deviceInfo.initDeviceId.videoinput,d.deviceInfo.initDeviceId.audioinput):
r(a,b,c,d)};!d.isNeedCheckChangeLocalStream||L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)&&L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)?g():f.enumerateDevices(function(a){g()},{isSetlocalStorage:!0})};f.enumerateDevices=function(a,b){function c(c){var d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),h=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),g=
{},k={},m={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},r=L.Utils.getBrowserInfo();r=r&&r.language&&r.language.toLowerCase().match(/zh/g)?"chinese":"english";var p={videoinput:{label:"chinese"===r?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":"video input device ",num:0},audioinput:{label:"chinese"===r?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",num:0},audiooutput:{label:"chinese"===r?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":
"audio output device ",num:0}};c&&c.forEach&&c.forEach(function(a){if(a&&"communications"!=a.groupId&&"communications"!=a.deiceId&&"\u901a\u8baf"!=a.label){var b={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};!b.label&&p[a.kind]&&(b.label=p[a.kind].label+ ++p[a.kind].num);"audioinput"===a.kind&&a.deviceId===d&&(m.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===f&&(m.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===h&&(m.useDevices[a.kind]=a.deviceId);
g[a.kind]=g[a.kind]||a.deviceId;m.devices[a.kind].push(b);m.hasdevice[a.kind]=!0;"default"===a.deviceId&&(k[a.kind]=a.deviceId)}});m.useDevices.audioinput||(m.useDevices.audioinput=k.audioinput||g.audioinput||"");m.useDevices.videoinput||(m.useDevices.videoinput=k.videoinput||g.videoinput||"");m.useDevices.audiooutput||(m.useDevices.audiooutput=k.audiooutput||g.audiooutput||"");L.Utils.localStorage?b.isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,m.useDevices.audioinput),
L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,m.useDevices.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,m.useDevices.audiooutput)):L.Logger.error("[tk-sdk]not support localStorage");L.Logger.info("[tk-sdk]enumerateDevices devicesInfo:",L.Utils.toJsonStringify(m));a&&"function"===typeof a&&a(m)}b=b||{};L.Logger.debug("[tk-sdk]call enumerateDevices!");b.isSetlocalStorage=void 0!=b.isSetlocalStorage?b.isSetlocalStorage:!1;(function(a){var b=[];if(!navigator.mediaDevices||
!navigator.mediaDevices.enumerateDevices)return L.Logger.error("[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),a&&"function"===typeof a&&a(b),null;navigator.mediaDevices.enumerateDevices().then(function(c){var d={};c.forEach(function(a){L.Logger.debug("[tk-sdk]"+a.kind+": "+a.label+" id \x3d "+a.deviceId,a);d[a.kind]=d[a.kind]||{};var c={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};d[a.kind][a.deviceId]=c;b.push(c)});L.Logger.debug("[tk-sdk]enumerateDevices devices:"+
L.Utils.toJsonStringify(d));a&&"function"===typeof a&&a(b)}).catch(function(c){L.Logger.error("[tk-sdk]enumerateDevices error :"+c.name+": "+c.message);a&&"function"===typeof a&&a(b);throw c;})})(function(a){c(a)})};f.getsSoundMeterInstance=function(a,b){if(a)return new function(a){var c=this,d=void 0,f=b&&"object"===typeof b;c.audioContext=a;c.instant=0;c.slow=0;c.clip=0;c.script=c.audioContext.createScriptProcessor(2048,1,1);c.script.onaudioprocess=function(a){if(!f||b&&b.stream){a=a.inputBuffer.getChannelData(0);
var h,g=0,k=0;for(h=0;h<a.length;++h)g+=a[h]*a[h],.99<Math.abs(a[h])&&(k+=1);c.instant=Math.sqrt(g/a.length);c.slow=.95*c.slow+.05*c.instant;c.clip=k/a.length}else c.stop();"function"===typeof d&&(d(null),d=void 0)};c.connectToSource=function(a,b){L.Logger.debug("SoundMeter connecting");try{c.mic=c.audioContext.createMediaStreamSource(a),c.mic.connect(c.script),c.script.connect(c.audioContext.destination),d=b}catch(R){L.Logger.error("[tk-sdk]connecToSource error:",R),"undefined"!==typeof b&&b(R)}};
c.stop=function(){c.mic&&c.mic.disconnect&&c.mic.disconnect();c.script&&c.script.disconnect&&c.script.disconnect()};return c}(a);L.Logger.error("[tk-sdk]getsSoundMeterInstance audioContext is not exist!")};f.setElementSinkIdToAudioouputDevice=function(a,b,c){if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative&&TK.subscribe_from_native)b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),window.tknative.postMessage({command:"setSpeaker",deviceId:b}),
c&&"function"===typeof c&&c(!1);else{var d=0,f=function(a,f,h){if(a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var f=a.getAttribute("id");L.Logger.debug("[tk-sdk]Audio output device set to "+b,f?" , element id is "+f:"  element:",f?"":a);d++;d===h&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var f=void 0,g=a.getAttribute("id");b&&"object"===typeof b&&"SecurityError"===b.name&&(f="You need to use HTTPS for selecting audio output device  ");
L.Logger.info("[tk-sdk]setSinkId error:",b,f?f:"",g?" , element id is "+g:"  element:",g?"":a);d++;d===h&&c&&"function"===typeof c&&c(!1)})}catch(ca){f=a.getAttribute("id"),L.Logger.error("[tk-sdk]setSinkId err:",ca,f?" , element id is "+f:"  element:",f?"":a),d++,d===h&&c&&"function"===typeof c&&c(!1)}else f=a.getAttribute("id"),L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,f?" , element id is "+f:"  element:",f?"":a),d++,d===h&&c&&"function"===
typeof c&&c(!1);else d++,d===h&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var h=document.getElementsByTagName("audio"),g=document.getElementsByTagName("video");if(h&&0<h.length)for(var k=0;k<h.length;k++){var m=h[k];a.push(m)}if(g&&0<g.length)for(k=0;k<g.length;k++)m=g[k],a.push(m)}if(a&&0<a.length)for(h=a.length,k=0;k<a.length;k++)m=a[k],f(m,k,h);else f(a,0,1)}else c&&"function"===typeof c&&c(!1)};f.addDeviceChangeListener=function(a){n=null;n=a};f.removeDeviceChangeListener=function(){n=null};
f.stopStreamTracks=function(a,c,d){b(a,c,d)};f.enabledStreamVideoTrack=function(a,b){if(a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(a=a.getVideoTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};f.enabledStreamAudioTrack=function(a,b){if(a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&(a=a.getAudioTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};f.stopCameraTest=function(){t.stream&&(g(t.stream),f.stopStreamTracks(t.stream),
t.stream=null);t={}};f.startCameraTest=function(b,c,d,h){h=h||{};b?c?(b={video:{sourceId:b},audio:!1},f.stopCameraTest(),f.getUserMedia(function(b){f.stopCameraTest();t.stream=b;a(t.stream,c,void 0,h)},function(a){f.stopCameraTest();L.Utils.isFunction(d)&&d(a);L.Logger.error("[tk-sdk] getUserMedia failed when test camera, failure info:",a)},b)):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid elementId")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid deviceId"))};
f.stopMicrophoneTest=function(){q.stream&&(g(q.stream),f.stopStreamTracks(q.stream),q.stream=null);q._soundMeter&&q._soundMeter.stop&&(q._soundMeter.stop(),q._soundMeter=void 0);clearInterval(q._soundMeterTimer);q._soundMeter=void 0;q._soundMeterTimer=void 0;q={}};f.startMicrophoneTest=function(b,c,d,h){b?c?(f.stopMicrophoneTest(),f.getUserMedia(function(b){q.stream=b;a(q.stream,c);try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext,
TK.audioContext=TK.audioContext||new window.AudioContext,q._soundMeter&&q._soundMeter.stop&&(q._soundMeter.stop(),q._soundMeter=void 0),TK.audioContext&&q.stream&&f&&f.getsSoundMeterInstance&&(q._soundMeter=f.getsSoundMeterInstance(TK.audioContext,q),q._soundMeter&&q._soundMeter.connectToSource&&q._soundMeter.connectToSource(q.stream,function(a){a||(q._soundMeter.instant&&q._soundMeter.instant.toFixed?(a=Math.floor(100*q._soundMeter.instant.toFixed(2)),L.Utils.isFunction(d)&&d(a)):L.Utils.isFunction(d)&&
d(0),clearInterval(q._soundMeterTimer),q._soundMeterTimer=setInterval(function(){if(q._soundMeter.instant&&q._soundMeter.instant.toFixed){var a=Math.floor(100*q._soundMeter.instant.toFixed(2));L.Utils.isFunction(d)&&d(a)}else L.Utils.isFunction(d)&&d(0)},100))}))}catch(U){L.Logger.error("[tk-sdk]startMicrophoneTest error:",U)}},function(a){L.Utils.isFunction(h)&&h(a);L.Logger.error("[tk-sdk] getUserMedia failed when test microphone, failure info:",a)},{audio:{sourceId:b},video:!1})):(L.Utils.isFunction(h)&&
h("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(h)&&h("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid deviceId"))};f.associateElementsToSpeaker=function(a,b,c){f.setElementSinkIdToAudioouputDevice(a,b,c)};f.getDevices=function(a){f.enumerateDevices(a)};f.setDevices=function(a,b){d(f.onDevicesSetted,a,function(a,c){a||0!==c||L.Utils.isFunction(b)&&b()})};navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=null,
navigator.mediaDevices.ondevicechange=k);return f}(TK);window.TK=window.TK||{};
TK.NativeAVMgr=function(){function c(a,c,d,f){c=c||{};var h={},g;for(g in c)L.Constant.deviceStorage[g]&&c[g]!==L.Utils.localStorage.getItem(L.Constant.deviceStorage[g])&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage[g],c[g]),h[g]=!0);h.audiooutput&&b.setElementSinkIdToAudioouputDevice(f);h.videoinput||h.audioinput?b.getUserMedia(function(b){a&&"function"===typeof a&&a(b);d&&"function"===typeof d&&d(b)},function(a){d&&"function"===typeof d&&d(void 0)},void 0,{isDemotionLocalStream:!0,isNeedCheckChangeLocalStream:!1,
isStopLocalStream:!1}):d&&"function"===typeof d&&d(void 0)}function d(a,b,c){c=c||{};a?(a=TK.NativeVideoPlayer({id:"videoinput_stream_player",stream:{stream:void 0},elementID:a,options:c}),"function"===typeof b&&b(a)):L.Logger.error("[tk-sdk]playDeviceStream elementID can not be empty!")}var b={room_video_width:320,room_video_height:240,room_video_fps:10,onMicVolumeReportCallback:void 0,onDevicesSetted:null,onDeviceChanged:null},a={},g={},f=100,t={player:null},q=null;b.setAVMgrProperty=function(a){for(var c in a)b.hasOwnProperty(c)&&
(b[c]=a[c])};window.tknative.addEventListener("message",function(c){if(!L.Utils.isNull(c)&&!L.Utils.isNull(c.data)&&!L.Utils.isNull(c.data.name)){var d=c.data.name;if("onEnumerateDevices"===d){var f=function(){var b=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput),d=L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput),f=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput);L.Logger.debug("devices in enumerateDevices(client):",c.data);var h=c.data.audioinput,
m=c.data.videoinput,r=c.data.audiooutput,p=c.data.seq,n={},q={},t={hasdevice:{audioinput:!1,audiooutput:!1,videoinput:!1},devices:{audioinput:[],audiooutput:[],videoinput:[]},useDevices:{}},B=L.Utils.getBrowserInfo();B=B&&B.language&&B.language.toLowerCase().match(/zh/g)?"chinese":"english";var K={videoinput:{label:"chinese"===B?"\u89c6\u9891\u8f93\u5165\u8bbe\u5907":"video input device ",num:0},audioinput:{label:"chinese"===B?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio input device ",num:0},audiooutput:{label:"chinese"===
B?"\u97f3\u9891\u8f93\u5165\u8bbe\u5907":"audio output device ",num:0}},I=function(a){if(null!=a&&"communications"!=a.groupId&&"communications"!=a.deiceId&&"\u901a\u8baf"!=a.label){var c={kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId};!c.label&&K[a.kind]&&(c.label=K[a.kind].label+ ++K[a.kind].num);"audioinput"===a.kind&&a.deviceId===b&&(t.useDevices[a.kind]=a.deviceId);"videoinput"===a.kind&&a.deviceId===d&&(t.useDevices[a.kind]=a.deviceId);"audiooutput"===a.kind&&a.deviceId===f&&
(t.useDevices[a.kind]=a.deviceId);n[a.kind]=n[a.kind]||a.deviceId;t.devices[a.kind].push(c);t.hasdevice[a.kind]=!0;"default"===a.deviceId&&(q[a.kind]=a.deviceId)}};Array.isArray(h)&&h.forEach(function(a){I(a)});Array.isArray(m)&&m.forEach(function(a){I(a)});Array.isArray(r)&&r.forEach(function(a){I(a)});t.useDevices.audioinput||(t.useDevices.audioinput=q.audioinput||n.audioinput||"");t.useDevices.videoinput||(t.useDevices.videoinput=q.videoinput||n.videoinput||"");t.useDevices.audiooutput||(t.useDevices.audiooutput=
q.audiooutput||n.audiooutput||"");L.Utils.localStorage?g[p].isSetlocalStorage&&(L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,t.useDevices.audioinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,t.useDevices.videoinput),L.Utils.localStorage.setItem(L.Constant.deviceStorage.audiooutput,t.useDevices.audiooutput)):L.Logger.error("not support localStorage");a[p]&&(a[p](t),delete a[p]);g[p]&&delete g[p]};TK.isTkNative&&TK.subscribe_from_native?f():navigator.mediaDevices&&
navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(a){var b=[];a.forEach(function(a){"audiooutput"===a.kind&&b.push({kind:a.kind,label:a.label,deviceId:a.deviceId,groupId:a.groupId})});c.data.audiooutput=b;f()}).catch(function(a){L.Logger.error("[tk-sdk]enumerateDevices error :"+a.name+": "+a.message);c.data.audiooutput=[];f()}):(L.Logger.error("[tk-sdk]navigator.mediaDevices.enumerateDevices method not supported."),c.data.audiooutput=[],f())}if("onMicVolumeReport"===
d){var h=c.data.volume;if(null===h||void 0===h)return;if(a["detecte-mic-callback"]&&"function"===typeof a["detecte-mic-callback"])a["detecte-mic-callback"](h);if(b.onMicVolumeReportCallback&&"function"===typeof b.onMicVolumeReportCallback)b.onMicVolumeReportCallback(h/100,c.data.connectionId)}"onGetSpeakerVolume"===d&&(h=c.data.volume,d=c.data.seq,"function"===typeof a[d]&&(h=Math.round(h/2.55),a[d](h),delete a[d]))}},!1);var n=function(a,c,d,f){var h=function(b){window.tknative.postMessage({command:"setCamera",
deviceId:b.video.deviceId,width:Number(b.video.width),height:Number(b.video.height),fps:Number(b.video.frameRate)});window.tknative.postMessage({command:"setMicrophone",deviceId:b.audio.deviceId});a(null)};d=d||{audio:{},video:{}};if(d.screen)L.Logger.debug("[tk-sdk]Screen access requested!"),a(null);else{var g={video:{},audio:{},screen:d.screen};"object"===typeof d.audio&&(g.audio=d.audio);f=void 0!=f&&null!=f&&"object"===typeof f?f:{video:{},audio:{},exclude:{}};f.video=f.video||{};f.audio=f.audio||
{};var m=d.audio.mandatory||{sourceId:f.audio.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput)||""},r=d.video.mandatory||{sourceId:f.video.sourceId||L.Utils.localStorage.getItem(L.Constant.deviceStorage.videoinput)||"",idealWidth:b.room_video_width||320,maxWidth:b.room_video_width||320,idealHeight:b.room_video_height||240,maxHeight:b.room_video_height||240};g.video.width=r.maxWidth;g.video.height=r.maxHeight;void 0!==d.video.optional?g.video.frameRate=d.video.optional[1].maxFrameRate:
(c={idealFrameRate:Number(b.room_video_fps||10),maxFrameRate:Number(b.room_video_fps||10)},void 0!=c.idealFrameRate&&void 0!=c.maxFrameRate?g.video.frameRate=c.maxFrameRate:void 0!=c.frameRate&&(g.video.frameRate=c.frameRate));r.sourceId&&m.sourceId?(null!==m.sourceId&&void 0!==m.sourceId?g.audio.deviceId=m.sourceId:g.audio=!1,null!==r.sourceId&&void 0!==r.sourceId?g.video.deviceId=r.sourceId:g.video=!1,f.exclude&&f.exclude.video?g.video=!1:f.exclude&&f.exclude.audio&&(g.audio=!1),h(g)):b.enumerateDevices(function(a){var b=
a.useDevices;a=a.hasdevice;null===a.videoinput||void 0===a.videoinput||null===b.videoinput||void 0===b.videoinput||r.sourceId||(r.sourceId=b.videoinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.videoinput,r.sourceId));null===a.audioinput||void 0===a.audioinput||null===b.audioinput||void 0===b.audioinput||m.sourceId||(m.sourceId=b.audioinput,L.Utils.localStorage.setItem(L.Constant.deviceStorage.audioinput,m.sourceId));null!==m.sourceId&&void 0!==m.sourceId?g.audio.deviceId=m.sourceId:g.audio=
!1;null!==r.sourceId&&void 0!==r.sourceId?g.video.deviceId=r.sourceId:g.video=!1;f.exclude&&f.exclude.video?g.video=!1:f.exclude&&f.exclude.audio&&(g.audio=!1);h(g)})}};b.getUserMedia=function(a,b,c,d){n(a,b,c,d)};b.startDetecteMic=function(c,d){b.stopDetectMic();window.tknative.postMessage({command:"startDetecteMic",deviceId:c});a["detecte-mic-callback"]=d};b.stopDetectMic=function(){window.tknative.postMessage({command:"stopDetecteMic"});delete a["detecte-mic-callback"]};b.startDetecteCam=function(a,
c){b.stopDetecteCam();window.tknative.postMessage({command:"startDetecteCam",deviceId:a,args:c})};b.stopDetecteCam=function(){window.tknative.postMessage({command:"stopDetecteCam"})};b.enumerateDevices=function(b,c){L.Logger.debug("[tk-sdk]call enumerateDevices from client!");var d=f++;a[d]=b;b={};b.isSetlocalStorage=void 0===c?!1:void 0!=c.isSetlocalStorage?c.isSetlocalStorage:!1;g[d]=b;window.tknative.postMessage({command:"enumerateDevices",seq:d})};b.setSpeaker=function(a){window.tknative.postMessage({command:"setSpeaker",
deviceId:a})};b.setElementSinkIdToAudioouputDevice=function(a,b,c){if(b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))if(TK.isTkNative&&TK.subscribe_from_native)b=b||L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput),window.tknative.postMessage({command:"setSpeaker",deviceId:b}),c&&"function"===typeof c&&c(!1);else{var d=0,f=function(a,f,h){if(a&&/(audio|video)/g.test(a.nodeName.toLowerCase())&&b)if(a.setSinkId)try{a.setSinkId(b).then(function(){var f=a.getAttribute("id");
L.Logger.debug("[tk-sdk]Audio output device set to "+b,f?" , element id is "+f:"  element:",f?"":a);d++;d===h&&c&&"function"===typeof c&&c(!0)}).catch(function(b){var f=void 0,g=a.getAttribute("id");b&&"SecurityError"===b.name&&(f="You need to use HTTPS for selecting audio output device  ");L.Logger.warning("[tk-sdk]setSinkId error:",b,f?f:"",g?" , element id is "+g:"  element:",g?"":a);d++;d===h&&c&&"function"===typeof c&&c(!1)})}catch(S){f=a.getAttribute("id"),L.Logger.error("[tk-sdk]setSinkId err:",
S,f?" , element id is "+f:"  element:",f?"":a),d++,d===h&&c&&"function"===typeof c&&c(!1)}else f=a.getAttribute("id"),L.Logger.error("[tk-sdk]The browser does not support the setSinkId method,audiooutputDeviceId :",b,f?" , element id is "+f:"  element:",f?"":a),d++,d===h&&c&&"function"===typeof c&&c(!1);else d++,d===h&&c&&"function"===typeof c&&c(!1)};if(!a){a=[];var g=document.getElementsByTagName("audio"),m=document.getElementsByTagName("video");if(g&&0<g.length)for(var r=0;r<g.length;r++){var p=
g[r];a.push(p)}if(m&&0<m.length)for(r=0;r<m.length;r++)p=m[r],a.push(p)}if(a&&0<a.length)for(g=a.length,r=0;r<a.length;r++)p=a[r],f(p,r,g);else f(a,0,1)}else c&&"function"===typeof c&&c(!1)};b.addDeviceChangeListener=function(a){};b.removeDeviceChangeListener=function(){};b.getSpeakerVolume=function(b){if("function"!==typeof b)L.Logger.error("[tk-sdk] wrong arguments in funciton getSpeakerVolume");else{var c=f++;a[c]=b;window.tknative.postMessage({command:"getSpeakerVolume",seq:c})}};b.setSpeakerVolume=
function(a){void 0===a||null===a||0>a||100<a?L.Logger.error("[tk-sdk] invalid arguments in funciton setSpeakerVolume"):(a=Math.round(2.55*a),window.tknative.postMessage({command:"setSpeakerVolume",volume:a}))};b.enabledStreamVideoTrack=function(a,b){if(a&&a.getVideoTracks&&"function"===typeof a.getVideoTracks&&(a=a.getVideoTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};b.enabledStreamAudioTrack=function(a,b){if(a&&a.getAudioTracks&&"function"===typeof a.getAudioTracks&&
(a=a.getAudioTracks())&&0<a.length)for(var c=0;c<a.length;c++)a[c].enabled!==b&&(a[c].enabled=b)};b.associateElementsToSpeaker=function(a,b,c){};b.getDevices=function(a){b.enumerateDevices(a)};b.setDevices=function(a,d){c(b.onDevicesSetted,a,function(a){})};b.stopCameraTest=function(){var a=t.player;a&&a&&a.destroy&&a.destroy();window.tknative.postMessage({command:"stopDetecteCam"});delete t.player;t.player=null};b.startCameraTest=function(a,c,f,h){if(a)if(c){b.stopCameraTest();var g=void 0;d(c,function(a){t.player=
a;g=a.id},h);g?window.tknative.postMessage({command:"startDetecteCam",deviceId:a,args:{elementId:g}}):(L.Utils.isFunction(f)&&f("TK_ERR_INTERNAL_EXCEPTION"),L.Logger.error("startCameraTest occurred internal exception"))}else L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid elementId");else L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error("startCameraTest got invalid deviceId")};b.stopMicrophoneTest=function(){b.stopDetectMic();var a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audioinput);
a&&window.tknative.postMessage({command:"setMicrophone",deviceId:a})};b.startMicrophoneTest=function(a,c,d,f){a?c?(b.stopDetectMic(),b.startDetecteMic(a,d)):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid elementId")):(L.Utils.isFunction(f)&&f("TK_ERR_INVALID_ARG"),L.Logger.error("startMicrophoneTest got invalid deviceId"))};b.stopSpeakerTest=function(){if(q){var a={};a.audioUrl=q;window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"stop",
options:a});q=null}(a=L.Utils.localStorage.getItem(L.Constant.deviceStorage.audiooutput))&&b.setSpeaker(a)};b.startSpeakerTest=function(a,c,d){a?c?(b.stopSpeakerTest(),b.setSpeaker(a),a={},a.audioUrl=c,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:"play",options:a}),q=c):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startSpeakerTest got invalid audioUrl")):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.error("startSpeakerTest got invalid deviceId"))};
return b};var TK=TK||{};
TK.NativeProxy=function(){function c(a,b,c){TK.isTkNative?void 0===a||null===a?("function"===typeof c&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] getShareScreenProfile function got wrong arguments")):(c=d(),TK.waitNativeToCallbackList[c]=b,window.tknative.postMessage({command:"getShareScreenProfile",args:a,seq:c})):("function"===typeof c&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk]getShareScreenProfile method must be in the client environment!"))}function d(){if(void 0===TK.nativeCallSeq||
"number"!==typeof TK.nativeCallSeq)TK.nativeCallSeq=0;return++TK.nativeCallSeq}function b(a){if(!L.Utils.isNull(a)&&!L.Utils.isNull(a.data)&&!L.Utils.isNull(a.data.name))switch(a.data.name){case "onValidWindowList":var b=a.data.seq;if(void 0===b)break;if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](a.data.validWindows);delete TK.waitNativeToCallbackList[b];break;case "onLog":b=a.data.level;a=a.data.log;0===b&&L.Logger.debug(a);1===b&&L.Logger.info(a);2===
b&&L.Logger.warning(a);3===b&&L.Logger.error(a);break;case "onMonitorCount":var c=a.data.count;b=a.data.seq;if(void 0===b)break;if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](c);delete TK.waitNativeToCallbackList[b];break;case "onTakSnapshot":b=a.data.action;c=a.data.requestId;var d=a.data.total,g=a.data.now,m=a.data.code;if("function"!==typeof TK.waitNativeToCallbackList[c])break;a=L.Utils.toJsonParse(a.data.result);TK.waitNativeToCallbackList[c](b,c,d,
g,m,a);"result"===b&&delete TK.waitNativeToCallbackList[c];break;case "onGetMediaPlayPos":c=a.data.arg;c.duration=parseInt(1E3*c.duration);1<c.pos&&(c.pos=1);c.position=parseInt(c.pos*c.duration);c.position>c.duration&&(c.position=c.duration);b=a.data.seq;if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](c);break;case "onNativeNotification":if(L.Utils.isFunction(f.onNativeNotification))f.onNativeNotification(a.data.arg);break;case "onMicVolumeReport":if(L.Utils.isFunction(f.onMicVolumeReport))f.onMicVolumeReport(a.data);
break;case "onGetMediaFileInfo":c=a.data.arg;b=a.data.seq;c.duration&&(c.duration*=1E3);if("function"!==typeof TK.waitNativeToCallbackList[b])break;TK.waitNativeToCallbackList[b](c);delete TK.waitNativeToCallbackList[b];break;case "onLocalRecord":case "onGetOpenOrSaveFileName":case "onBrowseForFolder":case "onGetRecordingPath":case "onStartupFileTransmitter":case "getShareScreenProfile":c=a.data.arg,b=a.data.seq,"function"===typeof TK.waitNativeToCallbackList[b]&&(TK.waitNativeToCallbackList[b](c),
delete TK.waitNativeToCallbackList[b])}}function a(a,b,c){TK.isTkNative?L.Utils.isNull(a)?(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getMediaFileInfo method got invalid fileName!")):(c=d(),TK.waitNativeToCallbackList[c]=b,window.tknative.postMessage({command:"getMediaFileInfo",seq:c,file:a})):(L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] getMediaFileInfo method must be called in the native environment!"))}function g(a,b,c){TK.isTkNative?
void 0===a||null===a||"function"!==typeof b?(L.Logger.error("[tk-sdk] getValidWindowList function got wrong arguments"),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")):(c=d(),TK.waitNativeToCallbackList[c]=b,window.tknative.postMessage({command:"getValidWindowList",type:Number(a),seq:c})):(L.Logger.warning("[tk-sdk]getValidWindowList method must be in the client environment!"),L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"))}var f=TK.EventDispatcher({}),t=void 0,q=0,n=void 0,p=void 0;f.onNativeStartShareMediaFile=
null;f.onNativeStopShareMediaFile=null;f.onNativeStartShareScreen=null;f.onNativeStopShareScreen=null;f.onNativeNotification=null;f.onMicVolumeReport=null;f.onSeekMediaFile=null;f.initialize=function(){window.tknative.addEventListener("message",b,!1)};f.createShareScreenWindow=function(a,b,c,d,f,n,p,q){TK.isTkNative?g(0,function(h){if((h=h[0])&&"object"===typeof h){h=h.id;var g=c,k=d,m=a,r=b,t=f,v=n,y=0,A=q;TK.isTkNative?(h=Number(h||0),g=Number(g||0),k=Number(k||0),m=Number(m||0),r=Number(r||0),
y=Number(y||0),window.tknative.postMessage({command:"updateWindowSource",id:Number(h),left:Number(g),top:Number(k),width:Number(m),height:Number(r),mixMic:t||!1,mixSpk:v||!1,type:Number(y),catchcursor:A||!1})):L.Logger.warning("[tk-sdk] updateWindowSource method must be in the client environment!")}else L.Logger.error("[tk-sdk]createShareScreenWindow:getValidWindowList is not data!"),L.Utils.isFunction(p)&&p("TK_ERR_NOT_DATA")},p):(L.Logger.error("[tk-sdk]createShareScreenWindow method must be in the client environment!"),
L.Utils.isFunction(p)&&p("TK_ERR_NOT_INITIALIZED"))};f.destroyShareScreenWindow=function(){f.createShareScreenWindow(0,0,0,0)};f.startShareScreen=function(a){if(TK.isTkNative)if(TK.isOnlyAudioRoom)L.Logger.warning("[tk-sdk]only audio room not execute method startShareScreen method !"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_SUPPORT");else{var b={},d={audio:!0,video:!0,attributes:b};if(TK.isTkNative&&2018061500<=TK.clientversion)g(0,function(h){if((h=h[0])&&"object"===typeof h)c(h,function(c){c&&"object"===
typeof c&&(b.videowidth=c.width,b.videoheight=c.height,b.videofps=c.fps);if(L.Utils.isFunction(f.onNativeStartShareScreen))f.onNativeStartShareScreen(d,a)},function(b){L.Logger.warning("[tk-sdk]startShareScreen:getShareScreenProfile is failure , failure info:"+b+"!");if(L.Utils.isFunction(f.onNativeStartShareScreen))f.onNativeStartShareScreen(d,a)});else if(L.Logger.warning("[tk-sdk]startShareScreen:getValidWindowList is not data!"),L.Utils.isFunction(f.onNativeStartShareScreen))f.onNativeStartShareScreen(d,
a)},function(b){L.Logger.error("[tk-sdk]startShareScreen:getValidWindowList error info:"+b);if(L.Utils.isFunction(f.onNativeStartShareScreen))f.onNativeStartShareScreen(d,a)});else if(L.Utils.isFunction(f.onNativeStartShareScreen))f.onNativeStartShareScreen(d,a)}else L.Logger.error("[tk-sdk]startShareScreen method must be in the client environment!"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED")};f.stopShareScreen=function(a){if(TK.isTkNative){if(L.Utils.isFunction(f.onNativeStopShareMediaFile))f.onNativeStopShareScreen(a);
f.destroyShareScreenWindow()}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopShareScreen method must be called in the native environment!")};f.startShareMediaFile=function(b,c,d,g){g=g||{};TK.isTkNative?L.Utils.isNull(b)?(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startShareMediaFile method got invalid fileName!")):g&&g.IgnoreElementId||!L.Utils.isNull(c)?a(b,function(a){var h=a.duration,k=a.width,m=a.height,r=a.video,n=a.audio;
if(a.video||a.audio)if(TK.isOnlyAudioRoom&&a.video)L.Logger.error("[tk-sdk]only audio room not execute method startShareMediaFile to video media !"),L.Utils.isFunction(d)&&d("TK_ERR_NOT_SUPPORT");else{h={width:k,height:m,duration:h,filename:L.Utils.getFileName(b)};TK.isTkNative&&2018061500<=TK.clientversion&&(h.videowidth=k,h.videoheight=m,h.videofps=a.fps);void 0!==g.toID&&(h.toID=g.toID);if(g.attrs&&"object"===typeof g.attrs)for(var p in g.attrs)"toID"!==p&&"type"!==p&&(h[p]=g.attrs[p]);a={video:r,
audio:n,attributes:h,path:b,scale:g.scale};if(L.Utils.isFunction(f.onNativeStartShareMediaFile))f.onNativeStartShareMediaFile(a,c,d,g);q=1}else L.Utils.isFunction(d)&&d("TK_ERR_INVALID_FIEL"),L.Logger.error("[tk-sdk] startShareMediaFile method got invalid file!")},d):(L.Utils.isFunction(d)&&d("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startShareMediaFile method got invalid elementId!")):(L.Utils.isFunction(d)&&d("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startShareMediaFile method must be called in the native environment!"))};
f.stopShareMediaFile=function(a){if(TK.isTkNative){if(L.Utils.isFunction(f.onNativeStopShareMediaFile))f.onNativeStopShareMediaFile(a);q=0}else L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopShareMediaFile method must be called in the native environment!")};f.pauseShareMediaFile=function(a,b,c){if(TK.isTkNative)if(L.Utils.isBoolean(a))if(0===q)L.Utils.isFunction(c)&&c("TK_ERR_NOT_OPEN_MEDIA_FILE"),L.Logger.warning("[tk-sdk] pauseShareMediaFile:The local media file is not open!");
else{if(a&&2!==q||!a&&1!==q)if(window.tknative.postMessage({command:"pauseMediaFile",pause:a}),q=a?2:1,L.Utils.isFunction(f.onPauseMediaFile))f.onPauseMediaFile(a);L.Utils.isFunction(b)&&b(!0===a?"Paused":"Sharing")}else L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] pauseShareMediaFile function got wrong arguments");else L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseShareMediaFile method must be called in the native environment!")};f.getMediaFileProgress=
function(a,b){TK.isTkNative?L.Utils.isFunction(a)?0===q?(L.Utils.isFunction(b)&&b("TK_ERR_NOT_OPEN_MEDIA_FILE"),L.Logger.warning("[tk-sdk] getMediaFileProgress:The local media file is not open!")):(L.Utils.isNull(p)&&(p=d()),TK.waitNativeToCallbackList[p]=a,window.tknative.postMessage({command:"getMediaPlayPos",seq:p})):(L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] getMediaFileProgress function got wrong arguments")):(L.Utils.isFunction(b)&&b("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] getMediaFileProgress method must be called in the native environment!"))};
f.registerMediaFileProgressListener=function(a,b,c){TK.isTkNative?L.Utils.isNull(a)||0>=a||!L.Utils.isFunction(b)?(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] registerMediaFileProgressListener function got wrong arguments")):(f.unregisterMediaFileProgressListener(),1E3>a&&(a=1E3),L.Utils.isNull(n)&&(n=d()),TK.waitNativeToCallbackList[n]=b,1===q&&window.tknative.postMessage({command:"getMediaPlayPos",seq:n}),t=setInterval(function(){1===q&&window.tknative.postMessage({command:"getMediaPlayPos",
seq:n})},a)):(L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] registerMediaFileProgressListener method must be called in the native environment!"))};f.unregisterMediaFileProgressListener=function(a){TK.isTkNative?(L.Utils.isNull(t)||(clearInterval(t),t=void 0),L.Utils.isNull(n)||(delete TK.waitNativeToCallbackList[n],n=void 0)):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] unregisterMediaFileProgressListener method must be called in the native environment!"))};
f.seekMediaFile=function(a,b){if(TK.isTkNative)if(L.Utils.isNumber(a))if(0===q)L.Utils.isFunction(b)&&b("TK_ERR_NOT_OPEN_MEDIA_FILE"),L.Logger.warning("[tk-sdk] seekMediaFile:The local media file is not open!");else{if(0>a&&(a=0),1<a&&(a=1),window.tknative.postMessage({command:"seekMediaFile",pos:a}),L.Utils.isFunction(f.onSeekMediaFile))f.onSeekMediaFile(a)}else L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG"),L.Logger.error("[tk-sdk] seekShareMediaFile function got wrong arguments");else L.Utils.isFunction(b)&&
b("TK_ERR_NOT_INITIALIZED"),L.Logger.error("[tk-sdk] seekMediaFile method must be called in the native environment!")};f.getShareableApplicationsList=function(a,b){TK.isTkNative?"function"!==typeof a?(L.Logger.error("[tk-sdk] getShareableApplicationsList function got wrong arguments"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG")):g(1,a,b):(L.Logger.warning("[tk-sdk]getShareableApplicationsList method must be in the client environment!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_INITIALIZED"))};f.startShareApplications=
function(){};f.stopShareApplications=function(){};f.getMonitorCount=function(a,b){TK.isTkNative?"function"!==typeof a?(L.Logger.error("[tk-sdk] getMonitorCount function got wrong arguments"),L.Utils.isFunction(b)&&b("TK_ERR_INVALID_ARG")):(b=d(),TK.waitNativeToCallbackList[b]=a,window.tknative.postMessage({command:"getMonitorCount",seq:b})):(L.Logger.warning("[tk-sdk]getMonitorCount method must be in the client environment!"),L.Utils.isFunction(b)&&b("TK_ERR_NOT_INITIALIZED"))};f.enableViceMonitor=
function(a){TK.isTkNative?(TK.subscribe_from_native=!0,window.tknative.postMessage({command:"enableViceMonitor"})):(L.Logger.warning("[tk-sdk]enableViceMonitor method must be in the client environment!"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"))};f.switchMainViceMonitor=function(a){TK.isTkNative?window.tknative.postMessage({command:"exchangeClientPosition"}):(L.Logger.warning("[tk-sdk]changeMainViceMonitor method must be in the client environment!"),L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"))};
f.nativeUploadFile=function(a,b,c,f){TK.isTkNative?"object"!==typeof c||"string"!==typeof a||"string"!==typeof b||""===a||""===b?(L.Logger.error("[tk-sdk] nativeUploadFile function got wrong arguments"),"function"===typeof f&&f("TK_ERR_INVALID_ARG")):(f=d(),window.tknative.postMessage({command:"uploadFile",seq:f,uri:a,filename:b,params:c})):(L.Logger.warning("[tk-sdk]nativeUploadFile method must be in the client environment!"),"function"===typeof f&&f("TK_ERR_NOT_INITIALIZED"))};f.nativeDownloadFile=
function(a,b,c){TK.isTkNative?"string"!==typeof a||"string"!==typeof b||""===a||""===b?(L.Logger.error("[tk-sdk] nativeDownloadFile function got wrong arguments"),"function"===typeof c&&c("TK_ERR_INVALID_ARG")):(c=d(),window.tknative.postMessage({command:"downloadFile",seq:c,uri:a,filename:b})):(L.Logger.warning("[tk-sdk]nativeDownloadFile method must be in the client environment!"),"function"===typeof c&&c("TK_ERR_NOT_INITIALIZED"))};f.screenCaptureUpload=function(a,b,c,f){TK.isTkNative?a&&"function"===
typeof b?(c=c||!1,f=d(),TK.waitNativeToCallbackList[f]=b,window.tknative.postMessage({command:"takeSnapshot",needMin:c,fileName:a,requestId:f})):(L.Logger.error("[tk-sdk] screenCaptureUpload function got wrong arguments"),"function"===typeof f&&f("TK_ERR_INVALID_ARG")):("function"===typeof f&&f("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk]screenCaptureUpload method must be in the client environment!"))};f.browseForLocalFolder=function(a,b,c){TK.isTkNative?"object"!==typeof a||"function"!==
typeof b?(L.Logger.error("[tk-sdk] browseForLocalFolder function got wrong arguments ,param must is json , onSuccess must is function! "),L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG")):(c=d(),TK.waitNativeToCallbackList[c]=b,window.tknative.postMessage({command:"browseForFolder",args:a,seq:c})):(L.Logger.warning("[tk-sdk]browseForLocalFolder method must be in the client environment!"),"function"===typeof c&&c("TK_ERR_NOT_INITIALIZED"))};f.startRecordScreen=function(a,b,c){if(TK.isTkNative)if(L.Utils.isNull(a)||
L.Utils.isNull(a.filename))L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startRecordScreen function got wrong arguments");else{var f={type:1,fileName:a.filename,forcepath:!0},h;for(h in a)"type"!==h&&"filename"!==h&&(f[h]=a[h]);a=d();TK.waitNativeToCallbackList[a]=function(a){"Recording"===a.action?L.Utils.isFunction(b)&&b({action:a.action,filename:a.filepath}):L.Utils.isFunction(c)&&c("record screen failed")};window.tknative.postMessage({command:"startLocalRecord",args:f,
seq:a})}else L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startRecordScreen method must be called in the native environment!")};f.pauseRecordScreen=function(a,b,c){TK.isTkNative?L.Utils.isNull(a)?(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] pauseRecordScreen function got wrong arguments")):(a={type:1,pause:a},c=d(),TK.waitNativeToCallbackList[c]=function(a){L.Utils.isFunction(b)&&b({action:a.action})},window.tknative.postMessage({command:"pauseLocalRecord",
args:a,seq:c})):(L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseRecordScreen method must be called in the native environment!"))};f.stopRecordScreen=function(a){TK.isTkNative?window.tknative.postMessage({command:"stopLocalRecord",args:{type:1}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopRecordScreen method must be called in the native environment!"))};f.startRecordAudio=function(a,b,c){if(TK.isTkNative)if(L.Utils.isNull(a)||
L.Utils.isNull(a.filename))L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] startRecordAudio function got wrong arguments");else{var f={type:0,fileName:a.filename,forcepath:!0},h;for(h in a)"type"!==h&&"filename"!==h&&(f[h]=a[h]);a=d();TK.waitNativeToCallbackList[a]=function(a){"Recording"===a.action?L.Utils.isFunction(b)&&b({action:a.action,filename:a.filepath}):L.Utils.isFunction(c)&&c("record screen failed")};window.tknative.postMessage({command:"startLocalRecord",args:f,
seq:a})}else L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] startRecordAudio method must be called in the native environment!")};f.pauseRecordAudio=function(a,b,c){TK.isTkNative?L.Utils.isNull(a)?(L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] pauseRecordAudio function got wrong arguments")):(a={type:0,pause:a},c=d(),TK.waitNativeToCallbackList[c]=function(a){L.Utils.isFunction(b)&&b({action:a.action})},window.tknative.postMessage({command:"pauseLocalRecord",
args:a,seq:c})):(L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] pauseRecordAudio method must be called in the native environment!"))};f.stopRecordAudio=function(a){TK.isTkNative?window.tknative.postMessage({command:"stopLocalRecord",args:{type:0}}):(L.Utils.isFunction(a)&&a("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] stopRecordAudio method must be called in the native environment!"))};f.getOpenFileName=function(a,b,c){if(TK.isTkNative)if(L.Utils.isNull(a)||
L.Utils.isNull(a.caption)||L.Utils.isNull(a.filter))L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getOpenFileName function got wrong arguments");else{var f=d();TK.waitNativeToCallbackList[f]=function(a){"Activated"===a.action?L.Utils.isFunction(c)&&(c("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning("[tk-sdk] getOpenFileName in progress")):L.Utils.isFunction(b)&&b(a)};window.tknative.postMessage({command:"getOpenFileName",args:a,seq:f})}else L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),
L.Logger.warning("[tk-sdk] getOpenFileName method must be called in the native environment!")};f.getSaveFileName=function(a,b,c){if(TK.isTkNative)if(L.Utils.isNull(a)||L.Utils.isNull(a.caption)||L.Utils.isNull(a.filter))L.Utils.isFunction(c)&&c("TK_ERR_INVALID_ARG"),L.Logger.warning("[tk-sdk] getSaveFileName function got wrong arguments");else{var f=d();TK.waitNativeToCallbackList[f]=function(a){"Activated"===a.action?L.Utils.isFunction(c)&&(c("TK_ERR_OPERATION_IN_PROGRESS"),L.Logger.warning("[tk-sdk] getSaveFileName in progress")):
L.Utils.isFunction(b)&&b(a)};window.tknative.postMessage({command:"getSaveFileName",args:a,seq:f})}else L.Utils.isFunction(c)&&c("TK_ERR_NOT_INITIALIZED"),L.Logger.warning("[tk-sdk] getSaveFileName method must be called in the native environment!")};f.listenCloseEvent=function(){if(TK.isTkNative)try{talk_window&&talk_window.listenCloseEvent?talk_window.listenCloseEvent():L.Logger.error("[tk-sdk]talk_window.listenCloseEvent is not exist!")}catch(m){L.Logger.error("[tk-sdk] listenCloseEvent function can not be called")}else L.Logger.warning("[tk-sdk]listenCloseEvent method must be in the client environment!")};
f.shutdownNativeClient=function(){TK.isTkNative?window.tknative.postMessage({command:"shutdownNativeClient"}):L.Logger.warning("[tk-sdk]shutdownNativeClient method must be in the client environment!")};f.closeWindow=function(){try{talk_window&&talk_window.closeWindow?talk_window.closeWindow():L.Logger.error("[tk-sdk]talk_window.closeWindow is not exist!")}catch(m){L.Logger.error("[tk-sdk] closeWindow function can not be called")}};f.clientAudioMediaPlayer=function(a,b,c){TK.isTkNative?2018031E3>TK.clientversion?
L.Logger.warning("[tk-sdk]Current version client is not support clientAudioMediaPlayer method ,please update the latest client !"):(c=c||{},b?(L.Logger.info("[tk-sdk]clientAudioMediaPlayer url is "+a+" , action is "+b+" , options is"+L.Utils.toJsonStringify(c)),c.audioUrl=a,window.tknative.postMessage({command:"clientAudioMediaPlayer",action:b,options:c})):L.Logger.error("[tk-sdk]clientAudioMediaPlayer action is not exist!")):L.Logger.warning("[tk-sdk]clientAudioMediaPlayer method must be in the client environment!")};
f.clientPreloadMediaFile=function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientPreloadMediaFile method ,please update the latest client !"):Array.isArray(a)?a&&0<a.length&&window.tknative.postMessage({command:"clientPreloadMediaFile",urlArray:a}):L.Logger.error("[tk-sdk]clientPreloadMediaFile args must is array!"):L.Logger.warning("[tk-sdk]clientPreloadMediaFile method must be in the client environment!")};f.clientOpenBrowserUrl=
function(a){TK.isTkNative?2018031E3>TK.clientversion?L.Logger.warning("[tk-sdk]Current version client is not support clientOpenBrowserUrl method ,please update the latest client !"):a?window.tknative.postMessage({command:"clientOpenBrowserUrl",url:a}):L.Logger.error("[tk-sdk]clientOpenBrowserUrl url is not exist!"):L.Logger.warning("[tk-sdk]clientOpenBrowserUrl method must be in the client environment!")};f.getRecordingPath=function(a,b){TK.isTkNative?("function"!==typeof a&&L.Utils.isFunction(b)&&
b("TK_ERR_INVALID_ARG"),b=d(),TK.waitNativeToCallbackList[b]=a,window.tknative.postMessage({command:"getRecordingPath",seq:b})):(L.Logger.error("[tk-sdk] getRecordingPath method must be called in the native environment!"),"function"===typeof b&&b("TK_ERR_NOT_INITIALIZED"))};f.setRecordingPath=function(a,b){TK.isTkNative?"object"!==typeof a?(L.Logger.error("[tk-sdk] setRecordingPath function got wrong arguments!"),"function"===typeof b&&b("TK_ERR_INVALID_ARG")):window.tknative.postMessage({command:"setRecordingPath",
args:a}):(L.Logger.error("[tk-sdk] setRecordingPath method must be called in the native environment!"),"function"===typeof b&&b("TK_ERR_NOT_INITIALIZED"))};f.startupFileTransmitter=function(a,b,c){TK.isTkNative?"object"!==typeof a||"function"!==typeof b?(L.Logger.error("[tk-sdk] startupFileTransmitter function got wrong arguments!"),"function"===typeof c&&c("TK_ERR_INVALID_ARG")):(c=d(),TK.waitNativeToCallbackList[c]=b,window.tknative.postMessage({command:"startupFileTransmitter",args:a,seq:c})):
(L.Logger.error("[tk-sdk] startupFileTransmitter method must be called in the native environment!"),"function"===typeof c&&c("TK_ERR_NOT_INITIALIZED"))};f.initBroadcast=function(a,b,c,d,f){TK.isTkNative?a?(b||(b=10),c||(c=3),d&&f?window.tknative.postMessage({command:"initBroadcast",url:a.toString(),fps:Number(b),key_sec:Number(c),width:Number(d),height:Number(f)}):L.Logger.error("[tk-sdk]argument width or height of initBroadcast function not exist!")):L.Logger.error("[tk-sdk]argument url of initBroadcast function not exist!"):
L.Logger.warning("[tk-sdk]initBroadcast method must be in the client environment!")};f.updateBroadcast=function(a,b,c,d){a||(a=10);b||(b=3);c&&d?window.tknative.postMessage({command:"updateBroadcast",fps:Number(a),key_sec:Number(b),width:Number(c),height:Number(d)}):L.Logger.error("[tk-sdk]argument width or height of updateBroadcast function not exist!")};f.uninitBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"uninitBroadcast"}):L.Logger.warning("[tk-sdk]uninitBroadcast method must be in the client environment!")};
f.startBroadcast=function(a){TK.isTkNative?a?window.tknative.postMessage({command:"startBroadcast",streamId:a}):L.Logger.error("[tk-sdk]argument extensionId of startBroadcast function not exist!"):L.Logger.warning("[tk-sdk]startBroadcast method must be in the client environment!")};f.stopBroadcast=function(){TK.isTkNative?window.tknative.postMessage({command:"stopBroadcast"}):L.Logger.warning("[tk-sdk]stopBroadcast method must be in the client environment!")};return f}(TK);
